# 推荐能力介绍与接入

## 文档概述

本文档全面介绍稿定平台的推荐能力体系，包括推荐系统的整体架构、核心流程、各阶段策略以及在不同业务场景下的应用。通过本文档，您可以：

- 了解推荐系统的完整技术架构
- 理解推荐流程的各个阶段及其作用
- 掌握不同业务场景下的推荐策略配置
- 快速接入和配置推荐能力

---

## 1. 推荐能力框架图

![推荐能力框架图](./attachments/推荐能力框架.png)

> **说明**：上图展示了推荐系统的整体架构，包括从内容过滤、召回、融合、精排到重排的完整流程。

---

## 2. 推荐能力详细介绍

推荐系统采用经典的**召回-排序**架构，通过多阶段处理，从海量内容中筛选出最符合用户需求的内容。整个流程可以分为以下几个核心阶段：

### 2.1 过滤阶段

在推荐流程的最前端，过滤阶段负责剔除不符合要求的内容，确保推荐结果的质量和合规性。

| 过滤类型 | 说明 | 详细文档 |
|---------|------|---------|
| **政治敏感过滤** | 过滤涉及政治敏感内容 | [政治敏感过滤] |
| **曝光过滤** | 过滤已曝光内容，避免重复推荐 | - |
| **过气热点过滤** | 离线过滤过时的热点内容 | 离线过气热点过滤 |

**过滤阶段的作用**：
- 保障内容合规性，避免推荐不当内容
- 提升用户体验，减少重复和过时内容
- 优化系统性能，减少后续处理的数据量

---

### 2.2 召回阶段

召回阶段是推荐系统的核心环节，负责从海量内容库中快速筛选出与用户相关的候选内容。我们采用**多路召回**策略，通过不同的召回方式覆盖用户的各种需求场景。

#### 2.2.1 基于热度的召回

| 召回类型 | 说明 | 详细文档 |
|---------|------|---------|
| **热度召回** | 基于内容热度进行召回，适合新用户或冷启动场景 | [2.1.0 热度召回](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=176929106) |

#### 2.2.2 基于实时行为的召回

实时行为召回能够捕捉用户最新的兴趣变化，提供更精准的推荐。

| 召回类型 | 说明 | 详细文档 |
|---------|------|---------|
| **实时点击召回** | 基于用户实时点击行为进行召回 | [2.1.7.2 实时点击模板召回](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=168645749) |
| **实时搜索召回** | 基于用户实时搜索行为进行召回 | [2.1.7.5 实时queryi2i](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=168645777) |

#### 2.2.3 基于历史行为的召回

历史行为召回通过分析用户的长期兴趣，提供个性化的推荐结果。

| 召回类型 | 说明 | 详细文档 |
|---------|------|---------|
| **历史行为相似召回** | 基于用户历史行为模式的相似内容召回 | [2.1.7.0 离线i2i召回](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=185228465) |
| **历史点击相似召回** | 基于用户历史点击内容的相似召回 | [2.1.7.1 离线clicki2i](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=151726658) |
| **历史收藏相似召回** | 基于用户收藏内容的相似召回 | [2.1.7.4 离线收藏i2i](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=168645667) |
| **历史下载相似召回** | 基于用户下载内容的相似召回 | [2.1.7.3 离线downloadi2i](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=168645697) |

#### 2.2.4 基于深度学习的召回

深度学习模型能够学习用户和内容的深层特征，提供更精准的推荐。

| 召回类型 | 说明 | 详细文档 |
|---------|------|---------|
| **DAC召回** | Deep Attention Cross 模型，支持个性化推荐和冷启动 | [2.1.5.1 Web模板中心DAC召回模型](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=123766180) |
| **DSSM召回** | Deep Structured Semantic Model，学习用户和内容的语义表示 | [2.1.4.2 稿定Web DSSM召回](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=151726650)<br>[2.1.4.1 稿定App-DSSM](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=160280496) |
| **相似召回** | 基于item2vec的模板/素材相似召回 | [2.1.7.6 item2vec模板/素材相似召回](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=151726642) |

**DAC召回特殊说明**：
- 除了个性化推荐外，还通过该模型训练用户冷启动的数据
- 使用 `userid=0` 的用户训练DAC模型，得到 `dac_common`，这是冷启动用户的推荐结果

#### 2.2.5 其他召回策略

| 召回类型 | 说明 | 详细文档 |
|---------|------|---------|
| **人群标签召回** | 基于用户人群标签进行召回 | [2.1.9 人群标签召回](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=185228365) |
| **SEM召回** | 搜索引擎营销相关的召回策略 | [2.1.10 sem召回](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=185228367) |

**个性化召回限制**：
- 个性化召回仅召回优质内容池的内容，确保推荐质量

---

### 2.3 融合阶段

融合阶段将多路召回的结果进行合并，通过统一的评分机制对候选内容进行初步排序。

**融合策略**：[融合策略]

**内容优质分计算**：
```
内容优质分 = 内容是否优质 + 热度分
```

**评分规则**：
- **内容是否优质**：内容在优质内容池内，分值为100；否则分值为0
- **热度分**：基于内容的热度指标计算

**融合阶段的作用**：
- 统一多路召回结果的评分标准
- 初步筛选和排序候选内容
- 为后续精排阶段提供高质量的候选集

---

### 2.4 精排阶段

精排阶段使用复杂的机器学习模型，对融合后的候选内容进行精细化排序，预测用户对每个内容的点击、下载等行为概率。

| 模型类型 | 说明 | 详细文档 |
|---------|------|---------|
| **CTR精排模型** | 点击率预估模型，用于模板中心推荐 | [20221027-WEB模板中心CTR精排-V3](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=263063436) |
| **相似推荐精排模型** | 用于编辑器相似推荐场景 | [web编辑器相似推荐精排模型](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=176932064) |

**精排阶段的作用**：
- 通过机器学习模型预测用户行为
- 对候选内容进行精细化排序
- 提升推荐的准确性和相关性

---

### 2.5 重排阶段

重排阶段在精排结果的基础上，应用业务规则和策略，进一步优化推荐结果的展示效果。

#### 2.5.1 内容质量优化

| 策略 | 说明 | 详细文档 |
|------|------|---------|
| **过气热点打压** | 对过时热点内容进行降权 | [过气热点打压] |
| **实时曝光打压** | 对近期已曝光内容进行降权，避免重复推荐 | [20240126 双端曝光打压逻辑优化（优化为取最近14天数据）（需ab）](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=20240126)<br>[20231213-排序结果干预后台支持配置曝光打压](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=20231213) |

#### 2.5.2 业务规则应用

| 策略 | 说明 | 详细文档 |
|------|------|---------|
| **付费模板置顶** | 针对注册超过30天的非会员，仅查看付费内容和公益内容 | [付费模板置顶] |
| **运营人工干预** | 支持运营人员对排序结果进行人工调整 | [排序结果干预_操作指引] |

#### 2.5.3 多样性保障

| 策略 | 说明 | 详细文档 |
|------|------|---------|
| **比例混排** | 按照设定的比例混合不同召回路径的结果 | [流量池后台_操作指引] |
| **多样性打散** | 确保推荐结果的多样性，避免内容过于相似 | - |

**比例混排详细说明**：
- 设置好混排比例后，根据混排比例取完后按照CTR得分排序
- **混排规则**：20个一桶，比如比例设置10%，那么每20个里，有 `20 × 10% = 2` 个这一路的召回
- **补足机制**：不足比例的，用base补足

**重排阶段的作用**：
- 应用业务规则，满足业务需求
- 保障推荐结果的多样性和新鲜度
- 支持运营人员进行灵活调整

---

## 3. 各业务场景推荐策略

不同业务场景对推荐策略有不同的需求，本节详细介绍各业务场景下的推荐策略配置。

### 3.1 稿定-Web端

#### 3.1.1 模板中心/场景页模板中心/营销日历/首页-瀑布流-推荐分类内容

**应用场景**：模板中心、场景页、营销日历、首页等核心页面的瀑布流推荐

**详细文档**：[模板中心/场景页模板中心/营销日历]/首页瀑布流推荐分类/首页内容专栏推荐

**专栏顺序推荐逻辑**：
- 取轻舟人群标签配置顺序逻辑
- 子tab取筛选器热度排

**相关优化**：[20231023-WEB推荐页内容分发维度路径优化](https://doc.huanleguang.com/wiki/pages/viewpage.action?pageId=333263465)

#### 3.1.2 最新/最热专栏

**应用场景**：展示最新和最热门的内容专栏

**详细文档**：[新品\热门专栏推荐]

#### 3.1.3 编辑器左侧栏-模板tab/找相似弹窗/模板详情页相似推荐

**应用场景**：编辑器内模板推荐、找相似功能、模板详情页相似推荐

**详细文档**：待补充

#### 3.1.4 编辑器左侧栏-素材

**应用场景**：编辑器内素材推荐

**详细文档**：[编辑器左侧栏模板推荐素材]

#### 3.1.5 编辑器左侧栏-素材相似素材推荐

**应用场景**：编辑器内相似素材推荐

**详细文档**：[素材相似推荐]

---

### 3.2 稿定-App端

#### 3.2.1 创作页瀑布流/模板页瀑布流

**应用场景**：App端创作页和模板页的瀑布流推荐

**详细文档**：[创作页瀑布流/模板页瀑布流/场景页瀑布流/营销日历]

#### 3.2.2 最新/最热专栏

**应用场景**：App端最新和最热门专栏（逻辑同Web端）

**详细文档**：[新品\热门专栏推荐]

#### 3.2.3 模板详情页/图片模板编辑器-换模板

**应用场景**：模板详情页和编辑器内的换模板功能

**详细文档**：
- [模板详情页]
- [编辑器内换模板]

#### 3.2.4 图片标记编辑器-换模板

**应用场景**：图片标记编辑器内的换模板功能

**详细文档**：待补充

#### 3.2.5 编辑器左侧栏-素材为你推荐

**应用场景**：编辑器内素材推荐（逻辑同Web端）

**详细文档**：[编辑器左侧栏模板推荐素材]

#### 3.2.6 编辑器左侧栏-素材相似素材推荐

**应用场景**：编辑器内相似素材推荐（逻辑同Web端）

**详细文档**：[素材相似推荐]

#### 3.2.7 模板编辑器-作图完成页

**应用场景**：完成作图后的推荐页面

**详细文档**：[模板编辑器作图完成页]

#### 3.2.8 我的收藏

**应用场景**：用户收藏夹内容推荐

**详细文档**：[收藏夹]

---

### 3.3 稿定-Art-AI社区

#### 3.3.1 关联推荐

**应用场景**：AI社区作品和模板的关联推荐

**实现方式**：通过图搜能力进行支持

**详细文档**：稿定ai社区增加作品/模板图搜能力支持

---

## 4. 推荐系统接入指南

### 4.1 接入流程

1. **确定业务场景**：明确需要接入推荐能力的业务场景
2. **选择推荐策略**：根据业务场景选择合适的召回、精排、重排策略
3. **配置参数**：在轻舟后台配置相应的推荐参数
4. **测试验证**：进行AB测试，验证推荐效果
5. **上线监控**：上线后持续监控推荐效果，根据数据反馈优化策略

### 4.2 配置后台

- **轻舟后台**：推荐策略配置、流量池管理、人群标签配置
- **排序结果干预后台**：人工干预排序结果、配置曝光打压

### 4.3 注意事项

- 不同业务场景需要根据实际情况调整推荐策略
- 定期监控推荐效果，根据数据反馈持续优化
- 注意平衡推荐准确性和多样性
- 关注用户体验，避免过度推荐

---

## 附录

### 相关文档链接

- [推荐能力框架图](./attachments/推荐能力框架.png)
- [详细流程图](./attachments/222.png)

### 更新记录

本文档会持续更新，记录推荐系统的优化和新增功能。

---

**文档维护**：推荐算法团队  
**最后更新**：2025-01-14
