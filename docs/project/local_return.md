# 本地退

## 本地退

背景：

1：损益视角，本地退目前整体退货发起率偏高，由于正向和逆向笔单价的差异，基本退货率在0.4%以上即会出现损益风险（此处未考虑额外的物流费用成本）。所以将退货率控制在合理范围内，是本地退能够持续健康发展的根基。

2：用户行为，目前小金额退货占比非常高，因为港澳台新马我们均支持免费上门取件或网点自寄，于用户来说退货无任何成本，导致原本金额较小并且在可退可不退中间动摇的用户，最终会选择退货，而每一笔子订单的退货，我们均需要向菜鸟支付10-31元不等的物流费用。全年整体物流费用预计百万+（港澳台新马全地区202306-202403预测）


目标：

通过付费形式降低本地退发起率，核心降低小金额发起率。以香港10月为例，总共退货包裹10891，10元以下占比1.7%，20元以下占比6.72%，30元以下占比14.59%

● 香港：香港地区降低预约率 23% * 0.8 = 18.4%


项目名称：新加坡本地退货流程线上化优化
项目时间：202X年X月 - 202X年X月

项目角色：产品经理/项目经理

项目背景：
新加坡本地退货流程依赖线下上门取件，退货成功率仅为35%。为提高效率并减少人为错误（如退货码填错等），计划将流程线上化，目标是将退货成功率提升至40%，并将该模式推广至其他地区。

项目职责：

负责整体流程设计，包括手淘逆向流程定制和本地退-预约上门流程优化。

定制退款详情页和退货退款列表页，优化用户体验。

与菜鸟接口对接，实现预约配送服务的线上化，包括可预约、已预约和不可预约异常页面的设计。

协调物流CP和保险公司的结算流程，确保退货码的唯一性和正确性。

定制商家处理状态、寄回商品状态和协商历史的文案，确保信息准确传达。

识别并解决项目中的风险点，如PC端不支持预约服务、保险校验和系统超时问题。


流程页面开发：

负责手淘逆向流程的定制化开发，实现本地退-预约上门流程的线上化。

开发退款详情页，定制本地退流程，优化用户操作体验。

实现退货退款列表页的定制化展示，针对海外地址用户隐藏不必要的选项。

预约模块开发：

开发预约配送服务模块，支持可预约、已预约和不可预约异常页面的状态展示。

对接菜鸟接口，动态获取并展示可预约时间段，支持用户选择取件时间。

实现取件地址、收货人和手机号的编辑功能，确保用户信息的准确性。

状态管理与展示：

定制商家处理状态、寄回商品状态和协商历史的展示文案，确保与视觉稿一致。

开发预约模块的两种状态：“预约时间”和“查看预约详情”，并根据逆向单状态跳转至相应页面。

实现最晚预约时间的判断逻辑，调用菜鸟接口动态计算并展示可预约时间。

交互与用户体验优化：

实现预约提交的二次确认弹窗，确保用户操作的准确性。

开发面单下载功能，支持用户将菜鸟返回的面单URL保存至本地相册。

处理不可预约状态的异常情况，提供兜底文案和联系客服的功能。

接口对接与数据处理：

对接菜鸟接口，实现退货码的回传和状态更新。

处理物流CP回传的取件信息，更新逆向单状态至“已寄回”。

确保退款码的唯一性和正确性，处理系统超时等异常情况。

项目成果：

成功将新加坡本地退货流程线上化，退货成功率提升至40%。

优化了用户预约上门取件的体验，减少了人为错误。

为其他地区的推广奠定了基础，提供了可复制的流程和解决方案。

技术亮点：

与菜鸟接口深度对接，实现预约时间的动态判断和展示。

定制化设计退款详情页和退货退款列表页，提升用户操作便捷性。

通过流程优化和风险控制，确保项目的顺利实施和推广。

项目影响：

提高了用户满意度和退货成功率，减少了客诉。

为公司在东南亚市场的业务扩展提供了有力支持。

## 本地退二期

项目名称：海外本地退货流程优化与仓库工作台建设

项目时间：202X年X月 - 202X年X月

项目角色：前端开发工程师

项目背景：
根据9月份的数据统计，海外本地退货流程存在大量退款失败的情况，主要原因为「少货、错误、假货」等问题。为了提高用户体验并减少人工处理成本，项目旨在优化海外本地退货流程，建设自寄站点“仓库工作台”，提升逆向处理效率，同时防止套现风险。

项目职责：
需求分析与技术方案设计：

参与需求评审，分析用户痛点，设计技术方案，确保前端功能与业务需求高度匹配。

针对香港、澳门、中亚五国等地区的本地退流程，设计差异化的前端解决方案。

核销码扫码功能开发：

实现扫码枪与前端页面的集成，支持扫码枪快速输入核销码并调用接口展示商品信息。

使用键盘监听事件（onkeydown）捕获扫码枪输入，确保数据实时处理。

处理扫码枪输入的速度差异，优化用户体验。

仓库工作台开发：

开发自寄站点“仓库工作台”，支持商品签收、状态查询、数据导出等功能。

实现多条件筛选、分页加载、全量导出等功能，提升仓库操作效率。

使用 xlsx 库实现数据导出功能，支持全量导出和按条件导出。

接口对接与数据处理：

对接商品查询、确认签收、列表查询等接口，确保数据实时更新。

处理接口分页数据，递归调用接口实现全量数据导出。

优化前端数据展示逻辑，确保页面性能。

异常处理与用户体验优化：

针对扫码枪输入异常、接口超时等场景，提供友好的错误提示和解决方案。

优化页面交互设计，提升仓库操作人员的使用体验。

技术亮点：
扫码枪集成与键盘事件监听：

使用 onkeydown 事件监听扫码枪输入，支持快速捕获核销码。

处理扫码枪输入速度差异，确保数据准确性。

实现扫码枪输入与接口调用的无缝衔接。

数据导出功能：

使用 xlsx 库实现数据导出功能，支持全量导出和按条件导出。

递归调用分页接口，确保数据完整性。

优化导出性能，减少内存占用。

仓库工作台功能开发：

实现多条件筛选、分页加载、签收确认等功能，提升仓库操作效率。

支持动态加载和状态更新，确保数据实时性。

接口对接与数据处理：

对接多个后端接口，确保数据实时更新和展示。

处理分页数据，优化前端性能。

异常处理与用户体验优化：

提供友好的错误提示和解决方案，提升用户体验。

优化页面交互设计，减少操作步骤。

技术栈：
前端框架：React/Vue.js

状态管理：Redux/Vuex

数据处理：xlsx、Axios

工具：Webpack、ESLint、Git

接口对接：RESTful API

项目成果：
优化海外本地退货流程：

支持香港、澳门、中亚五国等地区的本地退流程，提升用户体验。

减少人工处理成本，提高退款成功率。

建设仓库工作台：

实现商品签收、状态查询、数据导出等功能，提升仓库操作效率。

支持多条件筛选和分页加载，优化数据处理性能。

防止套现风险：

通过核销码扫码功能和数据校验，有效防止套现风险。

项目影响：
提升用户体验：

优化海外本地退货流程，减少退款失败率，提升用户满意度。

提高操作效率：

仓库工作台的建设显著提升了仓库操作效率，减少了人工处理时间。

降低风险：

通过技术手段防止套现风险，保障平台资金安全。

总结：
该项目通过前端技术的深度优化，实现了海外本地退货流程的线上化和仓库工作台的高效化。技术亮点包括扫码枪集成、数据导出功能、仓库工作台开发等，不仅提升了系统的功能性，还为后续的扩展和优化奠定了坚实基础。

## 质检平台

> 背景：退货仓由第三方公司直接质检和运营。 目前现状退货仓为菜鸟仓，菜鸟仓的工作人员并非专业从事质检和验货的，导致验货标准不统一，难落地，增加理赔。且菜鸟的收费相对偏贵，不符合市场定价，故业务需设立专门的第三方仓，负责整体退货商品的质检和分拣，控制成本

![alt text](./img/inspection.png)

安装配置流程：

- 组装台式windows
- 接入扫描仪，安装驱动程序和厂商应用程序
- 配置访问链接和通信脚本`getScanData`
- 扫描仪扫描调用将信息发送给客户端，客户端调用接口
- 安装和配置打印机
- 质检通过，客户端打印质检面单


获取扫描仪信息：

在扫描设备中输入以下代码:
```js
window.ExecBarcode = function(mailNo,mailWeight,picPackage,picPerson) {
 //你的代码
  window.getScanData(mailNo,mailWeight,picPackage,picPerson);
 var params = "单号：" + mailNo + "，\n重量：" + mailWeight + "Kg，\n底单照片：" + picPackage + "，\n人像照片：" + picPerson;
}
```

如上，在自己的代码中提供window.getScanData全局方法，在扫描设备扫描到信息后会调用此方法进行参数传递，以获取单号、重量、照片等信息

接收到base64的照片信息，由于图片过大，需要进行压缩

> Base64 编码将 3 个字节（24 位）分成 4 个 6 位的组。然后，每个 6 位的组对应一个字符，从 Base64 字符表中查找对应字符（通常包括大写字母、数字和其他符号）。这样可以将任意二进制数据表示为只包含 ASCII 字符的文本数据。
> data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...
> data:image/png;base64, 是前缀，表示该数据是一个图片，格式是 PNG。
> 后面的部分（如 iVBORw0KGgoAAAANSUhEUgAA...）是实际的 Base64 编码后的图片数据。
> Base64 编码后的输出是文本形式，可以通过标准的文本协议（例如 HTTP）进行传输

```ts
// 此函数通过利用 HTML <img> 和 <canvas> 元素实现了对 Base64 图像数据的压缩功能。首先，它将输入的 Base64 数据加载到一个 <img> 元素上，然后将其绘制到一个尺寸已调整好的 <canvas> 上，最后将 <canvas> 中的内容导出为新的 Base64 数据。这种方式可以有效地减少图像文件大小，同时保持一定的视觉质量。
export const compressImageBase64 = (
  base64: string,
  targetWidth: number,
  targetHeight: number,
  outputFormat = "image/jpeg"
): Promise<string> => {
  return new Promise((resolve, reject) => {
    // 创建 Image 对象
    const img = new Image();
    img.onload = function () {
      // 创建 canvas
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");

      // 设置 canvas 的宽高为目标宽高
      canvas.width = targetWidth;
      canvas.height = targetHeight;

      // 缩放并绘制图像到 canvas
      ctx!.drawImage(img, 0, 0, targetWidth, targetHeight);

      // 将 canvas 内容转换为 base64
      const newDataUrl = canvas.toDataURL(outputFormat);

      // 返回压缩后的 base64 字符串
      resolve(newDataUrl);
    };

    // 错误处理
    img.onerror = function (err) {
      reject(err);
    };

    // 设置原图的 base64 字符串
    img.src = base64;
  });
};
```
拿到信息之后调用上传接口，展示商品信息以及质检情况。


质检通过后打印：

构建以下面单信息的dom结构并隐藏，当质检员质检通过后调用打印机进行打印，打印某个dom结构由react-to-print库实现。


### 前端技术亮点总结：牧炫软件配置与质检流程优化
1. 系统参数配置与软件安装
技术实现：

使用本地安装包（VC_redist.x64 和 VC_redist.x86）确保系统环境兼容性。

通过牧炫软件的系统设定模块，实现参数配置的界面化操作，提升用户配置效率。

技术亮点：

提供清晰的安装指引和配置步骤，降低用户操作门槛。

支持本地化安装和配置，确保系统的稳定性和独立性。

2. 打印机驱动调试与集成
技术实现：

下载并安装打印机驱动，确保与牧炫软件的兼容性。

通过调试确保打印功能的稳定性和准确性。

技术亮点：

提供详细的驱动安装文档，支持多种打印机型号。

实现打印功能的无缝集成，支持自动打印和手动重打。

3. 对接地址配置与脚本注入
技术实现：

通过右键配置框，动态注入对接地址和脚本代码。

使用 window.ExecBarcode 函数实现扫描数据的回调处理。

技术亮点：

支持动态配置对接地址，灵活适配不同环境。

通过脚本注入实现扫描数据的实时处理，确保数据准确性。

每个扫描机的唯一编号（如 HK001）确保数据来源的可追溯性。

4. 质检账号登录与页面跳转
技术实现：

实现密码登录功能，支持账号密码的输入和验证。

登录成功后自动跳转到质检页面，提升用户体验。

技术亮点：

提供清晰的登录界面和跳转逻辑，减少用户操作步骤。

支持账号密码的安全性校验，确保系统安全性。

5. 商品扫描与信息展示
技术实现：

通过扫描设备获取商品二维码数据，并自动请求商品信息。

动态展示商品的数量、品类、金额等信息，支持用户手动检查。

技术亮点：

实现扫描数据的实时请求和展示，提升质检效率。

提供清晰的信息展示界面，支持用户快速核对商品信息。

6. 质检操作与状态更新
技术实现：

支持鼠标点击和键盘快捷键操作，提升质检操作的便捷性。

质检完成后自动更新商品状态，并触发面单打印。

技术亮点：

提供多种操作方式，满足不同用户的操作习惯。

实现质检状态和面单打印的自动化处理，减少人工干预。

7. 面单打印与异常处理
技术实现：

实现自动打印功能，支持面单的清晰打印。

提供手动重打功能，应对打印失败或面单不清晰的情况。

技术亮点：

自动打印功能提升效率，手动重打功能确保容错性。

提供清晰的异常状态提示（如未查询到重量信息、缺少图片信息等），支持用户快速定位问题。

8. 异常状态处理与系统健壮性
技术实现：

针对常见异常状态（如未查询到重量信息、缺少图片信息、更新状态失败等），提供明确的提示和解决方案。

支持重启程序或重新操作以解决异常状态。

技术亮点：

提供详细的异常处理指引，提升系统的健壮性和用户体验。

支持快速恢复操作，减少因异常导致的流程中断。

总结

该项目通过前端技术的深度优化，实现了牧炫软件的配置、质检流程的自动化和异常处理的高效化。技术亮点包括：

动态配置与脚本注入：支持灵活对接和数据处理。

扫描与信息展示：实现实时数据请求和展示，提升质检效率。

自动化打印与异常处理：确保流程的顺畅和系统的健壮性。

用户体验优化：通过清晰的界面设计和操作指引，降低用户操作难度。

这些技术亮点不仅提升了系统的功能性，还为后续的扩展和优化奠定了坚实基础。