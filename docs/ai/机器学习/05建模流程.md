# 机器学习建模流程

> 本章介绍机器学习的完整建模流程，包括数据处理、特征工程、模型训练、评估与部署

---

## 一、建模流程全景图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        机器学习建模流程                                   │
└─────────────────────────────────────────────────────────────────────────┘

  ┌──────┐    ┌──────┐    ┌──────┐    ┌──────┐    ┌──────┐    ┌──────┐
  │  1   │    │  2   │    │  3   │    │  4   │    │  5   │    │  6   │
  │ 获取 │ →  │ 数据 │ →  │ 特征 │ →  │ 模型 │ →  │ 模型 │ →  │ 模型 │
  │ 数据 │    │ 处理 │    │ 工程 │    │ 训练 │    │ 评估 │    │ 部署 │
  └──────┘    └──────┘    └──────┘    └──────┘    └──────┘    └──────┘
     📊          🔧          ⚙️          🤖          📈          🚀
```

::: warning 工作重点
实际工作中 **30%-40%** 的时间用于数据处理和特征工程，数据质量直接影响模型效果！
:::

---

## 二、六大阶段详解

### 2.1 获取数据

**数据来源：**

| 数据类型 | 说明 | 示例 |
|----------|------|------|
| 📷 图像 | 图片、视频帧 | 人脸数据集 |
| 📝 文本 | 文章、评论 | 新闻语料库 |
| 🎤 语音 | 音频文件 | 语音识别数据 |
| 📊 结构化 | 表格数据 | 学生成绩、房价 |
| 📡 传感器 | IoT 设备数据 | 温度、位置 |

### 2.2 数据基本处理

::: tip 核心任务
处理"脏数据"，提升数据质量
:::

| 处理类型 | 说明 | 处理方法 |
|----------|------|----------|
| 🕳️ 缺失值 | 数据为空 | 填充均值/删除行 |
| ⚠️ 异常值 | 数据明显异常 | 3σ 原则/箱线图 |
| 🔄 重复值 | 数据重复 | 去重 |
| 🔀 不一致 | 格式不统一 | 标准化 |

### 2.3 特征工程

::: warning 关键环节
特征工程是建模过程中**最耗时**的环节，需要结合领域经验！
:::

**核心任务：**

```
原始数据 → 特征提取 → 特征预处理 → 特征降维 → 可用特征
              │            │            │
              ▼            ▼            ▼
         提取有用信息   标准化/归一化  100维→10维
```

| 任务 | 说明 | 示例 |
|------|------|------|
| 特征提取 | 从原始数据提取有用信息 | 从图片提取边缘特征 |
| 特征预处理 | 标准化、归一化 | Z-Score 标准化 |
| 特征降维 | 减少特征数量 | PCA 主成分分析 |

### 2.4 模型训练

**常用算法：**

| 算法 | 类型 | 适用场景 |
|------|------|----------|
| 线性回归 | 回归 | 房价预测、销量预测 |
| 逻辑回归 | 分类 | 二分类问题 |
| 决策树 | 分类/回归 | 规则解释性强 |
| GBDT | 集成学习 | 竞赛常用 |
| 神经网络 | 深度学习 | 图像、NLP |

### 2.5 模型评估

| 任务类型 | 评估指标 |
|----------|----------|
| 回归 | RMSE、MAE、R² |
| 分类 | 准确率、召回率、F1-Score、AUC |
| 聚类 | 轮廓系数、CH 指数 |

::: info 面试提示
面试中需要用**具体数据**证明模型效果，如"准确率从 85% 提升到 92%"。
:::

### 2.6 模型部署

```
训练环境                    生产环境
    │                           │
    ▼                           ▼
┌─────────┐  模型导出    ┌─────────────┐
│ 模型训练 │ ────────→   │  API 服务   │
│ (.pkl)  │             │ (Flask/etc) │
└─────────┘              └─────────────┘
```

---

## 三、训练阶段 vs 预测阶段

### 3.1 流程对比

```
┌─────────────────────────────────────────────────────────────┐
│                      训练阶段                                │
└─────────────────────────────────────────────────────────────┘
    ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌────────┐
    │ 原始数据  │ →  │ 特征提取  │ →  │ 算法学习  │ →  │ 分类器 │
    │ + 标签   │    │          │    │ (X, y)   │    │ 模型   │
    └──────────┘    └──────────┘    └──────────┘    └────────┘

┌─────────────────────────────────────────────────────────────┐
│                      预测阶段                                │
└─────────────────────────────────────────────────────────────┘
    ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌────────┐
    │ 新数据   │ →  │ 特征提取  │ →  │ 模型分类  │ →  │ 预测   │
    │ (无标签) │    │          │    │          │    │ 标签   │
    └──────────┘    └──────────┘    └──────────┘    └────────┘
```

### 3.2 核心区别

| 对比项 | 训练阶段 | 预测阶段 |
|--------|----------|----------|
| 标签 | ✅ 必须提供 | ❌ 不需要 |
| 目的 | 学习规律 | 应用规律 |
| 输出 | 模型参数 | 预测结果 |

---

## 四、传统机器学习 vs 深度学习

```
传统机器学习：
┌──────┐    ┌──────────┐    ┌──────┐    ┌──────┐
│ 数据 │ →  │ 特征工程  │ →  │ 模型 │ →  │ 结果 │
│      │    │ (人工)   │    │      │    │      │
└──────┘    └──────────┘    └──────┘    └──────┘

深度学习：
┌──────┐    ┌──────────────────────┐    ┌──────┐
│ 数据 │ →  │   端到端学习          │ →  │ 结果 │
│      │    │ (自动特征 + 模型)     │    │      │
└──────┘    └──────────────────────┘    └──────┘
```

| 对比项 | 传统机器学习 | 深度学习 |
|--------|--------------|----------|
| 特征工程 | 需要人工 ⚠️ | 自动学习 ✅ |
| 数据需求 | 相对较少 | 需要大量数据 |
| 可解释性 | 较好 | 较差（黑盒） |
| 计算资源 | 要求较低 | 需要 GPU |

---

## 五、实战案例：线性回归预测学生成绩

### 5.1 问题描述

::: info 任务
根据学生的**平时成绩**和**期末成绩**，预测**最终成绩**。
:::

**训练数据：**

| 平时成绩 | 期末成绩 | 最终成绩 |
|----------|----------|----------|
| 80 | 70 | 73 |
| 90 | 80 | 83 |
| 70 | 60 | 63 |
| 60 | 70 | 67 |
| 85 | 75 | 78 |
| 95 | 85 | 88 |
| 75 | 65 | 68 |

### 5.2 代码实现

```python
from sklearn.linear_model import LinearRegression

def predict_score():
    """使用线性回归预测学生成绩"""
    
    # 1. 准备数据
    # X: 特征（二维列表）- 平时成绩、期末成绩
    X = [
        [80, 70],
        [90, 80],
        [70, 60],
        [60, 70],
        [85, 75],
        [95, 85],
        [75, 65]
    ]
    
    # y: 标签（一维列表）- 最终成绩
    y = [73, 83, 63, 67, 78, 88, 68]
    
    # 2. 实例化模型
    model = LinearRegression()
    
    # 3. 训练模型
    model.fit(X, y)
    
    # 4. 查看模型参数
    print(f"斜率 (coef_): {model.coef_}")       # [0.3, 0.7]
    print(f"截距 (intercept_): {model.intercept_}")  # ≈ 0
    
    # 5. 预测新数据
    new_student = [[90, 80]]  # 平时90分，期末80分
    prediction = model.predict(new_student)
    print(f"预测成绩: {prediction[0]:.1f}")  # 83.0
    
    return model

# 运行
model = predict_score()
```

### 5.3 结果解读

```
回归方程: y = 0.3 × 平时成绩 + 0.7 × 期末成绩 + 0

含义：
- 平时成绩权重 30%
- 期末成绩权重 70%
- 截距约为 0（拟合良好）

验证：
- 输入: [90, 80]
- 计算: 0.3 × 90 + 0.7 × 80 = 27 + 56 = 83
- 输出: 83 ✅
```

### 5.4 关键 API

| 方法/属性 | 说明 |
|-----------|------|
| `LinearRegression()` | 实例化线性回归模型 |
| `.fit(X, y)` | 训练模型，学习参数 |
| `.coef_` | 获取斜率参数 k |
| `.intercept_` | 获取截距参数 b |
| `.predict(X)` | 使用模型进行预测 |

::: warning 注意事项
- 特征数据 X 必须是**二维列表**
- 标签数据 y 必须是**一维列表**
- 预测时输入也必须是**二维列表**
:::

---

## 六、模型评估与迭代

```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ 训练模型 │ →  │ 测试评估 │ →  │ 分析指标 │ →  │ 优化调整 │
└─────────┘    └─────────┘    └─────────┘    └─────────┘
     │                                            │
     └────────────────────────────────────────────┘
                     迭代循环
```

**优化方向：**
- 📊 增加/优化数据
- ⚙️ 改进特征工程
- 🔧 调整模型参数
- 🔄 更换算法模型

---

## 七、知识小结

| 知识点 | 核心内容 | 考试重点/易混淆点 | 难度 |
|--------|----------|-------------------|------|
| 建模流程 | 数据 → 特征工程 → 训练 → 评估 → 部署 | 特征工程占工作量 30%-40% | ⭐⭐⭐ |
| 特征工程 | 特征提取、预处理、降维 | 传统 ML 需人工，DL 自动学习 | ⭐⭐⭐⭐ |
| 线性回归 | `fit()` 训练，`predict()` 预测 | X 需为二维列表，y 为一维列表 | ⭐⭐ |
| 模型评估 | 回归用 RMSE，分类用准确率等 | 面试需用数据证明模型效果 | ⭐⭐⭐ |
| ML vs DL | ML 需特征工程，DL 端到端 | 适用场景和数据需求的差异 | ⭐⭐⭐⭐ |

---

## 八、代码速查卡

::: tip 📝 sklearn 线性回归速查
```python
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split

# 1. 划分数据集
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)

# 2. 实例化 & 训练
model = LinearRegression()
model.fit(X_train, y_train)

# 3. 预测 & 评估
y_pred = model.predict(X_test)

# 4. 查看参数
print(f"斜率: {model.coef_}")
print(f"截距: {model.intercept_}")
```
:::
