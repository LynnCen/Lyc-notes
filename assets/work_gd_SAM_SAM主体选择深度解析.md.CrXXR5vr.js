import{_ as a,c as i,o as n,a7 as l}from"./chunks/framework.BQb8NfN9.js";const c=JSON.parse('{"title":"SAMä¸»ä½“é€‰æ‹©æ·±åº¦è§£æ","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/SAM/SAMä¸»ä½“é€‰æ‹©æ·±åº¦è§£æ.md","filePath":"work/gd/SAM/SAMä¸»ä½“é€‰æ‹©æ·±åº¦è§£æ.md","lastUpdated":1770085732000}'),p={name:"work/gd/SAM/SAMä¸»ä½“é€‰æ‹©æ·±åº¦è§£æ.md"};function e(t,s,h,k,r,d){return n(),i("div",null,s[0]||(s[0]=[l(`<h1 id="samä¸»ä½“é€‰æ‹©æ·±åº¦è§£æ" tabindex="-1">SAMä¸»ä½“é€‰æ‹©æ·±åº¦è§£æ <a class="header-anchor" href="#samä¸»ä½“é€‰æ‹©æ·±åº¦è§£æ" aria-label="Permalink to &quot;SAMä¸»ä½“é€‰æ‹©æ·±åº¦è§£æ&quot;">â€‹</a></h1><blockquote><p><strong>æ–‡æ¡£è¯´æ˜ï¼š</strong> æœ¬æ–‡æ¡£è¯¦ç»†è§£æåŸºäºSAMï¼ˆSegment Anything Modelï¼‰çš„ä¸»ä½“é€‰æ‹©åŠŸèƒ½å®ç°åŸç†ï¼Œæ¶µç›–ä»APIè°ƒç”¨ã€æ•°æ®å¤„ç†ã€ç”¨æˆ·äº¤äº’åˆ°è§†è§‰æ¸²æŸ“çš„å®Œæ•´æŠ€æœ¯é“¾è·¯ã€‚</p></blockquote><h2 id="ğŸ“š-ç›®å½•" tabindex="-1">ğŸ“š ç›®å½• <a class="header-anchor" href="#ğŸ“š-ç›®å½•" aria-label="Permalink to &quot;ğŸ“š ç›®å½•&quot;">â€‹</a></h2><ol><li><a href="#ä¸€ä»€ä¹ˆæ˜¯samä¸»ä½“é€‰æ‹©">ä»€ä¹ˆæ˜¯SAMä¸»ä½“é€‰æ‹©</a></li><li><a href="#äºŒå®Œæ•´å·¥ä½œæµç¨‹">å®Œæ•´å·¥ä½œæµç¨‹</a></li><li><a href="#ä¸‰æŠ€æœ¯æ¶æ„ä¸èŒè´£åˆ’åˆ†">æŠ€æœ¯æ¶æ„ä¸èŒè´£åˆ’åˆ†</a></li><li><a href="#å››æ ¸å¿ƒå®ç°åŸç†">æ ¸å¿ƒå®ç°åŸç†</a></li><li><a href="#äº”é«˜äº®æ•ˆæœçš„æ·±åº¦å®ç°">é«˜äº®æ•ˆæœçš„æ·±åº¦å®ç°</a></li><li><a href="#å…­æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ">æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ</a></li></ol><hr><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯samä¸»ä½“é€‰æ‹©" tabindex="-1">ä¸€ã€ä»€ä¹ˆæ˜¯SAMä¸»ä½“é€‰æ‹©ï¼Ÿ <a class="header-anchor" href="#ä¸€ã€ä»€ä¹ˆæ˜¯samä¸»ä½“é€‰æ‹©" aria-label="Permalink to &quot;ä¸€ã€ä»€ä¹ˆæ˜¯SAMä¸»ä½“é€‰æ‹©ï¼Ÿ&quot;">â€‹</a></h2><h3 id="_1-1-åŠŸèƒ½æ¦‚è¿°" tabindex="-1">1.1 åŠŸèƒ½æ¦‚è¿° <a class="header-anchor" href="#_1-1-åŠŸèƒ½æ¦‚è¿°" aria-label="Permalink to &quot;1.1 åŠŸèƒ½æ¦‚è¿°&quot;">â€‹</a></h3><p>SAMä¸»ä½“é€‰æ‹©æ˜¯åŸºäºMetaçš„Segment Anything Modelï¼ˆSAMï¼‰å®ç°çš„æ™ºèƒ½é€‰åŒºåŠŸèƒ½ã€‚è¯¥åŠŸèƒ½é€šè¿‡AIæ¨¡å‹é¢„å…ˆåˆ†æå›¾åƒï¼Œç”Ÿæˆå¤šä¸ªå€™é€‰åˆ†å‰²åŒºåŸŸï¼ˆmaskï¼‰ï¼Œç”¨æˆ·é€šè¿‡é¼ æ ‡äº¤äº’å¿«é€Ÿé€‰æ‹©ç›®æ ‡åŒºåŸŸã€‚</p><p><strong>æ ¸å¿ƒç‰¹æ€§ï¼š</strong></p><ul><li><strong>é¢„è®¡ç®—åˆ†å‰²</strong>ï¼šåç«¯SAMæ¨¡å‹é¢„å…ˆç”Ÿæˆæ‰€æœ‰å€™é€‰maskï¼Œå‰ç«¯æ— éœ€å®æ—¶æ¨ç†</li><li><strong>äº¤äº’å¼é€‰æ‹©</strong>ï¼šé¼ æ ‡æ‚¬åœå®æ—¶é«˜äº®é¢„è§ˆï¼Œç‚¹å‡»ç¡®è®¤é€‰ä¸­</li><li><strong>å¤šé€‰æ”¯æŒ</strong>ï¼šæ”¯æŒè¿ç»­ç‚¹å‡»å¤šä¸ªåŒºåŸŸè¿›è¡ŒåŠ é€‰æˆ–å‡é€‰</li><li><strong>é«˜æ€§èƒ½æ¸²æŸ“</strong>ï¼šé‡‡ç”¨Canvaså†…é˜´å½±æŠ€æœ¯å®ç°æµç•…çš„é«˜äº®æ•ˆæœ</li></ul><h3 id="_1-2-æŠ€æœ¯æ¶æ„" tabindex="-1">1.2 æŠ€æœ¯æ¶æ„ <a class="header-anchor" href="#_1-2-æŠ€æœ¯æ¶æ„" aria-label="Permalink to &quot;1.2 æŠ€æœ¯æ¶æ„&quot;">â€‹</a></h3><p><strong>åç«¯èŒè´£ï¼š</strong></p><ul><li>SAMæ¨¡å‹æ¨ç†ï¼šæ¥æ”¶å›¾åƒURLï¼Œè¿”å›å¤šä¸ªå€™é€‰maskçš„RLEå‹ç¼©æ•°æ®</li><li>æ•°æ®æ ¼å¼ï¼šæ¯ä¸ªmaskåŒ…å«segmentationï¼ˆRLEç¼–ç ï¼‰ã€bboxï¼ˆè¾¹ç•Œæ¡†ï¼‰ã€areaï¼ˆé¢ç§¯ï¼‰ç­‰å…ƒä¿¡æ¯</li></ul><p><strong>å‰ç«¯èŒè´£ï¼š</strong></p><ul><li>APIè°ƒç”¨ä¸ç¼“å­˜ï¼šç®¡ç†maskæ•°æ®çš„è·å–ä¸ç¼“å­˜</li><li>æ•°æ®è§£ç ï¼šå°†RLEæ•°æ®è§£ç ä¸ºCanvaså›¾åƒ</li><li>äº¤äº’å¤„ç†ï¼šåæ ‡è½¬æ¢ã€layeræŸ¥æ‰¾ã€çŠ¶æ€ç®¡ç†</li><li>è§†è§‰æ¸²æŸ“ï¼šé«˜äº®è¾¹æ¡†ã€è’™ç‰ˆåˆå¹¶ã€é¢œè‰²å¡«å……</li></ul><p><strong>å…³é”®è®¾è®¡ï¼š</strong> é‡‡ç”¨é¢„è®¡ç®—+æŸ¥æ‰¾æ¨¡å¼ï¼Œè€Œéå®æ—¶æ¨ç†ï¼Œç¡®ä¿äº¤äº’æµç•…æ€§ã€‚</p><h3 id="_1-3-åœ¨é¡¹ç›®ä¸­çš„è§’è‰²" tabindex="-1">1.3 åœ¨é¡¹ç›®ä¸­çš„è§’è‰² <a class="header-anchor" href="#_1-3-åœ¨é¡¹ç›®ä¸­çš„è§’è‰²" aria-label="Permalink to &quot;1.3 åœ¨é¡¹ç›®ä¸­çš„è§’è‰²&quot;">â€‹</a></h3><p>åœ¨AIæ”¹å›¾åŠŸèƒ½ä¸­ï¼Œä¸»ä½“é€‰æ‹©æ˜¯ä¸‰ä¸ªé€‰åŒºå·¥å…·ä¹‹ä¸€ï¼š</p><ul><li><strong>ä¸»ä½“é€‰æ‹©ï¼ˆæœ¬æ–‡ï¼‰</strong>ï¼šAIè¾…åŠ©ï¼Œç‚¹å‡»å³é€‰ï¼Œé€‚åˆå¿«é€Ÿé€‰ä¸­è§„åˆ™ç‰©ä½“</li><li><strong>å¥—ç´¢å·¥å…·</strong>ï¼šæ‰‹åŠ¨ç»˜åˆ¶è·¯å¾„ï¼Œé€‚åˆè‡ªç”±å½¢çŠ¶</li><li><strong>ç”»ç¬”å·¥å…·</strong>ï¼šæ‰‹ç»˜è’™ç‰ˆï¼Œé€‚åˆç²¾ç»†æ§åˆ¶</li></ul><p>ä¸‰è€…é…åˆä½¿ç”¨ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ã€‚</p><hr><h2 id="äºŒã€å®Œæ•´å·¥ä½œæµç¨‹" tabindex="-1">äºŒã€å®Œæ•´å·¥ä½œæµç¨‹ <a class="header-anchor" href="#äºŒã€å®Œæ•´å·¥ä½œæµç¨‹" aria-label="Permalink to &quot;äºŒã€å®Œæ•´å·¥ä½œæµç¨‹&quot;">â€‹</a></h2><h3 id="_2-1-å®è§‚æµç¨‹å›¾" tabindex="-1">2.1 å®è§‚æµç¨‹å›¾ <a class="header-anchor" href="#_2-1-å®è§‚æµç¨‹å›¾" aria-label="Permalink to &quot;2.1 å®è§‚æµç¨‹å›¾&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–ï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰                              â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚  1. ç”¨æˆ·é€‰æ‹©&quot;ä¸»ä½“é€‰æ‹©&quot;å·¥å…·                               â”‚</span></span>
<span class="line"><span>â”‚  2. ç³»ç»Ÿè·å–å½“å‰å›¾ç‰‡URL                                  â”‚</span></span>
<span class="line"><span>â”‚  3. æ£€æŸ¥æœ¬åœ°ç¼“å­˜ï¼ˆjsonMapï¼‰                              â”‚</span></span>
<span class="line"><span>â”‚     â”œâ”€ å‘½ä¸­ç¼“å­˜ï¼šç›´æ¥ä½¿ç”¨                                â”‚</span></span>
<span class="line"><span>â”‚     â””â”€ æœªå‘½ä¸­ï¼šè°ƒç”¨åç«¯API                               â”‚</span></span>
<span class="line"><span>â”‚  4. åç«¯è¿”å›å¤šä¸ªå€™é€‰maskï¼ˆSAMé¢„æµ‹ç»“æœï¼‰                  â”‚</span></span>
<span class="line"><span>â”‚  5. åˆ›å»ºAutoMaskModelå®ä¾‹ï¼ˆç®¡ç†æ‰€æœ‰maskï¼‰                â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                          â†“</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  é˜¶æ®µäºŒï¼šäº¤äº’å¤„ç†ï¼ˆé¢‘ç¹è§¦å‘ï¼‰                             â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚  6. ç”¨æˆ·é¼ æ ‡hoveråˆ°å›¾ç‰‡æŸä½ç½®                            â”‚</span></span>
<span class="line"><span>â”‚  7. å±å¹•åæ ‡è½¬æ¢ä¸ºå›¾åƒåæ ‡                               â”‚</span></span>
<span class="line"><span>â”‚  8. è°ƒç”¨pickLayer(x, y)æŸ¥æ‰¾å¯¹åº”çš„mask                   â”‚</span></span>
<span class="line"><span>â”‚  9. åœ¨selectionCanvasä¸Šç»˜åˆ¶é«˜äº®è¾¹æ¡†                     â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                          â†“</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  é˜¶æ®µä¸‰ï¼šç¡®è®¤é€‰æ‹©ï¼ˆç‚¹å‡»æ—¶ï¼‰                               â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚  10. ç”¨æˆ·ç‚¹å‡»ç¡®è®¤                                        â”‚</span></span>
<span class="line"><span>â”‚  11. è°ƒç”¨toggleLayerMode(x, y)åˆ‡æ¢é€‰ä¸­çŠ¶æ€              â”‚</span></span>
<span class="line"><span>â”‚  12. åˆå¹¶æ‰€æœ‰é€‰ä¸­çš„maskï¼ˆgetMaskResultï¼‰                â”‚</span></span>
<span class="line"><span>â”‚  13. æ›´æ–°maskCanvasï¼Œæ˜¾ç¤ºæœ€ç»ˆè’™ç‰ˆ                       â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_2-2-æµç¨‹ç»†èŠ‚è§£æ" tabindex="-1">2.2 æµç¨‹ç»†èŠ‚è§£æ <a class="header-anchor" href="#_2-2-æµç¨‹ç»†èŠ‚è§£æ" aria-label="Permalink to &quot;2.2 æµç¨‹ç»†èŠ‚è§£æ&quot;">â€‹</a></h3><h4 id="é˜¶æ®µä¸€-åˆå§‹åŒ–-æ™ºèƒ½ç¼“å­˜æœºåˆ¶" tabindex="-1">é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–ï¼ˆæ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼‰ <a class="header-anchor" href="#é˜¶æ®µä¸€-åˆå§‹åŒ–-æ™ºèƒ½ç¼“å­˜æœºåˆ¶" aria-label="Permalink to &quot;é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–ï¼ˆæ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼‰&quot;">â€‹</a></h4><p><strong>æ­¥éª¤1-2ï¼šè§¦å‘æ—¶æœº</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å½“ç”¨æˆ·ç‚¹å‡»å·¥å…·æ çš„&quot;ä¸»ä½“é€‰æ‹©&quot;æŒ‰é’®æ—¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> computed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> currentType.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;autoMask&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>æ­¥éª¤3ï¼šç¼“å­˜æ£€æŸ¥</strong></p><p>ç³»ç»Ÿä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„<code>jsonMap</code>æ¥ç¼“å­˜å·²è¯·æ±‚è¿‡çš„å›¾ç‰‡çš„maskæ•°æ®ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç®€åŒ–é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> jsonMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IAutoMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (jsonMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imageUrl)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œæ— éœ€è¯·æ±‚åç«¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cachedMasks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jsonMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imageUrl);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è°ƒç”¨åç«¯APIè·å–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> masks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchAutoMasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imageUrl);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  jsonMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imageUrl, masks);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜ï¼Ÿ</strong></p><ul><li>åç«¯SAMæ¨ç†è€—æ—¶ï¼ˆé€šå¸¸1-3ç§’ï¼‰</li><li>ç”¨æˆ·å¯èƒ½åˆ‡æ¢å·¥å…·åå†åˆ‡å›æ¥</li><li>é¿å…é‡å¤è¯·æ±‚ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li></ul><p><strong>æ­¥éª¤4ï¼šåç«¯è¿”å›çš„æ•°æ®ç»“æ„</strong></p><p>åç«¯APIè¿”å›çš„æ˜¯ä¸€ä¸ªmaskæ•°ç»„ï¼Œæ¯ä¸ªmaskä»£è¡¨ä¸€ä¸ªå¯é€‰åŒºåŸŸï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IAutoMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å”¯ä¸€æ ‡è¯†</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  segmentation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    counts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// RLEå‹ç¼©çš„åƒç´ æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å°ºå¯¸</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  bbox</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾¹ç•Œæ¡†</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¢ç§¯</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  predicted_iou</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¢„æµ‹çš„è´¨é‡åˆ†æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>RLEï¼ˆRun-Length Encodingï¼‰å‹ç¼©è¯´æ˜ï¼š</strong></p><p>RLEæ˜¯ä¸€ç§ç®€å•é«˜æ•ˆçš„å‹ç¼©ç®—æ³•ï¼Œç‰¹åˆ«é€‚åˆmaskè¿™ç§å¤§é‡è¿ç»­ç›¸åŒå€¼çš„æ•°æ®ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>åŸå§‹æ•°æ®ï¼ˆ1ä»£è¡¨é€‰ä¸­ï¼Œ0ä»£è¡¨æœªé€‰ä¸­ï¼‰ï¼š</span></span>
<span class="line"><span>0 0 0 1 1 1 1 0 0 1 1 0 0 0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RLEå‹ç¼©åï¼š</span></span>
<span class="line"><span>[3, 4, 2, 2, 3]  // 3ä¸ª0ï¼Œ4ä¸ª1ï¼Œ2ä¸ª0ï¼Œ2ä¸ª1ï¼Œ3ä¸ª0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>å‹ç¼©ç‡é€šå¸¸å¯è¾¾80-90%ï¼Œå¤§å¤§å‡å°‘ç½‘ç»œä¼ è¾“é‡ã€‚</p><p><strong>æ­¥éª¤5ï¼šåˆ›å»ºAutoMaskModel</strong></p><p><code>AutoMaskModel</code>æ˜¯<code>@lego/sam</code>åº“æä¾›çš„æ ¸å¿ƒç±»ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š</p><ul><li>å°†RLEå‹ç¼©çš„maskæ•°æ®è§£ç ä¸ºCanvaså›¾åƒ</li><li>æä¾›<code>pickLayer(x, y)</code>æŸ¥æ‰¾æ–¹æ³•</li><li>ç®¡ç†é€‰ä¸­çŠ¶æ€ï¼ˆ<code>toggleLayerMode</code>ï¼‰</li><li>åˆå¹¶maskï¼ˆ<code>getMaskResult</code>ï¼‰</li></ul><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> autoMaskModel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createAutoMaskModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imageUrl, masksData);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>å†…éƒ¨ä¼šä¸ºæ¯ä¸ªmaskåˆ›å»ºä¸€ä¸ª<code>AutoMaskLayer</code>å¯¹è±¡ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å”¯ä¸€ID</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  maskCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è§£ç åçš„maskå›¾åƒ</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¢ç§¯</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  bbox</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">w</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">h</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾¹ç•Œæ¡†</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source-over&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;destination-out&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é€‰ä¸­æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="é˜¶æ®µäºŒ-äº¤äº’å¤„ç†-å®æ—¶å“åº”" tabindex="-1">é˜¶æ®µäºŒï¼šäº¤äº’å¤„ç†ï¼ˆå®æ—¶å“åº”ï¼‰ <a class="header-anchor" href="#é˜¶æ®µäºŒ-äº¤äº’å¤„ç†-å®æ—¶å“åº”" aria-label="Permalink to &quot;é˜¶æ®µäºŒï¼šäº¤äº’å¤„ç†ï¼ˆå®æ—¶å“åº”ï¼‰&quot;">â€‹</a></h4><p><strong>æ­¥éª¤6-7ï¼šåæ ‡è½¬æ¢çš„å¿…è¦æ€§</strong></p><p>ç”¨æˆ·çš„é¼ æ ‡ä½ç½®æ˜¯<strong>å±å¹•åæ ‡</strong>ï¼ˆç›¸å¯¹äºæµè§ˆå™¨çª—å£ï¼‰ï¼Œè€Œmaskæ•°æ®æ˜¯<strong>å›¾åƒåæ ‡</strong>ï¼ˆç›¸å¯¹äºåŸå§‹å›¾ç‰‡ï¼‰ã€‚å¿…é¡»è¿›è¡Œè½¬æ¢ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å±å¹•åæ ‡ï¼ˆclientX, clientYï¼‰</span></span>
<span class="line"><span>    â†“ è€ƒè™‘canvasçš„ä½ç½®å’Œå°ºå¯¸</span></span>
<span class="line"><span>Canvasåæ ‡ï¼ˆoffsetX, offsetYï¼‰</span></span>
<span class="line"><span>    â†“ è€ƒè™‘canvasçš„ç¼©æ”¾</span></span>
<span class="line"><span>å›¾åƒåæ ‡ï¼ˆimageX, imageYï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>è¯¦ç»†è½¬æ¢é€»è¾‘ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pointFormEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MouseEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">imageSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. è·å–canvasçš„DOMçŸ©å½¢</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBoundingClientRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. å±å¹•åæ ‡ â†’ Canvasåæ ‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canvasX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e.clientX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rect.left) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (canvas.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rect.width);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canvasY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e.clientY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rect.top) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (canvas.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rect.height);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 3. Canvasåæ ‡ â†’ å›¾åƒåæ ‡ï¼ˆè€ƒè™‘ç¼©æ”¾ã€è£å‰ªç­‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scaleX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imageSize.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> canvas.width;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scaleY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imageSize.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> canvas.height;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    x: canvasX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scaleX,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y: canvasY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scaleY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå¤æ‚ï¼Ÿ</strong></p><ul><li>Canvasçš„æ˜¾ç¤ºå°ºå¯¸ï¼ˆCSSå°ºå¯¸ï¼‰â‰  Canvasçš„å®é™…å°ºå¯¸ï¼ˆwidth/heightå±æ€§ï¼‰</li><li>å›¾ç‰‡å¯èƒ½è¢«ç¼©æ”¾æ˜¾ç¤ºï¼ˆé€‚åº”å±å¹•ï¼‰</li><li>å¯èƒ½æœ‰æ—‹è½¬ã€åç§»ç­‰å˜æ¢</li></ul><p><strong>æ­¥éª¤8ï¼špickLayeræ–¹æ³•è°ƒç”¨</strong></p><p><code>pickLayer(x, y)</code>ç”±<code>@lego/sam</code>åº“çš„<code>AutoMaskModel</code>æä¾›ï¼Œè¯¥æ–¹æ³•æ ¹æ®å›¾åƒåæ ‡æŸ¥æ‰¾å¯¹åº”çš„mask layerã€‚</p><p><strong>æ¥å£å®šä¹‰ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// @lego/sam æä¾›çš„æ¥å£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  pickLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskLayer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  toggleLayerMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getMaskResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MaskResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getSourceImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLImageElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>å®ç°è¯´æ˜ï¼š</strong></p><p>è¯¥æ–¹æ³•çš„å…·ä½“å®ç°ä½äº<code>@lego/sam</code>åº“å†…éƒ¨ï¼Œé¡¹ç›®ä»£ç é€šè¿‡æ¥å£è°ƒç”¨ã€‚å®ç°é€»è¾‘åŒ…æ‹¬ï¼š</p><ul><li>åæ ‡åˆ°layerçš„æ˜ å°„æŸ¥æ‰¾</li><li>æ”¯æŒå¤šä¸ªlayeré‡å æ—¶çš„ä¼˜å…ˆçº§å¤„ç†</li><li>åŸºäºRLEæ•°æ®çš„å¿«é€Ÿç‚¹åŒ…å«åˆ¤æ–­</li></ul><p><strong>è°ƒç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts:127</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> layer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pickLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿”å›çš„<code>AutoMaskLayer</code>åŒ…å«<code>maskCanvas</code>ï¼ˆè¯¥layerçš„maskå›¾åƒï¼‰ç­‰å±æ€§ï¼Œç”¨äºåç»­çš„é«˜äº®æ¸²æŸ“ã€‚</p><p><strong>æ­¥éª¤9ï¼šé«˜äº®è¾¹æ¡†æ¸²æŸ“</strong></p><p>æ‰¾åˆ°layeråï¼Œåœ¨<code>selectionCanvas</code>ä¸Šç»˜åˆ¶é«˜äº®è¾¹æ¡†ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleHoverMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MouseEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> layer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pickLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (layer) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ¸…ç©ºä¹‹å‰çš„é«˜äº®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    selectionCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clearRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç»˜åˆ¶æ–°çš„é«˜äº®è¾¹æ¡†</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    addBorderToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layer.maskCanvas, selectionCanvas, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      borderWidth: calculatedWidth,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      borderColor: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;#33C8E6&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é’è‰²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>å…·ä½“çš„é«˜äº®å®ç°åŸç†ï¼Œè§ä¸‹æ–‡&quot;ç¬¬äº”éƒ¨åˆ†&quot;çš„è¯¦ç»†è®²è§£ã€‚</p><h4 id="é˜¶æ®µä¸‰-ç¡®è®¤é€‰æ‹©-çŠ¶æ€ç®¡ç†" tabindex="-1">é˜¶æ®µä¸‰ï¼šç¡®è®¤é€‰æ‹©ï¼ˆçŠ¶æ€ç®¡ç†ï¼‰ <a class="header-anchor" href="#é˜¶æ®µä¸‰-ç¡®è®¤é€‰æ‹©-çŠ¶æ€ç®¡ç†" aria-label="Permalink to &quot;é˜¶æ®µä¸‰ï¼šç¡®è®¤é€‰æ‹©ï¼ˆçŠ¶æ€ç®¡ç†ï¼‰&quot;">â€‹</a></h4><p><strong>æ­¥éª¤10-11ï¼šåˆ‡æ¢é€‰ä¸­çŠ¶æ€</strong></p><p>ç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œè°ƒç”¨<code>toggleLayerMode</code>åˆ‡æ¢layerçš„é€‰ä¸­çŠ¶æ€ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts:151</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toggleLayerMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>æ¥å£è¯´æ˜ï¼š</strong></p><p><code>toggleLayerMode</code>ç”±<code>@lego/sam</code>åº“å®ç°ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>æ ¹æ®åæ ‡æŸ¥æ‰¾å¯¹åº”çš„layer</li><li>åˆ‡æ¢layerçš„é€‰ä¸­çŠ¶æ€ï¼ˆnull â†” &#39;source-over&#39;ï¼‰</li><li>æ”¯æŒå‡é€‰æ¨¡å¼ï¼ˆ&#39;destination-out&#39;ï¼‰</li></ul><p><strong>çŠ¶æ€ç®¡ç†ï¼š</strong></p><p>layerçš„<code>mode</code>å±æ€§è¡¨ç¤ºé€‰ä¸­çŠ¶æ€ï¼š</p><ul><li><code>null</code>ï¼šæœªé€‰ä¸­</li><li><code>&#39;source-over&#39;</code>ï¼šåŠ é€‰æ¨¡å¼ï¼ˆå åŠ åˆ°ç»“æœï¼‰</li><li><code>&#39;destination-out&#39;</code>ï¼šå‡é€‰æ¨¡å¼ï¼ˆä»ç»“æœä¸­æ“¦é™¤ï¼‰</li></ul><p><strong>æ­¥éª¤12-13ï¼šåˆå¹¶maskå¹¶æ›´æ–°</strong></p><p>é€‰ä¸­çŠ¶æ€æ”¹å˜åï¼Œè°ƒç”¨<code>getMaskResult()</code>è·å–åˆå¹¶åçš„maskç»“æœï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts:152-154</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> maskResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMaskResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">maskResultChange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?.(maskResult?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AUTO_MASK_COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSnapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>æ¥å£è¯´æ˜ï¼š</strong></p><p><code>getMaskResult()</code>ç”±<code>@lego/sam</code>åº“å®ç°ï¼Œè¿”å›<code>MaskResult</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æä¾›<code>getMask(color)</code>æ–¹æ³•ç”ŸæˆæŒ‡å®šé¢œè‰²çš„mask Canvasã€‚</p><p><strong>æ›´æ–°æµç¨‹ï¼š</strong></p><ol><li><code>getMaskResult()</code>ï¼šåˆå¹¶æ‰€æœ‰é€‰ä¸­layerçš„maskï¼Œè¿”å›<code>MaskResult</code>å¯¹è±¡</li><li><code>maskResult.getMask(AUTO_MASK_COLOR)</code>ï¼šç”ŸæˆæŒ‡å®šé¢œè‰²çš„mask Canvas</li><li><code>maskResultChange</code>å›è°ƒï¼šå°†ç»“æœä¼ é€’ç»™çˆ¶ç»„ä»¶ï¼Œæ›´æ–°<code>maskCanvas</code></li></ol><p><strong>æ··åˆæ¨¡å¼ï¼š</strong></p><p>maskåˆå¹¶æ—¶ä½¿ç”¨Canvasçš„<code>globalCompositeOperation</code>ï¼š</p><ul><li><code>&#39;source-over&#39;</code>ï¼šåŠ é€‰æ¨¡å¼ï¼Œæ–°maskå åŠ åˆ°å·²æœ‰maskä¸Š</li><li><code>&#39;destination-out&#39;</code>ï¼šå‡é€‰æ¨¡å¼ï¼Œä»å·²æœ‰maskä¸­æ“¦é™¤</li></ul><hr><h2 id="ä¸‰ã€æŠ€æœ¯æ¶æ„ä¸èŒè´£åˆ’åˆ†" tabindex="-1">ä¸‰ã€æŠ€æœ¯æ¶æ„ä¸èŒè´£åˆ’åˆ† <a class="header-anchor" href="#ä¸‰ã€æŠ€æœ¯æ¶æ„ä¸èŒè´£åˆ’åˆ†" aria-label="Permalink to &quot;ä¸‰ã€æŠ€æœ¯æ¶æ„ä¸èŒè´£åˆ’åˆ†&quot;">â€‹</a></h2><h3 id="_3-1-æ ¸å¿ƒæ–‡ä»¶ç»“æ„" tabindex="-1">3.1 æ ¸å¿ƒæ–‡ä»¶ç»“æ„ <a class="header-anchor" href="#_3-1-æ ¸å¿ƒæ–‡ä»¶ç»“æ„" aria-label="Permalink to &quot;3.1 æ ¸å¿ƒæ–‡ä»¶ç»“æ„&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>é¡¹ç›®ä»£ç </span></span>
<span class="line"><span>â”œâ”€â”€ use-auto-masks.ts          # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆé¡¹ç›®å®ç°ï¼‰</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ äº‹ä»¶å¤„ç†ï¼ˆhoverã€clickï¼‰</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ åæ ‡è½¬æ¢</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ UIæ¸²æŸ“ï¼ˆé«˜äº®æ•ˆæœï¼‰</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ ç¼“å­˜ç®¡ç†ï¼ˆjsonMapï¼‰</span></span>
<span class="line"><span>â”‚   â””â”€â”€ ç”Ÿå‘½å‘¨æœŸç®¡ç†</span></span>
<span class="line"><span>â”‚</span></span>
<span class="line"><span>â””â”€â”€ @lego/sam                   # ç®—æ³•å±‚ï¼ˆåº“æä¾›ï¼‰</span></span>
<span class="line"><span>    â”œâ”€â”€ AutoMaskModel           # æ•°æ®æ¨¡å‹</span></span>
<span class="line"><span>    â”œâ”€â”€ AutoMaskLayer           # å•ä¸ªmask</span></span>
<span class="line"><span>    â”œâ”€â”€ SamFactory              # å·¥å‚ç±»</span></span>
<span class="line"><span>    â”œâ”€â”€ pickLayer()             # æŸ¥æ‰¾ç®—æ³•</span></span>
<span class="line"><span>    â”œâ”€â”€ toggleLayerMode()       # çŠ¶æ€ç®¡ç†</span></span>
<span class="line"><span>    â””â”€â”€ getMaskResult()         # maskåˆå¹¶</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_3-2-èŒè´£åˆ’åˆ†è¡¨" tabindex="-1">3.2 èŒè´£åˆ’åˆ†è¡¨ <a class="header-anchor" href="#_3-2-èŒè´£åˆ’åˆ†è¡¨" aria-label="Permalink to &quot;3.2 èŒè´£åˆ’åˆ†è¡¨&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>åŠŸèƒ½æ¨¡å—</th><th>lego/samåº“</th><th>é¡¹ç›®ä»£ç </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ•°æ®ç»“æ„</strong></td><td>âœ… AutoMaskModel</td><td>âŒ</td><td>ç®¡ç†æ‰€æœ‰maskæ•°æ®</td></tr><tr><td><strong>ç®—æ³•å®ç°</strong></td><td>âœ… pickLayer(x,y)</td><td>âŒ</td><td>åæ ‡æŸ¥æ‰¾ç®—æ³•</td></tr><tr><td><strong>çŠ¶æ€ç®¡ç†</strong></td><td>âœ… toggleLayerMode()</td><td>âŒ</td><td>é€‰ä¸­/å–æ¶ˆé€»è¾‘</td></tr><tr><td><strong>Maskåˆå¹¶</strong></td><td>âœ… getMaskResult()</td><td>âŒ</td><td>æ··åˆæ¨¡å¼åˆå¹¶</td></tr><tr><td><strong>APIè°ƒç”¨</strong></td><td>âŒ</td><td>âœ… fetch + cache</td><td>ç½‘ç»œè¯·æ±‚ä¸ç¼“å­˜</td></tr><tr><td><strong>åæ ‡è½¬æ¢</strong></td><td>âŒ</td><td>âœ… pointFormEvent()</td><td>å±å¹•â†’å›¾åƒåæ ‡</td></tr><tr><td><strong>äº‹ä»¶ç»‘å®š</strong></td><td>âŒ</td><td>âœ… useEventListener</td><td>é¼ æ ‡äº‹ä»¶å¤„ç†</td></tr><tr><td><strong>é«˜äº®æ¸²æŸ“</strong></td><td>âŒ</td><td>âœ… addBorderToCanvas()</td><td>è§†è§‰åé¦ˆ</td></tr><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>âŒ</td><td>âœ… Vue hooks</td><td>ç»„ä»¶ç®¡ç†</td></tr></tbody></table><h3 id="_3-3-ä¸ºä»€ä¹ˆè¿™æ ·åˆ’åˆ†" tabindex="-1">3.3 ä¸ºä»€ä¹ˆè¿™æ ·åˆ’åˆ†ï¼Ÿ <a class="header-anchor" href="#_3-3-ä¸ºä»€ä¹ˆè¿™æ ·åˆ’åˆ†" aria-label="Permalink to &quot;3.3 ä¸ºä»€ä¹ˆè¿™æ ·åˆ’åˆ†ï¼Ÿ&quot;">â€‹</a></h3><p><strong>lego/samçš„èŒè´£ï¼š</strong> æä¾›&quot;èƒ½åŠ›&quot;</p><ul><li>ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼ˆé€šç”¨ã€å¯å¤ç”¨ï¼‰</li><li>ä¸å…·ä½“UIæ¡†æ¶æ— å…³</li><li>å¯ä»¥åœ¨Vueã€Reactã€åŸç”ŸJSä¸­ä½¿ç”¨</li></ul><p><strong>é¡¹ç›®ä»£ç çš„èŒè´£ï¼š</strong> æä¾›&quot;ä½“éªŒ&quot;</p><ul><li>ä¸šåŠ¡é€»è¾‘å’ŒUIäº¤äº’ï¼ˆå®šåˆ¶åŒ–ï¼‰</li><li>ä¸Vueç”Ÿæ€é›†æˆ</li><li>ç¬¦åˆé¡¹ç›®ç‰¹å®šéœ€æ±‚</li></ul><p><strong>è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿ï¼š</strong></p><ol><li><strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ï¼šç®—æ³•ä¸UIè§£è€¦</li><li><strong>å¯æµ‹è¯•æ€§</strong>ï¼šç®—æ³•å±‚å¯ä»¥å•ç‹¬æµ‹è¯•</li><li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šå‡çº§SAMç®—æ³•ä¸å½±å“UIä»£ç </li><li><strong>å¯å¤ç”¨æ€§</strong>ï¼š<code>@lego/sam</code>å¯ä»¥åœ¨å…¶ä»–é¡¹ç›®ä¸­ä½¿ç”¨</li></ol><hr><h2 id="å››ã€æ ¸å¿ƒå®ç°åŸç†" tabindex="-1">å››ã€æ ¸å¿ƒå®ç°åŸç† <a class="header-anchor" href="#å››ã€æ ¸å¿ƒå®ç°åŸç†" aria-label="Permalink to &quot;å››ã€æ ¸å¿ƒå®ç°åŸç†&quot;">â€‹</a></h2><h3 id="_4-1-apiè°ƒç”¨ä¸æ•°æ®æµ" tabindex="-1">4.1 APIè°ƒç”¨ä¸æ•°æ®æµ <a class="header-anchor" href="#_4-1-apiè°ƒç”¨ä¸æ•°æ®æµ" aria-label="Permalink to &quot;4.1 APIè°ƒç”¨ä¸æ•°æ®æµ&quot;">â€‹</a></h3><h4 id="åç«¯apiæ¥å£" tabindex="-1">åç«¯APIæ¥å£ <a class="header-anchor" href="#åç«¯apiæ¥å£" aria-label="Permalink to &quot;åç«¯APIæ¥å£&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å®é™…çš„APIè°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchAutoMasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">imageUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IAutoMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. å›¾ç‰‡é¢„å¤„ç†ï¼ˆå‹ç¼©åˆ°3000x3000ä»¥å†…ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> processedUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ossUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imageUrl, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    width: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    height: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    useDpr: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    forcePngResize: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    transformFormat: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. è°ƒç”¨åç«¯SAMæœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/sam/auto-masks&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image_url: processedUrl,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 3. è¿”å›maskæ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.data.masks;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆè¦å‹ç¼©åˆ°3000x3000ï¼Ÿ</strong></p><ul><li>SAMæ¨¡å‹çš„è¾“å…¥å°ºå¯¸é™åˆ¶</li><li>å¹³è¡¡ç²¾åº¦ä¸æ€§èƒ½</li><li>å¤ªå¤§ï¼šæ¨ç†æ—¶é—´é•¿ï¼Œå†…å­˜å ç”¨é«˜</li><li>å¤ªå°ï¼šç»†èŠ‚ä¸¢å¤±ï¼Œåˆ†å‰²ä¸å‡†ç¡®</li></ul><h4 id="æ•°æ®æµè½¬å›¾" tabindex="-1">æ•°æ®æµè½¬å›¾ <a class="header-anchor" href="#æ•°æ®æµè½¬å›¾" aria-label="Permalink to &quot;æ•°æ®æµè½¬å›¾&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·æ“ä½œ â†’ å‰ç«¯è¯·æ±‚ â†’ OSSå›¾ç‰‡å¤„ç† â†’ åç«¯SAMæ¨ç† â†’ RLEå‹ç¼©</span></span>
<span class="line"><span>    â†“                                                    â†“</span></span>
<span class="line"><span>ç¼“å­˜åˆ°jsonMap â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â† JSONå“åº”</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>åˆ›å»ºAutoMaskModel</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>è§£ç RLE â†’ ç”ŸæˆCanvas</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>ç”¨æˆ·äº¤äº’ï¼ˆhover/clickï¼‰</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>æ›´æ–°maskCanvas</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_4-2-automaskmodelæ¥å£è¯´æ˜" tabindex="-1">4.2 AutoMaskModelæ¥å£è¯´æ˜ <a class="header-anchor" href="#_4-2-automaskmodelæ¥å£è¯´æ˜" aria-label="Permalink to &quot;4.2 AutoMaskModelæ¥å£è¯´æ˜&quot;">â€‹</a></h3><p><code>AutoMaskModel</code>ç”±<code>@lego/sam</code>åº“æä¾›ï¼Œé¡¹ç›®ä»£ç é€šè¿‡æ¥å£è°ƒç”¨å…¶æ–¹æ³•ã€‚</p><h4 id="æ ¸å¿ƒæ¥å£å®šä¹‰" tabindex="-1">æ ¸å¿ƒæ¥å£å®šä¹‰ <a class="header-anchor" href="#æ ¸å¿ƒæ¥å£å®šä¹‰" aria-label="Permalink to &quot;æ ¸å¿ƒæ¥å£å®šä¹‰&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// @lego/sam æä¾›çš„æ¥å£ï¼ˆé¡¹ç›®ä»£ç ä¸­çš„ä½¿ç”¨æ–¹å¼ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è·å–æºå›¾åƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getSourceImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLImageElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ ¹æ®åæ ‡æŸ¥æ‰¾å¯¹åº”çš„layer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  pickLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskLayer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ‡æ¢layerçš„é€‰ä¸­çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  toggleLayerMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è·å–åˆå¹¶åçš„maskç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getMaskResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MaskResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¿«ç…§ç›¸å…³æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getSimpleAutoMasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskModelSnapshotItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  setSimpleAutoMasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">snapshot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskModelSnapshotItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[])</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  reset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // èµ„æºé‡Šæ”¾</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  release</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="æ•°æ®ç»“æ„è¯´æ˜" tabindex="-1">æ•°æ®ç»“æ„è¯´æ˜ <a class="header-anchor" href="#æ•°æ®ç»“æ„è¯´æ˜" aria-label="Permalink to &quot;æ•°æ®ç»“æ„è¯´æ˜&quot;">â€‹</a></h4><p><strong>AutoMaskLayerï¼ˆç”±åº“æä¾›ï¼‰ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å”¯ä¸€æ ‡è¯†</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  maskCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¯¥layerçš„maskå›¾åƒï¼ˆç™½è‰²maskï¼Œé€æ˜èƒŒæ™¯ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¢ç§¯</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  bbox</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾¹ç•Œæ¡†</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source-over&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;destination-out&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é€‰ä¸­çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>MaskResultï¼ˆç”±åº“æä¾›ï¼‰ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MaskResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç”ŸæˆæŒ‡å®šé¢œè‰²çš„mask Canvas</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="rleæ•°æ®æ ¼å¼è¯´æ˜" tabindex="-1">RLEæ•°æ®æ ¼å¼è¯´æ˜ <a class="header-anchor" href="#rleæ•°æ®æ ¼å¼è¯´æ˜" aria-label="Permalink to &quot;RLEæ•°æ®æ ¼å¼è¯´æ˜&quot;">â€‹</a></h4><p>åç«¯è¿”å›çš„maskæ•°æ®ä½¿ç”¨RLEï¼ˆRun-Length Encodingï¼‰å‹ç¼©ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IAutoMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  segmentation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    counts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// RLEå‹ç¼©çš„åƒç´ æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å°ºå¯¸</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  bbox</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾¹ç•Œæ¡†</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¢ç§¯</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  predicted_iou</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¢„æµ‹è´¨é‡åˆ†æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>RLEç¼–ç åŸç†ï¼š</strong></p><p>RLEå°†è¿ç»­çš„ç›¸åŒå€¼å‹ç¼©ä¸º<code>[æ•°é‡, å€¼]</code>çš„åºåˆ—ã€‚å¯¹äºmaskæ•°æ®ï¼š</p><ul><li><code>counts</code>æ•°ç»„ï¼š<code>[èƒŒæ™¯åƒç´ æ•°, å‰æ™¯åƒç´ æ•°, èƒŒæ™¯åƒç´ æ•°, ...]</code></li><li>äº¤æ›¿è¡¨ç¤ºèƒŒæ™¯å’Œå‰æ™¯åŒºåŸŸ</li><li>å‹ç¼©ç‡é€šå¸¸å¯è¾¾80-90%</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>åŸå§‹æ•°æ®ï¼ˆ1ä»£è¡¨é€‰ä¸­ï¼Œ0ä»£è¡¨æœªé€‰ä¸­ï¼‰ï¼š</span></span>
<span class="line"><span>0 0 0 1 1 1 1 0 0 1 1 0 0 0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RLEå‹ç¼©åï¼š</span></span>
<span class="line"><span>counts = [3, 4, 2, 2, 3]</span></span>
<span class="line"><span>å«ä¹‰ï¼š3ä¸ª0ï¼Œ4ä¸ª1ï¼Œ2ä¸ª0ï¼Œ2ä¸ª1ï¼Œ3ä¸ª0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>è§£ç å¤„ç†ï¼š</strong></p><p>RLEè§£ç ç”±<code>@lego/sam</code>åº“å†…éƒ¨å¤„ç†ï¼Œå°†å‹ç¼©æ•°æ®è½¬æ¢ä¸ºCanvaså›¾åƒã€‚é¡¹ç›®ä»£ç ç›´æ¥ä½¿ç”¨è§£ç åçš„<code>maskCanvas</code>ã€‚</p><h3 id="_4-3-åæ ‡è½¬æ¢çš„æ•°å­¦åŸç†" tabindex="-1">4.3 åæ ‡è½¬æ¢çš„æ•°å­¦åŸç† <a class="header-anchor" href="#_4-3-åæ ‡è½¬æ¢çš„æ•°å­¦åŸç†" aria-label="Permalink to &quot;4.3 åæ ‡è½¬æ¢çš„æ•°å­¦åŸç†&quot;">â€‹</a></h3><h4 id="å¤šé‡åæ ‡ç³»ç»Ÿ" tabindex="-1">å¤šé‡åæ ‡ç³»ç»Ÿ <a class="header-anchor" href="#å¤šé‡åæ ‡ç³»ç»Ÿ" aria-label="Permalink to &quot;å¤šé‡åæ ‡ç³»ç»Ÿ&quot;">â€‹</a></h4><p>åœ¨Canvasåº”ç”¨ä¸­ï¼Œé€šå¸¸æ¶‰åŠä¸‰ä¸ªåæ ‡ç³»ç»Ÿï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. å±å¹•åæ ‡ï¼ˆScreen Coordinateï¼‰</span></span>
<span class="line"><span>   - ç›¸å¯¹äºæµè§ˆå™¨çª—å£å·¦ä¸Šè§’</span></span>
<span class="line"><span>   - å•ä½ï¼šç‰©ç†åƒç´ </span></span>
<span class="line"><span>   - æ¥æºï¼šMouseEvent.clientX/clientY</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. Canvasåæ ‡ï¼ˆCanvas Coordinateï¼‰</span></span>
<span class="line"><span>   - ç›¸å¯¹äºcanvaså…ƒç´ å·¦ä¸Šè§’</span></span>
<span class="line"><span>   - å•ä½ï¼šcanvasé€»è¾‘åƒç´ </span></span>
<span class="line"><span>   - è€ƒè™‘äº†canvasçš„CSSç¼©æ”¾</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3. å›¾åƒåæ ‡ï¼ˆImage Coordinateï¼‰</span></span>
<span class="line"><span>   - ç›¸å¯¹äºåŸå§‹å›¾ç‰‡å·¦ä¸Šè§’</span></span>
<span class="line"><span>   - å•ä½ï¼šå›¾ç‰‡åƒç´ </span></span>
<span class="line"><span>   - SAM maskæ•°æ®ä½¿ç”¨çš„åæ ‡ç³»</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="è½¬æ¢å…¬å¼æ¨å¯¼" tabindex="-1">è½¬æ¢å…¬å¼æ¨å¯¼ <a class="header-anchor" href="#è½¬æ¢å…¬å¼æ¨å¯¼" aria-label="Permalink to &quot;è½¬æ¢å…¬å¼æ¨å¯¼&quot;">â€‹</a></h4><p><strong>ç¬¬ä¸€æ­¥ï¼šå±å¹•åæ ‡ â†’ Canvasåæ ‡</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// canvasçš„DOMä½ç½®å’Œå°ºå¯¸</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBoundingClientRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// canvasçš„å®é™…å°ºå¯¸ï¼ˆwidth/heightå±æ€§ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> actualWidth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> canvas.width;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> actualHeight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> canvas.height;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç¼©æ”¾æ¯”ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scaleX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> actualWidth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rect.width;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scaleY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> actualHeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rect.height;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è½¬æ¢å…¬å¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canvasX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (screenX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rect.left) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scaleX;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canvasY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (screenY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rect.top) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scaleY;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ç¼©æ”¾ï¼Ÿ</strong></p><p>Canvasçš„CSSå°ºå¯¸å’Œå®é™…å°ºå¯¸å¯èƒ½ä¸ä¸€è‡´ï¼š</p><ul><li>CSSå°ºå¯¸ï¼š500px Ã— 400pxï¼ˆæ˜¾ç¤ºå¤§å°ï¼‰</li><li>å®é™…å°ºå¯¸ï¼š1000px Ã— 800pxï¼ˆç»˜åˆ¶ç¼“å†²åŒºï¼‰</li><li>ç¼©æ”¾æ¯”ä¾‹ï¼š2å€</li></ul><p>å¦‚æœä¸è€ƒè™‘ç¼©æ”¾ï¼Œç‚¹å‡»ä½ç½®ä¼šåç§»ä¸€å€ï¼</p><p><strong>ç¬¬äºŒæ­¥ï¼šCanvasåæ ‡ â†’ å›¾åƒåæ ‡</strong></p><p>è¿™ä¸€æ­¥éœ€è¦è€ƒè™‘å›¾ç‰‡çš„æ˜¾ç¤ºæ–¹å¼ï¼ˆcontainã€coverç­‰ï¼‰ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> canvasToImageCoordinate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  canvasPoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  canvasSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  imageSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  fitMode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;contain&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;cover&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è®¡ç®—å›¾ç‰‡åœ¨canvasä¸­çš„å®é™…æ˜¾ç¤ºåŒºåŸŸ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imageDisplayRect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> calculateDisplayRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvasSize, imageSize, fitMode);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è½¬æ¢å…¬å¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imageX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (canvasPoint.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imageDisplayRect.x) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (imageSize.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imageDisplayRect.width);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imageY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (canvasPoint.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imageDisplayRect.y) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (imageSize.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imageDisplayRect.height);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { x: imageX, y: imageY };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>containæ¨¡å¼ç¤ºä¾‹ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Canvaså°ºå¯¸ï¼š800 Ã— 600</span></span>
<span class="line"><span>å›¾ç‰‡å°ºå¯¸ï¼š1000 Ã— 500</span></span>
<span class="line"><span></span></span>
<span class="line"><span>containæ¨¡å¼ä¸‹ï¼Œå›¾ç‰‡æŒ‰æ¯”ä¾‹ç¼©æ”¾åˆ°800 Ã— 400ï¼Œå±…ä¸­æ˜¾ç¤ºï¼š</span></span>
<span class="line"><span>- æ˜¾ç¤ºåŒºåŸŸï¼šx=0, y=100, width=800, height=400</span></span>
<span class="line"><span>- ç‚¹å‡»ä½ç½®ï¼ˆcanvasåæ ‡ï¼‰ï¼š400, 300</span></span>
<span class="line"><span>- è½¬æ¢ä¸ºå›¾åƒåæ ‡ï¼š500, 250</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-4-æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯" tabindex="-1">4.4 æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯ <a class="header-anchor" href="#_4-4-æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯" aria-label="Permalink to &quot;4.4 æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯&quot;">â€‹</a></h3><h4 id="_1-ç¼“å­˜ç­–ç•¥" tabindex="-1">1. ç¼“å­˜ç­–ç•¥ <a class="header-anchor" href="#_1-ç¼“å­˜ç­–ç•¥" aria-label="Permalink to &quot;1. ç¼“å­˜ç­–ç•¥&quot;">â€‹</a></h4><p><strong>ä¸‰çº§ç¼“å­˜æ¶æ„ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸€çº§ç¼“å­˜ï¼šAPIå“åº”ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> jsonMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IAutoMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// äºŒçº§ç¼“å­˜ï¼šAutoMaskModelå®ä¾‹ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> autoMaskModel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskModel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸‰çº§ç¼“å­˜ï¼šé«˜äº®Canvasç¼“å­˜ï¼ˆé¿å…é‡å¤ç”Ÿæˆï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> highlightCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>ç¼“å­˜å¤±æ•ˆç­–ç•¥ï¼š</strong></p><ul><li>å›¾ç‰‡URLæ”¹å˜ï¼šæ¸…ç©ºæ‰€æœ‰ç¼“å­˜</li><li>åˆ‡æ¢å·¥å…·ï¼šä¿ç•™ä¸€çº§ç¼“å­˜ï¼Œæ¸…ç©ºäºŒä¸‰çº§</li><li>å†…å­˜å‹åŠ›ï¼šä½¿ç”¨LRUç­–ç•¥æ·˜æ±°æ—§æ•°æ®</li></ul><h4 id="_2-äº‹ä»¶èŠ‚æµ" tabindex="-1">2. äº‹ä»¶èŠ‚æµ <a class="header-anchor" href="#_2-äº‹ä»¶èŠ‚æµ" aria-label="Permalink to &quot;2. äº‹ä»¶èŠ‚æµ&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é«˜é¢‘äº‹ä»¶ï¼ˆhoverï¼‰ä½¿ç”¨èŠ‚æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> handleHoverMask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> throttle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MouseEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... é«˜äº®é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// çº¦60fps</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆæ˜¯16msï¼Ÿ</strong></p><ul><li>1000ms / 60fps â‰ˆ 16.67ms</li><li>ä¿è¯æµç•…çš„è§†è§‰ä½“éªŒ</li><li>é¿å…è¿‡åº¦æ¶ˆè€—CPU</li></ul><h4 id="_3-ç¦»å±canvasæŠ€æœ¯" tabindex="-1">3. ç¦»å±CanvasæŠ€æœ¯ <a class="header-anchor" href="#_3-ç¦»å±canvasæŠ€æœ¯" aria-label="Permalink to &quot;3. ç¦»å±CanvasæŠ€æœ¯&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é«˜äº®æ•ˆæœåœ¨ä¸´æ—¶canvasä¸Šç”Ÿæˆï¼Œé¿å…æ±¡æŸ“ä¸»canvas</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tempCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createOffscreenCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(width, height);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">renderHighlight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tempCanvas);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸€æ¬¡æ€§ç»˜åˆ¶åˆ°selectionCanvas</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">selectionCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tempCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>ä¼˜åŠ¿ï¼š</strong></p><ul><li>é¿å…å¤šæ¬¡æ“ä½œä¸»canvaså¯¼è‡´çš„é‡ç»˜</li><li>æ”¯æŒå¤æ‚çš„å¤šæ­¥éª¤æ¸²æŸ“</li><li>ä¾¿äºè°ƒè¯•å’Œæµ‹è¯•</li></ul><h4 id="_4-æƒ°æ€§åˆå§‹åŒ–" tabindex="-1">4. æƒ°æ€§åˆå§‹åŒ– <a class="header-anchor" href="#_4-æƒ°æ€§åˆå§‹åŒ–" aria-label="Permalink to &quot;4. æƒ°æ€§åˆå§‹åŒ–&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åªåœ¨çœŸæ­£éœ€è¦æ—¶æ‰åˆå§‹åŒ–SAM Factory</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _factory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SamFactory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getFactory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (_factory) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _factory;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰åŠ è½½ï¼ˆå¯èƒ½å‡ MBçš„WASMæ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SamFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@lego/sam&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _factory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SamFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _factory;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆè¦æƒ°æ€§ï¼Ÿ</strong></p><ul><li><code>@lego/sam</code>åŒ…å«å¤§å‹WASMæ–‡ä»¶ï¼ˆ2-5MBï¼‰</li><li>ä¸æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½ä¼šä½¿ç”¨ä¸»ä½“é€‰æ‹©å·¥å…·</li><li>æŒ‰éœ€åŠ è½½ï¼Œä¼˜åŒ–é¦–å±æ€§èƒ½</li></ul><hr><h2 id="äº”ã€é«˜äº®æ•ˆæœçš„æ·±åº¦å®ç°" tabindex="-1">äº”ã€é«˜äº®æ•ˆæœçš„æ·±åº¦å®ç° <a class="header-anchor" href="#äº”ã€é«˜äº®æ•ˆæœçš„æ·±åº¦å®ç°" aria-label="Permalink to &quot;äº”ã€é«˜äº®æ•ˆæœçš„æ·±åº¦å®ç°&quot;">â€‹</a></h2><h3 id="_5-1-æŠ€æœ¯èƒŒæ™¯" tabindex="-1">5.1 æŠ€æœ¯èƒŒæ™¯ <a class="header-anchor" href="#_5-1-æŠ€æœ¯èƒŒæ™¯" aria-label="Permalink to &quot;5.1 æŠ€æœ¯èƒŒæ™¯&quot;">â€‹</a></h3><p>Canvas APIæä¾›<code>stroke()</code>æ–¹æ³•ç”¨äºæè¾¹ï¼Œä½†è¯¥æ–¹æ³•ä»…é€‚ç”¨äºå‡ ä½•è·¯å¾„ï¼ˆPathï¼‰ï¼Œæ— æ³•ç›´æ¥å¯¹ä½å›¾å›¾åƒè¿›è¡Œæè¾¹ã€‚maskæ•°æ®æ˜¯åƒç´ ä½å›¾ï¼Œéœ€è¦é‡‡ç”¨å…¶ä»–æŠ€æœ¯å®ç°è¾¹æ¡†æ•ˆæœã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong> ä½¿ç”¨Canvasçš„é˜´å½±APIï¼ˆ<code>shadowBlur</code>ï¼‰ç»“åˆæ··åˆæ¨¡å¼ï¼ˆ<code>globalCompositeOperation</code>ï¼‰æ¨¡æ‹Ÿå†…é˜´å½±æ•ˆæœï¼Œè§†è§‰ä¸Šå‘ˆç°ä¸ºè¾¹æ¡†ã€‚</p><h4 id="canvas-apiçš„å±€é™æ€§" tabindex="-1">Canvas APIçš„å±€é™æ€§ <a class="header-anchor" href="#canvas-apiçš„å±€é™æ€§" aria-label="Permalink to &quot;Canvas APIçš„å±€é™æ€§&quot;">â€‹</a></h4><p>å¦‚æœè¦ç»™çŸ©å½¢æˆ–åœ†å½¢æè¾¹ï¼ŒCanvasæä¾›äº†ä¾¿æ·çš„APIï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">strokeRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y, width, height); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// çŸ©å½¢æè¾¹</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y, radius, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Math.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PI</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stroke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åœ†å½¢æè¾¹</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä½†è¿™äº›æ–¹æ³•çš„å‰ææ˜¯ï¼š<strong>ä½ æœ‰æ˜ç¡®çš„å‡ ä½•è·¯å¾„ï¼ˆPathï¼‰</strong>ã€‚</p><p>è€Œæˆ‘ä»¬çš„maskæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯ä¸€å¼ <strong>åƒç´ ä½å›¾</strong>â€”â€”å¯èƒ½æ˜¯å¤æ‚çš„äººç‰©è½®å»“ã€å¤´å‘ä¸ã€æ‰‹æŒ‡ç­‰ä¸è§„åˆ™å½¢çŠ¶ï¼Œæ ¹æœ¬æ²¡æœ‰ç®€å•çš„å‡ ä½•æè¿°ã€‚</p><p><strong>æ ¸å¿ƒçŸ›ç›¾ï¼š</strong> Canvasçš„<code>stroke()</code>åªèƒ½æè·¯å¾„ï¼Œä¸èƒ½æä½å›¾çš„è¾¹ç•Œã€‚</p><h4 id="ä¼ ç»Ÿæ–¹æ¡ˆä¸ºä»€ä¹ˆä¸å¯è¡Œ" tabindex="-1">ä¼ ç»Ÿæ–¹æ¡ˆä¸ºä»€ä¹ˆä¸å¯è¡Œï¼Ÿ <a class="header-anchor" href="#ä¼ ç»Ÿæ–¹æ¡ˆä¸ºä»€ä¹ˆä¸å¯è¡Œ" aria-label="Permalink to &quot;ä¼ ç»Ÿæ–¹æ¡ˆä¸ºä»€ä¹ˆä¸å¯è¡Œï¼Ÿ&quot;">â€‹</a></h4><p><strong>æ–¹æ¡ˆ1ï¼šå°†ä½å›¾è½¬æ¢ä¸ºçŸ¢é‡è·¯å¾„</strong></p><p>å¯ä»¥ä½¿ç”¨Marching Squaresç­‰ç®—æ³•æå–è¾¹ç•Œç‚¹ï¼Œç„¶åç”Ÿæˆè·¯å¾„ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¼ªä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boundaryPoints</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> extractBoundary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(maskCanvas); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æå–è¾¹ç•Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pointsToPath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(boundaryPoints); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è½¬ä¸ºè·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stroke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(path); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æè¾¹</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>é—®é¢˜ï¼š</strong></p><ul><li>ç®—æ³•å¤æ‚åº¦é«˜ï¼šO(nÃ—m)ï¼ŒnÃ—mæ˜¯å›¾ç‰‡å°ºå¯¸</li><li>å¤æ‚å½¢çŠ¶ä¼šç”Ÿæˆæ•°ä¸‡ä¸ªè·¯å¾„ç‚¹</li><li>å®æ—¶æ€§å·®ï¼šhoveræ—¶éœ€è¦ç«‹å³å“åº”ï¼Œæ²¡æ—¶é—´è®¡ç®—</li><li>æŠ—é”¯é½¿æ•ˆæœå·®</li></ul><p><strong>æ–¹æ¡ˆ2ï¼šé€åƒç´ ç»˜åˆ¶è¾¹ç•Œ</strong></p><p>éå†æ¯ä¸ªåƒç´ ï¼Œæ£€æµ‹æ˜¯å¦æ˜¯è¾¹ç•Œç‚¹ï¼ˆæ—è¾¹æœ‰é€æ˜åƒç´ ï¼‰ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¼ªä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> height; y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> width; x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isBoundaryPixel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç»˜åˆ¶è¾¹ç•Œç‚¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>é—®é¢˜ï¼š</strong></p><ul><li>åŒé‡å¾ªç¯ï¼Œæ€§èƒ½æå·®</li><li>è¾¹æ¡†æ²¡æœ‰æŠ—é”¯é½¿ï¼Œå¾ˆç²—ç³™</li><li>è¾¹æ¡†å®½åº¦éš¾ä»¥æ§åˆ¶</li></ul><h3 id="_5-2-å®ç°æ–¹æ¡ˆ" tabindex="-1">5.2 å®ç°æ–¹æ¡ˆ <a class="header-anchor" href="#_5-2-å®ç°æ–¹æ¡ˆ" aria-label="Permalink to &quot;5.2 å®ç°æ–¹æ¡ˆ&quot;">â€‹</a></h3><p>é‡‡ç”¨å†…é˜´å½±æŠ€æœ¯å®ç°è¾¹æ¡†æ•ˆæœï¼Œæ ¸å¿ƒåŸç†ï¼š</p><ol><li>ä½¿ç”¨<code>shadowBlur</code>åœ¨maskè¾¹ç¼˜ç”Ÿæˆæ¨¡ç³Šå…‰æ™•</li><li>é€šè¿‡<code>destination-in</code>æ··åˆæ¨¡å¼é™åˆ¶é˜´å½±ä»…åœ¨maskå†…éƒ¨æ˜¾ç¤º</li><li>é€šè¿‡é‡å¤ç»˜åˆ¶å¼ºåŒ–é˜´å½±æ•ˆæœï¼Œå½¢æˆæ¸…æ™°çš„è¾¹æ¡†</li></ol><p><strong>æŠ€æœ¯è¦ç‚¹ï¼š</strong></p><ul><li><code>shadowOffsetX/Y = 0</code>ï¼šé˜´å½±å‡åŒ€æ‰©æ•£ï¼Œæ— æ–¹å‘æ€§</li><li><code>shadowColor</code>ï¼šä½¿ç”¨é«˜äº®è‰²ï¼ˆé’è‰²ï¼‰è€Œéä¼ ç»Ÿé˜´å½±çš„é»‘è‰²</li><li><code>destination-in</code>ï¼šå»ºç«‹maskè¾¹ç•Œï¼Œé™åˆ¶åç»­ç»˜åˆ¶èŒƒå›´</li></ul><h3 id="_5-3-addinsetshadowtocanvaså‡½æ•°é€è¡Œè§£æ" tabindex="-1">5.3 addInsetShadowToCanvaså‡½æ•°é€è¡Œè§£æ <a class="header-anchor" href="#_5-3-addinsetshadowtocanvaså‡½æ•°é€è¡Œè§£æ" aria-label="Permalink to &quot;5.3 addInsetShadowToCanvaså‡½æ•°é€è¡Œè§£æ&quot;">â€‹</a></h3><p><strong>å‡½æ•°ç­¾åï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addInsetShadowToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  sourceCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾“å…¥çš„mask Canvas</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  targetCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç›®æ ‡Canvasï¼ˆselectionCanvasï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">blur</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">offsetX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">offsetY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>è¾“å…¥è¯´æ˜ï¼š</strong></p><ul><li><code>sourceCanvas</code>ï¼šlayerçš„maskCanvasï¼ŒåŒ…å«ç™½è‰²maskåŒºåŸŸå’Œé€æ˜èƒŒæ™¯çš„Canvaså›¾åƒ</li><li><code>targetCanvas</code>ï¼šç”¨äºæ˜¾ç¤ºé«˜äº®æ•ˆæœçš„selectionCanvas</li><li><code>options.blur</code>ï¼šé˜´å½±æ¨¡ç³ŠåŠå¾„ï¼Œå†³å®šè¾¹æ¡†å®½åº¦</li><li><code>options.color</code>ï¼šè¾¹æ¡†é¢œè‰²ï¼ˆå¦‚<code>#33C8E6</code>é’è‰²ï¼‰</li><li><code>options.offsetX/Y</code>ï¼šé˜´å½±åç§»ï¼ˆé€šå¸¸ä¸º0ï¼Œå®ç°å‡åŒ€æ‰©æ•£ï¼‰</li></ul><h4 id="æ­¥éª¤1-å‚æ•°æ ¡éªŒä¸åˆå§‹åŒ–" tabindex="-1">æ­¥éª¤1ï¼šå‚æ•°æ ¡éªŒä¸åˆå§‹åŒ– <a class="header-anchor" href="#æ­¥éª¤1-å‚æ•°æ ¡éªŒä¸åˆå§‹åŒ–" aria-label="Permalink to &quot;æ­¥éª¤1ï¼šå‚æ•°æ ¡éªŒä¸åˆå§‹åŒ–&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 67-69è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">blur</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">offsetX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">offsetY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> options;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sourceCanvas;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sourceCanvas;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> è§£æ„é…ç½®å‚æ•°ï¼Œè·å–sourceCanvaså°ºå¯¸ã€‚</p><p><strong>CanvasçŠ¶æ€ï¼š</strong> æ— å˜åŒ–</p><h4 id="æ­¥éª¤2-åˆ›å»ºresultcanvas-ç»“æœå®¹å™¨" tabindex="-1">æ­¥éª¤2ï¼šåˆ›å»ºresultCanvasï¼ˆç»“æœå®¹å™¨ï¼‰ <a class="header-anchor" href="#æ­¥éª¤2-åˆ›å»ºresultcanvas-ç»“æœå®¹å™¨" aria-label="Permalink to &quot;æ­¥éª¤2ï¼šåˆ›å»ºresultCanvasï¼ˆç»“æœå®¹å™¨ï¼‰&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 72-73è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(width, height);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultCtx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resultCanvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> åˆ›å»ºä¸sourceCanvasåŒå°ºå¯¸çš„ç»“æœCanvasï¼Œç”¨äºå­˜å‚¨æœ€ç»ˆçš„é«˜äº®æ•ˆæœã€‚</p><p><strong>CanvasçŠ¶æ€ï¼š</strong></p><ul><li><code>resultCanvas</code>ï¼šç©ºç™½Canvasï¼ˆwidth Ã— heightï¼‰</li></ul><h4 id="æ­¥éª¤3-åˆ›å»ºtempcanvas-ä¸´æ—¶å·¥ä½œåŒº" tabindex="-1">æ­¥éª¤3ï¼šåˆ›å»ºtempCanvasï¼ˆä¸´æ—¶å·¥ä½œåŒºï¼‰ <a class="header-anchor" href="#æ­¥éª¤3-åˆ›å»ºtempcanvas-ä¸´æ—¶å·¥ä½œåŒº" aria-label="Permalink to &quot;æ­¥éª¤3ï¼šåˆ›å»ºtempCanvasï¼ˆä¸´æ—¶å·¥ä½œåŒºï¼‰&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 76-77è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tempCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blur </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blur </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tempCtx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tempCanvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> åˆ›å»ºæ¯”åŸå›¾æ›´å¤§çš„ä¸´æ—¶Canvasï¼Œä¸ºé˜´å½±æ‰©æ•£é¢„ç•™ç©ºé—´ã€‚</p><p><strong>å°ºå¯¸è®¡ç®—ï¼š</strong></p><ul><li>å®½åº¦ï¼š<code>width + blur * 2</code>ï¼ˆå·¦å³å„é¢„ç•™bluråƒç´ ï¼‰</li><li>é«˜åº¦ï¼š<code>height + blur * 2</code>ï¼ˆä¸Šä¸‹å„é¢„ç•™bluråƒç´ ï¼‰</li></ul><p><strong>CanvasçŠ¶æ€ï¼š</strong></p><ul><li><code>tempCanvas</code>ï¼šç©ºç™½Canvasï¼ˆ(width + blur<em>2) Ã— (height + blur</em>2)ï¼‰</li></ul><h4 id="æ­¥éª¤4-ç»˜åˆ¶åŸå›¾åˆ°tempcanvas-å¸¦åç§»" tabindex="-1">æ­¥éª¤4ï¼šç»˜åˆ¶åŸå›¾åˆ°tempCanvasï¼ˆå¸¦åç§»ï¼‰ <a class="header-anchor" href="#æ­¥éª¤4-ç»˜åˆ¶åŸå›¾åˆ°tempcanvas-å¸¦åç§»" aria-label="Permalink to &quot;æ­¥éª¤4ï¼šç»˜åˆ¶åŸå›¾åˆ°tempCanvasï¼ˆå¸¦åç§»ï¼‰&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 80-82è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> drawOffsetX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blur </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> offsetX;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> drawOffsetY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blur </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> offsetY;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tempCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, drawOffsetX, drawOffsetY, width, height);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> å°†sourceCanvasç»˜åˆ¶åˆ°tempCanvasçš„ä¸­å¿ƒä½ç½®ï¼ˆè€ƒè™‘åç§»ï¼‰ã€‚</p><p><strong>åæ ‡è®¡ç®—ï¼š</strong></p><ul><li><code>drawOffsetX = blur + offsetX</code>ï¼šæ°´å¹³åç§»ï¼ˆblurä¸ºé¢„ç•™ç©ºé—´ï¼ŒoffsetXä¸ºé…ç½®åç§»ï¼‰</li><li><code>drawOffsetY = blur + offsetY</code>ï¼šå‚ç›´åç§»</li></ul><p><strong>CanvasçŠ¶æ€ï¼š</strong></p><ul><li><code>tempCanvas</code>ï¼šä¸­å¿ƒä½ç½®æœ‰ç™½è‰²maskå›¾åƒï¼Œå››å‘¨ä¸ºé€æ˜åŒºåŸŸ</li></ul><p><strong>è§†è§‰ç¤ºæ„ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>tempCanvas (width+blur*2 Ã— height+blur*2)</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  (é€æ˜)                  â”‚</span></span>
<span class="line"><span>â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚</span></span>
<span class="line"><span>â”‚    â”‚  maskå›¾åƒ   â”‚       â”‚ â† åç§»(blur, blur)ä½ç½®</span></span>
<span class="line"><span>â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚</span></span>
<span class="line"><span>â”‚  (é€æ˜)                  â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="æ­¥éª¤5-xoræ“ä½œåˆ›å»ºè´Ÿç‰‡æ•ˆæœ" tabindex="-1">æ­¥éª¤5ï¼šXORæ“ä½œåˆ›å»ºè´Ÿç‰‡æ•ˆæœ <a class="header-anchor" href="#æ­¥éª¤5-xoræ“ä½œåˆ›å»ºè´Ÿç‰‡æ•ˆæœ" aria-label="Permalink to &quot;æ­¥éª¤5ï¼šXORæ“ä½œåˆ›å»ºè´Ÿç‰‡æ•ˆæœ&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 85-86è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tempCtx.globalCompositeOperation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;xor&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tempCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tempCanvas.width, tempCanvas.height);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> ä½¿ç”¨XORæ··åˆæ¨¡å¼å¡«å……æ•´ä¸ªtempCanvasï¼Œåˆ›å»ºè´Ÿç‰‡æ•ˆæœã€‚</p><p><strong>XORæ··åˆæ¨¡å¼åŸç†ï¼š</strong></p><ul><li>XORæ“ä½œï¼šç›¸åŒåƒç´ å€¼ç»“æœä¸º0ï¼ˆé€æ˜ï¼‰ï¼Œä¸åŒåƒç´ å€¼ä¿ç•™</li><li>ç™½è‰²maskåŒºåŸŸï¼šXORåå˜ä¸ºé€æ˜</li><li>é€æ˜èƒŒæ™¯åŒºåŸŸï¼šXORåå˜ä¸ºä¸é€æ˜ï¼ˆç™½è‰²ï¼‰</li></ul><p><strong>CanvasçŠ¶æ€ï¼š</strong></p><ul><li><code>tempCanvas</code>ï¼šmaskåŒºåŸŸå˜ä¸ºé€æ˜ï¼ŒèƒŒæ™¯åŒºåŸŸå˜ä¸ºç™½è‰²</li></ul><p><strong>è§†è§‰ç¤ºæ„ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>tempCanvas (XORå)</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â”‚ â† èƒŒæ™¯å˜ç™½è‰²</span></span>
<span class="line"><span>â”‚  â–ˆâ–ˆâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â–ˆâ–ˆ    â”‚</span></span>
<span class="line"><span>â”‚  â–ˆâ–ˆâ”‚  (é€æ˜)     â”‚â–ˆâ–ˆ    â”‚ â† maskåŒºåŸŸå˜é€æ˜</span></span>
<span class="line"><span>â”‚  â–ˆâ–ˆâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â–ˆâ–ˆ    â”‚</span></span>
<span class="line"><span>â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>æ³¨æ„ï¼š</strong> ä»£ç ä¸­å­˜åœ¨è°ƒè¯•ä»£ç ï¼ˆ97-103è¡Œï¼‰ï¼Œå®é™…æ‰§è¡Œæ—¶å¯èƒ½è¢«ç§»é™¤æˆ–ä¿®æ”¹ã€‚</p><h4 id="æ­¥éª¤6-é…ç½®é˜´å½±å‚æ•°" tabindex="-1">æ­¥éª¤6ï¼šé…ç½®é˜´å½±å‚æ•° <a class="header-anchor" href="#æ­¥éª¤6-é…ç½®é˜´å½±å‚æ•°" aria-label="Permalink to &quot;æ­¥éª¤6ï¼šé…ç½®é˜´å½±å‚æ•°&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 89-93è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">save</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.shadowBlur </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blur;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.shadowColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.shadowOffsetX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> offsetX;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.shadowOffsetY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> offsetY;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> åœ¨resultCtxä¸Šé…ç½®é˜´å½±å‚æ•°ï¼Œåç»­ç»˜åˆ¶æ“ä½œå°†è‡ªåŠ¨åº”ç”¨é˜´å½±ã€‚</p><p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p><ul><li><code>shadowBlur</code>ï¼šæ¨¡ç³ŠåŠå¾„ï¼Œå†³å®šé˜´å½±æ‰©æ•£èŒƒå›´</li><li><code>shadowColor</code>ï¼šé˜´å½±é¢œè‰²ï¼ˆé«˜äº®è‰²ï¼Œéä¼ ç»Ÿé»‘è‰²ï¼‰</li><li><code>shadowOffsetX/Y</code>ï¼šé€šå¸¸ä¸º0ï¼Œå®ç°å‡åŒ€æ‰©æ•£</li></ul><p><strong>CanvasçŠ¶æ€ï¼š</strong> resultCanvasä»ä¸ºç©ºç™½ï¼Œä½†å·²é…ç½®é˜´å½±ä¸Šä¸‹æ–‡</p><h4 id="æ­¥éª¤7-ç»˜åˆ¶sourcecanvasè§¦å‘é˜´å½±" tabindex="-1">æ­¥éª¤7ï¼šç»˜åˆ¶sourceCanvasè§¦å‘é˜´å½± <a class="header-anchor" href="#æ­¥éª¤7-ç»˜åˆ¶sourcecanvasè§¦å‘é˜´å½±" aria-label="Permalink to &quot;æ­¥éª¤7ï¼šç»˜åˆ¶sourceCanvasè§¦å‘é˜´å½±&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 95è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">drawOffsetX, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">drawOffsetY);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> åœ¨resultCanvasä¸Šç»˜åˆ¶sourceCanvasï¼Œè§¦å‘é˜´å½±æ•ˆæœã€‚</p><p><strong>åæ ‡è¯´æ˜ï¼š</strong></p><ul><li>ä½¿ç”¨è´Ÿåç§»<code>(-drawOffsetX, -drawOffsetY)</code>ï¼Œä¸tempCanvasçš„åç§»å¯¹åº”</li></ul><p><strong>é˜´å½±ç”Ÿæˆæœºåˆ¶ï¼š</strong></p><ul><li>Canvasåœ¨ç»˜åˆ¶æ—¶è‡ªåŠ¨åœ¨ç»˜åˆ¶åŒºåŸŸè¾¹ç¼˜ç”Ÿæˆé˜´å½±</li><li>é˜´å½±å‘å†…å¤–ä¸¤ä¾§æ‰©æ•£</li><li>ç”±äºåç»­çš„<code>destination-in</code>è£å‰ªï¼Œå¤–ä¾§é˜´å½±è¢«æˆªæ–­ï¼Œä»…ä¿ç•™å†…ä¾§é˜´å½±</li></ul><p><strong>CanvasçŠ¶æ€ï¼š</strong></p><ul><li><code>resultCanvas</code>ï¼šåŒ…å«maskå›¾åƒå’Œè¾¹ç¼˜é˜´å½±ï¼ˆæ¨¡ç³Šçš„é’è‰²å…‰æ™•ï¼‰</li></ul><h4 id="æ­¥éª¤8-æ¸…ç†tempcanvas" tabindex="-1">æ­¥éª¤8ï¼šæ¸…ç†tempCanvas <a class="header-anchor" href="#æ­¥éª¤8-æ¸…ç†tempcanvas" aria-label="Permalink to &quot;æ­¥éª¤8ï¼šæ¸…ç†tempCanvas&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 105è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleanCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tempCanvas);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> é‡Šæ”¾tempCanvaså†…å­˜ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p><h4 id="æ­¥éª¤9-æ¢å¤ä¸Šä¸‹æ–‡çŠ¶æ€" tabindex="-1">æ­¥éª¤9ï¼šæ¢å¤ä¸Šä¸‹æ–‡çŠ¶æ€ <a class="header-anchor" href="#æ­¥éª¤9-æ¢å¤ä¸Šä¸‹æ–‡çŠ¶æ€" aria-label="Permalink to &quot;æ­¥éª¤9ï¼šæ¢å¤ä¸Šä¸‹æ–‡çŠ¶æ€&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 106è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> æ¢å¤ä¹‹å‰ä¿å­˜çš„Canvasä¸Šä¸‹æ–‡çŠ¶æ€ï¼ˆæ¸…é™¤é˜´å½±é…ç½®ï¼‰ã€‚</p><p><strong>æ³¨æ„ï¼š</strong> ç”±äºæ­¥éª¤7å·²è§¦å‘é˜´å½±ï¼Œé˜´å½±æ•ˆæœå·²ç»˜åˆ¶åˆ°resultCanvasä¸Šï¼Œæ¢å¤çŠ¶æ€ä¸å½±å“å·²ç»˜åˆ¶å†…å®¹ã€‚</p><h4 id="æ­¥éª¤10-destination-inè£å‰ª-é™åˆ¶é˜´å½±èŒƒå›´" tabindex="-1">æ­¥éª¤10ï¼šdestination-inè£å‰ªï¼ˆé™åˆ¶é˜´å½±èŒƒå›´ï¼‰ <a class="header-anchor" href="#æ­¥éª¤10-destination-inè£å‰ª-é™åˆ¶é˜´å½±èŒƒå›´" aria-label="Permalink to &quot;æ­¥éª¤10ï¼šdestination-inè£å‰ªï¼ˆé™åˆ¶é˜´å½±èŒƒå›´ï¼‰&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 109-111è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.globalCompositeOperation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;destination-in&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.globalCompositeOperation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source-over&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> ä½¿ç”¨<code>destination-in</code>æ··åˆæ¨¡å¼ï¼Œå°†resultCanvasè£å‰ªä¸ºä»…ä¿ç•™ä¸sourceCanvasé‡å çš„ä¸é€æ˜åŒºåŸŸã€‚</p><p><strong>destination-inåŸç†ï¼š</strong></p><ul><li>ä¿ç•™destinationï¼ˆresultCanvasï¼‰ä¸­ä¸sourceï¼ˆsourceCanvasï¼‰é‡å çš„ä¸é€æ˜éƒ¨åˆ†</li><li>ç›¸å½“äºç”¨sourceCanvasä½œä¸º&quot;é®ç½©&quot;è£å‰ªresultCanvas</li></ul><p><strong>æ•ˆæœï¼š</strong></p><ul><li>é˜´å½±çš„å¤–ä¾§éƒ¨åˆ†ï¼ˆè¶…å‡ºmaskè¾¹ç•Œï¼‰è¢«æˆªæ–­</li><li>ä»…ä¿ç•™maskå†…éƒ¨çš„å†…é˜´å½±éƒ¨åˆ†</li></ul><p><strong>CanvasçŠ¶æ€ï¼š</strong></p><ul><li><code>resultCanvas</code>ï¼šä»…åŒ…å«maskåŒºåŸŸå†…çš„å†…é˜´å½±æ•ˆæœ</li></ul><h4 id="æ­¥éª¤11-é¢œè‰²å¡«å……-ç”Ÿæˆå¡«å……è‰²" tabindex="-1">æ­¥éª¤11ï¼šé¢œè‰²å¡«å……ï¼ˆç”Ÿæˆå¡«å……è‰²ï¼‰ <a class="header-anchor" href="#æ­¥éª¤11-é¢œè‰²å¡«å……-ç”Ÿæˆå¡«å……è‰²" aria-label="Permalink to &quot;æ­¥éª¤11ï¼šé¢œè‰²å¡«å……ï¼ˆç”Ÿæˆå¡«å……è‰²ï¼‰&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 114è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> colorCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> colorizeCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AUTO_MASK_HOVER_FILL_COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> è°ƒç”¨<code>colorizeCanvas</code>å°†sourceCanvasçš„é¢œè‰²è½¬æ¢ä¸ºå¡«å……è‰²ã€‚</p><p><strong>colorizeCanvaså®ç°ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// canvas.ts:12-43</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> colorizeCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sourceCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">targetColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;canvas&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCanvas.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sourceCanvas.width;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCanvas.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sourceCanvas.height;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultCtx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resultCanvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. å¤åˆ¶åŸå§‹å›¾åƒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. ä½¿ç”¨source-inæ¨¡å¼ï¼šåªä¿ç•™é‡å çš„ä¸é€æ˜åŒºåŸŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.globalCompositeOperation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source-in&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 3. å¡«å……ç›®æ ‡é¢œè‰²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.fillStyle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> targetColor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 4. æ¢å¤æ··åˆæ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.globalCompositeOperation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source-over&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resultCanvas;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>å¤„ç†æµç¨‹ï¼š</strong></p><ol><li>å¤åˆ¶sourceCanvasåˆ°æ–°Canvas</li><li>ä½¿ç”¨<code>source-in</code>æ¨¡å¼ï¼šåªä¿ç•™ä¸sourceé‡å çš„ä¸é€æ˜åŒºåŸŸ</li><li>å¡«å……ç›®æ ‡é¢œè‰²ï¼ˆ<code>AUTO_MASK_HOVER_FILL_COLOR = &#39;rgba(20, 179, 210, 0.16)&#39;</code>ï¼‰</li><li>è¿”å›é¢œè‰²åŒ–åçš„Canvas</li></ol><p><strong>CanvasçŠ¶æ€ï¼š</strong></p><ul><li><code>colorCanvas</code>ï¼šmaskåŒºåŸŸå¡«å……ä¸ºåŠé€æ˜é’è‰²ï¼ŒèƒŒæ™¯é€æ˜</li></ul><h4 id="æ­¥éª¤12-ç»˜åˆ¶å¡«å……è‰²åˆ°targetcanvas" tabindex="-1">æ­¥éª¤12ï¼šç»˜åˆ¶å¡«å……è‰²åˆ°targetCanvas <a class="header-anchor" href="#æ­¥éª¤12-ç»˜åˆ¶å¡«å……è‰²åˆ°targetcanvas" aria-label="Permalink to &quot;æ­¥éª¤12ï¼šç»˜åˆ¶å¡«å……è‰²åˆ°targetCanvas&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 115è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">targetCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(colorCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, targetCanvas.width, targetCanvas.height);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> å°†é¢œè‰²åŒ–çš„maskç»˜åˆ¶åˆ°targetCanvasï¼ˆselectionCanvasï¼‰ã€‚</p><p><strong>CanvasçŠ¶æ€ï¼š</strong></p><ul><li><code>targetCanvas</code>ï¼šåŒ…å«åŠé€æ˜é’è‰²å¡«å……çš„maskåŒºåŸŸ</li></ul><h4 id="æ­¥éª¤13-æ¸…ç†colorcanvas" tabindex="-1">æ­¥éª¤13ï¼šæ¸…ç†colorCanvas <a class="header-anchor" href="#æ­¥éª¤13-æ¸…ç†colorcanvas" aria-label="Permalink to &quot;æ­¥éª¤13ï¼šæ¸…ç†colorCanvas&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 116è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleanCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(colorCanvas);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> é‡Šæ”¾colorCanvaså†…å­˜ã€‚</p><h4 id="æ­¥éª¤14-è¿”å›resultcanvas" tabindex="-1">æ­¥éª¤14ï¼šè¿”å›resultCanvas <a class="header-anchor" href="#æ­¥éª¤14-è¿”å›resultcanvas" aria-label="Permalink to &quot;æ­¥éª¤14ï¼šè¿”å›resultCanvas&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 118è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resultCanvas;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> è¿”å›åŒ…å«å†…é˜´å½±è¾¹æ¡†çš„resultCanvasã€‚</p><p><strong>æ³¨æ„ï¼š</strong> å®é™…ä»£ç ä¸­ï¼ŒresultCanvasåŒ…å«è¾¹æ¡†æ•ˆæœï¼Œä½†targetCanvaså·²ç»˜åˆ¶å¡«å……è‰²ã€‚åç»­çš„<code>addBorderToCanvas</code>å‡½æ•°ä¼šè¿›ä¸€æ­¥å¤„ç†resultCanvasã€‚</p><h3 id="_5-4-addbordertocanvaså‡½æ•°è§£æ" tabindex="-1">5.4 addBorderToCanvaså‡½æ•°è§£æ <a class="header-anchor" href="#_5-4-addbordertocanvaså‡½æ•°è§£æ" aria-label="Permalink to &quot;5.4 addBorderToCanvaså‡½æ•°è§£æ&quot;">â€‹</a></h3><p><strong>å‡½æ•°ç­¾åï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addBorderToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  sourceCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// layer.maskCanvas</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  targetCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// selectionCanvas</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    borderColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾¹æ¡†é¢œè‰²</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    borderWidth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾¹æ¡†å®½åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>è°ƒç”¨æµç¨‹ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts:132-137</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addBorderToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layer.maskCanvas, hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  borderWidth:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layer.maskCanvas.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pixelRatio.value,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  borderColor: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AUTO_MASK_HOVER_BORDER_COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="æ­¥éª¤1-è°ƒç”¨addinsetshadowtocanvasç”Ÿæˆå†…é˜´å½±" tabindex="-1">æ­¥éª¤1ï¼šè°ƒç”¨addInsetShadowToCanvasç”Ÿæˆå†…é˜´å½± <a class="header-anchor" href="#æ­¥éª¤1-è°ƒç”¨addinsetshadowtocanvasç”Ÿæˆå†…é˜´å½±" aria-label="Permalink to &quot;æ­¥éª¤1ï¼šè°ƒç”¨addInsetShadowToCanvasç”Ÿæˆå†…é˜´å½±&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// canvas.ts:132-137</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> insetShadowCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addInsetShadowToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, targetCanvas, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  blur: options.borderWidth,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  color: options.borderColor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  offsetX: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  offsetY: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> è°ƒç”¨å†…é˜´å½±å‡½æ•°ï¼Œç”ŸæˆåŒ…å«è¾¹æ¡†æ•ˆæœçš„Canvasã€‚</p><p><strong>è¿”å›ç»“æœï¼š</strong></p><ul><li><code>insetShadowCanvas</code>ï¼šåŒ…å«å†…é˜´å½±è¾¹æ¡†çš„Canvasï¼ˆmaskåŒºåŸŸæœ‰é’è‰²è¾¹æ¡†æ•ˆæœï¼‰</li></ul><p><strong>æ³¨æ„ï¼š</strong> åœ¨<code>addInsetShadowToCanvas</code>å†…éƒ¨ï¼Œå·²æ‰§è¡Œæ­¥éª¤11-12ï¼Œå°†å¡«å……è‰²ç»˜åˆ¶åˆ°targetCanvasã€‚</p><h4 id="æ­¥éª¤2-é‡å¤ç»˜åˆ¶å¼ºåŒ–è¾¹æ¡†æ•ˆæœ" tabindex="-1">æ­¥éª¤2ï¼šé‡å¤ç»˜åˆ¶å¼ºåŒ–è¾¹æ¡†æ•ˆæœ <a class="header-anchor" href="#æ­¥éª¤2-é‡å¤ç»˜åˆ¶å¼ºåŒ–è¾¹æ¡†æ•ˆæœ" aria-label="Permalink to &quot;æ­¥éª¤2ï¼šé‡å¤ç»˜åˆ¶å¼ºåŒ–è¾¹æ¡†æ•ˆæœ&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// canvas.ts:140-149</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> insetShadowCtx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> insetShadowCanvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  insetShadowCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    insetShadowCanvas,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    insetShadowCanvas.width,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    insetShadowCanvas.height,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> å°†insetShadowCanvasç»˜åˆ¶åˆ°è‡ªèº«ï¼Œé‡å¤50æ¬¡ï¼Œå¼ºåŒ–è¾¹æ¡†çš„ä¸é€æ˜åº¦ã€‚</p><p><strong>å åŠ åŸç†ï¼š</strong></p><p>æ¯æ¬¡<code>drawImage</code>ä½¿ç”¨<code>source-over</code>æ··åˆæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼ŒåŠé€æ˜å†…å®¹å åŠ ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>åˆå§‹è¾¹æ¡†ä¸é€æ˜åº¦ï¼šÎ±â‚€ â‰ˆ 10-20%ï¼ˆç”±shadowBlurç”Ÿæˆï¼‰</span></span>
<span class="line"><span>ç¬¬1æ¬¡å åŠ ï¼šÎ±â‚ = Î±â‚€ + Î±â‚€ Ã— (1 - Î±â‚€)</span></span>
<span class="line"><span>ç¬¬2æ¬¡å åŠ ï¼šÎ±â‚‚ = Î±â‚ + Î±â‚€ Ã— (1 - Î±â‚)</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>ç¬¬50æ¬¡å åŠ ï¼šÎ±â‚…â‚€ â‰ˆ 99%ï¼ˆæ¥è¿‘å®Œå…¨ä¸é€æ˜ï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>æ•°å­¦æ¨å¯¼ï¼ˆç®€åŒ–ï¼‰ï¼š</strong></p><p>å‡è®¾æ¯æ¬¡å åŠ å¢åŠ å›ºå®šæ¯”ä¾‹çš„ä¸é€æ˜åº¦å¢é‡ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Î±â‚™ = 1 - (1 - Î±â‚€)^(n+1)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>å½“Î±â‚€ = 0.1ï¼Œn = 50æ—¶ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Î±â‚…â‚€ = 1 - (1 - 0.1)^51 â‰ˆ 0.995</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>è§†è§‰æ•ˆæœï¼š</strong></p><ul><li>è¾¹æ¡†ä»æ·¡é’è‰²é€æ¸å˜æµ“</li><li>50æ¬¡åè¾¾åˆ°æ¥è¿‘å®Œå…¨ä¸é€æ˜çš„æ¸…æ™°è¾¹æ¡†</li></ul><h4 id="æ­¥éª¤3-ç»˜åˆ¶è¾¹æ¡†åˆ°targetcanvas" tabindex="-1">æ­¥éª¤3ï¼šç»˜åˆ¶è¾¹æ¡†åˆ°targetCanvas <a class="header-anchor" href="#æ­¥éª¤3-ç»˜åˆ¶è¾¹æ¡†åˆ°targetcanvas" aria-label="Permalink to &quot;æ­¥éª¤3ï¼šç»˜åˆ¶è¾¹æ¡†åˆ°targetCanvas&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// canvas.ts:151è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">targetCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(insetShadowCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, targetCanvas.width, targetCanvas.height);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> å°†å¼ºåŒ–åçš„è¾¹æ¡†æ•ˆæœç»˜åˆ¶åˆ°targetCanvasï¼ˆselectionCanvasï¼‰ã€‚</p><p><strong>CanvasçŠ¶æ€ï¼š</strong></p><ul><li><code>targetCanvas</code>ï¼šåŒ…å«å¡«å……è‰²ï¼ˆæ­¥éª¤11-12ï¼‰å’Œè¾¹æ¡†ï¼ˆå½“å‰æ­¥éª¤ï¼‰</li></ul><p><strong>å›¾å±‚å åŠ ï¼š</strong></p><ul><li>åº•å±‚ï¼šåŠé€æ˜é’è‰²å¡«å……ï¼ˆ<code>rgba(20, 179, 210, 0.16)</code>ï¼‰</li><li>ä¸Šå±‚ï¼šæ¸…æ™°çš„é’è‰²è¾¹æ¡†ï¼ˆ<code>#33C8E6</code>ï¼‰</li></ul><h4 id="æ­¥éª¤4-æ¸…ç†insetshadowcanvas" tabindex="-1">æ­¥éª¤4ï¼šæ¸…ç†insetShadowCanvas <a class="header-anchor" href="#æ­¥éª¤4-æ¸…ç†insetshadowcanvas" aria-label="Permalink to &quot;æ­¥éª¤4ï¼šæ¸…ç†insetShadowCanvas&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// canvas.ts:153è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleanCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(insetShadowCanvas);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong> é‡Šæ”¾insetShadowCanvaså†…å­˜ã€‚</p><h3 id="_5-5-é¢œè‰²ç”Ÿæˆä¸å åŠ æœºåˆ¶" tabindex="-1">5.5 é¢œè‰²ç”Ÿæˆä¸å åŠ æœºåˆ¶ <a class="header-anchor" href="#_5-5-é¢œè‰²ç”Ÿæˆä¸å åŠ æœºåˆ¶" aria-label="Permalink to &quot;5.5 é¢œè‰²ç”Ÿæˆä¸å åŠ æœºåˆ¶&quot;">â€‹</a></h3><h4 id="å¡«å……è‰²çš„ç”Ÿæˆ" tabindex="-1">å¡«å……è‰²çš„ç”Ÿæˆ <a class="header-anchor" href="#å¡«å……è‰²çš„ç”Ÿæˆ" aria-label="Permalink to &quot;å¡«å……è‰²çš„ç”Ÿæˆ&quot;">â€‹</a></h4><p><strong>colorizeCanvaså‡½æ•°å¤„ç†æµç¨‹ï¼š</strong></p><ol><li><p><strong>å¤åˆ¶sourceCanvas</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>ç»“æœï¼šresultCanvasåŒ…å«ç™½è‰²maskåŒºåŸŸå’Œé€æ˜èƒŒæ™¯</li></ul></li><li><p><strong>source-inæ··åˆæ¨¡å¼</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.globalCompositeOperation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source-in&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>ä½œç”¨ï¼šåªä¿ç•™ä¸sourceé‡å çš„ä¸é€æ˜åŒºåŸŸ</li><li>ç»“æœï¼šresultCanvasä»…ä¿ç•™maskåŒºåŸŸï¼ŒèƒŒæ™¯å®Œå…¨é€æ˜</li></ul></li><li><p><strong>å¡«å……ç›®æ ‡é¢œè‰²</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.fillStyle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AUTO_MASK_HOVER_FILL_COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;rgba(20, 179, 210, 0.16)&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>   - ä½œç”¨ï¼šå¡«å……æ•´ä¸ªCanvasï¼Œä½†ç”±äºsource-iné™åˆ¶ï¼Œä»…maskåŒºåŸŸè¢«å¡«å……</span></span>
<span class="line"><span>   - ç»“æœï¼šmaskåŒºåŸŸå˜ä¸ºåŠé€æ˜é’è‰²ï¼ŒèƒŒæ™¯ä¿æŒé€æ˜</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**æœ€ç»ˆæ•ˆæœï¼š**</span></span>
<span class="line"><span>- maskåŒºåŸŸï¼š\`rgba(20, 179, 210, 0.16)\`ï¼ˆ16%ä¸é€æ˜åº¦çš„é’è‰²ï¼‰</span></span>
<span class="line"><span>- èƒŒæ™¯ï¼šå®Œå…¨é€æ˜</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#### è¾¹æ¡†è‰²çš„ç”Ÿæˆ</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**å†…é˜´å½±ç”Ÿæˆæµç¨‹ï¼š**</span></span>
<span class="line"><span></span></span>
<span class="line"><span>1. **é˜´å½±è§¦å‘**</span></span>
<span class="line"><span>   \`\`\`typescript</span></span>
<span class="line"><span>   resultCtx.shadowBlur = blur;</span></span>
<span class="line"><span>   resultCtx.shadowColor = color; // &#39;#33C8E6&#39;</span></span>
<span class="line"><span>   resultCtx.drawImage(sourceCanvas, ...);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>ä½œç”¨ï¼šåœ¨maskè¾¹ç¼˜ç”Ÿæˆæ¨¡ç³Šçš„é’è‰²é˜´å½±</li></ul><ol start="2"><li><strong>destination-inè£å‰ª</strong></li></ol><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.globalCompositeOperation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;destination-in&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>ä½œç”¨ï¼šæˆªæ–­å¤–ä¾§é˜´å½±ï¼Œä»…ä¿ç•™å†…ä¾§é˜´å½±</li></ul><ol start="3"><li><p><strong>é‡å¤å¼ºåŒ–</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    insetShadowCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(insetShadowCanvas, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>ä½œç”¨ï¼šé€šè¿‡å åŠ æé«˜è¾¹æ¡†ä¸é€æ˜åº¦</li></ul></li></ol><p><strong>æœ€ç»ˆæ•ˆæœï¼š</strong></p><ul><li>è¾¹æ¡†ï¼šæ¥è¿‘å®Œå…¨ä¸é€æ˜çš„é’è‰²ï¼ˆ<code>#33C8E6</code>ï¼‰</li><li>ä¸­å¿ƒåŒºåŸŸï¼šè¢«maskè¦†ç›–ï¼Œä¸å¯è§</li></ul><h4 id="å›¾å±‚å åŠ å…³ç³»" tabindex="-1">å›¾å±‚å åŠ å…³ç³» <a class="header-anchor" href="#å›¾å±‚å åŠ å…³ç³»" aria-label="Permalink to &quot;å›¾å±‚å åŠ å…³ç³»&quot;">â€‹</a></h4><p><strong>targetCanvasï¼ˆselectionCanvasï¼‰çš„æœ€ç»ˆçŠ¶æ€ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>targetCanvaså›¾å±‚ç»“æ„ï¼ˆä»åº•åˆ°é¡¶ï¼‰ï¼š</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  1. åŠé€æ˜é’è‰²å¡«å……            â”‚ â† colorCanvasç»˜åˆ¶</span></span>
<span class="line"><span>â”‚     rgba(20, 179, 210, 0.16) â”‚</span></span>
<span class="line"><span>â”‚                              â”‚</span></span>
<span class="line"><span>â”‚  2. æ¸…æ™°é’è‰²è¾¹æ¡†              â”‚ â† insetShadowCanvasç»˜åˆ¶</span></span>
<span class="line"><span>â”‚     #33C8E6 (ä¸é€æ˜)         â”‚</span></span>
<span class="line"><span>â”‚                              â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>è§†è§‰å‘ˆç°ï¼š</strong></p><ul><li>maskåŒºåŸŸä¸­å¿ƒï¼šåŠé€æ˜é’è‰²å¡«å……ï¼ˆ16%ä¸é€æ˜åº¦ï¼‰</li><li>maskåŒºåŸŸè¾¹ç¼˜ï¼šæ¸…æ™°çš„é’è‰²è¾¹æ¡†ï¼ˆ100%ä¸é€æ˜åº¦ï¼‰</li><li>èƒŒæ™¯ï¼šå®Œå…¨é€æ˜</li></ul><h3 id="_5-6-è¾¹æ¡†å®½åº¦çš„è‡ªé€‚åº”è®¡ç®—åŸç†" tabindex="-1">5.6 è¾¹æ¡†å®½åº¦çš„è‡ªé€‚åº”è®¡ç®—åŸç† <a class="header-anchor" href="#_5-6-è¾¹æ¡†å®½åº¦çš„è‡ªé€‚åº”è®¡ç®—åŸç†" aria-label="Permalink to &quot;5.6 è¾¹æ¡†å®½åº¦çš„è‡ªé€‚åº”è®¡ç®—åŸç†&quot;">â€‹</a></h3><h4 id="é—®é¢˜-ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€è®¡ç®—" tabindex="-1">é—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€è®¡ç®—ï¼Ÿ <a class="header-anchor" href="#é—®é¢˜-ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€è®¡ç®—" aria-label="Permalink to &quot;é—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€è®¡ç®—ï¼Ÿ&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">borderWidth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layer.maskCanvas.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  pixelRatio.value;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™ä¸ªå…¬å¼çœ‹èµ·æ¥å¤æ‚ï¼ŒèƒŒåè§£å†³çš„æ˜¯ä¸€ä¸ªé‡è¦é—®é¢˜ï¼š<strong>åœ¨ä¸åŒç¼©æ”¾å’Œä¸åŒè®¾å¤‡ä¸Šï¼Œå¦‚ä½•ä¿æŒè¾¹æ¡†çš„è§†è§‰ä¸€è‡´æ€§ï¼Ÿ</strong></p><h4 id="åœºæ™¯1-ç¼©æ”¾å¯¼è‡´çš„è§†è§‰ä¸ä¸€è‡´" tabindex="-1">åœºæ™¯1ï¼šç¼©æ”¾å¯¼è‡´çš„è§†è§‰ä¸ä¸€è‡´ <a class="header-anchor" href="#åœºæ™¯1-ç¼©æ”¾å¯¼è‡´çš„è§†è§‰ä¸ä¸€è‡´" aria-label="Permalink to &quot;åœºæ™¯1ï¼šç¼©æ”¾å¯¼è‡´çš„è§†è§‰ä¸ä¸€è‡´&quot;">â€‹</a></h4><p>å‡è®¾æˆ‘ä»¬å›ºå®šè¾¹æ¡†å®½åº¦ä¸º4åƒç´ ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>åŸå§‹maskï¼š2000pxå®½</span></span>
<span class="line"><span>è¾¹æ¡†ï¼š4px</span></span>
<span class="line"><span>è§†è§‰å æ¯”ï¼š4 / 2000 = 0.2%</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç¼©å°æ˜¾ç¤ºåˆ°500pxï¼š</span></span>
<span class="line"><span>è¾¹æ¡†ï¼šè¿˜æ˜¯4px</span></span>
<span class="line"><span>è§†è§‰å æ¯”ï¼š4 / 500 = 0.8%</span></span>
<span class="line"><span>ç»“æœï¼šè¾¹æ¡†çœ‹èµ·æ¥ç²—äº†4å€ï¼</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>ç”¨æˆ·ä½“éªŒé—®é¢˜ï¼š</strong></p><ul><li>ç¼©å°æŸ¥çœ‹å…¨å›¾æ—¶ï¼Œè¾¹æ¡†æ˜¾å¾—å¾ˆç²—ï¼Œé®æŒ¡å†…å®¹</li><li>æ”¾å¤§æŸ¥çœ‹ç»†èŠ‚æ—¶ï¼Œè¾¹æ¡†æ˜¾å¾—å¾ˆç»†ï¼Œçœ‹ä¸æ¸…</li></ul><h4 id="åœºæ™¯2-é«˜dpiå±å¹•çš„æ¨¡ç³Šé—®é¢˜" tabindex="-1">åœºæ™¯2ï¼šé«˜DPIå±å¹•çš„æ¨¡ç³Šé—®é¢˜ <a class="header-anchor" href="#åœºæ™¯2-é«˜dpiå±å¹•çš„æ¨¡ç³Šé—®é¢˜" aria-label="Permalink to &quot;åœºæ™¯2ï¼šé«˜DPIå±å¹•çš„æ¨¡ç³Šé—®é¢˜&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ™®é€šå±å¹•ï¼ˆDPR=1ï¼‰ï¼š</span></span>
<span class="line"><span>4px CSSåƒç´  = 4px ç‰©ç†åƒç´  âœ“</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Retinaå±å¹•ï¼ˆDPR=2ï¼‰ï¼š</span></span>
<span class="line"><span>4px CSSåƒç´  = 4px Ã— 2 = 8px ç‰©ç†åƒç´ </span></span>
<span class="line"><span>ä½†canvasçš„åƒç´ æ¯”ä¾‹å¯èƒ½æ²¡æœ‰é€‚é…</span></span>
<span class="line"><span>ç»“æœï¼š4px / 2 = 2px ç‰©ç†åƒç´ ï¼ˆçœ‹èµ·æ¥å¾ˆç»†å¾ˆæ¨¡ç³Šï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="è§£å†³æ–¹æ¡ˆæ‹†è§£" tabindex="-1">è§£å†³æ–¹æ¡ˆæ‹†è§£ <a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆæ‹†è§£" aria-label="Permalink to &quot;è§£å†³æ–¹æ¡ˆæ‹†è§£&quot;">â€‹</a></h4><p><strong>ç¬¬ä¸€éƒ¨åˆ†ï¼šç¼©æ”¾ç³»æ•°è®¡ç®—</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layer.maskCanvas.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.width;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>è®¡ç®—é€»è¾‘ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>layer.maskCanvas.width = 2000pxï¼ˆåŸå§‹maskå°ºå¯¸ï¼‰</span></span>
<span class="line"><span>hoverCanvasRef.value!.width = 500pxï¼ˆå½“å‰æ˜¾ç¤ºå°ºå¯¸ï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç¼©æ”¾æ¯”ä¾‹ = 2000 / 500 = 4å€ç¼©å°</span></span>
<span class="line"><span></span></span>
<span class="line"><span>è¾¹æ¡†å®½åº¦ç³»æ•° = 2 Ã— 4 = 8</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆè¦ä¹˜ä»¥2ï¼Ÿ</strong></p><ul><li>è¿™æ˜¯ä¸€ä¸ªè°ƒæ•´ç³»æ•°ï¼Œç¡®ä¿è¾¹æ¡†åœ¨ä»»ä½•å°ºå¯¸ä¸‹éƒ½ä¸ä¼šå¤ªç»†</li><li>2è¿™ä¸ªæ•°å€¼æ˜¯é€šè¿‡å¤§é‡å®é™…æµ‹è¯•ç¡®å®šçš„ç»éªŒå€¼</li><li>å¦‚æœä¸ä¹˜2ï¼Œåœ¨å¤§å›¾ä¸Šè¾¹æ¡†ä¼šæ˜¾å¾—å¤ªç»†</li></ul><p><strong>ç¬¬äºŒéƒ¨åˆ†ï¼šæœ€å°å€¼ä¿æŠ¤</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ç¡®ä¿è¾¹æ¡†è‡³å°‘æœ‰1åƒç´ å®½ï¼š</p><ul><li>åœ¨æç«¯ç¼©æ”¾æƒ…å†µä¸‹ï¼Œè®¡ç®—ç»“æœå¯èƒ½å°äº1</li><li>å°äº1åƒç´ çš„è¾¹æ¡†åŸºæœ¬çœ‹ä¸è§</li><li>å¼ºåˆ¶è®¾ç½®ä¸ºè‡³å°‘1åƒç´ ï¼Œä¿è¯å¯è§æ€§</li></ul><p><strong>ç¬¬ä¸‰éƒ¨åˆ†ï¼šDPIé€‚é…</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pixelRatio.value</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ä¸åŒè®¾å¤‡çš„åƒç´ æ¯”ä¾‹ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ™®é€šå±å¹•ï¼špixelRatio = 1ï¼Œä¸ç¼©æ”¾</span></span>
<span class="line"><span>Retinaå±å¹•ï¼ˆMacBook Proï¼‰ï¼špixelRatio = 2ï¼Œè¾¹æ¡†ç¿»å€</span></span>
<span class="line"><span>4Ké«˜å¯†åº¦å±å¹•ï¼špixelRatio = 3æˆ–4ï¼Œè¾¹æ¡†ç›¸åº”å¢åŠ </span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>å®é™…è®¡ç®—ç¤ºä¾‹ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>åŸå§‹maskï¼š2000px</span></span>
<span class="line"><span>æ˜¾ç¤ºå°ºå¯¸ï¼š500px</span></span>
<span class="line"><span>è®¾å¤‡ï¼šRetinaå±å¹•ï¼ˆpixelRatio = 2ï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>borderWidth = Math.max(1, (2 Ã— 2000) / 500) Ã— 2</span></span>
<span class="line"><span>           = Math.max(1, 4000 / 500) Ã— 2</span></span>
<span class="line"><span>           = Math.max(1, 8) Ã— 2</span></span>
<span class="line"><span>           = 8 Ã— 2</span></span>
<span class="line"><span>           = 16px</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æœ€ç»ˆè¾¹æ¡†å®½åº¦ï¼š16pxï¼ˆåœ¨Retinaå±å¹•ä¸Šç›¸å½“äº8pxçš„è§†è§‰æ•ˆæœï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="ä¸ºä»€ä¹ˆè¿™æ ·å°±èƒ½ä¿è¯è§†è§‰ä¸€è‡´" tabindex="-1">ä¸ºä»€ä¹ˆè¿™æ ·å°±èƒ½ä¿è¯è§†è§‰ä¸€è‡´ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¿™æ ·å°±èƒ½ä¿è¯è§†è§‰ä¸€è‡´" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆè¿™æ ·å°±èƒ½ä¿è¯è§†è§‰ä¸€è‡´ï¼Ÿ&quot;">â€‹</a></h4><p><strong>æ ¸å¿ƒåŸç†ï¼š</strong> è¾¹æ¡†å®½åº¦ä¸maskçš„ç¼©æ”¾æ¯”ä¾‹æˆæ­£æ¯”ï¼Œä¸è®¾å¤‡DPIæˆæ­£æ¯”ã€‚</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>è§†è§‰å æ¯” = borderWidth / æ˜¾ç¤ºå®½åº¦</span></span>
<span class="line"><span>        = (ç¼©æ”¾ç³»æ•° Ã— DPI) / æ˜¾ç¤ºå®½åº¦</span></span>
<span class="line"><span>        = å¸¸æ•°ï¼ˆåœ¨ä¸åŒæƒ…å†µä¸‹è¿‘ä¼¼ç›¸ç­‰ï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¿™æ ·æ— è®ºç”¨æˆ·æ€ä¹ˆç¼©æ”¾ã€ä½¿ç”¨ä»€ä¹ˆè®¾å¤‡ï¼Œè¾¹æ¡†åœ¨è§†è§‰ä¸Šçš„&quot;ç²—ç»†æ„Ÿ&quot;éƒ½ä¿æŒä¸€è‡´ã€‚</p><h3 id="_5-7-å›¾å±‚å…³ç³»åˆ†æ" tabindex="-1">5.7 å›¾å±‚å…³ç³»åˆ†æ <a class="header-anchor" href="#_5-7-å›¾å±‚å…³ç³»åˆ†æ" aria-label="Permalink to &quot;5.7 å›¾å±‚å…³ç³»åˆ†æ&quot;">â€‹</a></h3><h4 id="hoverçŠ¶æ€çš„å›¾å±‚å…³ç³»" tabindex="-1">HoverçŠ¶æ€çš„å›¾å±‚å…³ç³» <a class="header-anchor" href="#hoverçŠ¶æ€çš„å›¾å±‚å…³ç³»" aria-label="Permalink to &quot;HoverçŠ¶æ€çš„å›¾å±‚å…³ç³»&quot;">â€‹</a></h4><p><strong>Canvaså±‚çº§ç»“æ„ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  åº•å±‚ï¼šåŸå§‹å›¾ç‰‡ï¼ˆImage Elementï¼‰         â”‚</span></span>
<span class="line"><span>â”‚  - ç”¨æˆ·ç¼–è¾‘çš„åŸå§‹å›¾åƒ                    â”‚</span></span>
<span class="line"><span>â”‚  - ä¸å‚ä¸maskæ¸²æŸ“                        â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>              â†“</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  ä¸­å±‚ï¼šmaskCanvasï¼ˆæœ€ç»ˆè’™ç‰ˆï¼‰            â”‚</span></span>
<span class="line"><span>â”‚  - æ˜¾ç¤ºå·²é€‰ä¸­çš„maskåŒºåŸŸ                  â”‚</span></span>
<span class="line"><span>â”‚  - ä½¿ç”¨AUTO_MASK_COLORå¡«å……              â”‚</span></span>
<span class="line"><span>â”‚  - ä»…åœ¨ç‚¹å‡»ç¡®è®¤åæ›´æ–°                    â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>              â†“</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  é¡¶å±‚ï¼šselectionCanvasï¼ˆäº¤äº’é¢„è§ˆï¼‰       â”‚</span></span>
<span class="line"><span>â”‚  - Hoveræ—¶æ˜¾ç¤ºé«˜äº®è¾¹æ¡†å’Œå¡«å……             â”‚</span></span>
<span class="line"><span>â”‚  - åŒ…å«colorCanvasï¼ˆå¡«å……è‰²ï¼‰             â”‚</span></span>
<span class="line"><span>â”‚  - åŒ…å«insetShadowCanvasï¼ˆè¾¹æ¡†ï¼‰        â”‚</span></span>
<span class="line"><span>â”‚  - é¼ æ ‡ç¦»å¼€æ—¶æ¸…ç©º                        â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>Hoveræ—¶çš„æ¸²æŸ“æµç¨‹ï¼š</strong></p><ol><li><strong>æ¸…ç©ºselectionCanvas</strong></li></ol><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clearRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>æ¸…é™¤ä¹‹å‰çš„é«˜äº®æ•ˆæœ</li></ul><ol start="2"><li><p><strong>ç»˜åˆ¶å¡«å……è‰²</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// addInsetShadowToCanvaså†…éƒ¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">targetCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(colorCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>åœ¨selectionCanvasä¸Šç»˜åˆ¶åŠé€æ˜é’è‰²å¡«å……</li></ul></li><li><p><strong>ç»˜åˆ¶è¾¹æ¡†</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// addBorderToCanvas</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">targetCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(insetShadowCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>åœ¨selectionCanvasä¸Šç»˜åˆ¶æ¸…æ™°é’è‰²è¾¹æ¡†</li></ul></li></ol><p><strong>æœ€ç»ˆè§†è§‰æ•ˆæœï¼š</strong></p><ul><li>ç”¨æˆ·çœ‹åˆ°ï¼šmaskåŒºåŸŸæœ‰åŠé€æ˜é’è‰²å¡«å……å’Œæ¸…æ™°é’è‰²è¾¹æ¡†</li><li>maskCanvasï¼šä¿æŒä¸å˜ï¼ˆæ˜¾ç¤ºå·²é€‰ä¸­çš„maskï¼‰</li><li>selectionCanvasï¼šæ˜¾ç¤ºå½“å‰hoverçš„layerçš„é«˜äº®æ•ˆæœ</li></ul><h4 id="clickçŠ¶æ€çš„å›¾å±‚å…³ç³»" tabindex="-1">ClickçŠ¶æ€çš„å›¾å±‚å…³ç³» <a class="header-anchor" href="#clickçŠ¶æ€çš„å›¾å±‚å…³ç³»" aria-label="Permalink to &quot;ClickçŠ¶æ€çš„å›¾å±‚å…³ç³»&quot;">â€‹</a></h4><p><strong>Clickåçš„æ¸²æŸ“æµç¨‹ï¼š</strong></p><ol><li><p><strong>åˆ‡æ¢layeré€‰ä¸­çŠ¶æ€</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toggleLayerMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>æ›´æ–°layerçš„modeå±æ€§ï¼ˆnull â†” &#39;source-over&#39;ï¼‰</li></ul></li><li><p><strong>åˆå¹¶æ‰€æœ‰é€‰ä¸­çš„mask</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> maskResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMaskResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> finalMask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maskResult.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AUTO_MASK_COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>åˆå¹¶æ‰€æœ‰modeä¸º&#39;source-over&#39;çš„layer</li><li>ç”Ÿæˆæœ€ç»ˆmask Canvas</li></ul></li><li><p><strong>æ›´æ–°maskCanvas</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">maskResultChange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?.(finalMask, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSnapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>å°†æœ€ç»ˆmaskç»˜åˆ¶åˆ°maskCanvas</li><li>maskCanvasæ˜¾ç¤ºæ‰€æœ‰å·²é€‰ä¸­çš„maskåŒºåŸŸ</li></ul></li><li><p><strong>ç»§ç»­æ˜¾ç¤ºhoveré«˜äº®</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleHoverMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>selectionCanvasç»§ç»­æ˜¾ç¤ºå½“å‰hoverçš„layeré«˜äº®</li></ul></li></ol><p><strong>æœ€ç»ˆå›¾å±‚çŠ¶æ€ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  maskCanvas                             â”‚</span></span>
<span class="line"><span>â”‚  - æ˜¾ç¤ºæ‰€æœ‰å·²é€‰ä¸­çš„maskï¼ˆåˆå¹¶åï¼‰        â”‚</span></span>
<span class="line"><span>â”‚  - ä½¿ç”¨AUTO_MASK_COLORå¡«å……              â”‚</span></span>
<span class="line"><span>â”‚  - æŒä¹…æ˜¾ç¤ºï¼Œç›´åˆ°ç”¨æˆ·å–æ¶ˆé€‰ä¸­            â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>              â†“</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  selectionCanvas                        â”‚</span></span>
<span class="line"><span>â”‚  - æ˜¾ç¤ºå½“å‰hoverçš„layeré«˜äº®              â”‚</span></span>
<span class="line"><span>â”‚  - ä¸maskCanvaså åŠ æ˜¾ç¤º                 â”‚</span></span>
<span class="line"><span>â”‚  - æä¾›å®æ—¶äº¤äº’åé¦ˆ                     â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>è§†è§‰å‘ˆç°ï¼š</strong></p><ul><li>maskCanvasï¼šæ˜¾ç¤ºæ‰€æœ‰å·²é€‰ä¸­çš„maskåŒºåŸŸï¼ˆå¦‚ï¼šäººç‰©+èƒŒæ™¯ç‰©ä½“ï¼‰</li><li>selectionCanvasï¼šæ˜¾ç¤ºå½“å‰é¼ æ ‡æ‚¬åœçš„layeré«˜äº®ï¼ˆå¦‚ï¼šä»…äººç‰©ï¼‰</li><li>ä¸¤è€…å åŠ ï¼šç”¨æˆ·å¯ä»¥çœ‹åˆ°å·²é€‰ä¸­çš„åŒºåŸŸï¼ˆmaskCanvasï¼‰å’Œå½“å‰å¯é€‰çš„åŒºåŸŸï¼ˆselectionCanvasï¼‰</li></ul><h4 id="å›¾å±‚äº¤äº’é€»è¾‘" tabindex="-1">å›¾å±‚äº¤äº’é€»è¾‘ <a class="header-anchor" href="#å›¾å±‚äº¤äº’é€»è¾‘" aria-label="Permalink to &quot;å›¾å±‚äº¤äº’é€»è¾‘&quot;">â€‹</a></h4><p><strong>çŠ¶æ€è½¬æ¢ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>åˆå§‹çŠ¶æ€ï¼š</span></span>
<span class="line"><span>- maskCanvas: ç©ºç™½</span></span>
<span class="line"><span>- selectionCanvas: ç©ºç™½</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Hover Layer A:</span></span>
<span class="line"><span>- maskCanvas: ç©ºç™½</span></span>
<span class="line"><span>- selectionCanvas: Layer Açš„é«˜äº®</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Click Layer A:</span></span>
<span class="line"><span>- maskCanvas: Layer Aï¼ˆå·²é€‰ä¸­ï¼‰</span></span>
<span class="line"><span>- selectionCanvas: Layer Açš„é«˜äº®ï¼ˆç»§ç»­æ˜¾ç¤ºï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Hover Layer B:</span></span>
<span class="line"><span>- maskCanvas: Layer Aï¼ˆä¿æŒä¸å˜ï¼‰</span></span>
<span class="line"><span>- selectionCanvas: Layer Bçš„é«˜äº®</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Click Layer B:</span></span>
<span class="line"><span>- maskCanvas: Layer A + Layer Bï¼ˆåˆå¹¶ï¼‰</span></span>
<span class="line"><span>- selectionCanvas: Layer Bçš„é«˜äº®ï¼ˆç»§ç»­æ˜¾ç¤ºï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>å…³é”®è®¾è®¡ï¼š</strong></p><ul><li>maskCanvaså’ŒselectionCanvasç‹¬ç«‹ç®¡ç†ï¼Œäº’ä¸å¹²æ‰°</li><li>selectionCanvasä»…ç”¨äºäº¤äº’åé¦ˆï¼Œä¸å½±å“æœ€ç»ˆç»“æœ</li><li>maskCanvaså­˜å‚¨æœ€ç»ˆé€‰ä¸­çŠ¶æ€ï¼ŒæŒä¹…æ˜¾ç¤º</li></ul><h3 id="_5-9-å®Œæ•´æµç¨‹çš„è§†è§‰æ¼”å˜" tabindex="-1">5.9 å®Œæ•´æµç¨‹çš„è§†è§‰æ¼”å˜ <a class="header-anchor" href="#_5-9-å®Œæ•´æµç¨‹çš„è§†è§‰æ¼”å˜" aria-label="Permalink to &quot;5.9 å®Œæ•´æµç¨‹çš„è§†è§‰æ¼”å˜&quot;">â€‹</a></h3><p><strong>è¾“å…¥æ•°æ®ï¼š</strong></p><ul><li><code>sourceCanvas</code>ï¼šlayerçš„maskCanvasï¼ˆç™½è‰²maskåŒºåŸŸï¼Œé€æ˜èƒŒæ™¯ï¼Œ2000Ã—2000pxï¼‰</li><li><code>targetCanvas</code>ï¼šselectionCanvasï¼ˆ500Ã—500pxæ˜¾ç¤ºå°ºå¯¸ï¼‰</li></ul><p><strong>å¤„ç†æµç¨‹çš„CanvasçŠ¶æ€å˜åŒ–ï¼š</strong></p><table tabindex="0"><thead><tr><th>æ­¥éª¤</th><th>Canvas</th><th>å†…å®¹æè¿°</th><th>å…³é”®æ“ä½œ</th></tr></thead><tbody><tr><td>åˆå§‹</td><td>resultCanvas</td><td>ç©ºç™½Canvas</td><td>åˆ›å»º</td></tr><tr><td>åˆå§‹</td><td>tempCanvas</td><td>ç©ºç™½Canvasï¼ˆ2004Ã—2004pxï¼‰</td><td>åˆ›å»ºï¼ˆé¢„ç•™blurç©ºé—´ï¼‰</td></tr><tr><td>æ­¥éª¤4</td><td>tempCanvas</td><td>ä¸­å¿ƒä½ç½®æœ‰ç™½è‰²maskå›¾åƒ</td><td><code>drawImage(sourceCanvas, blur, blur)</code></td></tr><tr><td>æ­¥éª¤5</td><td>tempCanvas</td><td>maskåŒºåŸŸå˜é€æ˜ï¼ŒèƒŒæ™¯å˜ç™½è‰²</td><td>XORæ“ä½œ</td></tr><tr><td>æ­¥éª¤7</td><td>resultCanvas</td><td>ç™½è‰²mask + è¾¹ç¼˜é’è‰²é˜´å½±</td><td><code>drawImage</code>è§¦å‘é˜´å½±</td></tr><tr><td>æ­¥éª¤10</td><td>resultCanvas</td><td>ä»…maskå†…éƒ¨çš„å†…é˜´å½±</td><td><code>destination-in</code>è£å‰ª</td></tr><tr><td>æ­¥éª¤11</td><td>colorCanvas</td><td>maskåŒºåŸŸåŠé€æ˜é’è‰²å¡«å……</td><td><code>colorizeCanvas</code></td></tr><tr><td>æ­¥éª¤12</td><td>targetCanvas</td><td>åŠé€æ˜é’è‰²å¡«å……</td><td><code>drawImage(colorCanvas)</code></td></tr><tr><td>æ­¥éª¤2ï¼ˆaddBorderToCanvasï¼‰</td><td>insetShadowCanvas</td><td>å¼ºåŒ–åçš„è¾¹æ¡†ï¼ˆ50æ¬¡å åŠ ï¼‰</td><td>é‡å¤ç»˜åˆ¶</td></tr><tr><td>æ­¥éª¤3ï¼ˆaddBorderToCanvasï¼‰</td><td>targetCanvas</td><td>å¡«å……è‰² + è¾¹æ¡†</td><td><code>drawImage(insetShadowCanvas)</code></td></tr></tbody></table><p><strong>æœ€ç»ˆè§†è§‰æ•ˆæœï¼š</strong></p><ul><li>maskåŒºåŸŸä¸­å¿ƒï¼šåŠé€æ˜é’è‰²å¡«å……ï¼ˆ16%ä¸é€æ˜åº¦ï¼‰</li><li>maskåŒºåŸŸè¾¹ç¼˜ï¼šæ¸…æ™°é’è‰²è¾¹æ¡†ï¼ˆæ¥è¿‘100%ä¸é€æ˜åº¦ï¼‰</li><li>èƒŒæ™¯ï¼šå®Œå…¨é€æ˜</li></ul><h3 id="_5-8-æŠ€æœ¯æ–¹æ¡ˆçš„ä¼˜åŠ¿ä¸å±€é™" tabindex="-1">5.8 æŠ€æœ¯æ–¹æ¡ˆçš„ä¼˜åŠ¿ä¸å±€é™ <a class="header-anchor" href="#_5-8-æŠ€æœ¯æ–¹æ¡ˆçš„ä¼˜åŠ¿ä¸å±€é™" aria-label="Permalink to &quot;5.8 æŠ€æœ¯æ–¹æ¡ˆçš„ä¼˜åŠ¿ä¸å±€é™&quot;">â€‹</a></h3><h4 id="ä¼˜åŠ¿æ€»ç»“" tabindex="-1">ä¼˜åŠ¿æ€»ç»“ <a class="header-anchor" href="#ä¼˜åŠ¿æ€»ç»“" aria-label="Permalink to &quot;ä¼˜åŠ¿æ€»ç»“&quot;">â€‹</a></h4><p><strong>1. æ€§èƒ½ä¼˜å¼‚</strong></p><ul><li>åˆ©ç”¨CanvasåŸç”ŸshadowBlur APIï¼Œç”±æµè§ˆå™¨å†…æ ¸ä¼˜åŒ–ï¼ˆå¯èƒ½GPUåŠ é€Ÿï¼‰</li><li>ä¸éœ€è¦é€åƒç´ è®¡ç®—ï¼Œé¿å…åŒé‡å¾ªç¯</li><li>å®æ—¶å“åº”ï¼ˆhoveræ—¶å»¶&lt;10msï¼‰ï¼Œç”¨æˆ·æ„Ÿè§‰ä¸åˆ°å¡é¡¿</li></ul><p><strong>2. æ•ˆæœè‡ªç„¶</strong></p><ul><li>æ¨¡ç³Šè¾¹ç¼˜ï¼ŒæŠ—é”¯é½¿æ•ˆæœå¥½</li><li>è§†è§‰æŸ”å’Œï¼Œä¸åƒç¡¬è¾¹æ¡†é‚£æ ·ç”Ÿç¡¬</li><li>é€‚åˆå„ç§å¤æ‚å½¢çŠ¶ï¼ˆå¤´å‘ä¸ã€æ‰‹æŒ‡ç­‰ç»†èŠ‚ï¼‰</li></ul><p><strong>3. å®ç°ç®€æ´</strong></p><ul><li>ä¸éœ€è¦å¤æ‚çš„è¾¹ç•Œæå–ç®—æ³•ï¼ˆMarching Squaresç­‰ï¼‰</li><li>ä¸éœ€è¦ä½å›¾è½¬çŸ¢é‡è·¯å¾„</li><li>çº¦50è¡Œä»£ç å®ç°å®Œæ•´åŠŸèƒ½</li></ul><p><strong>4. æ‰©å±•æ€§å¼º</strong></p><ul><li>è¾¹æ¡†é¢œè‰²ã€å®½åº¦ã€æ¨¡ç³Šåº¦éƒ½å¯çµæ´»è°ƒæ•´</li><li>å¯ä»¥è½»æ¾æ·»åŠ åŠ¨ç”»æ•ˆæœï¼ˆæ”¹å˜é¢œè‰²æˆ–å®½åº¦ï¼‰</li><li>å¯ä»¥é€‚é…ä¸åŒä¸»é¢˜ï¼ˆæš—è‰²/äº®è‰²ï¼‰</li></ul><p><strong>5. å…¼å®¹æ€§å¥½</strong></p><ul><li>ä½¿ç”¨æ ‡å‡†Canvas APIï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ</li><li>ä¸éœ€è¦WebGLæˆ–ç‰¹æ®Šç¡¬ä»¶æ”¯æŒ</li><li>åœ¨ä½æ€§èƒ½è®¾å¤‡ä¸Šä¹Ÿèƒ½æµç•…è¿è¡Œ</li></ul><h4 id="å±€é™ä¸æƒè¡¡" tabindex="-1">å±€é™ä¸æƒè¡¡ <a class="header-anchor" href="#å±€é™ä¸æƒè¡¡" aria-label="Permalink to &quot;å±€é™ä¸æƒè¡¡&quot;">â€‹</a></h4><p><strong>1. è¾¹æ¡†å¿…é¡»æ˜¯æ¨¡ç³Šçš„</strong></p><ul><li>å¦‚æœäº§å“éœ€è¦æ¸…æ™°çš„å®çº¿è¾¹æ¡†ï¼Œæ­¤æ–¹æ¡ˆä¸é€‚ç”¨</li><li>è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥è°ƒæ•´shadowBlurä¸ºæ›´å°å€¼ï¼ˆå¦‚1-2pxï¼‰ï¼Œæ¥è¿‘å®çº¿</li></ul><p><strong>2. é‡å¤ç»˜åˆ¶50æ¬¡çš„å¼€é”€</strong></p><ul><li>è™½ç„¶5mså¯æ¥å—ï¼Œä½†åœ¨æä½æ€§èƒ½è®¾å¤‡ä¸Šå¯èƒ½å¡é¡¿</li><li>è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥æ ¹æ®è®¾å¤‡æ€§èƒ½åŠ¨æ€è°ƒæ•´æ¬¡æ•°ï¼ˆå¦‚ç§»åŠ¨ç«¯å‡å°‘åˆ°20æ¬¡ï¼‰</li></ul><p><strong>3. &quot;é­”æ³•æ•°å­—&quot;ç¼ºä¹ç†è®ºä¾æ®</strong></p><ul><li>50æ¬¡ã€ä¹˜ä»¥2ç­‰æ•°å€¼æ˜¯ç»éªŒå€¼ï¼Œæ²¡æœ‰ç†è®ºå…¬å¼</li><li>ä¸åŒåœºæ™¯å¯èƒ½éœ€è¦ä¸åŒå‚æ•°</li><li>è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥é€šè¿‡A/Bæµ‹è¯•æ‰¾åˆ°æœ€ä¼˜å€¼ï¼Œæˆ–è€…æä¾›é…ç½®é€‰é¡¹</li></ul><p><strong>4. å†…å­˜å¼€é”€</strong></p><ul><li>æ¯æ¬¡hoveréƒ½åˆ›å»ºä¸´æ—¶canvasï¼Œé¢‘ç¹åˆ›å»ºé”€æ¯</li><li>è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥å¤ç”¨ä¸´æ—¶canvasï¼Œè€Œä¸æ˜¯æ¯æ¬¡åˆ›å»ºæ–°çš„</li></ul><h4 id="ä¸å…¶ä»–æ–¹æ¡ˆçš„å¯¹æ¯”" tabindex="-1">ä¸å…¶ä»–æ–¹æ¡ˆçš„å¯¹æ¯” <a class="header-anchor" href="#ä¸å…¶ä»–æ–¹æ¡ˆçš„å¯¹æ¯”" aria-label="Permalink to &quot;ä¸å…¶ä»–æ–¹æ¡ˆçš„å¯¹æ¯”&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ–¹æ¡ˆ</th><th>æ€§èƒ½</th><th>æ•ˆæœ</th><th>å®ç°éš¾åº¦</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>å†…é˜´å½±æŠ€æœ¯ï¼ˆæœ¬æ–¹æ¡ˆï¼‰</strong></td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­</td><td>ä»»æ„å½¢çŠ¶ï¼Œæ¨¡ç³Šè¾¹æ¡†</td></tr><tr><td>ä½å›¾è½¬çŸ¢é‡æè¾¹</td><td>â­â­</td><td>â­â­â­â­â­</td><td>â­</td><td>ç®€å•å½¢çŠ¶ï¼Œæ¸…æ™°è¾¹æ¡†</td></tr><tr><td>é€åƒç´ è¾¹ç•Œæ£€æµ‹</td><td>â­</td><td>â­â­â­</td><td>â­â­â­</td><td>å°å°ºå¯¸å›¾åƒ</td></tr><tr><td>WebGLç€è‰²å™¨</td><td>â­â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­</td><td>éœ€è¦é«˜æ€§èƒ½å’Œé«˜è´¨é‡</td></tr></tbody></table><p><strong>é€‰æ‹©å»ºè®®ï¼š</strong></p><ul><li>å¤§å¤šæ•°åœºæ™¯ï¼šå†…é˜´å½±æŠ€æœ¯ï¼ˆæ€§ä»·æ¯”æœ€é«˜ï¼‰</li><li>è¿½æ±‚æè‡´æ€§èƒ½ï¼šWebGLç€è‰²å™¨ï¼ˆéœ€è¦é¢å¤–å­¦ä¹ æˆæœ¬ï¼‰</li><li>éœ€è¦æ¸…æ™°è¾¹æ¡†ï¼šä½å›¾è½¬çŸ¢é‡ï¼ˆå®ç°å¤æ‚ï¼Œä½†æ•ˆæœæœ€å¥½ï¼‰</li></ul><h3 id="_5-11-æŠ€æœ¯è¦ç‚¹æ€»ç»“" tabindex="-1">5.11 æŠ€æœ¯è¦ç‚¹æ€»ç»“ <a class="header-anchor" href="#_5-11-æŠ€æœ¯è¦ç‚¹æ€»ç»“" aria-label="Permalink to &quot;5.11 æŠ€æœ¯è¦ç‚¹æ€»ç»“&quot;">â€‹</a></h3><p><strong>æ ¸å¿ƒè®¾è®¡æ€è·¯ï¼š</strong></p><p>åˆ©ç”¨Canvasçš„é˜´å½±APIï¼ˆ<code>shadowBlur</code>ï¼‰ç»“åˆæ··åˆæ¨¡å¼ï¼ˆ<code>globalCompositeOperation</code>ï¼‰å®ç°è¾¹æ¡†æ•ˆæœï¼Œè€Œéä¼ ç»Ÿçš„è·¯å¾„æè¾¹ã€‚</p><p><strong>å…³é”®æŠ€æœ¯ç‚¹ï¼š</strong></p><ol><li><strong>XORæ“ä½œ</strong>ï¼šåˆ›å»ºè´Ÿç‰‡æ•ˆæœï¼Œä¸ºé˜´å½±ç”Ÿæˆåšå‡†å¤‡</li><li><strong>shadowBlur + shadowOffset=0</strong>ï¼šç”Ÿæˆå‡åŒ€æ‰©æ•£çš„é˜´å½±å…‰æ™•</li><li><strong>destination-inè£å‰ª</strong>ï¼šé™åˆ¶é˜´å½±ä»…åœ¨maskå†…éƒ¨æ˜¾ç¤º</li><li><strong>é‡å¤å åŠ </strong>ï¼šé€šè¿‡50æ¬¡ç»˜åˆ¶å¼ºåŒ–è¾¹æ¡†ä¸é€æ˜åº¦</li><li><strong>é¢œè‰²å¡«å……</strong>ï¼šä½¿ç”¨<code>colorizeCanvas</code>ç”ŸæˆåŠé€æ˜å¡«å……è‰²</li><li><strong>åŠ¨æ€å®½åº¦è®¡ç®—</strong>ï¼šæ ¹æ®ç¼©æ”¾æ¯”ä¾‹å’Œè®¾å¤‡DPIè‡ªé€‚åº”è¾¹æ¡†å®½åº¦</li></ol><p><strong>å®ç°ä¼˜åŠ¿ï¼š</strong></p><ul><li>æ€§èƒ½ä¼˜å¼‚ï¼šåˆ©ç”¨æµè§ˆå™¨åŸç”ŸAPIï¼Œå¯èƒ½GPUåŠ é€Ÿ</li><li>æ•ˆæœè‡ªç„¶ï¼šæ¨¡ç³Šè¾¹ç¼˜ï¼ŒæŠ—é”¯é½¿æ•ˆæœå¥½</li><li>å®ç°ç®€æ´ï¼šæ— éœ€å¤æ‚çš„è¾¹ç•Œæå–ç®—æ³•</li><li>å…¼å®¹æ€§å¥½ï¼šæ ‡å‡†Canvas APIï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨æ”¯æŒ</li></ul><hr><h2 id="å…­ã€æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ" tabindex="-1">å…­ã€æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ <a class="header-anchor" href="#å…­ã€æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ" aria-label="Permalink to &quot;å…­ã€æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="_6-1-æ€§èƒ½ç“¶é¢ˆåˆ†æ" tabindex="-1">6.1 æ€§èƒ½ç“¶é¢ˆåˆ†æ <a class="header-anchor" href="#_6-1-æ€§èƒ½ç“¶é¢ˆåˆ†æ" aria-label="Permalink to &quot;6.1 æ€§èƒ½ç“¶é¢ˆåˆ†æ&quot;">â€‹</a></h3><p>åœ¨SAMä¸»ä½“é€‰æ‹©åŠŸèƒ½ä¸­ï¼Œå¯èƒ½å‡ºç°æ€§èƒ½é—®é¢˜çš„ç¯èŠ‚ï¼š</p><h4 id="ç“¶é¢ˆ1-åˆå§‹åŒ–é˜¶æ®µ-apiè°ƒç”¨" tabindex="-1">ç“¶é¢ˆ1ï¼šåˆå§‹åŒ–é˜¶æ®µï¼ˆAPIè°ƒç”¨ï¼‰ <a class="header-anchor" href="#ç“¶é¢ˆ1-åˆå§‹åŒ–é˜¶æ®µ-apiè°ƒç”¨" aria-label="Permalink to &quot;ç“¶é¢ˆ1ï¼šåˆå§‹åŒ–é˜¶æ®µï¼ˆAPIè°ƒç”¨ï¼‰&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IAutoMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> factory.apiService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">autoMasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imageUrl);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>é—®é¢˜ï¼š</strong></p><ul><li>åç«¯SAMæ¨¡å‹æ¨ç†éœ€è¦1-3ç§’</li><li>ç½‘ç»œä¼ è¾“maskæ•°æ®ï¼ˆå¯èƒ½å‡ ç™¾KBï¼‰</li><li>ç”¨æˆ·éœ€è¦ç­‰å¾…ï¼Œä½“éªŒä¸ä½³</li></ul><p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. ç¼“å­˜æœºåˆ¶ï¼ˆå·²å®ç°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> jsonMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IAutoMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (jsonMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jsonMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç›´æ¥ä½¿ç”¨ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. é¢„åŠ è½½ï¼ˆå»ºè®®ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onImageLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åœ¨ç”¨æˆ·å¯èƒ½ä½¿ç”¨å‰å°±å¼€å§‹åŠ è½½</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  preloadAutoMasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imageUrl);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. é™ä½å›¾ç‰‡åˆ†è¾¨ç‡ï¼ˆå·²å®ç°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ossUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  width: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é™åˆ¶æœ€å¤§å°ºå¯¸</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  height: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  useDpr: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  forcePngResize: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>æ•ˆæœå¯¹æ¯”ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ— ä¼˜åŒ–ï¼šæ¯æ¬¡ä½¿ç”¨éœ€ç­‰å¾…3ç§’</span></span>
<span class="line"><span>ç¼“å­˜ï¼šäºŒæ¬¡ä½¿ç”¨&lt;10ms</span></span>
<span class="line"><span>é¢„åŠ è½½ï¼šç”¨æˆ·ä½¿ç”¨æ—¶å·²å°±ç»ª</span></span>
<span class="line"><span>é™åˆ†è¾¨ç‡ï¼šå‡å°‘50%å¤„ç†æ—¶é—´</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="ç“¶é¢ˆ2-hoveräº‹ä»¶çš„é«˜é¢‘è§¦å‘" tabindex="-1">ç“¶é¢ˆ2ï¼šHoveräº‹ä»¶çš„é«˜é¢‘è§¦å‘ <a class="header-anchor" href="#ç“¶é¢ˆ2-hoveräº‹ä»¶çš„é«˜é¢‘è§¦å‘" aria-label="Permalink to &quot;ç“¶é¢ˆ2ï¼šHoveräº‹ä»¶çš„é«˜é¢‘è§¦å‘&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvasRef, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mousemove&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handleHoverMask);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>é—®é¢˜ï¼š</strong></p><ul><li>é¼ æ ‡ç§»åŠ¨è§¦å‘é¢‘ç‡é«˜ï¼ˆæ¯ç§’100-200æ¬¡ï¼‰</li><li>æ¯æ¬¡è§¦å‘éƒ½è¦ç»˜åˆ¶é«˜äº®ï¼ˆ5-10msï¼‰</li><li>å¯èƒ½é€ æˆå¡é¡¿æˆ–æ‰å¸§</li></ul><p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. é˜²æŠ–/èŠ‚æµï¼ˆå»ºè®®èŠ‚æµï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> handleHoverMask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> throttle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MouseEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... é«˜äº®é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// çº¦60fpsï¼Œäººçœ¼å¯Ÿè§‰ä¸åˆ°å»¶è¿Ÿ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. é¿å…é‡å¤è®¡ç®—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastLayerId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleHoverMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MouseEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> layer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pickLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (layer?.id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastLayerId) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç›¸åŒlayerï¼Œä¸é‡æ–°ç»˜åˆ¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  lastLayerId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layer?.id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... ç»˜åˆ¶é«˜äº®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. RAFä¼˜åŒ–ï¼ˆé«˜çº§ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rafId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleHoverMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MouseEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (rafId) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å·²æœ‰å¾…å¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  rafId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> requestAnimationFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... é«˜äº®é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rafId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>æ•ˆæœå¯¹æ¯”ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ— ä¼˜åŒ–ï¼š200æ¬¡/ç§’ Ã— 10ms = 2000msï¼ˆå¡æ­»ï¼‰</span></span>
<span class="line"><span>èŠ‚æµï¼ˆ60fpsï¼‰ï¼š60æ¬¡/ç§’ Ã— 10ms = 600msï¼ˆæµç•…ï¼‰</span></span>
<span class="line"><span>é¿å…é‡å¤ï¼šçº¦10æ¬¡/ç§’ Ã— 10ms = 100msï¼ˆå¾ˆæµç•…ï¼‰</span></span>
<span class="line"><span>RAFï¼šçº¦60fpsï¼Œä¸æµè§ˆå™¨åˆ·æ–°ç‡åŒæ­¥ï¼ˆæœ€æµç•…ï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="ç“¶é¢ˆ3-é«˜äº®ç»˜åˆ¶çš„50æ¬¡é‡å¤" tabindex="-1">ç“¶é¢ˆ3ï¼šé«˜äº®ç»˜åˆ¶çš„50æ¬¡é‡å¤ <a class="header-anchor" href="#ç“¶é¢ˆ3-é«˜äº®ç»˜åˆ¶çš„50æ¬¡é‡å¤" aria-label="Permalink to &quot;ç“¶é¢ˆ3ï¼šé«˜äº®ç»˜åˆ¶çš„50æ¬¡é‡å¤&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resultCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>é—®é¢˜ï¼š</strong></p><ul><li>æ¯æ¬¡5msï¼Œè™½ç„¶å¯æ¥å—ï¼Œä½†ä»æœ‰ä¼˜åŒ–ç©ºé—´</li><li>åœ¨ä½æ€§èƒ½è®¾å¤‡ï¼ˆå¦‚æ—§æ¬¾æ‰‹æœºï¼‰ä¸Šå¯èƒ½å¡é¡¿</li></ul><p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. æ ¹æ®è®¾å¤‡æ€§èƒ½åŠ¨æ€è°ƒæ•´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getRepeatCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isMobile </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isLowEnd) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½ç«¯ç§»åŠ¨è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isMobile) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ™®é€šç§»åŠ¨è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¡Œé¢è®¾å¤‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. ç¼“å­˜é«˜äº®ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> highlightCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getHighlightCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">layerId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (highlightCache.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layerId)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> highlightCache.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layerId)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generateHighlight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layer);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  highlightCache.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layerId, canvas);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> canvas;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. Web Workerç¦»å±æ¸²æŸ“ï¼ˆé«˜çº§ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;highlight-worker.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">worker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ layer, options });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">worker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> highlightCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.data;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä½¿ç”¨ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>æ•ˆæœå¯¹æ¯”ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å›ºå®š50æ¬¡ï¼š5ms</span></span>
<span class="line"><span>åŠ¨æ€è°ƒæ•´ï¼ˆç§»åŠ¨ç«¯20æ¬¡ï¼‰ï¼š2ms</span></span>
<span class="line"><span>ç¼“å­˜ç»“æœï¼š&lt;0.1msï¼ˆå·²ç¼“å­˜çš„layerï¼‰</span></span>
<span class="line"><span>Web Workerï¼šä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œç”¨æˆ·æ„ŸçŸ¥é›¶å»¶è¿Ÿ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_6-2-å†…å­˜ç®¡ç†æœ€ä½³å®è·µ" tabindex="-1">6.2 å†…å­˜ç®¡ç†æœ€ä½³å®è·µ <a class="header-anchor" href="#_6-2-å†…å­˜ç®¡ç†æœ€ä½³å®è·µ" aria-label="Permalink to &quot;6.2 å†…å­˜ç®¡ç†æœ€ä½³å®è·µ&quot;">â€‹</a></h3><h4 id="é—®é¢˜-ä¸´æ—¶canvasçš„å†…å­˜æ³„æ¼" tabindex="-1">é—®é¢˜ï¼šä¸´æ—¶Canvasçš„å†…å­˜æ³„æ¼ <a class="header-anchor" href="#é—®é¢˜-ä¸´æ—¶canvasçš„å†…å­˜æ³„æ¼" aria-label="Permalink to &quot;é—®é¢˜ï¼šä¸´æ—¶Canvasçš„å†…å­˜æ³„æ¼&quot;">â€‹</a></h4><p>æ¯æ¬¡hoveréƒ½åˆ›å»ºä¸´æ—¶canvasï¼Œå¦‚æœä¸æ¸…ç†ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é”™è¯¯ç¤ºèŒƒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addBorderToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(...) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(width, height);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resultCanvas; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ²¡æœ‰æ¸…ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>æ­£ç¡®åšæ³•ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. ä½¿ç”¨å®Œç«‹å³æ¸…ç†ï¼ˆå·²å®ç°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addBorderToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(...) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(width, height);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    targetCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resultCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cleanCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resultCanvas); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ“ åŠæ—¶æ¸…ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. å¤ç”¨canvasï¼Œè€Œä¸æ˜¯æ¯æ¬¡åˆ›å»º</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reusableCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getReusableCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">width</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">reusableCanvas) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        reusableCanvas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(width, height);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        reusableCanvas.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> width;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        reusableCanvas.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> height;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reusableCanvas;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. ç”Ÿå‘½å‘¨æœŸç®¡ç†</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onUnmounted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç»„ä»¶é”€æ¯æ—¶æ¸…ç†æ‰€æœ‰èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cleanCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(maskCanvas.value);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cleanCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(selectionCanvas.value);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    jsonMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    autoMaskModel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>å†…å­˜ç›‘æ§ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¼€å‘ç¯å¢ƒç›‘æ§å†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DEV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> frameCount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> checkMemory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    frameCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (frameCount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> performance.memory) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;å†…å­˜ä½¿ç”¨:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        used: (performance.memory.usedJSHeapSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toFixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;MB&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        total: (performance.memory.totalJSHeapSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toFixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;MB&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    requestAnimationFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(checkMemory);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  checkMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_6-3-ä»£ç ç»„ç»‡æœ€ä½³å®è·µ" tabindex="-1">6.3 ä»£ç ç»„ç»‡æœ€ä½³å®è·µ <a class="header-anchor" href="#_6-3-ä»£ç ç»„ç»‡æœ€ä½³å®è·µ" aria-label="Permalink to &quot;6.3 ä»£ç ç»„ç»‡æœ€ä½³å®è·µ&quot;">â€‹</a></h3><h4 id="_1-å…³æ³¨ç‚¹åˆ†ç¦»" tabindex="-1">1. å…³æ³¨ç‚¹åˆ†ç¦» <a class="header-anchor" href="#_1-å…³æ³¨ç‚¹åˆ†ç¦»" aria-label="Permalink to &quot;1. å…³æ³¨ç‚¹åˆ†ç¦»&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>lego/samï¼ˆåº•å±‚åº“ï¼‰       é¡¹ç›®ä»£ç ï¼ˆä¸šåŠ¡å±‚ï¼‰</span></span>
<span class="line"><span>â”œâ”€â”€ æ•°æ®æ¨¡å‹             â”œâ”€â”€ APIè°ƒç”¨</span></span>
<span class="line"><span>â”œâ”€â”€ æ ¸å¿ƒç®—æ³•             â”œâ”€â”€ UIäº¤äº’</span></span>
<span class="line"><span>â””â”€â”€ Maskåˆå¹¶             â”œâ”€â”€ åæ ‡è½¬æ¢</span></span>
<span class="line"><span>                          â”œâ”€â”€ äº‹ä»¶å¤„ç†</span></span>
<span class="line"><span>                          â””â”€â”€ è§†è§‰æ•ˆæœ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>å¥½å¤„ï¼š</strong></p><ul><li>åº•å±‚åº“å¯ç‹¬ç«‹å‡çº§ï¼Œä¸å½±å“ä¸šåŠ¡ä»£ç </li><li>ä¸šåŠ¡ä»£ç å¯å¤ç”¨åº•å±‚èƒ½åŠ›ï¼Œä¸é‡å¤é€ è½®å­</li><li>èŒè´£æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤å’Œæµ‹è¯•</li></ul><h4 id="_2-ç±»å‹å®‰å…¨" tabindex="-1">2. ç±»å‹å®‰å…¨ <a class="header-anchor" href="#_2-ç±»å‹å®‰å…¨" aria-label="Permalink to &quot;2. ç±»å‹å®‰å…¨&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨ä¸¥æ ¼çš„ç±»å‹å®šä¹‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  maskCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source-over&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;destination-out&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¿å…anyç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pickLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskLayer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ˜ç¡®çš„è¿”å›ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_3-é”™è¯¯å¤„ç†" tabindex="-1">3. é”™è¯¯å¤„ç† <a class="header-anchor" href="#_3-é”™è¯¯å¤„ç†" aria-label="Permalink to &quot;3. é”™è¯¯å¤„ç†&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¤„ç†APIå¤±è´¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> factory.apiService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">autoMasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imageUrl);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;æœªè·å–åˆ°æœ‰æ•ˆmaskæ•°æ®&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;è·å–auto maskså¤±è´¥:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // é™çº§æ–¹æ¡ˆï¼šæç¤ºç”¨æˆ·ä½¿ç”¨å…¶ä»–å·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  showToast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;æ™ºèƒ½é€‰åŒºæš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ä½¿ç”¨å¥—ç´¢æˆ–ç”»ç¬”å·¥å…·&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¤„ç†åæ ‡è¶Šç•Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pickLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> height) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åæ ‡è¶Šç•Œï¼Œè¿”å›null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... æ­£å¸¸é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_6-4-ç”¨æˆ·ä½“éªŒä¼˜åŒ–" tabindex="-1">6.4 ç”¨æˆ·ä½“éªŒä¼˜åŒ– <a class="header-anchor" href="#_6-4-ç”¨æˆ·ä½“éªŒä¼˜åŒ–" aria-label="Permalink to &quot;6.4 ç”¨æˆ·ä½“éªŒä¼˜åŒ–&quot;">â€‹</a></h3><h4 id="_1-åŠ è½½çŠ¶æ€æç¤º" tabindex="-1">1. åŠ è½½çŠ¶æ€æç¤º <a class="header-anchor" href="#_1-åŠ è½½çŠ¶æ€æç¤º" aria-label="Permalink to &quot;1. åŠ è½½çŠ¶æ€æç¤º&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> loading</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getAutoMaskModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  loading.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ˜¾ç¤ºloading</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... åŠ è½½é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    loading.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// éšè—loading</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-vue vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v-if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;loading&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;loading-overlay&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Spin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;AIæ­£åœ¨åˆ†æå›¾ç‰‡...&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2-äº¤äº’åé¦ˆ" tabindex="-1">2. äº¤äº’åé¦ˆ <a class="header-anchor" href="#_2-äº¤äº’åé¦ˆ" aria-label="Permalink to &quot;2. äº¤äº’åé¦ˆ&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¼ æ ‡æ ·å¼å˜åŒ–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">canvas.style.cursor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;pointer&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;crosshair&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é«˜äº®é¢œè‰²åŒºåˆ†çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HOVER_COLOR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;#33C8E6&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ‚¬åœï¼šé’è‰²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SELECTED_COLOR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;#FF6B6B&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é€‰ä¸­ï¼šçº¢è‰²</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_3-å¿«æ·é”®æ”¯æŒ" tabindex="-1">3. å¿«æ·é”®æ”¯æŒ <a class="header-anchor" href="#_3-å¿«æ·é”®æ”¯æŒ" aria-label="Permalink to &quot;3. å¿«æ·é”®æ”¯æŒ&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Shifté”®ï¼šåŠ é€‰æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Alté”®ï¼šå‡é€‰æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(document, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;keydown&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e.key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Shift&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    setMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;add&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e.key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Alt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    setMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;subtract&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_6-5-è°ƒè¯•æŠ€å·§" tabindex="-1">6.5 è°ƒè¯•æŠ€å·§ <a class="header-anchor" href="#_6-5-è°ƒè¯•æŠ€å·§" aria-label="Permalink to &quot;6.5 è°ƒè¯•æŠ€å·§&quot;">â€‹</a></h3><h4 id="_1-å¯è§†åŒ–è°ƒè¯•" tabindex="-1">1. å¯è§†åŒ–è°ƒè¯• <a class="header-anchor" href="#_1-å¯è§†åŒ–è°ƒè¯•" aria-label="Permalink to &quot;1. å¯è§†åŒ–è°ƒè¯•&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ˜¾ç¤ºæ‰€æœ‰maskè¾¹ç•Œï¼ˆè°ƒè¯•ç”¨ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DEV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  autoMaskModel.layers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">layer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ctx.strokeStyle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`hsl(\${</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 360</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}, 80%, 50%)\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stroke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layer.path);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layer.id, layer.bbox.x, layer.bbox.y);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_2-æ€§èƒ½ç›‘æ§" tabindex="-1">2. æ€§èƒ½ç›‘æ§ <a class="header-anchor" href="#_2-æ€§èƒ½ç›‘æ§" aria-label="Permalink to &quot;2. æ€§èƒ½ç›‘æ§&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æµ‹é‡å…³é”®æ“ä½œè€—æ—¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> measurePerformance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> performance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> end</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> performance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`[æ€§èƒ½] \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}: \${</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toFixed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}ms\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> layer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> measurePerformance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pickLayer&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pickLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_3-æ•°æ®å¯¼å‡º-ç”¨äºåˆ†æ" tabindex="-1">3. æ•°æ®å¯¼å‡ºï¼ˆç”¨äºåˆ†æï¼‰ <a class="header-anchor" href="#_3-æ•°æ®å¯¼å‡º-ç”¨äºåˆ†æ" aria-label="Permalink to &quot;3. æ•°æ®å¯¼å‡ºï¼ˆç”¨äºåˆ†æï¼‰&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¯¼å‡ºmaskæ•°æ®ç”¨äºåˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> exportMaskData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    imageUrl,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    masks: autoMaskModel.layers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">layer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      id: layer.id,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      area: layer.area,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      bbox: layer.bbox,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æˆ–è€…ä¸‹è½½ä¸ºæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  downloadJSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mask-data.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><hr><h2 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to &quot;æ€»ç»“&quot;">â€‹</a></h2><h3 id="æ ¸å¿ƒè¦ç‚¹å›é¡¾" tabindex="-1">æ ¸å¿ƒè¦ç‚¹å›é¡¾ <a class="header-anchor" href="#æ ¸å¿ƒè¦ç‚¹å›é¡¾" aria-label="Permalink to &quot;æ ¸å¿ƒè¦ç‚¹å›é¡¾&quot;">â€‹</a></h3><ol><li><p><strong>SAMä¸»ä½“é€‰æ‹© = AIé¢„æµ‹ + å‰ç«¯äº¤äº’</strong></p><ul><li>åç«¯ï¼šSAMæ¨¡å‹ç”Ÿæˆå€™é€‰mask</li><li>å‰ç«¯ï¼šç”¨æˆ·äº¤äº’é€‰æ‹©mask</li></ul></li><li><p><strong>å®Œæ•´æµç¨‹</strong></p><ul><li>åˆå§‹åŒ–ï¼šè·å–maskæ•°æ®</li><li>Hoverï¼šå®æ—¶é«˜äº®é¢„è§ˆ</li><li>Clickï¼šç¡®è®¤é€‰ä¸­ï¼Œåˆå¹¶mask</li></ul></li><li><p><strong>èŒè´£åˆ’åˆ†</strong></p><ul><li><code>lego/sam</code>ï¼šæ•°æ®æ¨¡å‹ã€æ ¸å¿ƒç®—æ³•</li><li>é¡¹ç›®ä»£ç ï¼šAPIè°ƒç”¨ã€UIäº¤äº’ã€è§†è§‰æ•ˆæœ</li></ul></li><li><p><strong>é«˜äº®å®ç°çš„ç²¾é«“</strong></p><ul><li>åˆ©ç”¨å†…é˜´å½±æŠ€æœ¯ï¼Œå°†é˜´å½±API&quot;æ»¥ç”¨&quot;ä¸ºè¾¹æ¡†ç»˜åˆ¶</li><li>destination-inå»ºç«‹è¾¹ç•Œ + shadowBlurç”Ÿæˆå…‰æ™• + é‡å¤å¼ºåŒ–</li><li>åŠ¨æ€å®½åº¦è®¡ç®—ï¼Œä¿è¯è§†è§‰ä¸€è‡´æ€§</li></ul></li><li><p><strong>æ€§èƒ½ä¼˜åŒ–å…³é”®</strong></p><ul><li>ç¼“å­˜æœºåˆ¶ï¼ˆAPIç»“æœã€é«˜äº®canvasï¼‰</li><li>èŠ‚æµé˜²æŠ–ï¼ˆhoveräº‹ä»¶ï¼‰</li><li>é¿å…é‡å¤è®¡ç®—ï¼ˆç›¸åŒlayerä¸é‡ç»˜ï¼‰</li><li>å†…å­˜ç®¡ç†ï¼ˆåŠæ—¶æ¸…ç†ä¸´æ—¶canvasï¼‰</li></ul></li></ol><h3 id="æŠ€æœ¯äº®ç‚¹" tabindex="-1">æŠ€æœ¯äº®ç‚¹ <a class="header-anchor" href="#æŠ€æœ¯äº®ç‚¹" aria-label="Permalink to &quot;æŠ€æœ¯äº®ç‚¹&quot;">â€‹</a></h3><ul><li><strong>åˆ›æ–°æ€§</strong>ï¼šå†…é˜´å½±æŠ€æœ¯æ˜¯ä¸€ä¸ªå·§å¦™çš„hackï¼Œå°†ä¸ç›¸å…³çš„APIç”¨äºæ–°åœºæ™¯</li><li><strong>å®ç”¨æ€§</strong>ï¼šæ€§èƒ½å¥½ã€æ•ˆæœå¥½ã€å®ç°ç®€å•ï¼Œæ˜¯å·¥ç¨‹ä¸Šçš„æœ€ä¼˜è§£</li><li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ¶æ„æ¸…æ™°ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½ï¼ˆå¦‚åŠ¨ç”»ã€ä¸»é¢˜é€‚é…ï¼‰</li><li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šå®æ—¶åé¦ˆã€æµç•…äº¤äº’ï¼ŒAIè¾…åŠ©é™ä½æ“ä½œé—¨æ§›</li></ul><h3 id="å»¶ä¼¸æ€è€ƒ" tabindex="-1">å»¶ä¼¸æ€è€ƒ <a class="header-anchor" href="#å»¶ä¼¸æ€è€ƒ" aria-label="Permalink to &quot;å»¶ä¼¸æ€è€ƒ&quot;">â€‹</a></h3><p><strong>é—®é¢˜1ï¼šèƒ½å¦ç”¨WebGLå®ç°æ›´é«˜æ€§èƒ½çš„é«˜äº®ï¼Ÿ</strong></p><p>å¯ä»¥ï¼ŒWebGLç€è‰²å™¨å¯ä»¥å®ç°ç›¸åŒæ•ˆæœä¸”æ€§èƒ½æ›´å¥½ï¼Œä½†ï¼š</p><ul><li>å¢åŠ å®ç°å¤æ‚åº¦</li><li>å¢åŠ ä»£ç ä½“ç§¯ï¼ˆéœ€è¦ç€è‰²å™¨ä»£ç ï¼‰</li><li>åœ¨å½“å‰åœºæ™¯ä¸‹ï¼ŒCanvasæ–¹æ¡ˆå·²è¶³å¤Ÿæµç•…</li><li>å»ºè®®ï¼šæ€§èƒ½ç“¶é¢ˆå‡ºç°æ—¶å†è€ƒè™‘WebGL</li></ul><p><strong>é—®é¢˜2ï¼šä¸ºä»€ä¹ˆä¸ç”¨SVGè€Œç”¨Canvasï¼Ÿ</strong></p><p>SVGçš„ä¼˜åŠ¿æ˜¯çŸ¢é‡å¯ç¼©æ”¾ï¼Œä½†ï¼š</p><ul><li>Maskæ˜¯ä½å›¾æ•°æ®ï¼Œç”¨SVGéœ€è¦è½¬æ¢</li><li>SVGçš„æ»¤é•œæ•ˆæœæ€§èƒ½ä¸å¦‚Canvas</li><li>Canvasæ›´é€‚åˆåƒç´ çº§æ“ä½œ</li><li>Canvasçš„compositeOperationæ›´å¼ºå¤§</li></ul><p><strong>é—®é¢˜3ï¼šå¦‚ä½•æ”¯æŒæ›´å¤šäº¤äº’æ¨¡å¼ï¼Ÿ</strong></p><p>å¯ä»¥æ‰©å±•ï¼š</p><ul><li>æ¡†é€‰æ¨¡å¼ï¼šæ‹–æ‹½çŸ©å½¢æ¡†ï¼Œé€‰ä¸­æ‰€æœ‰ç›¸äº¤mask</li><li>ç”»ç¬”æ¨¡å¼ï¼šæ¶‚æŠ¹å¼é€‰æ‹©ï¼Œè‡ªåŠ¨åŒ¹é…æœ€è¿‘mask</li><li>é­”æ£’æ¨¡å¼ï¼šç‚¹å‡»åè‡ªåŠ¨æ‰©å±•åˆ°ç›¸ä¼¼åŒºåŸŸ</li><li>æ™ºèƒ½æ‰©å±•ï¼šé€‰ä¸­ä¸€ä¸ªmaskåï¼Œè‡ªåŠ¨å»ºè®®ç›¸å…³mask</li></ul><p>è¿™äº›éƒ½å¯ä»¥åŸºäºç°æœ‰æ¶æ„æ‰©å±•ï¼Œæ ¸å¿ƒæ˜¯AutoMaskModelæä¾›äº†è‰¯å¥½çš„æŠ½è±¡ã€‚</p><hr><p><strong>æ–‡æ¡£ç»“æŸã€‚å¸Œæœ›è¿™ä»½æ·±åº¦è§£æèƒ½å¸®åŠ©ä½ å®Œå…¨ç†è§£SAMä¸»ä½“é€‰æ‹©çš„å®ç°åŸç†ï¼</strong></p>`,506)]))}const g=a(p,[["render",e]]);export{c as __pageData,g as default};
