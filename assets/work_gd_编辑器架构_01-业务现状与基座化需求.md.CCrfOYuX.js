import{_ as n,c as a,o as p,a7 as i}from"./chunks/framework.BQb8NfN9.js";const d=JSON.parse('{"title":"编辑器业务现状与基座化需求","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/编辑器架构/01-业务现状与基座化需求.md","filePath":"work/gd/编辑器架构/01-业务现状与基座化需求.md","lastUpdated":1770085732000}'),l={name:"work/gd/编辑器架构/01-业务现状与基座化需求.md"};function e(r,s,t,h,c,k){return p(),a("div",null,s[0]||(s[0]=[i(`<h1 id="编辑器业务现状与基座化需求" tabindex="-1">编辑器业务现状与基座化需求 <a class="header-anchor" href="#编辑器业务现状与基座化需求" aria-label="Permalink to &quot;编辑器业务现状与基座化需求&quot;">​</a></h1><h2 id="一、业务背景" tabindex="-1">一、业务背景 <a class="header-anchor" href="#一、业务背景" aria-label="Permalink to &quot;一、业务背景&quot;">​</a></h2><h3 id="_1-1-编辑器产品矩阵" tabindex="-1">1.1 编辑器产品矩阵 <a class="header-anchor" href="#_1-1-编辑器产品矩阵" aria-label="Permalink to &quot;1.1 编辑器产品矩阵&quot;">​</a></h3><p>公司旗下存在多个编辑器产品线，面向不同市场和场景：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                        编辑器产品矩阵                                 │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│   ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐   │</span></span>
<span class="line"><span>│   │    稿定设计      │   │     InsMind     │   │    稿定Art      │   │</span></span>
<span class="line"><span>│   │   (国内主站)     │   │    (海外市场)    │   │   (AI创作)      │   │</span></span>
<span class="line"><span>│   ├─────────────────┤   ├─────────────────┤   ├─────────────────┤   │</span></span>
<span class="line"><span>│   │ • 设计模板编辑   │   │ • AI图像处理    │   │ • AI绘图生成    │   │</span></span>
<span class="line"><span>│   │ • 协同设计      │   │ • 批量抠图      │   │ • 风格转换      │   │</span></span>
<span class="line"><span>│   │ • 品牌管理      │   │ • 格式转换      │   │ • 创意设计      │   │</span></span>
<span class="line"><span>│   │ • 企业版       │   │ • 智能修复      │   │ • 艺术滤镜      │   │</span></span>
<span class="line"><span>│   └─────────────────┘   └─────────────────┘   └─────────────────┘   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│                    ┌─────────────────────────┐                       │</span></span>
<span class="line"><span>│                    │      共同核心需求        │                       │</span></span>
<span class="line"><span>│                    ├─────────────────────────┤                       │</span></span>
<span class="line"><span>│                    │  • 用户认证与权限管理    │                       │</span></span>
<span class="line"><span>│                    │  • VIP权益与计费系统     │                       │</span></span>
<span class="line"><span>│                    │  • 素材上传与OSS管理     │                       │</span></span>
<span class="line"><span>│                    │  • 导出下载与格式转换    │                       │</span></span>
<span class="line"><span>│                    │  • 埋点追踪与数据分析    │                       │</span></span>
<span class="line"><span>│                    │  • 协同编辑与实时同步    │                       │</span></span>
<span class="line"><span>│                    │  • 历史版本与回退机制    │                       │</span></span>
<span class="line"><span>│                    └─────────────────────────┘                       │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_1-2-monorepo-项目结构" tabindex="-1">1.2 Monorepo 项目结构 <a class="header-anchor" href="#_1-2-monorepo-项目结构" aria-label="Permalink to &quot;1.2 Monorepo 项目结构&quot;">​</a></h3><p>整个项目采用 <strong>pnpm Monorepo</strong> 架构，包含多个应用和公共包：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>domains/editor/</span></span>
<span class="line"><span>├── apps/                           # 应用层</span></span>
<span class="line"><span>│   ├── design/                     # 稿定设计主站</span></span>
<span class="line"><span>│   │   ├── routes/</span></span>
<span class="line"><span>│   │   │   ├── (nuxt3)/           # Nuxt3 页面</span></span>
<span class="line"><span>│   │   │   └── (vue3)/            # Vue3 页面</span></span>
<span class="line"><span>│   │   │       └── services/      # 工具服务</span></span>
<span class="line"><span>│   │   │           └── editor/</span></span>
<span class="line"><span>│   │   │               └── editors/</span></span>
<span class="line"><span>│   │   │                   ├── matting/       # 抠图工具</span></span>
<span class="line"><span>│   │   │                   ├── magic-eraser/  # 魔法橡皮擦</span></span>
<span class="line"><span>│   │   │                   ├── ai-replace/    # AI替换</span></span>
<span class="line"><span>│   │   │                   └── ...            # 20+ 工具</span></span>
<span class="line"><span>│   │   └── package.json</span></span>
<span class="line"><span>│   │</span></span>
<span class="line"><span>│   ├── design-view/                # 编辑器视图</span></span>
<span class="line"><span>│   └── insmind/                    # InsMind海外版</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── packages/                       # 公共包层</span></span>
<span class="line"><span>│   ├── design/                     # 设计相关</span></span>
<span class="line"><span>│   │   ├── services/              # 业务服务（180+ 文件）</span></span>
<span class="line"><span>│   │   ├── business-ui/           # 业务UI（950+ 组件）</span></span>
<span class="line"><span>│   │   └── stores/                # 状态管理</span></span>
<span class="line"><span>│   │</span></span>
<span class="line"><span>│   ├── foundations/               # 基座层</span></span>
<span class="line"><span>│   │   ├── design/               # 新基座（Kernel-X）</span></span>
<span class="line"><span>│   │   └── design-view/          # 旧基座</span></span>
<span class="line"><span>│   │</span></span>
<span class="line"><span>│   ├── kernel-x/                  # 扩展系统核心</span></span>
<span class="line"><span>│   │   ├── core/                 # 内核</span></span>
<span class="line"><span>│   │   ├── design-services/      # 服务扩展</span></span>
<span class="line"><span>│   │   └── design-components/    # 组件扩展</span></span>
<span class="line"><span>│   │</span></span>
<span class="line"><span>│   └── shared/                    # 共享工具</span></span>
<span class="line"><span>│       ├── apis/                 # API封装</span></span>
<span class="line"><span>│       ├── oss/                  # OSS服务</span></span>
<span class="line"><span>│       └── commerce/             # 商业化</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>└── package.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="_1-3-工具类型多样性" tabindex="-1">1.3 工具类型多样性 <a class="header-anchor" href="#_1-3-工具类型多样性" aria-label="Permalink to &quot;1.3 工具类型多样性&quot;">​</a></h3><p>以 InsMind 为例，单个产品包含 <strong>20+ 种编辑工具</strong>：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// apps/insmind/routes/(vue3)/services/editor/editors/ 目录结构</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ToolType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // AI图像处理类</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Matting</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;matting&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 智能抠图</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    AiBackground</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ai-background&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// AI换背景</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    OutPaintExpand</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;expand&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 扩图</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    AiUpscale</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;upscale&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// AI放大</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 智能修复类</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    MagicEraser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;magic-eraser&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 魔法橡皮擦</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    AiReplace</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ai-replace&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// AI替换</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ObjectRemover</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;object-remover&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 物体移除</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 图像编辑类</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Crop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;crop&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 裁剪</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Compress</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;compress&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 压缩</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Convert</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;convert&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 格式转换</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Resize</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;resize&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 尺寸调整</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // AI生成类</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    AiDraw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ai-draw&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// AI绘图</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    PhotoGenerate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;photo-generate&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 照片生成</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    AvatarGenerate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;avatar&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 头像生成</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... 更多工具</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>每个工具的核心需求：</p><table tabindex="0"><thead><tr><th>工具类别</th><th>具体工具</th><th>共性需求</th><th>差异需求</th></tr></thead><tbody><tr><td><strong>AI图像处理</strong></td><td>抠图、AI换背景、扩图</td><td>用户登录、VIP校验、OSS上传</td><td>AI模型调用、Canvas处理</td></tr><tr><td><strong>图像编辑</strong></td><td>裁剪、压缩、格式转换</td><td>用户登录、导出下载、埋点</td><td>图像变换算法、编解码</td></tr><tr><td><strong>AI生成</strong></td><td>AI绘图、照片生成</td><td>用户登录、VIP扣次、埋点</td><td>Prompt处理、生成流程</td></tr><tr><td><strong>智能修复</strong></td><td>魔法橡皮擦、AI替换</td><td>用户登录、VIP校验、Canvas</td><td>选区管理、Inpaint</td></tr></tbody></table><h3 id="_1-4-共性需求分析" tabindex="-1">1.4 共性需求分析 <a class="header-anchor" href="#_1-4-共性需求分析" aria-label="Permalink to &quot;1.4 共性需求分析&quot;">​</a></h3><p>观察各工具的核心能力，发现<strong>大量可复用的基础模块</strong>：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                         共性需求矩阵                                  │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  ┌──────────────────────────────────────────────────────────────┐   │</span></span>
<span class="line"><span>│  │                      用户与权限层                              │   │</span></span>
<span class="line"><span>│  │                                                                │   │</span></span>
<span class="line"><span>│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐             │   │</span></span>
<span class="line"><span>│  │  │  用户认证   │  │  VIP权益   │  │  权限控制   │             │   │</span></span>
<span class="line"><span>│  │  │            │  │            │  │            │             │   │</span></span>
<span class="line"><span>│  │  │ • 登录弹窗 │  │ • 等级判断 │  │ • 功能权限 │             │   │</span></span>
<span class="line"><span>│  │  │ • Token管理│  │ • 次数扣减 │  │ • 企业权限 │             │   │</span></span>
<span class="line"><span>│  │  │ • 多端同步 │  │ • 付费引导 │  │ • 编辑权限 │             │   │</span></span>
<span class="line"><span>│  │  └────────────┘  └────────────┘  └────────────┘             │   │</span></span>
<span class="line"><span>│  └──────────────────────────────────────────────────────────────┘   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  ┌──────────────────────────────────────────────────────────────┐   │</span></span>
<span class="line"><span>│  │                      资源与存储层                              │   │</span></span>
<span class="line"><span>│  │                                                                │   │</span></span>
<span class="line"><span>│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐             │   │</span></span>
<span class="line"><span>│  │  │  素材上传   │  │  OSS管理   │  │  字体服务   │             │   │</span></span>
<span class="line"><span>│  │  │            │  │            │  │            │             │   │</span></span>
<span class="line"><span>│  │  │ • 文件校验 │  │ • 上传配置 │  │ • 字体加载 │             │   │</span></span>
<span class="line"><span>│  │  │ • 格式转换 │  │ • CDN加速  │  │ • 字体渲染 │             │   │</span></span>
<span class="line"><span>│  │  │ • 进度追踪 │  │ • webp/avif│  │ • 字体授权 │             │   │</span></span>
<span class="line"><span>│  │  └────────────┘  └────────────┘  └────────────┘             │   │</span></span>
<span class="line"><span>│  └──────────────────────────────────────────────────────────────┘   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  ┌──────────────────────────────────────────────────────────────┐   │</span></span>
<span class="line"><span>│  │                      功能与交互层                              │   │</span></span>
<span class="line"><span>│  │                                                                │   │</span></span>
<span class="line"><span>│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐             │   │</span></span>
<span class="line"><span>│  │  │  导出下载   │  │  协同编辑   │  │  版本管理   │             │   │</span></span>
<span class="line"><span>│  │  │            │  │            │  │            │             │   │</span></span>
<span class="line"><span>│  │  │ • 格式选择 │  │ • 实时同步 │  │ • 历史记录 │             │   │</span></span>
<span class="line"><span>│  │  │ • 水印处理 │  │ • 冲突解决 │  │ • 版本回退 │             │   │</span></span>
<span class="line"><span>│  │  │ • 批量导出 │  │ • 成员管理 │  │ • 自动保存 │             │   │</span></span>
<span class="line"><span>│  │  └────────────┘  └────────────┘  └────────────┘             │   │</span></span>
<span class="line"><span>│  └──────────────────────────────────────────────────────────────┘   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  ┌──────────────────────────────────────────────────────────────┐   │</span></span>
<span class="line"><span>│  │                      监控与运营层                              │   │</span></span>
<span class="line"><span>│  │                                                                │   │</span></span>
<span class="line"><span>│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐             │   │</span></span>
<span class="line"><span>│  │  │  埋点追踪   │  │  日志系统   │  │  新手引导   │             │   │</span></span>
<span class="line"><span>│  │  │            │  │            │  │            │             │   │</span></span>
<span class="line"><span>│  │  │ • 行为埋点 │  │ • 错误上报 │  │ • 功能引导 │             │   │</span></span>
<span class="line"><span>│  │  │ • 转化追踪 │  │ • 性能监控 │  │ • 任务系统 │             │   │</span></span>
<span class="line"><span>│  │  │ • AB实验  │  │ • 健康检测 │  │ • 帮助文档 │             │   │</span></span>
<span class="line"><span>│  │  └────────────┘  └────────────┘  └────────────┘             │   │</span></span>
<span class="line"><span>│  └──────────────────────────────────────────────────────────────┘   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><hr><h2 id="二、无基座时代的困境" tabindex="-1">二、无基座时代的困境 <a class="header-anchor" href="#二、无基座时代的困境" aria-label="Permalink to &quot;二、无基座时代的困境&quot;">​</a></h2><h3 id="_2-1-最初的实现方式" tabindex="-1">2.1 最初的实现方式 <a class="header-anchor" href="#_2-1-最初的实现方式" aria-label="Permalink to &quot;2.1 最初的实现方式&quot;">​</a></h3><p>早期各产品独立开发，每个编辑器自己实现所有功能：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                      早期：各自为政                                   │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│   apps/design/                          apps/insmind/                │</span></span>
<span class="line"><span>│   ┌─────────────────────┐              ┌─────────────────────┐      │</span></span>
<span class="line"><span>│   │     稿定设计         │              │      InsMind        │      │</span></span>
<span class="line"><span>│   ├─────────────────────┤              ├─────────────────────┤      │</span></span>
<span class="line"><span>│   │ services/           │              │ services/           │      │</span></span>
<span class="line"><span>│   │   ├── user.ts      ✗│              │   ├── user.ts      ✗│      │</span></span>
<span class="line"><span>│   │   ├── vip.ts       ✗│              │   ├── vip.ts       ✗│      │</span></span>
<span class="line"><span>│   │   ├── upload.ts    ✗│              │   ├── upload.ts    ✗│      │</span></span>
<span class="line"><span>│   │   ├── export.ts    ✗│              │   ├── export.ts    ✗│      │</span></span>
<span class="line"><span>│   │   ├── tracker.ts   ✗│              │   ├── tracker.ts   ✗│      │</span></span>
<span class="line"><span>│   │   └── ...          │              │   └── ...          │      │</span></span>
<span class="line"><span>│   │                     │              │                     │      │</span></span>
<span class="line"><span>│   │ components/         │              │ components/         │      │</span></span>
<span class="line"><span>│   │   ├── Header.vue   ✗│              │   ├── Header.vue   ✗│      │</span></span>
<span class="line"><span>│   │   ├── Panel.vue    ✗│              │   ├── Panel.vue    ✗│      │</span></span>
<span class="line"><span>│   │   └── ...          │              │   └── ...          │      │</span></span>
<span class="line"><span>│   └─────────────────────┘              └─────────────────────┘      │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│   ✗ 表示重复实现的代码                                                │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│   问题统计：                                                          │</span></span>
<span class="line"><span>│   • 用户服务：2套实现，约 800 行重复代码                              │</span></span>
<span class="line"><span>│   • VIP服务：2套实现，约 1200 行重复代码                              │</span></span>
<span class="line"><span>│   • 上传服务：2套实现，约 600 行重复代码                              │</span></span>
<span class="line"><span>│   • 总计：约 15000+ 行重复代码                                        │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="_2-2-核心痛点详解" tabindex="-1">2.2 核心痛点详解 <a class="header-anchor" href="#_2-2-核心痛点详解" aria-label="Permalink to &quot;2.2 核心痛点详解&quot;">​</a></h3><h4 id="痛点一-代码重复" tabindex="-1">痛点一：代码重复 <a class="header-anchor" href="#痛点一-代码重复" aria-label="Permalink to &quot;痛点一：代码重复&quot;">​</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// apps/design/services/user/login.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GaodingUserService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> login</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 弹窗登录实现</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> modal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./login-modal&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        modal.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">show</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 登录成功后</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;gd_token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, token);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 刷新页面</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        window.location.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> checkLoginStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;gd_token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">token) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(token);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// apps/insmind/services/user/login.ts（高度相似但有细微差异）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InsMindUserService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> login</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 跳转登录页实现（因为海外版 OAuth 不同）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> redirectUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> encodeURIComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(window.location.href);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        window.location.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`/login?redirect=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">redirectUrl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> checkLoginStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Cookie 方式（因为要跨域）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCookie</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;im_token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">token) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(token);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getCookie</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Cookie 解析逻辑...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 问题：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. checkLoginStatus 逻辑 90% 相同，但存储方式不同</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. login 流程 70% 相同，但 UI 交互不同</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. 当需要增加「登录埋点」时，需要修改两处代码</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h4 id="痛点二-一致性差" tabindex="-1">痛点二：一致性差 <a class="header-anchor" href="#痛点二-一致性差" aria-label="Permalink to &quot;痛点二：一致性差&quot;">​</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 稿定设计的 VIP 检查</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> checkVipInGaoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> api.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/vip/status&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { userId });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 返回格式：{ isVip: boolean, level: number, expireTime: string }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// InsMind 的 VIP 检查</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> checkVipInInsMind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> api.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/user/membership&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { user_id: userId });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 返回格式：{ is_member: boolean, tier: string, expire_at: number }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 注意：字段命名不同，tier 是字符串不是数字</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        isVip: response.data.is_member,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        level: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tierToLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.data.tier),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 需要转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        expireTime: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.data.expire_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toISOString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 问题：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. API 路径不同：/vip/status vs /user/membership</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. 参数命名不同：userId vs user_id</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. 返回格式不同：需要额外的转换逻辑</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 4. 当后端统一接口时，两边都需要修改</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="痛点三-迭代缓慢" tabindex="-1">痛点三：迭代缓慢 <a class="header-anchor" href="#痛点三-迭代缓慢" aria-label="Permalink to &quot;痛点三：迭代缓慢&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                   新功能开发流程（无基座）                             │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  需求：增加「登录后自动同步云端设计」功能                             │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  Step 1: 稿定设计实现                                                │</span></span>
<span class="line"><span>│  ────────────────────                                                │</span></span>
<span class="line"><span>│  • 修改 user.ts                    1天                               │</span></span>
<span class="line"><span>│  • 修改 sync.ts                    2天                               │</span></span>
<span class="line"><span>│  • 测试验证                        1天                               │</span></span>
<span class="line"><span>│  • 代码审查                        0.5天                             │</span></span>
<span class="line"><span>│                                   ─────                              │</span></span>
<span class="line"><span>│                                   4.5天                              │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  Step 2: InsMind 实现（需要参考稿定设计，但不能直接复制）             │</span></span>
<span class="line"><span>│  ────────────────────                                                │</span></span>
<span class="line"><span>│  • 阅读稿定实现                    0.5天                             │</span></span>
<span class="line"><span>│  • 修改 user.ts（适配差异）        1.5天                             │</span></span>
<span class="line"><span>│  • 修改 sync.ts（适配差异）        2.5天                             │</span></span>
<span class="line"><span>│  • 测试验证                        1天                               │</span></span>
<span class="line"><span>│  • 代码审查                        0.5天                             │</span></span>
<span class="line"><span>│                                   ─────                              │</span></span>
<span class="line"><span>│                                   6天                                │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  Step 3: 后续产品线...                                               │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  总计：10.5天 × N（产品数量）                                        │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  如果有基座：                                                        │</span></span>
<span class="line"><span>│  • 基座层实现：4.5天                                                 │</span></span>
<span class="line"><span>│  • 各产品适配：0.5天 × N                                             │</span></span>
<span class="line"><span>│  • 节省：(6天 × (N-1)) 的开发时间                                    │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h4 id="痛点四-质量参差" tabindex="-1">痛点四：质量参差 <a class="header-anchor" href="#痛点四-质量参差" aria-label="Permalink to &quot;痛点四：质量参差&quot;">​</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 稿定设计的错误处理（较完善）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> uploadImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> File</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1. 文件校验</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">validateFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ValidationError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;文件格式不支持&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2. 大小检查</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (file.size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MAX_SIZE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FileSizeError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;文件过大&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3. 上传</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ossClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">upload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4. 埋点</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tracker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;upload_success&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { size: file.size });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 5. 错误上报</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        logger.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;upload_failed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 6. 用户提示</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ValidationError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            message.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error.message);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FileSizeError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            message.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;文件过大，请压缩后重试&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            message.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;上传失败，请重试&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// InsMind 的错误处理（较简陋）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> uploadImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> File</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ossClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">upload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Upload failed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 简单的 alert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error);    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 只有 console.log</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 问题：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. 错误处理策略不一致</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. 用户体验不统一</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. 日志和埋点缺失</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 4. 没有统一的最佳实践</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h3 id="_2-3-问题影响量化" tabindex="-1">2.3 问题影响量化 <a class="header-anchor" href="#_2-3-问题影响量化" aria-label="Permalink to &quot;2.3 问题影响量化&quot;">​</a></h3><table tabindex="0"><thead><tr><th>指标</th><th>无基座</th><th>有基座</th><th>改善</th></tr></thead><tbody><tr><td><strong>重复代码</strong></td><td>15000+ 行</td><td>0 行</td><td>-100%</td></tr><tr><td><strong>新功能开发周期</strong></td><td>10天 × N</td><td>5天 + 0.5天 × N</td><td>-50%+</td></tr><tr><td><strong>Bug 修复</strong></td><td>N 处修改</td><td>1 处修改</td><td>-80%+</td></tr><tr><td><strong>代码审查</strong></td><td>N 次审查</td><td>1 次审查</td><td>-80%+</td></tr><tr><td><strong>测试覆盖</strong></td><td>分散，难以统一</td><td>集中，统一标准</td><td>+200%</td></tr></tbody></table><hr><h2 id="三、基座化的必然性" tabindex="-1">三、基座化的必然性 <a class="header-anchor" href="#三、基座化的必然性" aria-label="Permalink to &quot;三、基座化的必然性&quot;">​</a></h2><h3 id="_3-1-什么是编辑器基座" tabindex="-1">3.1 什么是编辑器基座 <a class="header-anchor" href="#_3-1-什么是编辑器基座" aria-label="Permalink to &quot;3.1 什么是编辑器基座&quot;">​</a></h3><p><strong>基座（Foundation）</strong> 是一套可复用的基础架构，为上层业务提供标准化的能力支撑：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                         基座化架构                                    │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│     ┌──────────┐    ┌──────────┐    ┌──────────┐                    │</span></span>
<span class="line"><span>│     │ 稿定设计  │    │ InsMind  │    │ 稿定Art  │     应用层         │</span></span>
<span class="line"><span>│     └─────┬────┘    └─────┬────┘    └─────┬────┘                    │</span></span>
<span class="line"><span>│           │               │               │                          │</span></span>
<span class="line"><span>│           │    差异化配置  │    差异化配置  │                          │</span></span>
<span class="line"><span>│           │               │               │                          │</span></span>
<span class="line"><span>│           └───────────────┼───────────────┘                          │</span></span>
<span class="line"><span>│                           │                                          │</span></span>
<span class="line"><span>│                           ▼                                          │</span></span>
<span class="line"><span>│     ┌─────────────────────────────────────────────────────────┐     │</span></span>
<span class="line"><span>│     │                    编辑器基座层                           │     │</span></span>
<span class="line"><span>│     │                                                           │     │</span></span>
<span class="line"><span>│     │  ┌─────────────────────────────────────────────────────┐│     │</span></span>
<span class="line"><span>│     │  │                   Foundation                         ││     │</span></span>
<span class="line"><span>│     │  │              (应用入口与编排)                        ││     │</span></span>
<span class="line"><span>│     │  └─────────────────────────────────────────────────────┘│     │</span></span>
<span class="line"><span>│     │                          │                               │     │</span></span>
<span class="line"><span>│     │  ┌───────────┬───────────┼───────────┬───────────┐     │     │</span></span>
<span class="line"><span>│     │  │           │           │           │           │     │     │</span></span>
<span class="line"><span>│     │  ▼           ▼           ▼           ▼           ▼     │     │</span></span>
<span class="line"><span>│     │ ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐      │     │</span></span>
<span class="line"><span>│     │ │User │   │ VIP │   │Upload│   │Export│   │Track│ ... │     │</span></span>
<span class="line"><span>│     │ │Svc  │   │ Svc │   │ Svc │   │ Svc │   │ Svc │      │     │</span></span>
<span class="line"><span>│     │ └─────┘   └─────┘   └─────┘   └─────┘   └─────┘      │     │</span></span>
<span class="line"><span>│     │                                                           │     │</span></span>
<span class="line"><span>│     │  ┌─────────────────────────────────────────────────────┐│     │</span></span>
<span class="line"><span>│     │  │                   Business UI                        ││     │</span></span>
<span class="line"><span>│     │  │               (950+ 可复用组件)                      ││     │</span></span>
<span class="line"><span>│     │  └─────────────────────────────────────────────────────┘│     │</span></span>
<span class="line"><span>│     │                                                           │     │</span></span>
<span class="line"><span>│     └─────────────────────────────────────────────────────────┘     │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│     复用统计：                                                        │</span></span>
<span class="line"><span>│     • Services 层：90%+ 代码复用                                     │</span></span>
<span class="line"><span>│     • UI 层：70%+ 组件复用                                           │</span></span>
<span class="line"><span>│     • Foundation：100% 复用                                          │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="_3-2-基座化的核心价值" tabindex="-1">3.2 基座化的核心价值 <a class="header-anchor" href="#_3-2-基座化的核心价值" aria-label="Permalink to &quot;3.2 基座化的核心价值&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                       基座化收益分析                                   │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  ┌───────────────────────────────────────────────────────────────┐  │</span></span>
<span class="line"><span>│  │  收益一：开发效率提升                                          │  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  场景：开发新产品「稿定PPT」                                    │  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  无基座：                                                       │  │</span></span>
<span class="line"><span>│  │  ├─ 用户系统开发        2周                                    │  │</span></span>
<span class="line"><span>│  │  ├─ VIP系统开发         2周                                    │  │</span></span>
<span class="line"><span>│  │  ├─ 上传导出开发        1周                                    │  │</span></span>
<span class="line"><span>│  │  ├─ 埋点系统开发        1周                                    │  │</span></span>
<span class="line"><span>│  │  └─ PPT核心功能         4周                                    │  │</span></span>
<span class="line"><span>│  │                        ────                                    │  │</span></span>
<span class="line"><span>│  │                        10周                                    │  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  有基座：                                                       │  │</span></span>
<span class="line"><span>│  │  ├─ 基座配置适配        0.5周                                  │  │</span></span>
<span class="line"><span>│  │  └─ PPT核心功能         4周                                    │  │</span></span>
<span class="line"><span>│  │                        ────                                    │  │</span></span>
<span class="line"><span>│  │                        4.5周  (节省 55%)                       │  │</span></span>
<span class="line"><span>│  └───────────────────────────────────────────────────────────────┘  │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  ┌───────────────────────────────────────────────────────────────┐  │</span></span>
<span class="line"><span>│  │  收益二：维护成本降低                                          │  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  场景：修复「用户Token过期未正确处理」Bug                       │  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  无基座：                                                       │  │</span></span>
<span class="line"><span>│  │  ├─ 定位问题（每个项目）  0.5天 × N                            │  │</span></span>
<span class="line"><span>│  │  ├─ 修复代码             0.5天 × N                            │  │</span></span>
<span class="line"><span>│  │  ├─ 测试验证             0.5天 × N                            │  │</span></span>
<span class="line"><span>│  │  └─ 代码审查             0.25天 × N                           │  │</span></span>
<span class="line"><span>│  │                         ─────────                              │  │</span></span>
<span class="line"><span>│  │                         1.75天 × N  (N=3 时 5.25天)            │  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  有基座：                                                       │  │</span></span>
<span class="line"><span>│  │  ├─ 定位问题             0.5天                                 │  │</span></span>
<span class="line"><span>│  │  ├─ 修复代码             0.5天                                 │  │</span></span>
<span class="line"><span>│  │  ├─ 测试验证             0.5天                                 │  │</span></span>
<span class="line"><span>│  │  └─ 代码审查             0.25天                                │  │</span></span>
<span class="line"><span>│  │                         ─────                                  │  │</span></span>
<span class="line"><span>│  │                         1.75天  (节省 67%)                     │  │</span></span>
<span class="line"><span>│  └───────────────────────────────────────────────────────────────┘  │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  ┌───────────────────────────────────────────────────────────────┐  │</span></span>
<span class="line"><span>│  │  收益三：质量一致性保障                                        │  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  • 统一的错误处理策略                                          │  │</span></span>
<span class="line"><span>│  │  • 统一的日志上报格式                                          │  │</span></span>
<span class="line"><span>│  │  • 统一的埋点规范                                              │  │</span></span>
<span class="line"><span>│  │  • 统一的 UI/UX 体验                                           │  │</span></span>
<span class="line"><span>│  │  • 统一的测试覆盖标准                                          │  │</span></span>
<span class="line"><span>│  └───────────────────────────────────────────────────────────────┘  │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h3 id="_3-3-复用层次划分" tabindex="-1">3.3 复用层次划分 <a class="header-anchor" href="#_3-3-复用层次划分" aria-label="Permalink to &quot;3.3 复用层次划分&quot;">​</a></h3><p>基座化需要明确「什么该复用，什么该差异化」：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                        复用层次金字塔                                 │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│                           ▲                                          │</span></span>
<span class="line"><span>│                          /│\\                                         │</span></span>
<span class="line"><span>│                         / │ \\                                        │</span></span>
<span class="line"><span>│                        /  │  \\                                       │</span></span>
<span class="line"><span>│                       /   │   \\                                      │</span></span>
<span class="line"><span>│                      / 业务 \\      ← 差异化实现                       │</span></span>
<span class="line"><span>│                     / 逻辑层 \\        各工具核心算法                  │</span></span>
<span class="line"><span>│                    /─────────\\        20% 代码在这里                 │</span></span>
<span class="line"><span>│                   /           \\                                      │</span></span>
<span class="line"><span>│                  /   UI组件层  \\    ← 60%复用+40%定制                │</span></span>
<span class="line"><span>│                 /              \\      Header/Panel/Modal...          │</span></span>
<span class="line"><span>│                /────────────────\\                                    │</span></span>
<span class="line"><span>│               /                  \\                                   │</span></span>
<span class="line"><span>│              /   业务服务层       \\  ← 80%复用+20%配置               │</span></span>
<span class="line"><span>│             /                      \\    VIP/Upload/Export...         │</span></span>
<span class="line"><span>│            /────────────────────────\\                                │</span></span>
<span class="line"><span>│           /                          \\                               │</span></span>
<span class="line"><span>│          /        核心层              \\ ← 100%复用                   │</span></span>
<span class="line"><span>│         /                              \\   User/Auth/Logger...       │</span></span>
<span class="line"><span>│        /────────────────────────────────\\                            │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  各层说明：                                                           │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  核心层（100%复用）：                                                 │</span></span>
<span class="line"><span>│  • 用户认证、权限校验、日志系统                                       │</span></span>
<span class="line"><span>│  • 这些功能在所有产品中完全一致                                       │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  业务服务层（80%复用 + 20%配置）：                                    │</span></span>
<span class="line"><span>│  • VIP权益（规则可配置）                                             │</span></span>
<span class="line"><span>│  • 上传服务（大小限制可配置）                                        │</span></span>
<span class="line"><span>│  • 导出服务（格式可配置）                                            │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  UI组件层（60%复用 + 40%定制）：                                     │</span></span>
<span class="line"><span>│  • 工具栏（布局可调整）                                              │</span></span>
<span class="line"><span>│  • 面板（样式可定制）                                                │</span></span>
<span class="line"><span>│  • 弹窗（内容可替换）                                                │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  业务逻辑层（按需复用）：                                             │</span></span>
<span class="line"><span>│  • 各工具的核心算法（抠图、AI替换等）                                │</span></span>
<span class="line"><span>│  • 特定业务的交互流程                                                │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><hr><h2 id="四、基座化面临的技术挑战" tabindex="-1">四、基座化面临的技术挑战 <a class="header-anchor" href="#四、基座化面临的技术挑战" aria-label="Permalink to &quot;四、基座化面临的技术挑战&quot;">​</a></h2><h3 id="_4-1-挑战一-依赖管理复杂" tabindex="-1">4.1 挑战一：依赖管理复杂 <a class="header-anchor" href="#_4-1-挑战一-依赖管理复杂" aria-label="Permalink to &quot;4.1 挑战一：依赖管理复杂&quot;">​</a></h3><p>当服务数量增多，依赖关系变得复杂：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                       服务依赖关系图                                   │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│                         UserService                                   │</span></span>
<span class="line"><span>│                              │                                        │</span></span>
<span class="line"><span>│              ┌───────────────┼───────────────┐                       │</span></span>
<span class="line"><span>│              │               │               │                        │</span></span>
<span class="line"><span>│              ▼               ▼               ▼                        │</span></span>
<span class="line"><span>│        VipService    EnterpriseService  CollabService                │</span></span>
<span class="line"><span>│              │               │               │                        │</span></span>
<span class="line"><span>│              │               │               └────────┐              │</span></span>
<span class="line"><span>│              ▼               ▼                        │              │</span></span>
<span class="line"><span>│        GuideService  PermissionService               │              │</span></span>
<span class="line"><span>│              │               │                        │              │</span></span>
<span class="line"><span>│              └───────────────┼────────────────────────┘              │</span></span>
<span class="line"><span>│                              │                                        │</span></span>
<span class="line"><span>│                              ▼                                        │</span></span>
<span class="line"><span>│                       EditorService                                   │</span></span>
<span class="line"><span>│                              │                                        │</span></span>
<span class="line"><span>│              ┌───────────────┼───────────────┐                       │</span></span>
<span class="line"><span>│              │               │               │                        │</span></span>
<span class="line"><span>│              ▼               ▼               ▼                        │</span></span>
<span class="line"><span>│        FontsService   SaveService    ExportService                   │</span></span>
<span class="line"><span>│              │               │               │                        │</span></span>
<span class="line"><span>│              └───────────────┴───────────────┘                       │</span></span>
<span class="line"><span>│                              │                                        │</span></span>
<span class="line"><span>│                              ▼                                        │</span></span>
<span class="line"><span>│                       UploadService                                   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  问题：                                                               │</span></span>
<span class="line"><span>│  ├─ 如何确定正确的初始化顺序？                                        │</span></span>
<span class="line"><span>│  ├─ 如何检测循环依赖？                                                │</span></span>
<span class="line"><span>│  ├─ 某服务初始化失败时如何降级？                                      │</span></span>
<span class="line"><span>│  └─ 如何在不同产品中替换某个服务的实现？                              │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p><strong>具体问题示例</strong>：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 问题1：循环依赖</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VipService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> userService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> vipService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VipService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {}  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 循环！</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 问题2：初始化顺序</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 正确顺序：User → Vip → Editor → Fonts</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 但如果有人不小心写成：</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vipService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ userService 未初始化</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 问题3：依赖缺失</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExportService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fonts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useFontsService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 运行时才发现依赖</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useVipService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 运行时才发现依赖</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 如果这些服务未初始化，会报错</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_4-2-挑战二-扩展机制设计" tabindex="-1">4.2 挑战二：扩展机制设计 <a class="header-anchor" href="#_4-2-挑战二-扩展机制设计" aria-label="Permalink to &quot;4.2 挑战二：扩展机制设计&quot;">​</a></h3><p>不同业务有不同的定制需求：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                       定制需求场景                                    │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  场景1：VIP 权益差异                                                  │</span></span>
<span class="line"><span>│  ┌───────────────────────────────────────────────────────────────┐  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  稿定设计：                      InsMind：                     │  │</span></span>
<span class="line"><span>│  │  ┌─────────────────────┐       ┌─────────────────────┐       │  │</span></span>
<span class="line"><span>│  │  │ • 免费版：3次/天    │       │ • Free：5次/天      │       │  │</span></span>
<span class="line"><span>│  │  │ • VIP：无限次       │       │ • Pro：100次/月     │       │  │</span></span>
<span class="line"><span>│  │  │ • SVIP：无限次+优先│       │ • Enterprise：无限  │       │  │</span></span>
<span class="line"><span>│  │  └─────────────────────┘       └─────────────────────┘       │  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  问题：同一个 VipService，如何支持不同的权益规则？              │  │</span></span>
<span class="line"><span>│  └───────────────────────────────────────────────────────────────┘  │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  场景2：登录流程差异                                                  │</span></span>
<span class="line"><span>│  ┌───────────────────────────────────────────────────────────────┐  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  稿定设计：                      InsMind：                     │  │</span></span>
<span class="line"><span>│  │  ┌─────────────────────┐       ┌─────────────────────┐       │  │</span></span>
<span class="line"><span>│  │  │ • 弹窗登录          │       │ • Google OAuth      │       │  │</span></span>
<span class="line"><span>│  │  │ • 微信扫码          │       │ • Apple Sign In     │       │  │</span></span>
<span class="line"><span>│  │  │ • 手机验证码        │       │ • Email 登录        │       │  │</span></span>
<span class="line"><span>│  │  └─────────────────────┘       └─────────────────────┘       │  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  问题：如何在不修改核心代码的前提下，支持不同的登录方式？       │  │</span></span>
<span class="line"><span>│  └───────────────────────────────────────────────────────────────┘  │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  场景3：功能开关差异                                                  │</span></span>
<span class="line"><span>│  ┌───────────────────────────────────────────────────────────────┐  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  稿定设计：                      InsMind：                     │  │</span></span>
<span class="line"><span>│  │  ┌─────────────────────┐       ┌─────────────────────┐       │  │</span></span>
<span class="line"><span>│  │  │ ✓ 协同编辑          │       │ ✗ 协同编辑          │       │  │</span></span>
<span class="line"><span>│  │  │ ✓ 品牌管理          │       │ ✗ 品牌管理          │       │  │</span></span>
<span class="line"><span>│  │  │ ✓ 企业版            │       │ ✓ 多语言            │       │  │</span></span>
<span class="line"><span>│  │  └─────────────────────┘       └─────────────────────┘       │  │</span></span>
<span class="line"><span>│  │                                                                 │  │</span></span>
<span class="line"><span>│  │  问题：如何按需加载功能，避免打包无用代码？                     │  │</span></span>
<span class="line"><span>│  └───────────────────────────────────────────────────────────────┘  │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p><strong>当前的解决方式（问题多多）</strong>：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 方式1：条件分支污染核心代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// @design/services/src/vip/store.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> useVipService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;vip&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    actions: {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> checkVip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isInsMind) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // InsMind 逻辑（50行）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isGaoding) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // 稿定逻辑（50行）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isGaodingArt) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // 稿定Art 逻辑（50行）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 随着产品增加，if-else 越来越长...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 方式2：Fork 代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 每个产品维护自己的 vip/store.ts</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 问题：公共逻辑修改需要同步多处</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 方式3：配置化（但配置越来越复杂）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vipConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gaoding: { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    insmind: { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gaodingArt: { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 配置项越来越多，难以维护</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_4-3-挑战三-生命周期管理" tabindex="-1">4.3 挑战三：生命周期管理 <a class="header-anchor" href="#_4-3-挑战三-生命周期管理" aria-label="Permalink to &quot;4.3 挑战三：生命周期管理&quot;">​</a></h3><p>服务的初始化和销毁需要精确控制：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                       生命周期管理问题                                │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  问题1：初始化顺序                                                    │</span></span>
<span class="line"><span>│  ────────────────                                                    │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  应用启动                                                             │</span></span>
<span class="line"><span>│      │                                                                │</span></span>
<span class="line"><span>│      ▼                                                                │</span></span>
<span class="line"><span>│  ┌─────────────────────────────────────────────────────────────┐    │</span></span>
<span class="line"><span>│  │  1. 环境检测          ──┐                                    │    │</span></span>
<span class="line"><span>│  │  2. 配置加载            │ 同步，顺序执行                     │    │</span></span>
<span class="line"><span>│  │  3. Logger初始化      ──┘                                    │    │</span></span>
<span class="line"><span>│  │                                                               │    │</span></span>
<span class="line"><span>│  │  4. UserService.init()  ◄── 异步，必须最先完成               │    │</span></span>
<span class="line"><span>│  │          │                                                    │    │</span></span>
<span class="line"><span>│  │          ▼                                                    │    │</span></span>
<span class="line"><span>│  │  5. VipService.init()   ◄── 依赖 User，必须在 User 之后      │    │</span></span>
<span class="line"><span>│  │  6. EnterpriseService.init() ◄── 依赖 User                   │    │</span></span>
<span class="line"><span>│  │          │                                                    │    │</span></span>
<span class="line"><span>│  │          ▼                                                    │    │</span></span>
<span class="line"><span>│  │  7. EditorService.init() ◄── 依赖 Vip + Enterprise           │    │</span></span>
<span class="line"><span>│  │          │                                                    │    │</span></span>
<span class="line"><span>│  │          ▼                                                    │    │</span></span>
<span class="line"><span>│  │  8. FontsService.init() ◄── 依赖 Editor                      │    │</span></span>
<span class="line"><span>│  │  9. CollabService.init() ◄── 可选，依赖 Editor               │    │</span></span>
<span class="line"><span>│  └─────────────────────────────────────────────────────────────┘    │</span></span>
<span class="line"><span>│      │                                                                │</span></span>
<span class="line"><span>│      ▼                                                                │</span></span>
<span class="line"><span>│  应用就绪                                                             │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  当前方案（手动编排）的问题：                                         │</span></span>
<span class="line"><span>│  • 顺序靠人工记忆和文档约定                                          │</span></span>
<span class="line"><span>│  • 新增服务需要找到正确的插入点                                      │</span></span>
<span class="line"><span>│  • 删除服务需要检查是否有其他服务依赖它                              │</span></span>
<span class="line"><span>│  • 初始化失败时，后续服务如何处理？                                  │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  ─────────────────────────────────────────────────────────────────   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  问题2：资源销毁                                                      │</span></span>
<span class="line"><span>│  ────────────────                                                    │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  当前的销毁方式：                                                     │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  // 组件中手动清理                                                   │</span></span>
<span class="line"><span>│  onMounted(() =&gt; {                                                   │</span></span>
<span class="line"><span>│      lifecycleEvent.on(&#39;template-loaded&#39;, handler1);                 │</span></span>
<span class="line"><span>│      userStatusEvent.on(&#39;login&#39;, handler2);                          │</span></span>
<span class="line"><span>│      collabService.on(&#39;sync&#39;, handler3);                             │</span></span>
<span class="line"><span>│  });                                                                  │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  onUnmounted(() =&gt; {                                                 │</span></span>
<span class="line"><span>│      lifecycleEvent.off(&#39;template-loaded&#39;, handler1);  // 容易忘    │</span></span>
<span class="line"><span>│      userStatusEvent.off(&#39;login&#39;, handler2);           // 容易忘    │</span></span>
<span class="line"><span>│      // handler3 忘了清理！→ 内存泄漏                               │</span></span>
<span class="line"><span>│  });                                                                  │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h3 id="_4-4-挑战四-类型安全" tabindex="-1">4.4 挑战四：类型安全 <a class="header-anchor" href="#_4-4-挑战四-类型安全" aria-label="Permalink to &quot;4.4 挑战四：类型安全&quot;">​</a></h3><p>事件系统缺乏类型约束：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 当前的事件系统问题</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 问题1：事件名是字符串，容易拼错</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lifecycleEvent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;editor-ready&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lifecycleEvent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;editor-raedy&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 拼错了，编译不报错，运行时才发现</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 问题2：事件数据没有类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lifecycleEvent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;template-loaded&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // data 是 any 类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.template.id);      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 可能 undefined</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.template.pages);   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 可能不存在</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.tempalte);         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 拼错了，编译不报错</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 问题3：emit 和 on 的参数不匹配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lifecycleEvent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user-login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { userId: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;123&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lifecycleEvent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user-login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 期望 data.user，实际是 data.userId</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 编译不报错，运行时才发现问题</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_4-5-挑战汇总" tabindex="-1">4.5 挑战汇总 <a class="header-anchor" href="#_4-5-挑战汇总" aria-label="Permalink to &quot;4.5 挑战汇总&quot;">​</a></h3><table tabindex="0"><thead><tr><th>挑战</th><th>核心问题</th><th>期望解决方案</th></tr></thead><tbody><tr><td><strong>依赖管理</strong></td><td>隐式依赖、循环依赖、初始化顺序</td><td>显式声明 + 自动拓扑排序</td></tr><tr><td><strong>扩展机制</strong></td><td>定制困难、代码污染</td><td>插件化 + Token替换</td></tr><tr><td><strong>生命周期</strong></td><td>手动编排、资源泄漏</td><td>自动管理 + 追踪清理</td></tr><tr><td><strong>类型安全</strong></td><td>any类型、运行时错误</td><td>泛型Token + 编译检查</td></tr></tbody></table><hr><h2 id="五、演进方向" tabindex="-1">五、演进方向 <a class="header-anchor" href="#五、演进方向" aria-label="Permalink to &quot;五、演进方向&quot;">​</a></h2><h3 id="_5-1-设计原则" tabindex="-1">5.1 设计原则 <a class="header-anchor" href="#_5-1-设计原则" aria-label="Permalink to &quot;5.1 设计原则&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                       基座设计原则                                    │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  原则1：依赖倒置（DIP）                                              │</span></span>
<span class="line"><span>│  ──────────────────                                                  │</span></span>
<span class="line"><span>│  高层模块不应该依赖低层模块，两者都应该依赖抽象                       │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  // ❌ 直接依赖                                                      │</span></span>
<span class="line"><span>│  import { VipService } from &#39;./vip-service&#39;;                         │</span></span>
<span class="line"><span>│  class EditorService {                                               │</span></span>
<span class="line"><span>│      private vip = new VipService();  // 紧耦合                      │</span></span>
<span class="line"><span>│  }                                                                   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  // ✓ 依赖抽象                                                       │</span></span>
<span class="line"><span>│  interface IVipService { checkVip(): Promise&lt;boolean&gt;; }             │</span></span>
<span class="line"><span>│  class EditorService {                                               │</span></span>
<span class="line"><span>│      constructor(private vip: IVipService) {}  // 依赖接口           │</span></span>
<span class="line"><span>│  }                                                                   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  ─────────────────────────────────────────────────────────────────   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  原则2：开闭原则（OCP）                                              │</span></span>
<span class="line"><span>│  ──────────────────                                                  │</span></span>
<span class="line"><span>│  对扩展开放，对修改关闭                                              │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  // ❌ 修改核心代码                                                  │</span></span>
<span class="line"><span>│  if (isInsMind) { ... } else if (isGaoding) { ... }                 │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  // ✓ 扩展点设计                                                     │</span></span>
<span class="line"><span>│  const InsMindVipService = createVipService({ rules: insmindRules })│</span></span>
<span class="line"><span>│  const GaodingVipService = createVipService({ rules: gaodingRules })│</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  ─────────────────────────────────────────────────────────────────   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  原则3：单一职责（SRP）                                              │</span></span>
<span class="line"><span>│  ──────────────────                                                  │</span></span>
<span class="line"><span>│  一个模块只负责一件事                                                │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  // ❌ 职责混乱                                                      │</span></span>
<span class="line"><span>│  class UserService {                                                 │</span></span>
<span class="line"><span>│      login() { ... }                                                 │</span></span>
<span class="line"><span>│      checkVip() { ... }      // 应该在 VipService                   │</span></span>
<span class="line"><span>│      uploadAvatar() { ... }  // 应该在 UploadService                │</span></span>
<span class="line"><span>│  }                                                                   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  // ✓ 职责清晰                                                       │</span></span>
<span class="line"><span>│  class UserService { login() { ... } }                               │</span></span>
<span class="line"><span>│  class VipService { checkVip() { ... } }                             │</span></span>
<span class="line"><span>│  class UploadService { upload() { ... } }                            │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="_5-2-演进路线" tabindex="-1">5.2 演进路线 <a class="header-anchor" href="#_5-2-演进路线" aria-label="Permalink to &quot;5.2 演进路线&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                       基座演进路线图                                   │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  阶段1：服务抽取（第一代基座）                    ← 当前状态         │</span></span>
<span class="line"><span>│  ─────────────────────────────                                       │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  目标：将公共服务抽取到独立包                                        │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  实现：                                                               │</span></span>
<span class="line"><span>│  • @design/services：Pinia Store 管理服务                           │</span></span>
<span class="line"><span>│  • @design/business-ui：Vue 组件库                                  │</span></span>
<span class="line"><span>│  • @design/design-view-foundation：手动编排初始化                   │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  问题：                                                               │</span></span>
<span class="line"><span>│  • 依赖关系隐式                                                      │</span></span>
<span class="line"><span>│  • 初始化顺序手动管理                                                │</span></span>
<span class="line"><span>│  • 扩展需要修改核心代码                                              │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│                              │                                        │</span></span>
<span class="line"><span>│                              ▼                                        │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  阶段2：Kernel-X 架构（第二代基座）              ← 演进目标          │</span></span>
<span class="line"><span>│  ─────────────────────────────                                       │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  目标：引入依赖注入和扩展系统                                        │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  实现：                                                               │</span></span>
<span class="line"><span>│  • Token 系统：类型安全的身份标识                                    │</span></span>
<span class="line"><span>│  • 三层架构：Services → Components → Extensions                     │</span></span>
<span class="line"><span>│  • 扩展机制：Manifest + Activate                                    │</span></span>
<span class="line"><span>│  • 自动编排：依赖检查 + 拓扑排序                                    │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>│  收益：                                                               │</span></span>
<span class="line"><span>│  • 显式依赖声明                                                      │</span></span>
<span class="line"><span>│  • 自动初始化编排                                                    │</span></span>
<span class="line"><span>│  • Token 替换实现扩展                                                │</span></span>
<span class="line"><span>│  • 类型安全的事件系统                                                │</span></span>
<span class="line"><span>│                                                                       │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="_5-3-技术选型参考" tabindex="-1">5.3 技术选型参考 <a class="header-anchor" href="#_5-3-技术选型参考" aria-label="Permalink to &quot;5.3 技术选型参考&quot;">​</a></h3><table tabindex="0"><thead><tr><th>方案</th><th>代表项目</th><th>核心思想</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>依赖注入</strong></td><td>Angular、NestJS</td><td>声明依赖，容器自动注入</td><td>类型安全、可测试</td><td>学习成本</td></tr><tr><td><strong>扩展系统</strong></td><td>VSCode</td><td>扩展点 + 扩展实现</td><td>高度可扩展</td><td>设计复杂</td></tr><tr><td><strong>IOC容器</strong></td><td>InversifyJS</td><td>控制反转，解耦创建和使用</td><td>灵活、可插拔</td><td>运行时开销</td></tr><tr><td><strong>微前端</strong></td><td>qiankun</td><td>应用级隔离</td><td>独立部署</td><td>过重、通信复杂</td></tr></tbody></table><p><strong>最终选择</strong>：融合 <strong>依赖注入</strong> + <strong>扩展系统</strong> 的设计，形成 <strong>Kernel-X</strong> 架构。</p><hr><h2 id="六、小结" tabindex="-1">六、小结 <a class="header-anchor" href="#六、小结" aria-label="Permalink to &quot;六、小结&quot;">​</a></h2><p>本章介绍了编辑器业务的现状和基座化的必要性：</p><p><strong>核心要点</strong>：</p><ol><li><strong>多产品线矛盾</strong>：稿定设计、InsMind、稿定Art 等共享 70%+ 基础能力，但各自独立实现</li><li><strong>无基座困境</strong>：代码重复 15000+ 行、迭代效率低、质量参差、维护成本高</li><li><strong>基座化价值</strong>：开发效率提升 55%+、维护成本降低 67%+、质量一致性保障</li><li><strong>技术挑战</strong>：依赖管理、扩展机制、生命周期控制、类型安全</li></ol><p><strong>下一章预告</strong>：</p><p>我们将详细介绍<strong>第一代基座方案</strong>（Pinia + Vue）的实现：</p><ul><li>Foundation 层的应用入口设计</li><li>Services 层的 Pinia Store 模式</li><li>事件系统的实现</li><li>存在的局限性和问题</li></ul><p>这些内容将帮助理解为什么需要演进到 Kernel-X 架构。</p><hr><blockquote><p>📖 <strong>系列文档导航</strong></p><ul><li>[x] <strong>第一篇：业务现状与基座化需求</strong>（本文）</li><li>[ ] 第二篇：第一代基座方案实现</li><li>[ ] 第三篇：Kernel-X 架构详解</li><li>[ ] 第四篇：架构演进总结</li></ul></blockquote>`,82)]))}const u=n(l,[["render",e]]);export{d as __pageData,u as default};
