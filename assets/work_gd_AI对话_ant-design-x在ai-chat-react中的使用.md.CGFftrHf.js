import{_ as a,c as i,o as n,a7 as l}from"./chunks/framework.BQb8NfN9.js";const g=JSON.parse('{"title":"ant-design-x åœ¨ ai-chat-react ä¸­çš„ä½¿ç”¨è¯¦è§£","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/AIå¯¹è¯/ant-design-xåœ¨ai-chat-reactä¸­çš„ä½¿ç”¨.md","filePath":"work/gd/AIå¯¹è¯/ant-design-xåœ¨ai-chat-reactä¸­çš„ä½¿ç”¨.md","lastUpdated":1770085732000}'),p={name:"work/gd/AIå¯¹è¯/ant-design-xåœ¨ai-chat-reactä¸­çš„ä½¿ç”¨.md"};function e(t,s,h,k,r,d){return n(),i("div",null,s[0]||(s[0]=[l(`<h1 id="ant-design-x-åœ¨-ai-chat-react-ä¸­çš„ä½¿ç”¨è¯¦è§£" tabindex="-1">ant-design-x åœ¨ ai-chat-react ä¸­çš„ä½¿ç”¨è¯¦è§£ <a class="header-anchor" href="#ant-design-x-åœ¨-ai-chat-react-ä¸­çš„ä½¿ç”¨è¯¦è§£" aria-label="Permalink to &quot;ant-design-x åœ¨ ai-chat-react ä¸­çš„ä½¿ç”¨è¯¦è§£&quot;">â€‹</a></h1><blockquote><p><strong>æ–‡æ¡£ç›®çš„</strong>ï¼šè¯¦ç»†è¯´æ˜ <code>ai-chat-react</code> åŒ…ä¸­ä½¿ç”¨çš„ <code>ant-design-x</code> ç»„ä»¶å’Œ Hookï¼Œä»¥åŠå®ƒä»¬å„è‡ªçš„ä½œç”¨</p></blockquote><hr><h2 id="ä¸€ã€ant-design-x-ç®€ä»‹" tabindex="-1">ä¸€ã€ant-design-x ç®€ä»‹ <a class="header-anchor" href="#ä¸€ã€ant-design-x-ç®€ä»‹" aria-label="Permalink to &quot;ä¸€ã€ant-design-x ç®€ä»‹&quot;">â€‹</a></h2><p><strong>ant-design-x</strong> æ˜¯ç¨¿å®šï¼ˆGaodingï¼‰åŸºäº Ant Design æ”¹é€ çš„ React UI ç»„ä»¶åº“ï¼Œä¸“é—¨ä¸º <strong>AI é©±åŠ¨çš„ç”¨æˆ·ç•Œé¢</strong>è®¾è®¡ã€‚</p><p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p><ul><li>ğŸ¯ ä¸“ä¸º AI å¯¹è¯åœºæ™¯ä¼˜åŒ–</li><li>ğŸ’¬ å†…ç½®èŠå¤©ç»„ä»¶ï¼ˆBubbleã€Senderç­‰ï¼‰</li><li>ğŸ”„ æµå¼æ•°æ®å¤„ç†æ”¯æŒ</li><li>ğŸ¨ ç»Ÿä¸€çš„ä¸»é¢˜å’Œæ ·å¼ç³»ç»Ÿ</li></ul><hr><h2 id="äºŒã€ä½¿ç”¨çš„ç»„ä»¶å’Œ-hook-æ€»è§ˆ" tabindex="-1">äºŒã€ä½¿ç”¨çš„ç»„ä»¶å’Œ Hook æ€»è§ˆ <a class="header-anchor" href="#äºŒã€ä½¿ç”¨çš„ç»„ä»¶å’Œ-hook-æ€»è§ˆ" aria-label="Permalink to &quot;äºŒã€ä½¿ç”¨çš„ç»„ä»¶å’Œ Hook æ€»è§ˆ&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>å¯¼å…¥è·¯å¾„</th><th>ä½¿ç”¨ä½ç½®</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>ç»„ä»¶</strong></td><td><code>XProvider</code></td><td><code>@gaoding/ant-design-x</code></td><td>Chatç»„ä»¶</td><td>å…¨å±€ä¸»é¢˜æä¾›è€…</td></tr><tr><td><strong>ç»„ä»¶</strong></td><td><code>Bubble.List</code></td><td><code>@gaoding/ant-design-x</code></td><td>Messageç»„ä»¶</td><td>æ¶ˆæ¯æ°”æ³¡åˆ—è¡¨</td></tr><tr><td><strong>Hook</strong></td><td><code>useXAgent</code></td><td><code>@gaoding/ant-design-x</code></td><td>useMessage Hook</td><td>AI Agentè¯·æ±‚ç®¡ç†</td></tr><tr><td><strong>Hook</strong></td><td><code>useXChat</code></td><td><code>@gaoding/ant-design-x</code></td><td>useMessage Hook</td><td>èŠå¤©æ¶ˆæ¯çŠ¶æ€ç®¡ç†</td></tr><tr><td><strong>å·¥å…·</strong></td><td><code>XStream</code></td><td><code>@gaoding/ant-design-x</code></td><td>SSEæœåŠ¡</td><td>æµå¼æ•°æ®å¤„ç†</td></tr><tr><td><strong>ç±»å‹</strong></td><td><code>MessageInfo</code></td><td><code>@gaoding/ant-design-x/es/use-x-chat/index</code></td><td>Messageç»„ä»¶</td><td>æ¶ˆæ¯ä¿¡æ¯ç±»å‹</td></tr><tr><td><strong>ç±»å‹</strong></td><td><code>BubbleListRef</code></td><td><code>@gaoding/ant-design-x/es/bubble/BubbleList</code></td><td>useMessageScroll</td><td>æ°”æ³¡åˆ—è¡¨å¼•ç”¨ç±»å‹</td></tr></tbody></table><hr><h2 id="ä¸‰ã€è¯¦ç»†è§£æ" tabindex="-1">ä¸‰ã€è¯¦ç»†è§£æ <a class="header-anchor" href="#ä¸‰ã€è¯¦ç»†è§£æ" aria-label="Permalink to &quot;ä¸‰ã€è¯¦ç»†è§£æ&quot;">â€‹</a></h2><h3 id="_3-1-xprovider-å…¨å±€ä¸»é¢˜æä¾›è€…" tabindex="-1">3.1 XProviderï¼ˆå…¨å±€ä¸»é¢˜æä¾›è€…ï¼‰ <a class="header-anchor" href="#_3-1-xprovider-å…¨å±€ä¸»é¢˜æä¾›è€…" aria-label="Permalink to &quot;3.1 XProviderï¼ˆå…¨å±€ä¸»é¢˜æä¾›è€…ï¼‰&quot;">â€‹</a></h3><p><strong>ä½ç½®</strong>ï¼š<code>src/components/chat/index.tsx</code></p><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>æä¾›å…¨å±€ä¸»é¢˜é…ç½®</li><li>ç¡®ä¿æ‰€æœ‰ ant-design-x ç»„ä»¶ä½¿ç”¨ç»Ÿä¸€çš„ä¸»é¢˜</li><li>æ”¯æŒä¸»é¢˜å®šåˆ¶ï¼ˆå¦‚ç¦ç”¨ hash ç±»åï¼‰</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { XProvider } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@gaoding/ant-design-x&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Chat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChatOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &lt;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">XProvider</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            theme</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                hashed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç¦ç”¨CSSç±»åhashï¼Œä¾¿äºæ ·å¼è¦†ç›–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">div className</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{style.aiChatContainer}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Message messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{messages} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">XProvider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>é…ç½®è¯´æ˜</strong>ï¼š</p><table tabindex="0"><thead><tr><th>é…ç½®é¡¹</th><th>ç±»å‹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>hashed</code></td><td><code>boolean</code></td><td>æ˜¯å¦ä½¿ç”¨hashç±»å</td><td><code>true</code></td></tr><tr><td><code>theme</code></td><td><code>object</code></td><td>ä¸»é¢˜é…ç½®å¯¹è±¡</td><td><code>{}</code></td></tr></tbody></table><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ XProviderï¼Ÿ</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ant-design-x çš„ç»„ä»¶ï¼ˆå¦‚ Bubbleï¼‰éœ€è¦ç»Ÿä¸€çš„ä¸»é¢˜ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span>  â†’ å¦‚æœæ²¡æœ‰ XProviderï¼Œç»„ä»¶å¯èƒ½æ— æ³•æ­£ç¡®åº”ç”¨æ ·å¼</span></span>
<span class="line"><span>  â†’ ç±»ä¼¼äº Ant Design çš„ ConfigProvider</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><hr><h3 id="_3-2-bubble-list-æ¶ˆæ¯æ°”æ³¡åˆ—è¡¨" tabindex="-1">3.2 Bubble.Listï¼ˆæ¶ˆæ¯æ°”æ³¡åˆ—è¡¨ï¼‰ <a class="header-anchor" href="#_3-2-bubble-list-æ¶ˆæ¯æ°”æ³¡åˆ—è¡¨" aria-label="Permalink to &quot;3.2 Bubble.Listï¼ˆæ¶ˆæ¯æ°”æ³¡åˆ—è¡¨ï¼‰&quot;">â€‹</a></h3><p><strong>ä½ç½®</strong>ï¼š<code>src/components/message/index.tsx</code></p><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>æ¸²æŸ“èŠå¤©æ¶ˆæ¯åˆ—è¡¨</li><li>è‡ªåŠ¨å¤„ç†æ¶ˆæ¯æ°”æ³¡çš„å¸ƒå±€ï¼ˆå·¦ä¾§/å³ä¾§ï¼‰</li><li>æ”¯æŒä¸åŒè§’è‰²çš„æ¶ˆæ¯æ ·å¼é…ç½®</li><li>å†…ç½®æ»šåŠ¨å’Œè‡ªåŠ¨æ»šåŠ¨åŠŸèƒ½</li><li>æ”¯æŒæ‰“å­—æœºæ•ˆæœï¼ˆtypingï¼‰</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Bubble } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@gaoding/ant-design-x&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Bubble.List</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;chat-message-bubble-list&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{bubbleRef}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    roles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{messageRoles}           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è§’è‰²é…ç½®ï¼ˆuser/assistant/systemï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    autoScroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{true}              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    items</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{messages.map((message, index) =&gt; ({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: message.messageId,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        role</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: message.role,        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;user&#39; | &#39;assistant&#39; | &#39;system&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: message.content.text,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        messageRender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            getMessageRender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message, content, isLastMessage),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        typing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ˜¯å¦æ˜¾ç¤ºæ‰“å­—æœºæ•ˆæœ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        loading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: message.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;waiting&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åŠ è½½çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        loadingRender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Loading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        footer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MessageFooter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¶ˆæ¯åº•éƒ¨å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }))}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>è§’è‰²é…ç½®ï¼ˆmessageRolesï¼‰</strong>ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/components/message/config.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> messageRoles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GetProp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Bubble.List, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;roles&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  assistant: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    placement: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;start&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å·¦ä¾§æ˜¾ç¤ºï¼ˆAIæ¶ˆæ¯ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      maxWidth: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">760</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æœ€å¤§å®½åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    styles: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      footer: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        width: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;100%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  user: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    placement: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å³ä¾§æ˜¾ç¤ºï¼ˆç”¨æˆ·æ¶ˆæ¯ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    styles: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      content: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        width: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;90%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  system: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    placement: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;start&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å·¦ä¾§æ˜¾ç¤ºï¼ˆç³»ç»Ÿæ¶ˆæ¯ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š</p><p>| åŠŸèƒ½ | è¯´æ˜ | å®ç°æ–¹å¼ | | -------------- | ------------------------- | ----------------------------------- | ------ | | <strong>è‡ªåŠ¨å¸ƒå±€</strong> | æ ¹æ®roleè‡ªåŠ¨é€‰æ‹©å·¦ä¾§/å³ä¾§ | <code>placement: &#39;start&#39; | &#39;end&#39;</code> | | <strong>è‡ªåŠ¨æ»šåŠ¨</strong> | æ–°æ¶ˆæ¯æ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨ | <code>autoScroll={true}</code> | | <strong>æ‰“å­—æœºæ•ˆæœ</strong> | é€å­—æ˜¾ç¤ºæ¶ˆæ¯å†…å®¹ | <code>typing: true</code> + <code>onTypingComplete</code> | | <strong>åŠ è½½çŠ¶æ€</strong> | æ˜¾ç¤ºåŠ è½½åŠ¨ç”» | <code>loading: true</code> + <code>loadingRender</code> | | <strong>è‡ªå®šä¹‰æ¸²æŸ“</strong> | å®Œå…¨è‡ªå®šä¹‰æ¶ˆæ¯å†…å®¹ | <code>messageRender</code> å‡½æ•° |</p><p><strong>Bubble.List çš„ä¼˜åŠ¿</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>âœ… å†…ç½®èŠå¤©UIæœ€ä½³å®è·µï¼ˆå·¦å³å¸ƒå±€ã€æ°”æ³¡æ ·å¼ï¼‰</span></span>
<span class="line"><span>âœ… è‡ªåŠ¨å¤„ç†æ»šåŠ¨é€»è¾‘</span></span>
<span class="line"><span>âœ… æ”¯æŒæ‰“å­—æœºæ•ˆæœï¼ˆæµå¼æ¶ˆæ¯å±•ç¤ºï¼‰</span></span>
<span class="line"><span>âœ… å“åº”å¼å¸ƒå±€ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰</span></span>
<span class="line"><span>âœ… æ€§èƒ½ä¼˜åŒ–ï¼ˆè™šæ‹Ÿæ»šåŠ¨æ”¯æŒï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h3 id="_3-3-usexagent-ai-agentè¯·æ±‚ç®¡ç†hook" tabindex="-1">3.3 useXAgentï¼ˆAI Agentè¯·æ±‚ç®¡ç†Hookï¼‰ <a class="header-anchor" href="#_3-3-usexagent-ai-agentè¯·æ±‚ç®¡ç†hook" aria-label="Permalink to &quot;3.3 useXAgentï¼ˆAI Agentè¯·æ±‚ç®¡ç†Hookï¼‰&quot;">â€‹</a></h3><p><strong>ä½ç½®</strong>ï¼š<code>src/hook/use-message/index.ts</code></p><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>ç®¡ç† AI Agent çš„è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ</li><li>æä¾›ç»Ÿä¸€çš„è¯·æ±‚æ¥å£ï¼ˆrequestï¼‰</li><li>å†…ç½® loading çŠ¶æ€ç®¡ç†</li><li>æ”¯æŒæµå¼æ›´æ–°ï¼ˆonUpdateï¼‰</li><li>ç»Ÿä¸€çš„é”™è¯¯å¤„ç†</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { useXAgent } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@gaoding/ant-design-x&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">agent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useXAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MessageType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]&gt;({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">onUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">onError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. åˆå§‹åŒ– MessageHandler</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messageHandlerRef.current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessageHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      observer: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        onUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">filteredMessages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // æµå¼æ›´æ–°ï¼šæ¯æ¬¡æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          onUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(filteredMessages);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">messages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">autoSave</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // è¯·æ±‚å®Œæˆï¼šæ‰€æœ‰æ¶ˆæ¯å¤„ç†å®Œæ¯•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(messages);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. å»ºç«‹SSEè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sseManagerRef.current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SSEManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      onMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">done</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // SSEæ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œäº¤ç»™MessageHandlerå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        messageHandlerRef.current?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleSSEMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, done);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. è¿æ¥SSE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sseManagerRef.current.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([message[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]], isOnline.current, events);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨ agent</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isRequesting</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isRequesting</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è·å–è¯·æ±‚çŠ¶æ€</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><strong>useXAgent çš„æ ¸å¿ƒä»·å€¼</strong>ï¼š</p><table tabindex="0"><thead><tr><th>åŠŸèƒ½</th><th>è¯´æ˜</th><th>è§£å†³çš„é—®é¢˜</th></tr></thead><tbody><tr><td><strong>ç»Ÿä¸€è¯·æ±‚ç®¡ç†</strong></td><td>å°è£…è¯·æ±‚çš„å‘èµ·ã€æ›´æ–°ã€å®Œæˆ</td><td>é¿å…é‡å¤çš„çŠ¶æ€ç®¡ç†ä»£ç </td></tr><tr><td><strong>å†…ç½®loadingçŠ¶æ€</strong></td><td>è‡ªåŠ¨ç®¡ç† <code>isRequesting</code></td><td>ä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤loadingçŠ¶æ€</td></tr><tr><td><strong>æµå¼æ›´æ–°æ”¯æŒ</strong></td><td><code>onUpdate</code> å›è°ƒæ”¯æŒæµå¼æ•°æ®</td><td>SSEæµå¼æ¶ˆæ¯çš„å®æ—¶æ›´æ–°</td></tr><tr><td><strong>é”™è¯¯å¤„ç†</strong></td><td>ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶</td><td>ä¸€è‡´çš„é”™è¯¯å¤„ç†é€»è¾‘</td></tr><tr><td><strong>å–æ¶ˆæ”¯æŒ</strong></td><td>å†…ç½®å–æ¶ˆè¯·æ±‚çš„èƒ½åŠ›</td><td>ç”¨æˆ·å¯ä»¥å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚</td></tr></tbody></table><p><strong>è¿”å›çš„ agent å¯¹è±¡</strong>ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> XAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  isRequesting</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ˜¯å¦æ­£åœ¨è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å‘èµ·è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cancel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å–æ¶ˆè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h3 id="_3-4-usexchat-èŠå¤©æ¶ˆæ¯çŠ¶æ€ç®¡ç†hook" tabindex="-1">3.4 useXChatï¼ˆèŠå¤©æ¶ˆæ¯çŠ¶æ€ç®¡ç†Hookï¼‰ <a class="header-anchor" href="#_3-4-usexchat-èŠå¤©æ¶ˆæ¯çŠ¶æ€ç®¡ç†hook" aria-label="Permalink to &quot;3.4 useXChatï¼ˆèŠå¤©æ¶ˆæ¯çŠ¶æ€ç®¡ç†Hookï¼‰&quot;">â€‹</a></h3><p><strong>ä½ç½®</strong>ï¼š<code>src/hook/use-message/index.ts</code></p><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>ç®¡ç†èŠå¤©æ¶ˆæ¯åˆ—è¡¨çš„çŠ¶æ€</li><li>ä¸ <code>useXAgent</code> é…åˆä½¿ç”¨</li><li>æä¾›æ¶ˆæ¯çš„å¢åˆ æ”¹æŸ¥æ–¹æ³•</li><li>è‡ªåŠ¨å¤„ç†æ¶ˆæ¯çš„æ ¼å¼åŒ–</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { useXChat } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@gaoding/ant-design-x&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  onRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å‘èµ·è¯·æ±‚çš„æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  messages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¶ˆæ¯åˆ—è¡¨ï¼ˆæ ¼å¼åŒ–çš„ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  setMessages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®¾ç½®æ¶ˆæ¯åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useXChat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  agent, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä» useXAgent è¿”å›çš„ agent</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// messages çš„æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">messages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: Array</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MessageInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MessageType[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;msg-id-1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;finished&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message: [message1, message2], </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¯èƒ½åŒ…å«å¤šä¸ªæ¶ˆæ¯ï¼ˆå¦‚æ‰¹é‡ç”Ÿæˆï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;msg-id-2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;loading&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message: [message3],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>useXChat çš„æ ¸å¿ƒä»·å€¼</strong>ï¼š</p><table tabindex="0"><thead><tr><th>åŠŸèƒ½</th><th>è¯´æ˜</th><th>è§£å†³çš„é—®é¢˜</th></tr></thead><tbody><tr><td><strong>æ¶ˆæ¯æ ¼å¼åŒ–</strong></td><td>è‡ªåŠ¨å°†æ¶ˆæ¯æ ¼å¼åŒ–ä¸º <code>MessageInfo</code> æ ¼å¼</td><td>ç»Ÿä¸€æ¶ˆæ¯æ•°æ®ç»“æ„</td></tr><tr><td><strong>çŠ¶æ€ç®¡ç†</strong></td><td>ç®¡ç†æ¶ˆæ¯çš„çŠ¶æ€ï¼ˆwaiting/loading/finishedï¼‰</td><td>è‡ªåŠ¨æ›´æ–°æ¶ˆæ¯çŠ¶æ€</td></tr><tr><td><strong>æ‰¹é‡æ¶ˆæ¯æ”¯æŒ</strong></td><td>æ”¯æŒä¸€ä¸ªæ¶ˆæ¯é¡¹åŒ…å«å¤šä¸ªæ¶ˆæ¯</td><td>æ‰¹é‡ç”Ÿæˆåœºæ™¯</td></tr><tr><td><strong>ä¸Agenté›†æˆ</strong></td><td>ä¸ useXAgent æ— ç¼é›†æˆ</td><td>è‡ªåŠ¨å¤„ç†è¯·æ±‚å’Œæ¶ˆæ¯çš„å…³è”</td></tr></tbody></table><p><strong>MessageInfo ç±»å‹</strong>ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessageInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¶ˆæ¯ID</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// çŠ¶æ€ï¼ˆwaiting/loading/finishedï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¶ˆæ¯å†…å®¹æ•°ç»„ï¼ˆæ”¯æŒæ‰¹é‡ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ useXChatï¼Ÿ</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>useXAgent åªè´Ÿè´£è¯·æ±‚ç®¡ç†</span></span>
<span class="line"><span>useXChat è´Ÿè´£æ¶ˆæ¯çŠ¶æ€ç®¡ç†</span></span>
<span class="line"><span>  â†’ ä¸¤è€…é…åˆï¼Œå®ç°å®Œæ•´çš„èŠå¤©åŠŸèƒ½</span></span>
<span class="line"><span>  â†’ ç±»ä¼¼äº Redux çš„ action å’Œ reducer çš„å…³ç³»</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><hr><h3 id="_3-5-xstream-æµå¼æ•°æ®å¤„ç†å·¥å…·" tabindex="-1">3.5 XStreamï¼ˆæµå¼æ•°æ®å¤„ç†å·¥å…·ï¼‰ <a class="header-anchor" href="#_3-5-xstream-æµå¼æ•°æ®å¤„ç†å·¥å…·" aria-label="Permalink to &quot;3.5 XStreamï¼ˆæµå¼æ•°æ®å¤„ç†å·¥å…·ï¼‰&quot;">â€‹</a></h3><p><strong>ä½ç½®</strong>ï¼š<code>src/services/sse.ts</code></p><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>å¤„ç† ReadableStream æµå¼æ•°æ®</li><li>æ”¯æŒè‡ªå®šä¹‰ TransformStream</li><li>è‡ªåŠ¨å¤„ç†æµå¼æ•°æ®çš„è§£æå’Œè½¬æ¢</li><li>æ”¯æŒå¼‚æ­¥è¿­ä»£ï¼ˆfor await...ofï¼‰</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { XStream } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@gaoding/ant-design-x&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. åˆ›å»ºè‡ªå®šä¹‰ TransformStream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createCustomTransformStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TransformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">done</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessageType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TransformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    transform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">controller</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å¤„ç†JSONåˆ†æ®µ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enqueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ done: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        buffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        buffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸å®Œæ•´ï¼Œç¼“å­˜èµ·æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    flush</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">controller</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enqueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ done: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data: [] });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. ä½¿ç”¨ XStream å¤„ç†æµå¼æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> of</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> XStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  readableStream: response.body, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åŸå§‹çš„ ReadableStream</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  transformStream: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createCustomTransformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è‡ªå®šä¹‰è½¬æ¢æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  callBack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunk); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¤„ç†è½¬æ¢åçš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (chunk.done) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æµç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p><strong>XStream çš„æ ¸å¿ƒä»·å€¼</strong>ï¼š</p><table tabindex="0"><thead><tr><th>åŠŸèƒ½</th><th>è¯´æ˜</th><th>è§£å†³çš„é—®é¢˜</th></tr></thead><tbody><tr><td><strong>æµå¼å¤„ç†</strong></td><td>å°† ReadableStream è½¬æ¢ä¸ºå¯è¿­ä»£å¯¹è±¡</td><td>ç®€åŒ–æµå¼æ•°æ®çš„å¤„ç†</td></tr><tr><td><strong>Transformæ”¯æŒ</strong></td><td>æ”¯æŒè‡ªå®šä¹‰ TransformStream</td><td>å¯ä»¥åœ¨æµå¼ä¼ è¾“è¿‡ç¨‹ä¸­è½¬æ¢æ•°æ®</td></tr><tr><td><strong>å¼‚æ­¥è¿­ä»£</strong></td><td>æ”¯æŒ <code>for await...of</code> è¯­æ³•</td><td>ä¼˜é›…çš„å¼‚æ­¥æµå¼å¤„ç†</td></tr><tr><td><strong>é”™è¯¯å¤„ç†</strong></td><td>å†…ç½®é”™è¯¯å¤„ç†æœºåˆ¶</td><td>æµå¼ä¼ è¾“çš„é”™è¯¯å¤„ç†</td></tr></tbody></table><p><strong>XStream çš„å·¥ä½œæµç¨‹</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ReadableStream (åŸå§‹æµ)</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>XStream (åŒ…è£…)</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>TransformStream (è‡ªå®šä¹‰è½¬æ¢)</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>for await...of (å¼‚æ­¥è¿­ä»£)</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>å¤„ç†æ¯ä¸ªchunk</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ XStreamï¼Ÿ</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>åŸç”Ÿ ReadableStream å¤„ç†å¤æ‚ï¼š</span></span>
<span class="line"><span>  â†’ éœ€è¦æ‰‹åŠ¨ç®¡ç† reader</span></span>
<span class="line"><span>  â†’ éœ€è¦æ‰‹åŠ¨å¤„ç† buffer</span></span>
<span class="line"><span>  â†’ é”™è¯¯å¤„ç†å¤æ‚</span></span>
<span class="line"><span></span></span>
<span class="line"><span>XStream å°è£…åï¼š</span></span>
<span class="line"><span>  â†’ æ”¯æŒå¼‚æ­¥è¿­ä»£ï¼ˆfor await...ofï¼‰</span></span>
<span class="line"><span>  â†’ æ”¯æŒ TransformStreamï¼ˆæ•°æ®è½¬æ¢ï¼‰</span></span>
<span class="line"><span>  â†’ é”™è¯¯å¤„ç†æ›´ç®€å•</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h3 id="_3-6-bubblelistref-æ°”æ³¡åˆ—è¡¨å¼•ç”¨ç±»å‹" tabindex="-1">3.6 BubbleListRefï¼ˆæ°”æ³¡åˆ—è¡¨å¼•ç”¨ç±»å‹ï¼‰ <a class="header-anchor" href="#_3-6-bubblelistref-æ°”æ³¡åˆ—è¡¨å¼•ç”¨ç±»å‹" aria-label="Permalink to &quot;3.6 BubbleListRefï¼ˆæ°”æ³¡åˆ—è¡¨å¼•ç”¨ç±»å‹ï¼‰&quot;">â€‹</a></h3><p><strong>ä½ç½®</strong>ï¼š<code>src/hook/use-message-scroll.ts</code></p><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>æä¾›å¯¹ Bubble.List ç»„ä»¶çš„å¼•ç”¨</li><li>æš´éœ²æ»šåŠ¨ç›¸å…³çš„æ–¹æ³•å’Œå±æ€§</li><li>ç”¨äºå®ç°è‡ªå®šä¹‰æ»šåŠ¨é€»è¾‘</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { BubbleListRef } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@gaoding/ant-design-x/es/bubble/BubbleList&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bubbleRef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BubbleListRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨ ref è®¿é—®åŸç”ŸDOMå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> element</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bubbleRef.current?.nativeElement;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ»šåŠ¨åˆ°åº•éƒ¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">element.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scrollTo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  top: Number.MAX_SAFE_INTEGER,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  behavior: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;smooth&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è·å–æ»šåŠ¨ä½ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scrollTop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> element.scrollTop;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scrollHeight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> element.scrollHeight;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> clientHeight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> element.clientHeight;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>BubbleListRef çš„ç»“æ„</strong>ï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BubbleListRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  nativeElement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLDivElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åŸç”ŸDOMå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¯èƒ½è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼ˆæ ¹æ® ant-design-x ç‰ˆæœ¬ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ BubbleListRefï¼Ÿ</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Bubble.List ç»„ä»¶å°è£…äº†æ»šåŠ¨é€»è¾‘</span></span>
<span class="line"><span>ä½†æœ‰æ—¶éœ€è¦è‡ªå®šä¹‰æ»šåŠ¨è¡Œä¸ºï¼š</span></span>
<span class="line"><span>  â†’ æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆgoToBottomï¼‰</span></span>
<span class="line"><span>  â†’ æ£€æµ‹æ»šåŠ¨ä½ç½®ï¼ˆisScrollBottomï¼‰</span></span>
<span class="line"><span>  â†’ ç›‘å¬æ»šåŠ¨äº‹ä»¶</span></span>
<span class="line"><span></span></span>
<span class="line"><span>é€šè¿‡ ref å¯ä»¥è®¿é—®åŸç”ŸDOMå…ƒç´ ï¼Œå®ç°è‡ªå®šä¹‰é€»è¾‘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr><h2 id="å››ã€å®Œæ•´ä½¿ç”¨æµç¨‹" tabindex="-1">å››ã€å®Œæ•´ä½¿ç”¨æµç¨‹ <a class="header-anchor" href="#å››ã€å®Œæ•´ä½¿ç”¨æµç¨‹" aria-label="Permalink to &quot;å››ã€å®Œæ•´ä½¿ç”¨æµç¨‹&quot;">â€‹</a></h2><h3 id="_4-1-åˆå§‹åŒ–æµç¨‹" tabindex="-1">4.1 åˆå§‹åŒ–æµç¨‹ <a class="header-anchor" href="#_4-1-åˆå§‹åŒ–æµç¨‹" aria-label="Permalink to &quot;4.1 åˆå§‹åŒ–æµç¨‹&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. ä½¿ç”¨ useXAgent ç®¡ç†è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">agent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useXAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">onUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å»ºç«‹SSEè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sseManager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SSEManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            onMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">done</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // å¤„ç†SSEæ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                messageHandler.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleSSEMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, done);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä½¿ç”¨ XStream å¤„ç†æµå¼æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> of</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> XStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            readableStream: response.body,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            transformStream: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createCustomTransformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        })) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // å¤„ç†æ¯ä¸ªchunk</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. ä½¿ç”¨ useXChat ç®¡ç†æ¶ˆæ¯çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">messages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">onRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setMessages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useXChat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    agent,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. ä½¿ç”¨ Bubble.List æ¸²æŸ“æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">XProvider theme</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Bubble.List</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{bubbleRef}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        roles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{messageRoles}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        items</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{messages.map(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            key: msg.id,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            role: msg.role,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            content: msg.content.text,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            messageRender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> renderMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg, content),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }))}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    /&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">XProvider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="_4-2-æ•°æ®æµè½¬" tabindex="-1">4.2 æ•°æ®æµè½¬ <a class="header-anchor" href="#_4-2-æ•°æ®æµè½¬" aria-label="Permalink to &quot;4.2 æ•°æ®æµè½¬&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>onRequest() (useXChat)</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>agent.request() (useXAgent)</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>SSEè¿æ¥å»ºç«‹</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>XStream å¤„ç†æµå¼æ•°æ®</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>MessageHandler è§£ææ¶ˆæ¯</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>onUpdate() å›è°ƒ</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>useXChat æ›´æ–° messages</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>Bubble.List é‡æ–°æ¸²æŸ“</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>ç”¨æˆ·çœ‹åˆ°æ–°æ¶ˆæ¯</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><hr><h2 id="äº”ã€å„ç»„ä»¶-hookçš„èŒè´£åˆ’åˆ†" tabindex="-1">äº”ã€å„ç»„ä»¶/Hookçš„èŒè´£åˆ’åˆ† <a class="header-anchor" href="#äº”ã€å„ç»„ä»¶-hookçš„èŒè´£åˆ’åˆ†" aria-label="Permalink to &quot;äº”ã€å„ç»„ä»¶/Hookçš„èŒè´£åˆ’åˆ†&quot;">â€‹</a></h2><h3 id="_5-1-èŒè´£çŸ©é˜µ" tabindex="-1">5.1 èŒè´£çŸ©é˜µ <a class="header-anchor" href="#_5-1-èŒè´£çŸ©é˜µ" aria-label="Permalink to &quot;5.1 èŒè´£çŸ©é˜µ&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>ç»„ä»¶/Hook</th><th>è´Ÿè´£çš„å†…å®¹</th><th>ä¸è´Ÿè´£çš„å†…å®¹</th></tr></thead><tbody><tr><td><strong>XProvider</strong></td><td>å…¨å±€ä¸»é¢˜é…ç½®</td><td>ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ç®¡ç†</td></tr><tr><td><strong>Bubble.List</strong></td><td>æ¶ˆæ¯UIå±•ç¤ºã€å¸ƒå±€ã€æ»šåŠ¨</td><td>æ¶ˆæ¯æ•°æ®å¤„ç†ã€SSEè¿æ¥</td></tr><tr><td><strong>useXAgent</strong></td><td>è¯·æ±‚ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€loadingçŠ¶æ€</td><td>æ¶ˆæ¯çŠ¶æ€ç®¡ç†ã€UIæ¸²æŸ“</td></tr><tr><td><strong>useXChat</strong></td><td>æ¶ˆæ¯çŠ¶æ€ç®¡ç†ã€æ¶ˆæ¯æ ¼å¼åŒ–</td><td>SSEè¿æ¥ã€æ¶ˆæ¯è§£æ</td></tr><tr><td><strong>XStream</strong></td><td>æµå¼æ•°æ®å¤„ç†ã€æ•°æ®è½¬æ¢</td><td>æ¶ˆæ¯è§£æã€UIæ¸²æŸ“</td></tr></tbody></table><h3 id="_5-2-ä¾èµ–å…³ç³»" tabindex="-1">5.2 ä¾èµ–å…³ç³» <a class="header-anchor" href="#_5-2-ä¾èµ–å…³ç³»" aria-label="Permalink to &quot;5.2 ä¾èµ–å…³ç³»&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>XProvider</span></span>
<span class="line"><span>  â†“ (æä¾›ä¸»é¢˜)</span></span>
<span class="line"><span>Bubble.List</span></span>
<span class="line"><span>  â†“ (ä½¿ç”¨æ¶ˆæ¯æ•°æ®)</span></span>
<span class="line"><span>useXChat</span></span>
<span class="line"><span>  â†“ (ä¾èµ–)</span></span>
<span class="line"><span>useXAgent</span></span>
<span class="line"><span>  â†“ (ä½¿ç”¨æµå¼æ•°æ®)</span></span>
<span class="line"><span>XStream</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h2 id="å…­ã€ä¸ºä»€ä¹ˆé€‰æ‹©-ant-design-x" tabindex="-1">å…­ã€ä¸ºä»€ä¹ˆé€‰æ‹© ant-design-xï¼Ÿ <a class="header-anchor" href="#å…­ã€ä¸ºä»€ä¹ˆé€‰æ‹©-ant-design-x" aria-label="Permalink to &quot;å…­ã€ä¸ºä»€ä¹ˆé€‰æ‹© ant-design-xï¼Ÿ&quot;">â€‹</a></h2><h3 id="_6-1-ä¼˜åŠ¿" tabindex="-1">6.1 ä¼˜åŠ¿ <a class="header-anchor" href="#_6-1-ä¼˜åŠ¿" aria-label="Permalink to &quot;6.1 ä¼˜åŠ¿&quot;">â€‹</a></h3><ol><li><p><strong>ä¸“ä¸ºAIåœºæ™¯è®¾è®¡</strong></p><ul><li>Bubbleç»„ä»¶å†…ç½®èŠå¤©UIæœ€ä½³å®è·µ</li><li>æ”¯æŒæ‰“å­—æœºæ•ˆæœï¼ˆæµå¼æ¶ˆæ¯å±•ç¤ºï¼‰</li><li>è‡ªåŠ¨å¤„ç†æ¶ˆæ¯å¸ƒå±€ï¼ˆå·¦å³å¯¹é½ï¼‰</li></ul></li><li><p><strong>æµå¼æ•°æ®å¤„ç†</strong></p><ul><li>XStreamç®€åŒ–æµå¼æ•°æ®å¤„ç†</li><li>æ”¯æŒTransformStreamè‡ªå®šä¹‰è½¬æ¢</li><li>å¼‚æ­¥è¿­ä»£è¯­æ³•ä¼˜é›…</li></ul></li><li><p><strong>çŠ¶æ€ç®¡ç†</strong></p><ul><li>useXAgentç»Ÿä¸€è¯·æ±‚ç®¡ç†</li><li>useXChatç»Ÿä¸€æ¶ˆæ¯çŠ¶æ€ç®¡ç†</li><li>å‡å°‘æ ·æ¿ä»£ç </li></ul></li><li><p><strong>æ€§èƒ½ä¼˜åŒ–</strong></p><ul><li>Bubble.Listæ”¯æŒè™šæ‹Ÿæ»šåŠ¨</li><li>è‡ªåŠ¨æ»šåŠ¨ä¼˜åŒ–</li><li>å†…ç½®é˜²æŠ–å’ŒèŠ‚æµ</li></ul></li></ol><h3 id="_6-2-ä¸åŸç”Ÿå®ç°å¯¹æ¯”" tabindex="-1">6.2 ä¸åŸç”Ÿå®ç°å¯¹æ¯” <a class="header-anchor" href="#_6-2-ä¸åŸç”Ÿå®ç°å¯¹æ¯”" aria-label="Permalink to &quot;6.2 ä¸åŸç”Ÿå®ç°å¯¹æ¯”&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>åŠŸèƒ½</th><th>åŸç”Ÿå®ç°</th><th>ä½¿ç”¨ ant-design-x</th></tr></thead><tbody><tr><td><strong>æ¶ˆæ¯å¸ƒå±€</strong></td><td>éœ€è¦æ‰‹åŠ¨å®ç°å·¦å³å¸ƒå±€</td><td>âœ… Bubbleè‡ªåŠ¨å¤„ç†</td></tr><tr><td><strong>æµå¼æ•°æ®å¤„ç†</strong></td><td>éœ€è¦æ‰‹åŠ¨ç®¡ç†readerå’Œbuffer</td><td>âœ… XStreamå°è£…</td></tr><tr><td><strong>çŠ¶æ€ç®¡ç†</strong></td><td>éœ€è¦æ‰‹åŠ¨ç®¡ç†loadingã€messages</td><td>âœ… useXAgent + useXChat</td></tr><tr><td><strong>æ»šåŠ¨é€»è¾‘</strong></td><td>éœ€è¦æ‰‹åŠ¨å®ç°è‡ªåŠ¨æ»šåŠ¨</td><td>âœ… Bubbleå†…ç½®</td></tr><tr><td><strong>æ‰“å­—æœºæ•ˆæœ</strong></td><td>éœ€è¦æ‰‹åŠ¨å®ç°é€å­—æ˜¾ç¤º</td><td>âœ… Bubbleå†…ç½®</td></tr></tbody></table><hr><h2 id="ä¸ƒã€å®é™…ä½¿ç”¨ç¤ºä¾‹" tabindex="-1">ä¸ƒã€å®é™…ä½¿ç”¨ç¤ºä¾‹ <a class="header-anchor" href="#ä¸ƒã€å®é™…ä½¿ç”¨ç¤ºä¾‹" aria-label="Permalink to &quot;ä¸ƒã€å®é™…ä½¿ç”¨ç¤ºä¾‹&quot;">â€‹</a></h2><h3 id="_7-1-å®Œæ•´ç¤ºä¾‹" tabindex="-1">7.1 å®Œæ•´ç¤ºä¾‹ <a class="header-anchor" href="#_7-1-å®Œæ•´ç¤ºä¾‹" aria-label="Permalink to &quot;7.1 å®Œæ•´ç¤ºä¾‹&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { XProvider, useXAgent, useXChat, Bubble, XStream } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@gaoding/ant-design-x&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChatComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. ä½¿ç”¨ useXAgent ç®¡ç†è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">agent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useXAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">onUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // å»ºç«‹SSEè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/chat&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                body: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // ä½¿ç”¨ XStream å¤„ç†æµå¼æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> of</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> XStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                readableStream: response.body,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                transformStream: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createTransformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            })) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // è§£ææ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> parseMessages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunk.data);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // æµå¼æ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                onUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(messages);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // å®Œæˆ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(messages);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. ä½¿ç”¨ useXChat ç®¡ç†æ¶ˆæ¯çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">messages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">onRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useXChat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ agent });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. æ¸²æŸ“æ¶ˆæ¯åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">XProvider theme</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Bubble.List</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                roles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">placement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    assistant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">placement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;start&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                items</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{messages.map(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    key: msg.id,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    role: msg.role,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    content: msg.content,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    typing: msg.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;loading&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }))}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            /&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">XProvider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><hr><h2 id="å…«ã€æ€»ç»“" tabindex="-1">å…«ã€æ€»ç»“ <a class="header-anchor" href="#å…«ã€æ€»ç»“" aria-label="Permalink to &quot;å…«ã€æ€»ç»“&quot;">â€‹</a></h2><h3 id="_8-1-æ ¸å¿ƒç»„ä»¶-hookæ€»ç»“" tabindex="-1">8.1 æ ¸å¿ƒç»„ä»¶/Hookæ€»ç»“ <a class="header-anchor" href="#_8-1-æ ¸å¿ƒç»„ä»¶-hookæ€»ç»“" aria-label="Permalink to &quot;8.1 æ ¸å¿ƒç»„ä»¶/Hookæ€»ç»“&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>æ ¸å¿ƒä½œç”¨</th><th>é‡è¦æ€§</th></tr></thead><tbody><tr><td><strong>XProvider</strong></td><td>ç»„ä»¶</td><td>å…¨å±€ä¸»é¢˜æä¾›è€…</td><td>â­â­â­</td></tr><tr><td><strong>Bubble.List</strong></td><td>ç»„ä»¶</td><td>æ¶ˆæ¯æ°”æ³¡åˆ—è¡¨ï¼ˆæ ¸å¿ƒUIï¼‰</td><td>â­â­â­â­â­</td></tr><tr><td><strong>useXAgent</strong></td><td>Hook</td><td>AIè¯·æ±‚ç®¡ç†ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰</td><td>â­â­â­â­â­</td></tr><tr><td><strong>useXChat</strong></td><td>Hook</td><td>æ¶ˆæ¯çŠ¶æ€ç®¡ç†</td><td>â­â­â­â­â­</td></tr><tr><td><strong>XStream</strong></td><td>å·¥å…·</td><td>æµå¼æ•°æ®å¤„ç†</td><td>â­â­â­â­â­</td></tr><tr><td><strong>BubbleListRef</strong></td><td>ç±»å‹</td><td>æ°”æ³¡åˆ—è¡¨å¼•ç”¨</td><td>â­â­â­</td></tr></tbody></table><h3 id="_8-2-å­¦ä¹ å»ºè®®" tabindex="-1">8.2 å­¦ä¹ å»ºè®® <a class="header-anchor" href="#_8-2-å­¦ä¹ å»ºè®®" aria-label="Permalink to &quot;8.2 å­¦ä¹ å»ºè®®&quot;">â€‹</a></h3><ol><li><p><strong>å…ˆç†è§£ useXAgent å’Œ useXChat</strong></p><ul><li>è¿™æ˜¯æ ¸å¿ƒçš„çŠ¶æ€ç®¡ç†Hook</li><li>ç†è§£å®ƒä»¬å¦‚ä½•é…åˆå·¥ä½œ</li></ul></li><li><p><strong>å†ç†è§£ Bubble.List</strong></p><ul><li>è¿™æ˜¯æ ¸å¿ƒçš„UIç»„ä»¶</li><li>ç†è§£å¦‚ä½•é…ç½®å’Œè‡ªå®šä¹‰</li></ul></li><li><p><strong>æœ€åç†è§£ XStream</strong></p><ul><li>è¿™æ˜¯æµå¼æ•°æ®å¤„ç†çš„å…³é”®</li><li>ç†è§£ TransformStream çš„ä½œç”¨</li></ul></li></ol><h3 id="_8-3-å‚è€ƒèµ„æº" tabindex="-1">8.3 å‚è€ƒèµ„æº <a class="header-anchor" href="#_8-3-å‚è€ƒèµ„æº" aria-label="Permalink to &quot;8.3 å‚è€ƒèµ„æº&quot;">â€‹</a></h3><ul><li><strong>ant-design-x å®˜æ–¹æ–‡æ¡£</strong>ï¼šæŸ¥çœ‹å®Œæ•´çš„APIæ–‡æ¡£</li><li><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š<code>ai-chat-react/src/hook/use-message/index.ts</code></li><li><strong>Bubbleç»„ä»¶ç¤ºä¾‹</strong>ï¼š<code>ai-chat-react/src/components/message/index.tsx</code></li></ul><hr><blockquote><p><strong>æ–‡æ¡£å®Œæˆï¼</strong> æ‚¨å·²ç»äº†è§£äº† <code>ant-design-x</code> åœ¨ <code>ai-chat-react</code> ä¸­çš„ä½¿ç”¨æ–¹å¼å’Œä½œç”¨ã€‚</p></blockquote>`,115)]))}const c=a(p,[["render",e]]);export{g as __pageData,c as default};
