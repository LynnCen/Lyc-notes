import{_ as k,C as d,c as E,o as n,a7 as p,b as t,j as a,w as i,a as l,G as h,a9 as r}from"./chunks/framework.BQb8NfN9.js";const o="/Lyc-notes/assets/image2025-7-8_18-58-2.CcprbHo0.png",c="/Lyc-notes/assets/image2025-7-8_20-13-37.SPKxMqQT.png",g="/Lyc-notes/assets/image2025-7-7_18-49-56.CcPiEZr8.png",u="/Lyc-notes/assets/image2025-7-8_19-8-57.C0NidqgX.png",b="/Lyc-notes/assets/image2025-7-8_20-5-21.CKFjHCnC.png",y="/Lyc-notes/assets/image2025-7-8_20-5-50.B6lLKOeO.png",m="/Lyc-notes/assets/image2025-7-8_20-7-40.WiFAKbwE.png",G=JSON.parse('{"title":"LangGraph æ¥å…¥æ–¹æ¡ˆ","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/Agent/03-LangGraphé›†æˆ/LangGraphæ¥å…¥æ–¹æ¡ˆ.md","filePath":"work/gd/Agent/03-LangGraphé›†æˆ/LangGraphæ¥å…¥æ–¹æ¡ˆ.md","lastUpdated":1770085732000}'),F={name:"work/gd/Agent/03-LangGraphé›†æˆ/LangGraphæ¥å…¥æ–¹æ¡ˆ.md"};function A(_,s,q,C,D,B){const e=d("Mermaid");return n(),E("div",null,[s[3]||(s[3]=p(`<h1 id="langgraph-æ¥å…¥æ–¹æ¡ˆ" tabindex="-1">LangGraph æ¥å…¥æ–¹æ¡ˆ <a class="header-anchor" href="#langgraph-æ¥å…¥æ–¹æ¡ˆ" aria-label="Permalink to &quot;LangGraph æ¥å…¥æ–¹æ¡ˆ&quot;">â€‹</a></h1><h2 id="ä¸€ã€æ¦‚è¿°" tabindex="-1">ä¸€ã€æ¦‚è¿° <a class="header-anchor" href="#ä¸€ã€æ¦‚è¿°" aria-label="Permalink to &quot;ä¸€ã€æ¦‚è¿°&quot;">â€‹</a></h2><p>LangGraph æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæœ‰çŠ¶æ€ã€å¤šè½®å¯¹è¯åº”ç”¨çš„æ¡†æ¶ã€‚æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•å°† LangGraph é›†æˆåˆ°ç¨¿å®š AI Agent ç³»ç»Ÿä¸­ï¼Œå®ç°å¤æ‚çš„å·¥ä½œæµç¼–æ’å’ŒçŠ¶æ€ç®¡ç†ã€‚</p><hr><h2 id="äºŒã€langgraph-åœ¨æ¶æ„ä¸­çš„ä½ç½®" tabindex="-1">äºŒã€LangGraph åœ¨æ¶æ„ä¸­çš„ä½ç½® <a class="header-anchor" href="#äºŒã€langgraph-åœ¨æ¶æ„ä¸­çš„ä½ç½®" aria-label="Permalink to &quot;äºŒã€LangGraph åœ¨æ¶æ„ä¸­çš„ä½ç½®&quot;">â€‹</a></h2><p>LangGraph ä½œä¸º Agent çš„å·¥ä½œæµç¼–æ’å¼•æ“ï¼Œä½äº Agent æœåŠ¡å’Œ GaodingAssistant ä¹‹é—´ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·è¯·æ±‚ </span></span>
<span class="line"><span>  â†’ Agent æœåŠ¡ </span></span>
<span class="line"><span>  â†’ LangGraphï¼ˆå·¥ä½œæµç¼–æ’ï¼‰</span></span>
<span class="line"><span>  â†’ GaodingAssistantï¼ˆLLM + å·¥å…·è°ƒç”¨ï¼‰</span></span>
<span class="line"><span>  â†’ å·¥å…·æ‰§è¡Œ </span></span>
<span class="line"><span>  â†’ æµå¼å“åº”</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-1-æ¶æ„å…³ç³»" tabindex="-1">2.1 æ¶æ„å…³ç³» <a class="header-anchor" href="#_2-1-æ¶æ„å…³ç³»" aria-label="Permalink to &quot;2.1 æ¶æ„å…³ç³»&quot;">â€‹</a></h3>`,8)),(n(),t(r,null,{default:i(()=>[h(e,{id:"mermaid-20",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20User%5B%E7%94%A8%E6%88%B7%5D%20--%3E%20Agent%5BAgent%20%E6%9C%8D%E5%8A%A1%5D%0A%20%20%20%20Agent%20--%3E%20Graph%5BLangGraph%5D%0A%20%20%20%20Graph%20--%3E%20Node1%5BNode%201%5D%0A%20%20%20%20Graph%20--%3E%20Node2%5BNode%202%5D%0A%20%20%20%20Graph%20--%3E%20Node3%5BNode%203%5D%0A%20%20%20%20%0A%20%20%20%20Node1%20--%3E%20GA%5BGaodingAssistant%5D%0A%20%20%20%20Node2%20--%3E%20GA%0A%20%20%20%20Node3%20--%3E%20GA%0A%20%20%20%20%0A%20%20%20%20GA%20--%3E%20LLM%5BLLM%5D%0A%20%20%20%20GA%20--%3E%20Tools%5B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%5D%0A%20%20%20%20%0A%20%20%20%20Tools%20--%3E%20Result%5B%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E%5D%0A%20%20%20%20LLM%20--%3E%20Result%0A"})]),fallback:i(()=>s[0]||(s[0]=[l(" Loading... ")])),_:1})),s[4]||(s[4]=p('<h3 id="_2-2-èŒè´£åˆ’åˆ†" tabindex="-1">2.2 èŒè´£åˆ’åˆ† <a class="header-anchor" href="#_2-2-èŒè´£åˆ’åˆ†" aria-label="Permalink to &quot;2.2 èŒè´£åˆ’åˆ†&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>ç»„ä»¶</th><th>èŒè´£</th></tr></thead><tbody><tr><td><strong>Agent æœåŠ¡</strong></td><td>è¯·æ±‚è·¯ç”±ã€ä¼šè¯ç®¡ç†ã€çŠ¶æ€æŒä¹…åŒ–</td></tr><tr><td><strong>LangGraph</strong></td><td>å·¥ä½œæµç¼–æ’ã€èŠ‚ç‚¹è°ƒåº¦ã€ä¸­æ–­ä¸æ¢å¤</td></tr><tr><td><strong>GaodingAssistant</strong></td><td>LLM è°ƒç”¨ã€å·¥å…·è°ƒç”¨ã€æ¶ˆæ¯ç®¡ç†</td></tr><tr><td><strong>å·¥å…·å±‚</strong></td><td>å…·ä½“èƒ½åŠ›å®ç°ï¼ˆå›¾åƒç”Ÿæˆã€æœç´¢ç­‰ï¼‰</td></tr></tbody></table><hr><h2 id="ä¸‰ã€æ¥å…¥æŒ‘æˆ˜" tabindex="-1">ä¸‰ã€æ¥å…¥æŒ‘æˆ˜ <a class="header-anchor" href="#ä¸‰ã€æ¥å…¥æŒ‘æˆ˜" aria-label="Permalink to &quot;ä¸‰ã€æ¥å…¥æŒ‘æˆ˜&quot;">â€‹</a></h2><h3 id="_3-1-æ ¸å¿ƒæŒ‘æˆ˜" tabindex="-1">3.1 æ ¸å¿ƒæŒ‘æˆ˜ <a class="header-anchor" href="#_3-1-æ ¸å¿ƒæŒ‘æˆ˜" aria-label="Permalink to &quot;3.1 æ ¸å¿ƒæŒ‘æˆ˜&quot;">â€‹</a></h3><ol><li><p><strong>çŠ¶æ€åºåˆ—åŒ–</strong><br> LangGraph çš„çŠ¶æ€å¯¹è±¡éœ€è½¬æ¢ä¸ºå¯å­˜å‚¨æ ¼å¼ï¼ˆå¦‚ JSONï¼‰ï¼Œä»¥æ”¯æŒæŒä¹…åŒ–</p></li><li><p><strong>åˆ†å¸ƒå¼å­˜å‚¨</strong><br> åºåˆ—åŒ–åçš„çŠ¶æ€éœ€ä¿å­˜åˆ°å­˜å‚¨ä¸­é—´ä»¶ï¼ˆå¦‚ Redisã€PostgreSQLï¼‰</p></li><li><p><strong>ä¸€å¥—ä¸Šä¸‹æ–‡</strong><br> èŠ‚ç‚¹ã€Agent ä¹‹é—´éœ€å…±äº«åŒä¸€å¥—ä¸Šä¸‹æ–‡ï¼ˆmessagesã€thread_id ç­‰ï¼‰</p></li><li><p><strong>ä¸¤å±‚ä¸­æ–­ &amp; æ¢å¤</strong></p><ul><li><strong>èŠ‚ç‚¹çº§ä¸­æ–­</strong>ï¼šåœ¨èŠ‚ç‚¹æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸­æ–­ï¼ˆå¦‚ç¨¿è±†ä¸è¶³ï¼‰</li><li><strong>å·¥å…·çº§ä¸­æ–­</strong>ï¼šåœ¨å·¥å…·è°ƒç”¨è¿‡ç¨‹ä¸­ä¸­æ–­ï¼ˆå¦‚éœ€è¦ç”¨æˆ·ç¡®è®¤ï¼‰</li></ul></li></ol><h3 id="_3-2-è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ" tabindex="-1">3.2 è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ <a class="header-anchor" href="#_3-2-è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ" aria-label="Permalink to &quot;3.2 è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>æŒ‘æˆ˜</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>çŠ¶æ€åºåˆ—åŒ–</td><td>ä½¿ç”¨ LangGraph å†…ç½®çš„ <code>JsonPlusSerializer</code></td></tr><tr><td>åˆ†å¸ƒå¼å­˜å‚¨</td><td>è‡ªå®šä¹‰ Checkpointer é›†æˆ Redis/PostgreSQL</td></tr><tr><td>ä¸€å¥—ä¸Šä¸‹æ–‡</td><td>é€šè¿‡ thread_id å…³è” messagesï¼Œç»Ÿä¸€çŠ¶æ€ç®¡ç†</td></tr><tr><td>èŠ‚ç‚¹çº§ä¸­æ–­</td><td>ä½¿ç”¨ <code>NodeInterrupt</code> å¼‚å¸¸ + Checkpoint ä¿å­˜</td></tr><tr><td>å·¥å…·çº§ä¸­æ–­</td><td>åœ¨ GaodingAssistant ä¸­å®ç°çŠ¶æ€è®°å½•</td></tr></tbody></table><hr><h2 id="å››ã€æœ€ç»ˆæµç¨‹è®¾è®¡" tabindex="-1">å››ã€æœ€ç»ˆæµç¨‹è®¾è®¡ <a class="header-anchor" href="#å››ã€æœ€ç»ˆæµç¨‹è®¾è®¡" aria-label="Permalink to &quot;å››ã€æœ€ç»ˆæµç¨‹è®¾è®¡&quot;">â€‹</a></h2><h3 id="_4-1-åˆå§‹æ‰§è¡Œæµç¨‹" tabindex="-1">4.1 åˆå§‹æ‰§è¡Œæµç¨‹ <a class="header-anchor" href="#_4-1-åˆå§‹æ‰§è¡Œæµç¨‹" aria-label="Permalink to &quot;4.1 åˆå§‹æ‰§è¡Œæµç¨‹&quot;">â€‹</a></h3>',11)),(n(),t(r,null,{default:i(()=>[h(e,{id:"mermaid-175",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20GA%20as%20GaodingAssistant%0A%20%20%20%20participant%20Graph%20as%20Graph%0A%20%20%20%20participant%20LG%20as%20LangGraph%0A%20%20%20%20participant%20Storage%20as%20Storage%0A%0A%20%20%20%20GA-%3E%3EGraph%3A%20execute%20stream%20with%20context(thread_id)%0A%20%20%20%20Graph-%3E%3ELG%3A%20stream(thread_config)%0A%20%20%20%20LG-%3E%3EGraph%3A%20node_a%20output%0A%20%20%20%20Graph-%3E%3EGA%3A%20chunk%201%0A%20%20%20%20Note%20over%20Graph%3A%20%E6%A3%80%E6%B5%8B%E4%B8%AD%E6%96%AD%E6%9D%A1%E4%BB%B6%0A%20%20%20%20Graph-%3E%3EStorage%3A%20%E4%BF%9D%E5%AD%98%E7%8A%B6%E6%80%81(checkpoint)%0A%20%20%20%20Graph-%3E%3EGraph%3A%20%E6%B8%85%E9%99%A4%E6%9C%AC%E5%9C%B0%E7%8A%B6%E6%80%81%0A%20%20%20%20Graph-%3E%3EGA%3A%20%7B%22__interrupt__%22%3A%20true%7D%0A"})]),fallback:i(()=>s[1]||(s[1]=[l(" Loading... ")])),_:1})),s[5]||(s[5]=a("p",null,[a("strong",null,"å…³é”®æ­¥éª¤ï¼š")],-1)),s[6]||(s[6]=a("ol",null,[a("li",null,"GaodingAssistant è°ƒç”¨ Graph æ‰§è¡Œ"),a("li",null,"Graph é€šè¿‡ LangGraph æµå¼æ‰§è¡ŒèŠ‚ç‚¹"),a("li",null,"æ£€æµ‹åˆ°ä¸­æ–­æ¡ä»¶ï¼ˆå¦‚ç¨¿è±†ä¸è¶³ï¼‰"),a("li",null,"ä¿å­˜ checkpoint åˆ° Storage"),a("li",null,"è¿”å›ä¸­æ–­æ ‡è®°ç»™è°ƒç”¨æ–¹")],-1)),s[7]||(s[7]=a("h3",{id:"_4-2-æ¢å¤æ‰§è¡Œæµç¨‹",tabindex:"-1"},[l("4.2 æ¢å¤æ‰§è¡Œæµç¨‹ "),a("a",{class:"header-anchor",href:"#_4-2-æ¢å¤æ‰§è¡Œæµç¨‹","aria-label":'Permalink to "4.2 æ¢å¤æ‰§è¡Œæµç¨‹"'},"â€‹")],-1)),(n(),t(r,null,{default:i(()=>[h(e,{id:"mermaid-209",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20GA%20as%20GaodingAssistant%0A%20%20%20%20participant%20Graph%20as%20Graph%0A%20%20%20%20participant%20LG%20as%20LangGraph%0A%20%20%20%20participant%20Storage%20as%20Storage%0A%0A%20%20%20%20GA-%3E%3EGraph%3A%20execute%20stream%20with%20context(thread_id)%0A%20%20%20%20Note%20over%20Graph%3A%20%E6%A3%80%E6%B5%8B%E6%81%A2%E5%A4%8D%E6%9D%A1%E4%BB%B6%0A%20%20%20%20Graph-%3E%3EStorage%3A%20%E5%8A%A0%E8%BD%BD%E7%8A%B6%E6%80%81%0A%20%20%20%20Storage-%3E%3EGraph%3A%20state(checkpoint)%0A%20%20%20%20Graph-%3E%3ELG%3A%20update%20checkpoint%0A%20%20%20%20LG-%3E%3EGraph%3A%20node_b%20output%0A%20%20%20%20Graph-%3E%3EGA%3A%20chunk%202%0A%20%20%20%20LG-%3E%3EGraph%3A%20END%0A%20%20%20%20Graph-%3E%3EGraph%3A%20%E6%B8%85%E9%99%A4%E7%8A%B6%E6%80%81%0A%20%20%20%20Graph-%3E%3EGA%3A%20%7B%22__stream_complete__%22%3A%20true%7D%0A"})]),fallback:i(()=>s[2]||(s[2]=[l(" Loading... ")])),_:1})),s[8]||(s[8]=p('<p><strong>å…³é”®æ­¥éª¤ï¼š</strong></p><ol><li>GaodingAssistant å†æ¬¡è°ƒç”¨ï¼ˆç”¨æˆ·æ¢å¤æ“ä½œåï¼‰</li><li>Graph æ£€æµ‹åˆ°æ¢å¤æ¡ä»¶</li><li>ä» Storage åŠ è½½ checkpoint</li><li>æ›´æ–° LangGraph çŠ¶æ€</li><li>ä»ä¸­æ–­ç‚¹ç»§ç»­æ‰§è¡Œ</li><li>æ‰§è¡Œå®Œæˆï¼Œæ¸…é™¤çŠ¶æ€</li></ol><hr><h2 id="äº”ã€èŠ‚ç‚¹çº§æ¢å¤æœºåˆ¶" tabindex="-1">äº”ã€èŠ‚ç‚¹çº§æ¢å¤æœºåˆ¶ <a class="header-anchor" href="#äº”ã€èŠ‚ç‚¹çº§æ¢å¤æœºåˆ¶" aria-label="Permalink to &quot;äº”ã€èŠ‚ç‚¹çº§æ¢å¤æœºåˆ¶&quot;">â€‹</a></h2><h3 id="_5-1-çŠ¶æ€ä¿å­˜" tabindex="-1">5.1 çŠ¶æ€ä¿å­˜ <a class="header-anchor" href="#_5-1-çŠ¶æ€ä¿å­˜" aria-label="Permalink to &quot;5.1 çŠ¶æ€ä¿å­˜&quot;">â€‹</a></h3><h4 id="langgraph-çš„è¿­ä»£å™¨æ¨¡å¼" tabindex="-1">LangGraph çš„è¿­ä»£å™¨æ¨¡å¼ <a class="header-anchor" href="#langgraph-çš„è¿­ä»£å™¨æ¨¡å¼" aria-label="Permalink to &quot;LangGraph çš„è¿­ä»£å™¨æ¨¡å¼&quot;">â€‹</a></h4><p>LangGraph é€šè¿‡ <code>stream</code> / <code>astream</code> æ¥å£é€æ­¥æ‰§è¡Œï¼Œæ¯ä¸€æ­¥éƒ½ä¼šäº§ç”Ÿè¾“å‡ºï¼ˆåŒ…æ‹¬å½“å‰çŠ¶æ€ï¼‰ï¼š</p><p><img src="'+o+`" alt=""></p><p><strong>è¿­ä»£å™¨ç‰¹æ€§ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.stream(init_state, thread_config):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ¯æ¬¡è¿­ä»£éƒ½æ˜¯ä¸€ä¸ªæ‰§è¡Œæ­¥éª¤</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å¯ä»¥åœ¨ä»»æ„æ­¥éª¤ä¸­æ–­</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è¿™ç§è¿­ä»£å™¨æ¨¡å¼ç»™äº†æˆ‘ä»¬<strong>ä¸­æ–­çš„æœºä¼š</strong>ã€‚</p><h4 id="node-æ‰§è¡Œé™åˆ¶" tabindex="-1">Node æ‰§è¡Œé™åˆ¶ <a class="header-anchor" href="#node-æ‰§è¡Œé™åˆ¶" aria-label="Permalink to &quot;Node æ‰§è¡Œé™åˆ¶&quot;">â€‹</a></h4><p>LangGraph çš„ node æ‰§è¡Œæœ‰ä¸€ä¸ªé‡è¦é™åˆ¶ï¼š</p><blockquote><p>ğŸ’¡ <strong>é‡è¦çº¦æŸ</strong><br> ç”±äºè°ƒç”¨ LLMã€Tool åªå‘ç”Ÿåœ¨ <code>agent.run()</code> é‡Œï¼Œ<code>run()</code> ä¹‹å‰çš„ä»£ç å¯ä»¥é‡å¤æ‰§è¡Œã€‚</p></blockquote><p><strong>å®˜æ–¹ç¤ºä¾‹ï¼š</strong></p><p><img src="`+c+`" alt=""></p><p>åœ¨ä¸Šå›¾ä¸­ï¼Œ<code>&quot;---human_feedback---&quot;</code> ä¼šæ‰“å°<strong>ä¸¤æ¬¡</strong>ï¼š</p><ol><li><strong>ç¬¬ä¸€æ¬¡</strong>ï¼šnode åˆæ¬¡æ‰§è¡Œï¼Œåœ¨ interrupt å¤„ä¸´æ—¶ä¸­æ–­ã€è®°å½•çŠ¶æ€ï¼Œäº¤å›æ§åˆ¶æƒ</li><li><strong>ç¬¬äºŒæ¬¡</strong>ï¼šç”¨æˆ·å“åº”å resumeï¼ŒLangGraph é‡æ–°æ‰§è¡Œè¯¥ nodeï¼Œå†æ¬¡ printï¼Œä½†è¿™æ¬¡ä¸ä¼šä¸­æ–­</li></ol><p><strong>å¯¹æˆ‘ä»¬çš„å½±å“ï¼š</strong></p><p>è¿™ä¸ªé™åˆ¶æ˜¯ node-level ä¸­æ–­ &amp; æ¢å¤çš„å‰æï¼Œä½†å¯¹ç¨¿å®š Agent å½±å“ä¸å¤§ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> my_node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è¿™éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šæ‰§è¡Œå¤šæ¬¡ï¼ˆresume æ—¶é‡æ–°æ‰§è¡Œï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prepare_context(state)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # agent.run åªæ‰§è¡Œä¸€æ¬¡ï¼ˆåˆæ¬¡æ‰§è¡Œæˆ– resume åï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent.run(context)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: result}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_5-2-åŠ¨æ€æ–­ç‚¹-dynamic-breakpoints" tabindex="-1">5.2 åŠ¨æ€æ–­ç‚¹ (Dynamic Breakpoints) <a class="header-anchor" href="#_5-2-åŠ¨æ€æ–­ç‚¹-dynamic-breakpoints" aria-label="Permalink to &quot;5.2 åŠ¨æ€æ–­ç‚¹ (Dynamic Breakpoints)&quot;">â€‹</a></h3><p>è¦åœ¨ <code>run()</code> æ–¹æ³•é‡Œä¸­æ–­ï¼Œéœ€è¦ä½¿ç”¨ LangGraph æä¾›çš„<strong>åŠ¨æ€æ–­ç‚¹</strong>èƒ½åŠ›ï¼š</p><p><img src="`+g+`" alt=""></p><p><strong>NodeInterrupt å¼‚å¸¸ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.errors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NodeInterrupt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> my_node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ£€æŸ¥ç¨¿è±†æ˜¯å¦è¶³å¤Ÿ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> has_enough_points(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æŠ›å‡º NodeInterrupt å¼‚å¸¸</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        raise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NodeInterrupt(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ç¨¿è±†ä¸è¶³ï¼Œéœ€è¦å……å€¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ç»§ç»­æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent.run(state)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: result}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>âš ï¸ <strong>é‡è¦</strong><br> åªèƒ½ç”¨ <code>NodeInterrupt</code> çš„æ–¹å¼ä¸­æ–­ã€‚å› ä¸ºæˆ‘ä»¬åç»­éœ€è¦ LangGraph å¸®æˆ‘ä»¬ä»ä¸­æ–­çš„èŠ‚ç‚¹æ¢å¤æ‰§è¡Œï¼Œä½¿ç”¨å®ƒå¯ä»¥å‡å°‘å®ç°çŠ¶æ€ä¿å­˜çš„æˆæœ¬ã€‚</p></blockquote><h3 id="_5-3-ä¿å­˜-checkpoint" tabindex="-1">5.3 ä¿å­˜ Checkpoint <a class="header-anchor" href="#_5-3-ä¿å­˜-checkpoint" aria-label="Permalink to &quot;5.3 ä¿å­˜ Checkpoint&quot;">â€‹</a></h3><p>å½“è¿­ä»£å™¨è¢«æ‰“æ–­åï¼Œä¿å­˜æœ€æ–°çš„ checkpointï¼š</p><p><img src="`+u+`" alt=""></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> execute_with_interrupt_handling</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(graph, init_state, thread_config):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;æ‰§è¡Œ Graph å¹¶å¤„ç†ä¸­æ–­&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.stream(init_state, thread_config, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">stream_mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            yield</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    except</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NodeInterrupt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è·å–æœ€æ–°çš„ checkpoint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        checkpointer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.checkpointer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        checkpoint_tuple </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> checkpointer.get_tuple(thread_config)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åºåˆ—åŒ–å¹¶ä¿å­˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        checkpoint_json </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonPlusSerializer(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pickle_fallback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).dumps(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            checkpoint_tuple</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        save_checkpoint_to_storage(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            thread_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">thread_config[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;configurable&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;thread_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            checkpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">checkpoint_json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è¿”å›ä¸­æ–­æ ‡è®°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        yield</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;__interrupt__&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;reason&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e)}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="checkpoint-ç»“æ„ç¤ºä¾‹" tabindex="-1">Checkpoint ç»“æ„ç¤ºä¾‹ <a class="header-anchor" href="#checkpoint-ç»“æ„ç¤ºä¾‹" aria-label="Permalink to &quot;Checkpoint ç»“æ„ç¤ºä¾‹&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;checkpoint&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;v&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;checkpoint_123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-07-08T12:00:00Z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;channel_versions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;channel_values&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;user_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user_123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;source&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;loop&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;step&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;writes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;config&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;configurable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;thread_abc123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;checkpoint_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;checkpoint_123&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_5-4-çŠ¶æ€æ¸…é™¤" tabindex="-1">5.4 çŠ¶æ€æ¸…é™¤ <a class="header-anchor" href="#_5-4-çŠ¶æ€æ¸…é™¤" aria-label="Permalink to &quot;5.4 çŠ¶æ€æ¸…é™¤&quot;">â€‹</a></h3><p>æ‰§è¡Œå®Œæˆæˆ–ä¸­æ–­åï¼Œæ¸…é™¤æœ¬åœ°çŠ¶æ€ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cleanup_checkpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(thread_id):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;æ¸…é™¤ checkpoint&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    checkpointer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.checkpointer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    checkpointer.delete_thread(thread_id)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><hr><h2 id="å…­ã€çŠ¶æ€æ¢å¤" tabindex="-1">å…­ã€çŠ¶æ€æ¢å¤ <a class="header-anchor" href="#å…­ã€çŠ¶æ€æ¢å¤" aria-label="Permalink to &quot;å…­ã€çŠ¶æ€æ¢å¤&quot;">â€‹</a></h2><h3 id="_6-1-å¯¼å…¥-checkpoint" tabindex="-1">6.1 å¯¼å…¥ Checkpoint <a class="header-anchor" href="#_6-1-å¯¼å…¥-checkpoint" aria-label="Permalink to &quot;6.1 å¯¼å…¥ Checkpoint&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.checkpoint </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CheckpointTuple</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.checkpoint.serde.jsonplus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonPlusSerializer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> restore_from_checkpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(graph, checkpoint_json):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;ä» checkpoint æ¢å¤çŠ¶æ€&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ååºåˆ—åŒ– checkpoint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    checkpoint_tuple </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CheckpointTuple(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">JsonPlusSerializer(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pickle_fallback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).loads(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            checkpoint_json.encode()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å¯¼å…¥åˆ° LangGraph</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    graph.checkpointer.put(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        checkpoint_tuple.config,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        checkpoint_tuple.checkpoint,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        checkpoint_tuple.metadata,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        checkpoint_tuple.checkpoint[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;channel_versions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> checkpoint_tuple.config</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_6-2-resume-æ‰§è¡Œ" tabindex="-1">6.2 Resume æ‰§è¡Œ <a class="header-anchor" href="#_6-2-resume-æ‰§è¡Œ" aria-label="Permalink to &quot;6.2 Resume æ‰§è¡Œ&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> resume_execution</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(graph, checkpoint_json):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;æ¢å¤æ‰§è¡Œ&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å¯¼å…¥ checkpoint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    thread_config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> restore_from_checkpoint(graph, checkpoint_json)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # âš ï¸ LangGraph çš„å†…éƒ¨çº¦å®šï¼Œresume æ—¶ init_state å¿…é¡»æ˜¯ None</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    init_state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä½¿ç”¨å¸¦ checkpoint_id çš„ thread config</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.stream(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        init_state, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread_config, </span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        stream_mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;custom&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        yield</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>å…³é”®ç‚¹ï¼š</strong></p><ol><li><code>init_state</code> å¿…é¡»æ˜¯ <code>None</code></li><li><code>thread_config</code> å¿…é¡»åŒ…å« <code>checkpoint_id</code></li><li>ä¸¤è€…ç¼ºä¸€ä¸å¯</li></ol><hr><h2 id="ä¸ƒã€å·¥å…·çº§æ¢å¤" tabindex="-1">ä¸ƒã€å·¥å…·çº§æ¢å¤ <a class="header-anchor" href="#ä¸ƒã€å·¥å…·çº§æ¢å¤" aria-label="Permalink to &quot;ä¸ƒã€å·¥å…·çº§æ¢å¤&quot;">â€‹</a></h2><h3 id="_7-1-å·¥å…·çº§çŠ¶æ€" tabindex="-1">7.1 å·¥å…·çº§çŠ¶æ€ <a class="header-anchor" href="#_7-1-å·¥å…·çº§çŠ¶æ€" aria-label="Permalink to &quot;7.1 å·¥å…·çº§çŠ¶æ€&quot;">â€‹</a></h3><p>å·¥å…·çº§æ¢å¤æ‰€éœ€çš„çŠ¶æ€ï¼š</p><table tabindex="0"><thead><tr><th>çŠ¶æ€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>num_llm_calls_available</code></td><td>å•è½®å¯¹è¯å‰©ä½™ LLM è¿­ä»£æ•°</td></tr><tr><td><code>num_tool_calls_available</code></td><td>å•è½®å¯¹è¯å‰©ä½™å·¥å…·è°ƒç”¨æ•°</td></tr><tr><td><code>last_tool_message_id</code></td><td>æŒ‡é’ˆï¼ŒæŒ‡å‘æœ€åä¸€æ¬¡è°ƒç”¨çš„å·¥å…·æ¶ˆæ¯</td></tr></tbody></table><h3 id="_7-2-çŠ¶æ€ç®¡ç†" tabindex="-1">7.2 çŠ¶æ€ç®¡ç† <a class="header-anchor" href="#_7-2-çŠ¶æ€ç®¡ç†" aria-label="Permalink to &quot;7.2 çŠ¶æ€ç®¡ç†&quot;">â€‹</a></h3><p>è¿™äº›çŠ¶æ€è®°å½•åœ¨ <code>messages</code> é‡Œï¼Œä¸”æ¢å¤çš„é€»è¾‘å®ç°åœ¨ <code>GaodingAssistant</code> ä¸­ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GaodingAssistant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, state):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;messages&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ä» messages ä¸­æ¢å¤çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        num_llm_calls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._count_llm_calls(messages)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        num_tool_calls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._count_tool_calls(messages)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æ£€æŸ¥æ˜¯å¦è¶…é™</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num_llm_calls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MAX_LLM_CALLS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NodeInterrupt(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;LLM è°ƒç”¨æ¬¡æ•°è¶…é™&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num_tool_calls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MAX_TOOL_CALLS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NodeInterrupt(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;å·¥å…·è°ƒç”¨æ¬¡æ•°è¶…é™&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ç»§ç»­æ‰§è¡Œ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_7-3-æ¢å¤é€»è¾‘" tabindex="-1">7.3 æ¢å¤é€»è¾‘ <a class="header-anchor" href="#_7-3-æ¢å¤é€»è¾‘" aria-label="Permalink to &quot;7.3 æ¢å¤é€»è¾‘&quot;">â€‹</a></h3><p>ç”±äºçŠ¶æ€éƒ½åœ¨ <code>messages</code> ä¸­ï¼Œç†è®ºä¸Šä¸ç”¨ç‰¹æ®Šå¤„ç†å³å¯å®ç°å·¥å…·çº§æ¢å¤ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> resume_tool_execution</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(thread_id):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;æ¢å¤å·¥å…·æ‰§è¡Œ&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # åŠ è½½ messages</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> load_messages(thread_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # GaodingAssistant è‡ªåŠ¨ä» messages ä¸­æ¢å¤çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    assistant </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GaodingAssistant()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> assistant.run({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: messages})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr><h2 id="å…«ã€å¼€å‘çº¦å®š" tabindex="-1">å…«ã€å¼€å‘çº¦å®š <a class="header-anchor" href="#å…«ã€å¼€å‘çº¦å®š" aria-label="Permalink to &quot;å…«ã€å¼€å‘çº¦å®š&quot;">â€‹</a></h2><h3 id="_8-1-æ ¸å¿ƒçº¦å®š" tabindex="-1">8.1 æ ¸å¿ƒçº¦å®š <a class="header-anchor" href="#_8-1-æ ¸å¿ƒçº¦å®š" aria-label="Permalink to &quot;8.1 æ ¸å¿ƒçº¦å®š&quot;">â€‹</a></h3><ol><li><p><strong>ç»Ÿä¸€ä½¿ç”¨ GaodingAssistant</strong><br> ä½¿ç”¨ GaodingAssistant è°ƒç”¨ LLM å’Œå·¥å…·ï¼Œå®ç°ç»Ÿä¸€çš„å·¥å…·è°ƒç”¨èƒ½åŠ›å’Œä¸­æ–­ &amp; æ¢å¤æœºåˆ¶</p></li><li><p><strong>Node å®ç°é™åˆ¶</strong><br> Node å®ç°é‡Œæœ€å¤šåªæœ‰ä¸€æ¬¡ <code>GaodingAssistant.run</code>ï¼Œä¸”åœ¨ run ä¹‹å‰çš„ä»£ç å¯é‡å¤è¿è¡Œ</p></li><li><p><strong>çŠ¶æ€ç®¡ç†</strong><br> çŠ¶æ€ç”¨ <code>messages</code> æ‰¿è½½ï¼Œ<code>messages</code> ç”± <code>thread_id</code> å…³è”ï¼Œå‡å°‘çŠ¶æ€ä¿å­˜çš„æˆæœ¬</p></li><li><p><strong>é…ç½®ç»Ÿä¸€</strong><br> ä¸ºäº†æ–¹ä¾¿ç®¡ç†å’Œä¸€è‡´æ€§ï¼Œç»Ÿä¸€ä½¿ç”¨ç»ç”± GaodingAssistant ä¼ å…¥çš„ LLMã€Tools é…ç½®</p></li></ol><h3 id="_8-2-node-å®ç°ç¤ºä¾‹" tabindex="-1">8.2 Node å®ç°ç¤ºä¾‹ <a class="header-anchor" href="#_8-2-node-å®ç°ç¤ºä¾‹" aria-label="Permalink to &quot;8.2 Node å®ç°ç¤ºä¾‹&quot;">â€‹</a></h3><p><strong>âœ… æ­£ç¡®ç¤ºä¾‹ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> my_node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å¯é‡å¤æ‰§è¡Œçš„å‡†å¤‡å·¥ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prepare_context(state)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user_query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;messages&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # åªè°ƒç”¨ä¸€æ¬¡ GaodingAssistant.run</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    assistant </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GaodingAssistant(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        llm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;llm_config&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        tools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tools&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> assistant.run(user_query, context)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: result}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>âŒ é”™è¯¯ç¤ºä¾‹ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bad_node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # âŒ å¤šæ¬¡è°ƒç”¨ run</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> assistant.run(query1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> assistant.run(query2)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # âŒ run ä¹‹å‰æœ‰ä¸å¯é‡å¤æ‰§è¡Œçš„ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    database.insert(record)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¢å¤æ—¶ä¼šé‡å¤æ’å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> assistant.run(query)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: result}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr><h2 id="ä¹ã€å¾…å®šé—®é¢˜" tabindex="-1">ä¹ã€å¾…å®šé—®é¢˜ <a class="header-anchor" href="#ä¹ã€å¾…å®šé—®é¢˜" aria-label="Permalink to &quot;ä¹ã€å¾…å®šé—®é¢˜&quot;">â€‹</a></h2><h3 id="_9-1-checkpoint-å­˜å‚¨ä½ç½®" tabindex="-1">9.1 Checkpoint å­˜å‚¨ä½ç½® <a class="header-anchor" href="#_9-1-checkpoint-å­˜å‚¨ä½ç½®" aria-label="Permalink to &quot;9.1 Checkpoint å­˜å‚¨ä½ç½®&quot;">â€‹</a></h3><p><strong>è€ƒè™‘å› ç´ ï¼š</strong></p><ol><li>Checkpoint ä¸ç®—å°ï¼ˆå¯èƒ½å‡ ç™¾ KBï¼‰</li><li>åªä¸´æ—¶æ€§ç”¨ä¸€æ¬¡</li><li>ä¸é€‚åˆå­˜åˆ° messages é‡Œ</li></ol><p><strong>æ–¹æ¡ˆé€‰æ‹©ï¼š</strong></p><ul><li><strong>æ–¹æ¡ˆ A</strong>ï¼šå•ç‹¬å­˜æ”¾ï¼Œå’Œ thread_id å…³è”ï¼ˆæ¨èï¼‰</li><li><strong>æ–¹æ¡ˆ B</strong>ï¼šä½¿ç”¨ LangGraph çš„ PostgresSaver</li></ul><p><strong>å»¶ä¼¸é—®é¢˜ï¼š</strong><br> åœ¨é€šç”¨ agentã€IP design agent ç­‰å‡ä½¿ç”¨ LangGraph çš„æƒ…å†µä¸‹ï¼Œè¦ä¸è¦ç›´æ¥ç”¨ LangGraph çš„ <code>PostgresSaver</code> å®ç° Message çš„å­˜å‚¨ï¼Ÿ</p><h3 id="_9-2-ç»Ÿä¸€ä¸­æ–­æ–¹å¼" tabindex="-1">9.2 ç»Ÿä¸€ä¸­æ–­æ–¹å¼ <a class="header-anchor" href="#_9-2-ç»Ÿä¸€ä¸­æ–­æ–¹å¼" aria-label="Permalink to &quot;9.2 ç»Ÿä¸€ä¸­æ–­æ–¹å¼&quot;">â€‹</a></h3><p>ç›®å‰çš„å‡ ç§ä¸­æ–­å®ç°å„ä¸ç›¸åŒã€æ•£è½åœ¨å„å¤„ï¼š</p><p><img src="`+b+'" alt=""><img src="'+y+'" alt=""><img src="'+m+`" alt=""></p><p><strong>é—®é¢˜ï¼š</strong><br> æ˜¯å¦å¯ä»¥ç»Ÿä¸€æŠ›å‡º <code>NodeInterrupt</code> å¼‚å¸¸åœ¨å¤–å±‚å¤„ç†ï¼Ÿ</p><p><strong>å»ºè®®ï¼š</strong><br> ç»Ÿä¸€ä½¿ç”¨ <code>NodeInterrupt</code>ï¼Œåœ¨ Graph å±‚ç»Ÿä¸€å¤„ç†ä¸­æ–­é€»è¾‘ã€‚</p><h3 id="_9-3-ç»“æ„åŒ–è¾“å‡º" tabindex="-1">9.3 ç»“æ„åŒ–è¾“å‡º <a class="header-anchor" href="#_9-3-ç»“æ„åŒ–è¾“å‡º" aria-label="Permalink to &quot;9.3 ç»“æ„åŒ–è¾“å‡º&quot;">â€‹</a></h3><p><strong>éœ€æ±‚ï¼š</strong><br> å‰ç«¯å¯èƒ½éœ€è¦é€‚é… Graph çš„ç»“æ„åŒ–è¾“å‡ºã€‚</p><p><strong>ç¤ºä¾‹ï¼ˆIP Designï¼‰ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;image_candidates&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>å½±å“ï¼š</strong></p><ul><li>Content ç±»å‹éœ€è¦æ‰©å±•ï¼ˆtextã€reasoning_contentã€jsonï¼‰</li><li>å‰ç«¯éœ€è¦æ”¯æŒæ–°çš„äº¤äº’æ–¹å¼ï¼ˆå¦‚å•é€‰ç»„ä»¶ï¼‰</li></ul><hr><h2 id="åã€æœ€ä½³å®è·µ" tabindex="-1">åã€æœ€ä½³å®è·µ <a class="header-anchor" href="#åã€æœ€ä½³å®è·µ" aria-label="Permalink to &quot;åã€æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="_10-1-å¼€å‘å»ºè®®" tabindex="-1">10.1 å¼€å‘å»ºè®® <a class="header-anchor" href="#_10-1-å¼€å‘å»ºè®®" aria-label="Permalink to &quot;10.1 å¼€å‘å»ºè®®&quot;">â€‹</a></h3><p><strong>DOï¼š</strong></p><ul><li>âœ… ä½¿ç”¨ NodeInterrupt å®ç°ä¸­æ–­</li><li>âœ… åœ¨ run ä¹‹å‰çš„ä»£ç ä¿æŒå¹‚ç­‰</li><li>âœ… çŠ¶æ€å­˜å‚¨åœ¨ messages ä¸­</li><li>âœ… ä½¿ç”¨ç»Ÿä¸€çš„ GaodingAssistant</li></ul><p><strong>DON&#39;Tï¼š</strong></p><ul><li>âŒ åœ¨ node ä¸­å¤šæ¬¡è°ƒç”¨ run</li><li>âŒ åœ¨ run ä¹‹å‰æ‰§è¡Œå‰¯ä½œç”¨æ“ä½œ</li><li>âŒ è‡ªè¡Œå®ç°çŠ¶æ€åºåˆ—åŒ–</li><li>âŒ ç›´æ¥æ“ä½œ checkpoint</li></ul><h3 id="_10-2-è°ƒè¯•æŠ€å·§" tabindex="-1">10.2 è°ƒè¯•æŠ€å·§ <a class="header-anchor" href="#_10-2-è°ƒè¯•æŠ€å·§" aria-label="Permalink to &quot;10.2 è°ƒè¯•æŠ€å·§&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯ç”¨ LangGraph è°ƒè¯•æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> logging</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logging.getLogger(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;langgraph&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).setLevel(logging.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥çœ‹ checkpoint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">checkpointer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.checkpointer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">checkpoint_tuple </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> checkpointer.get_tuple(thread_config)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(checkpoint_tuple)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥çœ‹çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.get_state(thread_config)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><hr><h2 id="åä¸€ã€æ€»ç»“" tabindex="-1">åä¸€ã€æ€»ç»“ <a class="header-anchor" href="#åä¸€ã€æ€»ç»“" aria-label="Permalink to &quot;åä¸€ã€æ€»ç»“&quot;">â€‹</a></h2><h3 id="_11-1-æ ¸å¿ƒæœºåˆ¶" tabindex="-1">11.1 æ ¸å¿ƒæœºåˆ¶ <a class="header-anchor" href="#_11-1-æ ¸å¿ƒæœºåˆ¶" aria-label="Permalink to &quot;11.1 æ ¸å¿ƒæœºåˆ¶&quot;">â€‹</a></h3><ol><li><strong>èŠ‚ç‚¹çº§ä¸­æ–­</strong>ï¼šä½¿ç”¨ NodeInterrupt + Checkpoint</li><li><strong>å·¥å…·çº§ä¸­æ–­</strong>ï¼šçŠ¶æ€è®°å½•åœ¨ messages ä¸­</li><li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šç»Ÿä¸€ä½¿ç”¨ thread_id å…³è”</li><li><strong>æ¢å¤æµç¨‹</strong>ï¼šå¯¼å…¥ checkpoint â†’ resume æ‰§è¡Œ</li></ol><h3 id="_11-2-å…³é”®è®¾è®¡" tabindex="-1">11.2 å…³é”®è®¾è®¡ <a class="header-anchor" href="#_11-2-å…³é”®è®¾è®¡" aria-label="Permalink to &quot;11.2 å…³é”®è®¾è®¡&quot;">â€‹</a></h3><ul><li>âœ… è¿­ä»£å™¨æ¨¡å¼æä¾›ä¸­æ–­æœºä¼š</li><li>âœ… NodeInterrupt ç»Ÿä¸€ä¸­æ–­æ–¹å¼</li><li>âœ… Checkpoint å®ç°çŠ¶æ€æŒä¹…åŒ–</li><li>âœ… messages æ‰¿è½½ä¸šåŠ¡çŠ¶æ€</li></ul><hr><p><em>æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0</em><br><em>æœ€åæ›´æ–°ï¼š2025-01-26</em></p>`,100))])}const f=k(F,[["render",A]]);export{G as __pageData,f as default};
