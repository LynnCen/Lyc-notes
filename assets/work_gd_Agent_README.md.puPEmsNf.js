import{_ as a,c as i,o as n,a7 as l}from"./chunks/framework.BQb8NfN9.js";const c=JSON.parse('{"title":"AI Agent 部署方案文档","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/Agent/README.md","filePath":"work/gd/Agent/README.md","lastUpdated":1770085732000}'),e={name:"work/gd/Agent/README.md"};function p(t,s,h,r,k,d){return n(),i("div",null,s[0]||(s[0]=[l(`<h1 id="ai-agent-部署方案文档" tabindex="-1">AI Agent 部署方案文档 <a class="header-anchor" href="#ai-agent-部署方案文档" aria-label="Permalink to &quot;AI Agent 部署方案文档&quot;">​</a></h1><h2 id="📖-文档概述" tabindex="-1">📖 文档概述 <a class="header-anchor" href="#📖-文档概述" aria-label="Permalink to &quot;📖 文档概述&quot;">​</a></h2><p>本目录包含稿定 AI Agent 的完整技术方案文档，涵盖架构设计、消息系统、LangGraph 集成、业务功能和可观测性等核心模块。这些文档详细描述了 Agent 系统的设计思路、实现方案和最佳实践。</p><hr><h2 id="🗂️-文档结构" tabindex="-1">🗂️ 文档结构 <a class="header-anchor" href="#🗂️-文档结构" aria-label="Permalink to &quot;🗂️ 文档结构&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ai-agent/</span></span>
<span class="line"><span>├── README.md                                        # 本文件：文档导航</span></span>
<span class="line"><span>├── 01-架构设计/                                     # 架构设计层</span></span>
<span class="line"><span>│   └── 网络架构.md                                  # 网关、服务、LLM 平台架构</span></span>
<span class="line"><span>├── 02-消息系统/                                     # 消息系统层</span></span>
<span class="line"><span>│   ├── 消息结构设计.md                              # 统一消息格式、状态消息</span></span>
<span class="line"><span>│   └── Completion接口与工具调用.md                  # Function Calling 实现</span></span>
<span class="line"><span>├── 03-LangGraph集成/                               # LangGraph 集成层</span></span>
<span class="line"><span>│   └── LangGraph接入方案.md                        # 工作流编排、中断与恢复</span></span>
<span class="line"><span>├── 04-业务功能/                                    # 业务功能层</span></span>
<span class="line"><span>│   └── 会话标题生成.md                              # 自动标题生成</span></span>
<span class="line"><span>├── 05-可观测性/                                    # 可观测性层</span></span>
<span class="line"><span>│   └── 链路追踪与监控.md                            # 日志、指标、告警</span></span>
<span class="line"><span>└── attachments/                                    # 图片附件</span></span>
<span class="line"><span>    ├── image2025-7-1_1-8-34.png</span></span>
<span class="line"><span>    ├── image2025-7-4_14-16-44.png</span></span>
<span class="line"><span>    └── ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><hr><h2 id="📚-阅读指南" tabindex="-1">📚 阅读指南 <a class="header-anchor" href="#📚-阅读指南" aria-label="Permalink to &quot;📚 阅读指南&quot;">​</a></h2><h3 id="方式一-按角色阅读" tabindex="-1">方式一：按角色阅读 <a class="header-anchor" href="#方式一-按角色阅读" aria-label="Permalink to &quot;方式一：按角色阅读&quot;">​</a></h3><h4 id="技术负责人-架构师" tabindex="-1">技术负责人 / 架构师 <a class="header-anchor" href="#技术负责人-架构师" aria-label="Permalink to &quot;技术负责人 / 架构师&quot;">​</a></h4><ol><li><p><strong>必读</strong>：<a href="./01-架构设计/网络架构">网络架构</a></p><ul><li>理解整体架构设计</li><li>理解短连接和长连接分离策略</li><li>理解 LLM 平台接入</li></ul></li><li><p><strong>必读</strong>：<a href="./02-消息系统/消息结构设计">消息结构设计</a></p><ul><li>理解消息格式设计理念</li><li>理解中断与恢复机制</li></ul></li><li><p><strong>必读</strong>：<a href="./03-LangGraph集成/LangGraph接入方案">LangGraph 接入方案</a></p><ul><li>理解工作流编排</li><li>理解状态管理</li></ul></li><li><p><strong>推荐</strong>：<a href="./05-可观测性/链路追踪与监控">链路追踪与监控</a></p><ul><li>了解可观测性方案</li><li>了解成本管控</li></ul></li></ol><h4 id="开发者-后端" tabindex="-1">开发者（后端） <a class="header-anchor" href="#开发者-后端" aria-label="Permalink to &quot;开发者（后端）&quot;">​</a></h4><ol><li><p><strong>必读</strong>：<a href="./02-消息系统/消息结构设计">消息结构设计</a></p><ul><li>掌握消息格式规范</li><li>学习状态消息使用</li></ul></li><li><p><strong>必读</strong>：<a href="./02-消息系统/Completion接口与工具调用">Completion 接口与工具调用</a></p><ul><li>学习工具调用实现</li><li>理解不同模型适配</li></ul></li><li><p><strong>必读</strong>：<a href="./03-LangGraph集成/LangGraph接入方案">LangGraph 接入方案</a></p><ul><li>学习 Node 开发规范</li><li>掌握中断与恢复机制</li></ul></li><li><p><strong>推荐</strong>：<a href="./04-业务功能/会话标题生成">会话标题生成</a></p><ul><li>学习异步任务处理</li><li>了解降级策略</li></ul></li><li><p><strong>推荐</strong>：<a href="./05-可观测性/链路追踪与监控">链路追踪与监控</a></p><ul><li>学习日志记录规范</li><li>学习指标上报</li></ul></li></ol><h4 id="开发者-前端" tabindex="-1">开发者（前端） <a class="header-anchor" href="#开发者-前端" aria-label="Permalink to &quot;开发者（前端）&quot;">​</a></h4><ol><li><p><strong>必读</strong>：<a href="./02-消息系统/消息结构设计">消息结构设计</a></p><ul><li>掌握消息格式规范</li><li>学习状态消息处理</li><li>实现中断与恢复</li></ul></li><li><p><strong>推荐</strong>：<a href="./01-架构设计/网络架构">网络架构</a></p><ul><li>了解 SSE 长连接</li><li>了解请求链路</li></ul></li><li><p><strong>推荐</strong>：<a href="./05-可观测性/链路追踪与监控">链路追踪与监控</a></p><ul><li>学习前端埋点</li></ul></li></ol><h4 id="devops-运维" tabindex="-1">DevOps / 运维 <a class="header-anchor" href="#devops-运维" aria-label="Permalink to &quot;DevOps / 运维&quot;">​</a></h4><ol><li><p><strong>必读</strong>：<a href="./01-架构设计/网络架构">网络架构</a></p><ul><li>了解网关配置</li><li>了解服务部署</li><li>了解扩展策略</li></ul></li><li><p><strong>必读</strong>：<a href="./05-可观测性/链路追踪与监控">链路追踪与监控</a></p><ul><li>配置监控指标</li><li>配置告警规则</li><li>分析系统性能</li></ul></li><li><p><strong>推荐</strong>：<a href="./03-LangGraph集成/LangGraph接入方案">LangGraph 接入方案</a></p><ul><li>了解状态存储</li><li>了解 Checkpoint 管理</li></ul></li></ol><h3 id="方式二-按顺序阅读" tabindex="-1">方式二：按顺序阅读 <a class="header-anchor" href="#方式二-按顺序阅读" aria-label="Permalink to &quot;方式二：按顺序阅读&quot;">​</a></h3><h4 id="第一阶段-理解架构-20-30分钟" tabindex="-1">第一阶段：理解架构（20-30分钟） <a class="header-anchor" href="#第一阶段-理解架构-20-30分钟" aria-label="Permalink to &quot;第一阶段：理解架构（20-30分钟）&quot;">​</a></h4><ol><li><a href="./01-架构设计/网络架构">网络架构</a><ul><li>整体架构设计</li><li>服务分层</li><li>调用链路</li></ul></li></ol><h4 id="第二阶段-掌握消息系统-30-40分钟" tabindex="-1">第二阶段：掌握消息系统（30-40分钟） <a class="header-anchor" href="#第二阶段-掌握消息系统-30-40分钟" aria-label="Permalink to &quot;第二阶段：掌握消息系统（30-40分钟）&quot;">​</a></h4><ol start="2"><li><p><a href="./02-消息系统/消息结构设计">消息结构设计</a></p><ul><li>消息格式规范</li><li>状态消息</li><li>中断与恢复</li></ul></li><li><p><a href="./02-消息系统/Completion接口与工具调用">Completion 接口与工具调用</a></p><ul><li>Function Calling 机制</li><li>工具调用流程</li><li>多模型适配</li></ul></li></ol><h4 id="第三阶段-掌握-langgraph-40-50分钟" tabindex="-1">第三阶段：掌握 LangGraph（40-50分钟） <a class="header-anchor" href="#第三阶段-掌握-langgraph-40-50分钟" aria-label="Permalink to &quot;第三阶段：掌握 LangGraph（40-50分钟）&quot;">​</a></h4><ol start="4"><li><a href="./03-LangGraph集成/LangGraph接入方案">LangGraph 接入方案</a><ul><li>LangGraph 集成</li><li>节点级和工具级中断</li><li>状态管理</li></ul></li></ol><h4 id="第四阶段-业务功能-20-30分钟" tabindex="-1">第四阶段：业务功能（20-30分钟） <a class="header-anchor" href="#第四阶段-业务功能-20-30分钟" aria-label="Permalink to &quot;第四阶段：业务功能（20-30分钟）&quot;">​</a></h4><ol start="5"><li><a href="./04-业务功能/会话标题生成">会话标题生成</a><ul><li>异步任务处理</li><li>降级策略</li></ul></li></ol><h4 id="第五阶段-可观测性-30-40分钟" tabindex="-1">第五阶段：可观测性（30-40分钟） <a class="header-anchor" href="#第五阶段-可观测性-30-40分钟" aria-label="Permalink to &quot;第五阶段：可观测性（30-40分钟）&quot;">​</a></h4><ol start="6"><li><a href="./05-可观测性/链路追踪与监控">链路追踪与监控</a><ul><li>日志采集</li><li>监控指标</li><li>告警规则</li></ul></li></ol><hr><h2 id="🎯-核心概念速览" tabindex="-1">🎯 核心概念速览 <a class="header-anchor" href="#🎯-核心概念速览" aria-label="Permalink to &quot;🎯 核心概念速览&quot;">​</a></h2><h3 id="网络架构" tabindex="-1">网络架构 <a class="header-anchor" href="#网络架构" aria-label="Permalink to &quot;网络架构&quot;">​</a></h3><ul><li><strong>集群隔离</strong>：短连接集群 vs 长连接集群</li><li><strong>网关分离</strong>：Kong 短连接 vs Kong SSE 专用</li><li><strong>服务分层</strong>：网关 → 服务 → AI 能力 → LLM 平台</li></ul><h3 id="消息系统" tabindex="-1">消息系统 <a class="header-anchor" href="#消息系统" aria-label="Permalink to &quot;消息系统&quot;">​</a></h3><ul><li><strong>统一格式</strong>：不依赖特定 LLM 的消息格式</li><li><strong>状态消息</strong>：role = status，用于控制指令</li><li><strong>中断与恢复</strong>：通过状态码实现可恢复的中断</li></ul><h3 id="langgraph" tabindex="-1">LangGraph <a class="header-anchor" href="#langgraph" aria-label="Permalink to &quot;LangGraph&quot;">​</a></h3><ul><li><strong>工作流编排</strong>：Node 组成 Graph，实现复杂流程</li><li><strong>节点级中断</strong>：使用 NodeInterrupt 异常</li><li><strong>工具级中断</strong>：状态记录在 messages 中</li><li><strong>Checkpoint</strong>：序列化状态，支持恢复</li></ul><h3 id="工具调用" tabindex="-1">工具调用 <a class="header-anchor" href="#工具调用" aria-label="Permalink to &quot;工具调用&quot;">​</a></h3><ul><li><strong>统一格式</strong>：<code>&lt;tool_call&gt;</code> 标签 + JSON</li><li><strong>流式解析</strong>：支持流式输出中解析工具调用</li><li><strong>多模型适配</strong>：统一不同 LLM 的工具调用格式</li></ul><hr><h2 id="🚀-快速开始" tabindex="-1">🚀 快速开始 <a class="header-anchor" href="#🚀-快速开始" aria-label="Permalink to &quot;🚀 快速开始&quot;">​</a></h2><h3 id="开发者快速开始" tabindex="-1">开发者快速开始 <a class="header-anchor" href="#开发者快速开始" aria-label="Permalink to &quot;开发者快速开始&quot;">​</a></h3><p><strong>1. 理解消息格式</strong></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;thread_abc123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;msg_001&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;帮我生成一张牙膏产品图&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;input_skill_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>2. 处理状态消息</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handle_status_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(status_message):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status_message[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1002</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 稿豆不足</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 提示用户充值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        pass</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    elif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1004</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Token 过期</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 刷新 token</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        pass</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>3. 实现 LangGraph Node</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> my_node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 准备工作（可重复执行）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prepare_context(state)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 调用 GaodingAssistant（只执行一次）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    assistant </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GaodingAssistant()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> assistant.run(context)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: result}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>4. 记录日志</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">log_checkpoint(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;request_execute_begin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    trace_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">trace_id,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    thread_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">thread_id,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    user_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user_id,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: user_query, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;is_new&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr><h2 id="📋-架构设计原则" tabindex="-1">📋 架构设计原则 <a class="header-anchor" href="#📋-架构设计原则" aria-label="Permalink to &quot;📋 架构设计原则&quot;">​</a></h2><h3 id="集群隔离" tabindex="-1">集群隔离 <a class="header-anchor" href="#集群隔离" aria-label="Permalink to &quot;集群隔离&quot;">​</a></h3><table tabindex="0"><thead><tr><th>维度</th><th>短连接集群</th><th>长连接集群</th></tr></thead><tbody><tr><td>超时时间</td><td>60s</td><td>15mins</td></tr><tr><td>QPS</td><td>高</td><td>中低</td></tr><tr><td>资源占用</td><td>低</td><td>高</td></tr><tr><td>适用场景</td><td>快速查询</td><td>复杂任务</td></tr></tbody></table><h3 id="消息设计" tabindex="-1">消息设计 <a class="header-anchor" href="#消息设计" aria-label="Permalink to &quot;消息设计&quot;">​</a></h3><p><strong>DO：</strong></p><ul><li>✅ 使用统一的消息格式</li><li>✅ 消息创建后不可修改</li><li>✅ 使用状态消息传递控制指令</li><li>✅ 记录本地 ID 便于前端关联</li></ul><p><strong>DON&#39;T：</strong></p><ul><li>❌ 直接使用 LLM 的消息格式</li><li>❌ 修改已创建的消息</li><li>❌ 在消息中存储大文件</li></ul><h3 id="node-开发" tabindex="-1">Node 开发 <a class="header-anchor" href="#node-开发" aria-label="Permalink to &quot;Node 开发&quot;">​</a></h3><p><strong>约定：</strong></p><ol><li>使用 GaodingAssistant 调用 LLM 和工具</li><li>Node 里最多只有一次 <code>GaodingAssistant.run</code></li><li>run 之前的代码可重复运行</li><li>状态用 messages 承载</li></ol><hr><h2 id="🔄-关键流程" tabindex="-1">🔄 关键流程 <a class="header-anchor" href="#🔄-关键流程" aria-label="Permalink to &quot;🔄 关键流程&quot;">​</a></h2><h3 id="消息流转" tabindex="-1">消息流转 <a class="header-anchor" href="#消息流转" aria-label="Permalink to &quot;消息流转&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户输入 </span></span>
<span class="line"><span>  → Agent 接收 (request_execute_begin)</span></span>
<span class="line"><span>  → LangGraph 编排</span></span>
<span class="line"><span>  → Node 执行 (node_execute_begin/end)</span></span>
<span class="line"><span>  → LLM 调用 (llm_execute_begin/end)</span></span>
<span class="line"><span>  → 工具调用 (tool_execute_begin/end)</span></span>
<span class="line"><span>  → 流式响应</span></span>
<span class="line"><span>  → 请求完成 (request_execute_end)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="中断与恢复" tabindex="-1">中断与恢复 <a class="header-anchor" href="#中断与恢复" aria-label="Permalink to &quot;中断与恢复&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>正常执行 </span></span>
<span class="line"><span>  → 检测中断条件（如稿豆不足）</span></span>
<span class="line"><span>  → 抛出 NodeInterrupt</span></span>
<span class="line"><span>  → 保存 Checkpoint</span></span>
<span class="line"><span>  → 返回状态消息 (-1002)</span></span>
<span class="line"><span>  → 用户充值</span></span>
<span class="line"><span>  → 前端发送恢复消息 (-2001)</span></span>
<span class="line"><span>  → 加载 Checkpoint</span></span>
<span class="line"><span>  → 从中断点恢复</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="工具调用-1" tabindex="-1">工具调用 <a class="header-anchor" href="#工具调用-1" aria-label="Permalink to &quot;工具调用&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>LLM 输出 </span></span>
<span class="line"><span>  → 解析 &lt;tool_call&gt; 标签</span></span>
<span class="line"><span>  → 提取工具名称和参数</span></span>
<span class="line"><span>  → 调用工具</span></span>
<span class="line"><span>  → 返回结果</span></span>
<span class="line"><span>  → 继续 LLM 生成</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><hr><h2 id="💡-最佳实践" tabindex="-1">💡 最佳实践 <a class="header-anchor" href="#💡-最佳实践" aria-label="Permalink to &quot;💡 最佳实践&quot;">​</a></h2><h3 id="错误处理" tabindex="-1">错误处理 <a class="header-anchor" href="#错误处理" aria-label="Permalink to &quot;错误处理&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> safe_execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(func):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;安全执行装饰器&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wrapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> func(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        except</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NodeInterrupt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 中断异常，保存状态</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            save_checkpoint()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 其他异常，记录日志</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            logging.error(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Execution failed: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error_response(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wrapper</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="日志记录" tabindex="-1">日志记录 <a class="header-anchor" href="#日志记录" aria-label="Permalink to &quot;日志记录&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用结构化日志</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">log_checkpoint(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;llm_execute_end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    trace_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">trace_id,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;llm_calls_num&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;prompt_tokens&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">150</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;completion_tokens&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="性能优化" tabindex="-1">性能优化 <a class="header-anchor" href="#性能优化" aria-label="Permalink to &quot;性能优化&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用缓存</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@lru_cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">maxsize</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_tool_description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tool_name):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> generate_tool_description(tool_name)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 并行执行</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> parallel_tool_calls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tool_calls):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tasks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [call_tool(tc) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tool_calls]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> asyncio.gather(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tasks)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h2 id="🔗-相关资源" tabindex="-1">🔗 相关资源 <a class="header-anchor" href="#🔗-相关资源" aria-label="Permalink to &quot;🔗 相关资源&quot;">​</a></h2><h3 id="外部资源" tabindex="-1">外部资源 <a class="header-anchor" href="#外部资源" aria-label="Permalink to &quot;外部资源&quot;">​</a></h3><p><strong>LangGraph：</strong></p><ul><li>官方文档：<a href="https://langchain-ai.github.io/langgraph/" target="_blank" rel="noreferrer">https://langchain-ai.github.io/langgraph/</a></li><li>GitHub：<a href="https://github.com/langchain-ai/langgraph" target="_blank" rel="noreferrer">https://github.com/langchain-ai/langgraph</a></li></ul><p><strong>LangChain：</strong></p><ul><li>官方文档：<a href="https://python.langchain.com/" target="_blank" rel="noreferrer">https://python.langchain.com/</a></li><li>工具调用：<a href="https://python.langchain.com/docs/modules/agents/tools/" target="_blank" rel="noreferrer">https://python.langchain.com/docs/modules/agents/tools/</a></li></ul><p><strong>Dify：</strong></p><ul><li>官方文档：<a href="https://docs.dify.ai/" target="_blank" rel="noreferrer">https://docs.dify.ai/</a></li><li>Workflow 编排：<a href="https://docs.dify.ai/features/workflow" target="_blank" rel="noreferrer">https://docs.dify.ai/features/workflow</a></li></ul><hr><h2 id="❓-常见问题" tabindex="-1">❓ 常见问题 <a class="header-anchor" href="#❓-常见问题" aria-label="Permalink to &quot;❓ 常见问题&quot;">​</a></h2><h3 id="q1-为什么要自定义消息格式" tabindex="-1">Q1: 为什么要自定义消息格式？ <a class="header-anchor" href="#q1-为什么要自定义消息格式" aria-label="Permalink to &quot;Q1: 为什么要自定义消息格式？&quot;">​</a></h3><p><strong>A:</strong> LLM 的消息格式不统一，且缺少状态管理和业务扩展字段。自定义消息格式可以：</p><ul><li>统一不同 LLM 的格式</li><li>支持状态管理（中断与恢复）</li><li>扩展业务字段</li><li>完整回溯状态</li></ul><h3 id="q2-什么时候触发中断" tabindex="-1">Q2: 什么时候触发中断？ <a class="header-anchor" href="#q2-什么时候触发中断" aria-label="Permalink to &quot;Q2: 什么时候触发中断？&quot;">​</a></h3><p><strong>A:</strong> 中断场景包括：</p><ul><li>稿豆不足（-1002）</li><li>Token 过期（-1004）</li><li>内容安全风险（-1006）</li><li>LLM/工具调用超限（-1003）</li></ul><h3 id="q3-如何实现工具调用" tabindex="-1">Q3: 如何实现工具调用？ <a class="header-anchor" href="#q3-如何实现工具调用" aria-label="Permalink to &quot;Q3: 如何实现工具调用？&quot;">​</a></h3><p><strong>A:</strong> 工具调用流程：</p><ol><li>在 System Prompt 注入工具描述</li><li>LLM 生成 <code>&lt;tool_call&gt;</code> 标签</li><li>流式解析工具调用</li><li>执行工具并返回结果</li></ol><h3 id="q4-checkpoint-存储在哪" tabindex="-1">Q4: Checkpoint 存储在哪？ <a class="header-anchor" href="#q4-checkpoint-存储在哪" aria-label="Permalink to &quot;Q4: Checkpoint 存储在哪？&quot;">​</a></h3><p><strong>A:</strong> Checkpoint 单独存放，和 thread_id 关联。不建议存储在 messages 中，因为：</p><ul><li>Checkpoint 体积较大（可能几百 KB）</li><li>只临时性使用一次</li><li>与业务消息分离</li></ul><h3 id="q5-node-开发有什么限制" tabindex="-1">Q5: Node 开发有什么限制？ <a class="header-anchor" href="#q5-node-开发有什么限制" aria-label="Permalink to &quot;Q5: Node 开发有什么限制？&quot;">​</a></h3><p><strong>A:</strong> Node 开发约定：</p><ul><li>最多只有一次 <code>GaodingAssistant.run</code></li><li>run 之前的代码可重复运行（幂等）</li><li>不要在 run 之前执行副作用操作（如数据库写入）</li></ul><h3 id="q6-如何监控-agent-性能" tabindex="-1">Q6: 如何监控 Agent 性能？ <a class="header-anchor" href="#q6-如何监控-agent-性能" aria-label="Permalink to &quot;Q6: 如何监控 Agent 性能？&quot;">​</a></h3><p><strong>A:</strong> 关键指标：</p><ul><li><strong>成功率</strong>：请求完成率、工具调用成功率</li><li><strong>延迟</strong>：首响应延迟、请求处理时长</li><li><strong>成本</strong>：Token 消耗、稿豆消耗</li><li><strong>业务</strong>：技能使用率、采纳率</li></ul><hr><h2 id="📝-开发规范" tabindex="-1">📝 开发规范 <a class="header-anchor" href="#📝-开发规范" aria-label="Permalink to &quot;📝 开发规范&quot;">​</a></h2><h3 id="消息处理" tabindex="-1">消息处理 <a class="header-anchor" href="#消息处理" aria-label="Permalink to &quot;消息处理&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 正确</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handle_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;role&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;status&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        handle_status_message(message)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    elif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;role&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        process_user_message(message)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 错误</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handle_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 直接修改消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;processed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ❌ 消息不可变</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="工具注册" tabindex="-1">工具注册 <a class="header-anchor" href="#工具注册" aria-label="Permalink to &quot;工具注册&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 正确</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">registry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ToolRegistry()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">registry.register(ImageGenerationTool())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">registry.register(SearchTool())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ImageGenerationTool(), SearchTool()]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 缺少统一管理</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="日志记录-1" tabindex="-1">日志记录 <a class="header-anchor" href="#日志记录-1" aria-label="Permalink to &quot;日志记录&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 正确</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">log_checkpoint(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tool_execute_begin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    trace_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">trace_id,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;func_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 错误</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Tool called: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 缺少结构化信息</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h2 id="📅-更新记录" tabindex="-1">📅 更新记录 <a class="header-anchor" href="#📅-更新记录" aria-label="Permalink to &quot;📅 更新记录&quot;">​</a></h2><table tabindex="0"><thead><tr><th>版本</th><th>日期</th><th>更新内容</th><th>更新人</th></tr></thead><tbody><tr><td>v1.0</td><td>2025-01-26</td><td>初始版本，整合 Agent 部署方案</td><td>AI</td></tr></tbody></table><hr><h2 id="📞-联系方式" tabindex="-1">📞 联系方式 <a class="header-anchor" href="#📞-联系方式" aria-label="Permalink to &quot;📞 联系方式&quot;">​</a></h2><ul><li><strong>技术问题</strong>：联系 AI Agent 团队</li><li><strong>架构问题</strong>：联系技术负责人</li><li><strong>工具问题</strong>：提交 Issue 或联系 DevOps</li></ul><hr><p><em>最后更新：2025-01-26</em></p>`,122)]))}const g=a(e,[["render",p]]);export{c as __pageData,g as default};
