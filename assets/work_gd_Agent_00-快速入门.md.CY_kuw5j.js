import{_ as k,C as o,c as d,o as n,a7 as e,b as p,j as t,w as a,a as i,G as r,a9 as h}from"./chunks/framework.BQb8NfN9.js";const A=JSON.parse('{"title":"AI Agent 快速入门","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/Agent/00-快速入门.md","filePath":"work/gd/Agent/00-快速入门.md","lastUpdated":1770085732000}'),c={name:"work/gd/Agent/00-快速入门.md"};function u(b,s,g,E,m,F){const l=o("Mermaid");return n(),d("div",null,[s[2]||(s[2]=e(`<h1 id="ai-agent-快速入门" tabindex="-1">AI Agent 快速入门 <a class="header-anchor" href="#ai-agent-快速入门" aria-label="Permalink to &quot;AI Agent 快速入门&quot;">​</a></h1><blockquote><p><strong>5 分钟了解稿定 AI Agent 系统</strong></p></blockquote><hr><h2 id="什么是-ai-agent" tabindex="-1">什么是 AI Agent？ <a class="header-anchor" href="#什么是-ai-agent" aria-label="Permalink to &quot;什么是 AI Agent？&quot;">​</a></h2><p><strong>AI Agent</strong>（人工智能代理）是一个能够<strong>理解用户意图、调用工具、完成复杂任务</strong>的智能系统。与传统的单次 LLM 调用不同，Agent 可以：</p><ul><li>🤖 <strong>多轮对话</strong>：记住上下文，进行连贯的对话</li><li>🛠️ <strong>工具调用</strong>：调用图像生成、搜索等外部工具</li><li>🔄 <strong>任务编排</strong>：将复杂任务拆解为多个步骤</li><li>💾 <strong>状态管理</strong>：支持中断与恢复</li></ul><p><strong>简单类比</strong>：</p><ul><li><strong>传统 LLM</strong>：像一个只会回答问题的客服</li><li><strong>AI Agent</strong>：像一个能帮你完成任务的助理</li></ul><hr><h2 id="核心能力" tabindex="-1">核心能力 <a class="header-anchor" href="#核心能力" aria-label="Permalink to &quot;核心能力&quot;">​</a></h2><h3 id="_1-智能对话" tabindex="-1">1. 智能对话 <a class="header-anchor" href="#_1-智能对话" aria-label="Permalink to &quot;1. 智能对话&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户：帮我生成一张牙膏产品图</span></span>
<span class="line"><span>Agent：好的，我来帮你生成。请问你想要什么风格的？</span></span>
<span class="line"><span>用户：简约风格，白色背景</span></span>
<span class="line"><span>Agent：[调用图像生成工具] 已为你生成，请查看</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-工具调用" tabindex="-1">2. 工具调用 <a class="header-anchor" href="#_2-工具调用" aria-label="Permalink to &quot;2. 工具调用&quot;">​</a></h3><p>Agent 可以调用多种工具：</p><ul><li><strong>图像生成</strong>：生成产品图、海报等</li><li><strong>搜索</strong>：搜索模板、素材</li><li><strong>视频生成</strong>：生成视频内容</li><li><strong>...更多工具</strong></li></ul><h3 id="_3-任务编排" tabindex="-1">3. 任务编排 <a class="header-anchor" href="#_3-任务编排" aria-label="Permalink to &quot;3. 任务编排&quot;">​</a></h3><p>复杂任务自动拆解：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户任务：设计一套品牌视觉</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>Step 1：生成 Logo</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>Step 2：生成配色方案</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>Step 3：生成海报模板</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>完成</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-中断与恢复" tabindex="-1">4. 中断与恢复 <a class="header-anchor" href="#_4-中断与恢复" aria-label="Permalink to &quot;4. 中断与恢复&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户：生成图片</span></span>
<span class="line"><span>Agent：检测到稿豆不足，请充值</span></span>
<span class="line"><span>[用户充值]</span></span>
<span class="line"><span>用户：继续</span></span>
<span class="line"><span>Agent：[从中断点恢复] 继续生成...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h2 id="系统架构-一图胜千言" tabindex="-1">系统架构（一图胜千言） <a class="header-anchor" href="#系统架构-一图胜千言" aria-label="Permalink to &quot;系统架构（一图胜千言）&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────┐</span></span>
<span class="line"><span>│  用户   │</span></span>
<span class="line"><span>└────┬────┘</span></span>
<span class="line"><span>     │ 发送消息</span></span>
<span class="line"><span>     ↓</span></span>
<span class="line"><span>┌─────────────────┐</span></span>
<span class="line"><span>│  Kong 网关      │ ← SSE 长连接</span></span>
<span class="line"><span>│  (15分钟超时)   │</span></span>
<span class="line"><span>└────┬────────────┘</span></span>
<span class="line"><span>     │</span></span>
<span class="line"><span>     ↓</span></span>
<span class="line"><span>┌─────────────────┐</span></span>
<span class="line"><span>│  Agent 服务     │ ← 核心服务</span></span>
<span class="line"><span>│  - 会话管理     │</span></span>
<span class="line"><span>│  - 状态持久化   │</span></span>
<span class="line"><span>└────┬────────────┘</span></span>
<span class="line"><span>     │</span></span>
<span class="line"><span>     ↓</span></span>
<span class="line"><span>┌─────────────────┐</span></span>
<span class="line"><span>│  LangGraph      │ ← 工作流编排</span></span>
<span class="line"><span>│  - Node 调度    │</span></span>
<span class="line"><span>│  - 中断与恢复   │</span></span>
<span class="line"><span>└────┬────────────┘</span></span>
<span class="line"><span>     │</span></span>
<span class="line"><span>     ├──────────────────┐</span></span>
<span class="line"><span>     ↓                  ↓</span></span>
<span class="line"><span>┌──────────────┐  ┌──────────────┐</span></span>
<span class="line"><span>│ AI Gateway   │  │ gdesign-tool │</span></span>
<span class="line"><span>│ (LLM 调用)   │  │ (工具调用)   │</span></span>
<span class="line"><span>└──────────────┘  └──────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><hr><h2 id="核心概念" tabindex="-1">核心概念 <a class="header-anchor" href="#核心概念" aria-label="Permalink to &quot;核心概念&quot;">​</a></h2><h3 id="消息-message" tabindex="-1">消息 (Message) <a class="header-anchor" href="#消息-message" aria-label="Permalink to &quot;消息 (Message)&quot;">​</a></h3><p>Agent 中的所有交互都通过<strong>消息</strong>进行：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;thread_123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 会话 ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;msg_001&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 消息 ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 角色：user/assistant/function/status</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 类型：plain/function_call/function_response</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;帮我生成一张图&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>关键角色</strong>：</p><ul><li><code>user</code>：用户输入</li><li><code>assistant</code>：AI 回复</li><li><code>function</code>：工具调用结果</li><li><code>status</code>：状态消息（如稿豆不足）</li></ul><h3 id="会话-thread" tabindex="-1">会话 (Thread) <a class="header-anchor" href="#会话-thread" aria-label="Permalink to &quot;会话 (Thread)&quot;">​</a></h3><p>一次完整的对话称为一个<strong>会话</strong>：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Thread ID: thread_123</span></span>
<span class="line"><span>├── Message 1: 用户问好</span></span>
<span class="line"><span>├── Message 2: Agent 回复</span></span>
<span class="line"><span>├── Message 3: 用户请求生成图片</span></span>
<span class="line"><span>├── Message 4: Agent 调用工具</span></span>
<span class="line"><span>├── Message 5: 工具返回结果</span></span>
<span class="line"><span>└── Message 6: Agent 返回最终结果</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="工具调用-function-calling" tabindex="-1">工具调用 (Function Calling) <a class="header-anchor" href="#工具调用-function-calling" aria-label="Permalink to &quot;工具调用 (Function Calling)&quot;">​</a></h3><p>Agent 通过特殊格式调用工具：</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tool_call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &quot;name&quot;: &quot;generate_image&quot;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &quot;parameters&quot;: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &quot;user_prompt&quot;: &quot;一张牙膏产品图&quot;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &quot;width&quot;: &quot;512&quot;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &quot;height&quot;: &quot;512&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tool_call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="状态消息-status-message" tabindex="-1">状态消息 (Status Message) <a class="header-anchor" href="#状态消息-status-message" aria-label="Permalink to &quot;状态消息 (Status Message)&quot;">​</a></h3><p>用于传递系统状态：</p><table tabindex="0"><thead><tr><th>状态码</th><th>含义</th><th>处理方式</th></tr></thead><tbody><tr><td><code>-1002</code></td><td>稿豆不足</td><td>提示用户充值</td></tr><tr><td><code>-1004</code></td><td>Token 过期</td><td>刷新 token</td></tr><tr><td><code>-1006</code></td><td>内容风险</td><td>撤回并提示</td></tr><tr><td><code>-2001</code></td><td>恢复执行</td><td>从中断点继续</td></tr></tbody></table><hr><h2 id="快速体验" tabindex="-1">快速体验 <a class="header-anchor" href="#快速体验" aria-label="Permalink to &quot;快速体验&quot;">​</a></h2><h3 id="_1-简单对话" tabindex="-1">1. 简单对话 <a class="header-anchor" href="#_1-简单对话" aria-label="Permalink to &quot;1. 简单对话&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /api/agent/chat</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;thread_id&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> null,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 新会话传 null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;message&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;你好&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 响应（SSE 流式）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;role&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;assistant&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;content&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;你好！我是稿定 AI Agent，有什么可以帮你的吗？&quot;}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-调用工具" tabindex="-1">2. 调用工具 <a class="header-anchor" href="#_2-调用工具" aria-label="Permalink to &quot;2. 调用工具&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /api/agent/chat</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;thread_id&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;thread_123&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;message&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;帮我生成一张牙膏产品图&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;input_skill_id&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 图像生成技能</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 响应</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;role&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;assistant&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;content&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;好的，我来帮你生成...&quot;}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;role&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;function&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;content&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;tool_name&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;generate_image&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;result&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;success&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;image_url&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;...&quot;}}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;role&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;assistant&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;content&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;已为你生成，请查看&quot;}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-处理中断" tabindex="-1">3. 处理中断 <a class="header-anchor" href="#_3-处理中断" aria-label="Permalink to &quot;3. 处理中断&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 第一次请求</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /api/agent/chat</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;message&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;生成图片&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 响应：稿豆不足</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;role&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;status&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;content&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;code&quot;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1002,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;message&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;稿豆不足&quot;}}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 用户充值后恢复</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /api/agent/chat</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;thread_id&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;thread_123&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;message&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> null,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 恢复时不需要新消息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;resume&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 标记为恢复请求</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 响应：继续执行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;role&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;function&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;content&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {...}}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><hr><h2 id="关键流程" tabindex="-1">关键流程 <a class="header-anchor" href="#关键流程" aria-label="Permalink to &quot;关键流程&quot;">​</a></h2><h3 id="消息流转" tabindex="-1">消息流转 <a class="header-anchor" href="#消息流转" aria-label="Permalink to &quot;消息流转&quot;">​</a></h3>`,50)),(n(),p(h,null,{default:a(()=>[r(l,{id:"mermaid-244",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20Agent%0A%20%20%20%20participant%20LLM%0A%20%20%20%20participant%20Tool%0A%0A%20%20%20%20User-%3E%3EAgent%3A%20%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%0A%20%20%20%20Agent-%3E%3ELLM%3A%20%E8%B0%83%E7%94%A8%20LLM%0A%20%20%20%20LLM--%3E%3EAgent%3A%20%E8%BF%94%E5%9B%9E%E5%9B%9E%E5%A4%8D%EF%BC%88%E5%90%AB%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%EF%BC%89%0A%20%20%20%20Agent-%3E%3ETool%3A%20%E6%89%A7%E8%A1%8C%E5%B7%A5%E5%85%B7%0A%20%20%20%20Tool--%3E%3EAgent%3A%20%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%0A%20%20%20%20Agent-%3E%3EUser%3A%20%E6%B5%81%E5%BC%8F%E8%BF%94%E5%9B%9E%0A"})]),fallback:a(()=>s[0]||(s[0]=[i(" Loading... ")])),_:1})),s[3]||(s[3]=t("h3",{id:"中断与恢复",tabindex:"-1"},[i("中断与恢复 "),t("a",{class:"header-anchor",href:"#中断与恢复","aria-label":'Permalink to "中断与恢复"'},"​")],-1)),(n(),p(h,null,{default:a(()=>[r(l,{id:"mermaid-248",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20Agent%0A%20%20%20%20participant%20Tool%0A%0A%20%20%20%20User-%3E%3EAgent%3A%20%E7%94%9F%E6%88%90%E5%9B%BE%E7%89%87%0A%20%20%20%20Agent-%3E%3ETool%3A%20%E8%B0%83%E7%94%A8%E5%B7%A5%E5%85%B7%0A%20%20%20%20Tool--%3E%3EAgent%3A%20%E7%A8%BF%E8%B1%86%E4%B8%8D%E8%B6%B3%0A%20%20%20%20Agent-%3E%3EUser%3A%20%E7%8A%B6%E6%80%81%E6%B6%88%E6%81%AF%20(-1002)%0A%20%20%20%20%0A%20%20%20%20Note%20over%20User%3A%20%E7%94%A8%E6%88%B7%E5%85%85%E5%80%BC%0A%20%20%20%20%0A%20%20%20%20User-%3E%3EAgent%3A%20%E6%81%A2%E5%A4%8D%E6%89%A7%E8%A1%8C%20(-2001)%0A%20%20%20%20Agent-%3E%3ETool%3A%20%E9%87%8D%E8%AF%95%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%0A%20%20%20%20Tool--%3E%3EAgent%3A%20%E8%B0%83%E7%94%A8%E6%88%90%E5%8A%9F%0A%20%20%20%20Agent-%3E%3EUser%3A%20%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%0A"})]),fallback:a(()=>s[1]||(s[1]=[i(" Loading... ")])),_:1})),s[4]||(s[4]=e(`<hr><h2 id="核心优势" tabindex="-1">核心优势 <a class="header-anchor" href="#核心优势" aria-label="Permalink to &quot;核心优势&quot;">​</a></h2><h3 id="_1-长连接流式输出" tabindex="-1">1. 长连接流式输出 <a class="header-anchor" href="#_1-长连接流式输出" aria-label="Permalink to &quot;1. 长连接流式输出&quot;">​</a></h3><ul><li>✅ 实时反馈，用户体验好</li><li>✅ 支持 15 分钟长任务</li><li>✅ SSE 协议，兼容性好</li></ul><h3 id="_2-状态管理" tabindex="-1">2. 状态管理 <a class="header-anchor" href="#_2-状态管理" aria-label="Permalink to &quot;2. 状态管理&quot;">​</a></h3><ul><li>✅ 支持中断与恢复</li><li>✅ 完整的会话历史</li><li>✅ 状态持久化</li></ul><h3 id="_3-工具生态" tabindex="-1">3. 工具生态 <a class="header-anchor" href="#_3-工具生态" aria-label="Permalink to &quot;3. 工具生态&quot;">​</a></h3><ul><li>✅ 统一的工具调用接口</li><li>✅ 易于扩展新工具</li><li>✅ 工具调用可追踪</li></ul><h3 id="_4-可观测性" tabindex="-1">4. 可观测性 <a class="header-anchor" href="#_4-可观测性" aria-label="Permalink to &quot;4. 可观测性&quot;">​</a></h3><ul><li>✅ 完整的链路追踪</li><li>✅ 详细的性能指标</li><li>✅ 成本管控</li></ul><hr><h2 id="下一步" tabindex="-1">下一步 <a class="header-anchor" href="#下一步" aria-label="Permalink to &quot;下一步&quot;">​</a></h2><h3 id="深入学习" tabindex="-1">深入学习 <a class="header-anchor" href="#深入学习" aria-label="Permalink to &quot;深入学习&quot;">​</a></h3><ol><li><p><strong><a href="./01-基础概念">基础概念</a></strong><br> 理解 AI Agent 的核心原理</p></li><li><p><strong><a href="./02-消息系统">消息系统</a></strong><br> 掌握消息格式和状态管理</p></li><li><p><strong><a href="./03-工具调用">工具调用</a></strong><br> 学习 Function Calling 机制</p></li><li><p><strong><a href="./04-工作流编排">工作流编排</a></strong><br> 了解 LangGraph 集成</p></li></ol><h3 id="开发指南" tabindex="-1">开发指南 <a class="header-anchor" href="#开发指南" aria-label="Permalink to &quot;开发指南&quot;">​</a></h3><ul><li><strong><a href="./05-网络架构">网络架构</a></strong>：了解系统架构</li><li><strong><a href="./06-中断与恢复">中断与恢复</a></strong>：掌握状态管理</li><li><strong><a href="./07-业务功能">业务功能</a></strong>：学习实际应用</li><li><strong><a href="./08-可观测性">可观测性</a></strong>：监控与追踪</li><li><strong><a href="./09-最佳实践">最佳实践</a></strong>：开发规范</li></ul><hr><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h2><h3 id="q1-agent-和普通-llm-有什么区别" tabindex="-1">Q1: Agent 和普通 LLM 有什么区别？ <a class="header-anchor" href="#q1-agent-和普通-llm-有什么区别" aria-label="Permalink to &quot;Q1: Agent 和普通 LLM 有什么区别？&quot;">​</a></h3><p><strong>A:</strong> 主要区别：</p><ul><li><strong>LLM</strong>：单次问答，无状态</li><li><strong>Agent</strong>：多轮对话，有状态，可调用工具</li></ul><h3 id="q2-为什么需要状态消息" tabindex="-1">Q2: 为什么需要状态消息？ <a class="header-anchor" href="#q2-为什么需要状态消息" aria-label="Permalink to &quot;Q2: 为什么需要状态消息？&quot;">​</a></h3><p><strong>A:</strong> 状态消息用于：</p><ul><li>传递系统状态（如稿豆不足）</li><li>实现中断与恢复</li><li>控制流程（如停止生成）</li></ul><h3 id="q3-如何处理长任务" tabindex="-1">Q3: 如何处理长任务？ <a class="header-anchor" href="#q3-如何处理长任务" aria-label="Permalink to &quot;Q3: 如何处理长任务？&quot;">​</a></h3><p><strong>A:</strong> 通过以下机制：</p><ul><li>SSE 长连接（15分钟超时）</li><li>中断与恢复机制</li><li>状态持久化</li></ul><h3 id="q4-工具调用失败怎么办" tabindex="-1">Q4: 工具调用失败怎么办？ <a class="header-anchor" href="#q4-工具调用失败怎么办" aria-label="Permalink to &quot;Q4: 工具调用失败怎么办？&quot;">​</a></h3><p><strong>A:</strong> 系统会：</p><ul><li>记录错误日志</li><li>返回错误状态</li><li>支持重试机制</li></ul><hr><h2 id="快速参考" tabindex="-1">快速参考 <a class="header-anchor" href="#快速参考" aria-label="Permalink to &quot;快速参考&quot;">​</a></h2><h3 id="关键-api" tabindex="-1">关键 API <a class="header-anchor" href="#关键-api" aria-label="Permalink to &quot;关键 API&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 发送消息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /api/agent/chat</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 停止生成</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /api/agent/stop</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取会话历史</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /api/agent/thread/{thread_id}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取会话列表</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /api/agent/threads?user_id={user_id}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="关键配置" tabindex="-1">关键配置 <a class="header-anchor" href="#关键配置" aria-label="Permalink to &quot;关键配置&quot;">​</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 超时配置</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KONG_SSE_TIMEOUT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 900</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 15 分钟</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AGENT_TIMEOUT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 600</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # 10 分钟</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 限制配置</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAX_LLM_CALLS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 单轮最多 LLM 调用次数</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAX_TOOL_CALLS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 单轮最多工具调用次数</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr><p><em>文档版本：v1.0</em><br><em>最后更新：2026-01-26</em></p><p><strong>下一篇</strong>：<a href="./01-基础概念">基础概念 →</a></p>`,39))])}const y=k(c,[["render",u]]);export{A as __pageData,y as default};
