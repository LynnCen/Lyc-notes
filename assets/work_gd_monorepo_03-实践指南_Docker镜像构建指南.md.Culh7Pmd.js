import{_ as l,C as e,c as r,o as a,a7 as n,b as h,w as i,a as t,G as k,a9 as d}from"./chunks/framework.BQb8NfN9.js";const F=JSON.parse('{"title":"æŒ‡å—ï¼šåœ¨ Monorepo ä¸­ä½¿ç”¨ pnpm + Turbo æ„å»º Docker é•œåƒ","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/monorepo/03-å®è·µæŒ‡å—/Dockeré•œåƒæ„å»ºæŒ‡å—.md","filePath":"work/gd/monorepo/03-å®è·µæŒ‡å—/Dockeré•œåƒæ„å»ºæŒ‡å—.md","lastUpdated":1770085732000}'),c={name:"work/gd/monorepo/03-å®è·µæŒ‡å—/Dockeré•œåƒæ„å»ºæŒ‡å—.md"};function b(o,s,E,u,g,m){const p=e("Mermaid");return a(),r("div",null,[s[1]||(s[1]=n(`<h1 id="æŒ‡å—-åœ¨-monorepo-ä¸­ä½¿ç”¨-pnpm-turbo-æ„å»º-docker-é•œåƒ" tabindex="-1">æŒ‡å—ï¼šåœ¨ Monorepo ä¸­ä½¿ç”¨ pnpm + Turbo æ„å»º Docker é•œåƒ <a class="header-anchor" href="#æŒ‡å—-åœ¨-monorepo-ä¸­ä½¿ç”¨-pnpm-turbo-æ„å»º-docker-é•œåƒ" aria-label="Permalink to &quot;æŒ‡å—ï¼šåœ¨ Monorepo ä¸­ä½¿ç”¨ pnpm + Turbo æ„å»º Docker é•œåƒ&quot;">â€‹</a></h1><h2 id="ä¸€ã€æ–‡æ¡£æ¦‚è¿°" tabindex="-1">ä¸€ã€æ–‡æ¡£æ¦‚è¿° <a class="header-anchor" href="#ä¸€ã€æ–‡æ¡£æ¦‚è¿°" aria-label="Permalink to &quot;ä¸€ã€æ–‡æ¡£æ¦‚è¿°&quot;">â€‹</a></h2><blockquote><p>ğŸ“Œ <strong>å†…å®¹è¯´æ˜</strong><br> æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ Monorepo é¡¹ç›®ä¸­é…åˆä½¿ç”¨ pnpmã€Turbo å’Œ Dockerï¼Œå®ç°é«˜æ•ˆçš„å®¹å™¨é•œåƒæ„å»ºæµç¨‹ã€‚é€šè¿‡é¢„å…ˆæ„å»º dist äº§ç‰©ï¼Œå†è¿›å…¥ Docker æ„å»ºæµç¨‹ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨æ„å»ºç¼“å­˜ï¼Œæé«˜æ„å»ºæ•ˆç‡ã€‚</p></blockquote><h3 id="_1-1-èƒŒæ™¯" tabindex="-1">1.1 èƒŒæ™¯ <a class="header-anchor" href="#_1-1-èƒŒæ™¯" aria-label="Permalink to &quot;1.1 èƒŒæ™¯&quot;">â€‹</a></h3><p>åœ¨ Monorepo é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨ä»¥ä¸‹æŠ€æœ¯æ ˆï¼š</p><ul><li><strong>pnpm</strong>ï¼šåŒ…ç®¡ç†å·¥å…·ï¼Œæ”¯æŒ workspace å’Œé«˜æ•ˆçš„ä¾èµ–ç®¡ç†</li><li><strong>Turbo</strong>ï¼šä»»åŠ¡ç®¡ç†å·¥å…·ï¼Œæä¾›æ™ºèƒ½ç¼“å­˜å’Œå¹¶è¡Œæ„å»º</li><li><strong>Docker</strong>ï¼šå®¹å™¨åŒ–æŠ€æœ¯ï¼Œç”¨äºåº”ç”¨éƒ¨ç½²</li></ul><h3 id="_1-2-é¡¹ç›®ç»“æ„" tabindex="-1">1.2 é¡¹ç›®ç»“æ„ <a class="header-anchor" href="#_1-2-é¡¹ç›®ç»“æ„" aria-label="Permalink to &quot;1.2 é¡¹ç›®ç»“æ„&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>monorepo/</span></span>
<span class="line"><span>â”œâ”€â”€ apps/                    # åº”ç”¨ç›®å½•</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ app-editor/         # ç¼–è¾‘å™¨åº”ç”¨ï¼ˆç‹¬ç«‹ï¼‰</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ app-admin/          # ç®¡ç†åå°åº”ç”¨ï¼ˆç‹¬ç«‹ï¼‰</span></span>
<span class="line"><span>â”‚   â””â”€â”€ app-api/            # API æœåŠ¡ï¼ˆç‹¬ç«‹ï¼‰</span></span>
<span class="line"><span>â”œâ”€â”€ packages/               # å…¬å…±åŒ…ç›®å½•</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ ui-components/      # UI ç»„ä»¶åº“</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°åº“</span></span>
<span class="line"><span>â”‚   â””â”€â”€ shared-config/      # å…±äº«é…ç½®</span></span>
<span class="line"><span>â”œâ”€â”€ package.json</span></span>
<span class="line"><span>â”œâ”€â”€ pnpm-workspace.yaml</span></span>
<span class="line"><span>â””â”€â”€ turbo.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li><code>apps/</code> ç›®å½•ä¸­çš„åº”ç”¨ç›¸äº’ç‹¬ç«‹ï¼Œæ²¡æœ‰ä¾èµ–å…³ç³»</li><li><code>apps/</code> ä¸­çš„åº”ç”¨å¯èƒ½å…±åŒä¾èµ– <code>packages/</code> ä¸­çš„å…¬å…±åŒ…</li><li>æ¯ä¸ªåº”ç”¨éœ€è¦èƒ½å¤Ÿç‹¬ç«‹æ„å»º Docker é•œåƒ</li></ul><hr><h2 id="äºŒã€æ ¸å¿ƒè®¾è®¡åŸåˆ™" tabindex="-1">äºŒã€æ ¸å¿ƒè®¾è®¡åŸåˆ™ <a class="header-anchor" href="#äºŒã€æ ¸å¿ƒè®¾è®¡åŸåˆ™" aria-label="Permalink to &quot;äºŒã€æ ¸å¿ƒè®¾è®¡åŸåˆ™&quot;">â€‹</a></h2><h3 id="_2-1-é¢„æ„å»ºç­–ç•¥" tabindex="-1">2.1 é¢„æ„å»ºç­–ç•¥ <a class="header-anchor" href="#_2-1-é¢„æ„å»ºç­–ç•¥" aria-label="Permalink to &quot;2.1 é¢„æ„å»ºç­–ç•¥&quot;">â€‹</a></h3><p><strong>ä¸ºä»€ä¹ˆè¦é¢„æ„å»ºï¼Ÿ</strong></p><ul><li>âœ… åˆ©ç”¨ Turbo çš„ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤æ„å»º</li><li>âœ… åˆ†ç¦»æ„å»ºå’Œé•œåƒæ‰“åŒ…è¿‡ç¨‹ï¼Œæé«˜æ•ˆç‡</li><li>âœ… æ›´å¥½çš„è°ƒè¯•å’Œé—®é¢˜å®šä½</li><li>âœ… å¯ä»¥åœ¨æœ¬åœ°éªŒè¯æ„å»ºäº§ç‰©</li></ul><p><strong>æ„å»ºæµç¨‹ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. ä½¿ç”¨ Turbo æ„å»ºåº”ç”¨ï¼ˆç”Ÿæˆ dist/ï¼‰</span></span>
<span class="line"><span>2. å°†æ„å»ºäº§ç‰©å¤åˆ¶åˆ° Docker é•œåƒ</span></span>
<span class="line"><span>3. åœ¨é•œåƒä¸­é…ç½®è¿è¡Œç¯å¢ƒ</span></span>
<span class="line"><span>4. å¯åŠ¨åº”ç”¨</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-2-dockerfile-æ”¾ç½®ç­–ç•¥" tabindex="-1">2.2 Dockerfile æ”¾ç½®ç­–ç•¥ <a class="header-anchor" href="#_2-2-dockerfile-æ”¾ç½®ç­–ç•¥" aria-label="Permalink to &quot;2.2 Dockerfile æ”¾ç½®ç­–ç•¥&quot;">â€‹</a></h3><p><strong>æ¯ä¸ª app æ”¾ç‹¬ç«‹çš„ Dockerfileï¼ˆæ¨èï¼‰</strong></p><p><strong>ä¼˜åŠ¿ï¼š</strong></p><ul><li>âœ… Turbo å¯ä»¥ç®¡ç† Docker æ„å»ºä»»åŠ¡</li><li>âœ… æ¯ä¸ªåº”ç”¨çš„æ„å»ºé…ç½®ç‹¬ç«‹ï¼Œäº’ä¸å½±å“</li><li>âœ… æ›´å®¹æ˜“ç»´æŠ¤å’Œå®šåˆ¶</li><li>âœ… æ”¯æŒå¹¶è¡Œæ„å»ºå¤šä¸ªé•œåƒ</li></ul><p><strong>ç»“æ„ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>apps/</span></span>
<span class="line"><span>â”œâ”€â”€ app-editor/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ src/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ package.json</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ Dockerfile          # â† æ¯ä¸ª app æœ‰è‡ªå·±çš„ Dockerfile</span></span>
<span class="line"><span>â”‚   â””â”€â”€ .dockerignore</span></span>
<span class="line"><span>â”œâ”€â”€ app-admin/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ src/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ package.json</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ Dockerfile          # â† æ¯ä¸ª app æœ‰è‡ªå·±çš„ Dockerfile</span></span>
<span class="line"><span>â”‚   â””â”€â”€ .dockerignore</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><hr><h2 id="ä¸‰ã€æ–¹æ¡ˆè®¾è®¡" tabindex="-1">ä¸‰ã€æ–¹æ¡ˆè®¾è®¡ <a class="header-anchor" href="#ä¸‰ã€æ–¹æ¡ˆè®¾è®¡" aria-label="Permalink to &quot;ä¸‰ã€æ–¹æ¡ˆè®¾è®¡&quot;">â€‹</a></h2><h3 id="_3-1-æ•´ä½“æ¶æ„" tabindex="-1">3.1 æ•´ä½“æ¶æ„ <a class="header-anchor" href="#_3-1-æ•´ä½“æ¶æ„" aria-label="Permalink to &quot;3.1 æ•´ä½“æ¶æ„&quot;">â€‹</a></h3>`,26)),(a(),h(d,null,{default:i(()=>[k(p,{id:"mermaid-136",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5B%E6%BA%90%E4%BB%A3%E7%A0%81%5D%20--%3E%20B%5Bpnpm%20install%5D%0A%20%20%20%20B%20--%3E%20C%5BTurbo%20build%5D%0A%20%20%20%20C%20--%3E%20D%5B%E7%94%9F%E6%88%90%20dist%2F%5D%0A%20%20%20%20D%20--%3E%20E%5BDocker%20build%5D%0A%20%20%20%20E%20--%3E%20F%5BDocker%20%E9%95%9C%E5%83%8F%5D%0A%20%20%20%20%0A%20%20%20%20style%20C%20fill%3A%2390EE90%0A%20%20%20%20style%20E%20fill%3A%2387CEEB%0A"})]),fallback:i(()=>s[0]||(s[0]=[t(" Loading... ")])),_:1})),s[2]||(s[2]=n(`<h3 id="_3-2-æ„å»ºæµç¨‹" tabindex="-1">3.2 æ„å»ºæµç¨‹ <a class="header-anchor" href="#_3-2-æ„å»ºæµç¨‹" aria-label="Permalink to &quot;3.2 æ„å»ºæµç¨‹&quot;">â€‹</a></h3><h4 id="é˜¶æ®µä¸€-æœ¬åœ°æ„å»º" tabindex="-1">é˜¶æ®µä¸€ï¼šæœ¬åœ°æ„å»º <a class="header-anchor" href="#é˜¶æ®µä¸€-æœ¬åœ°æ„å»º" aria-label="Permalink to &quot;é˜¶æ®µä¸€ï¼šæœ¬åœ°æ„å»º&quot;">â€‹</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. å®‰è£…ä¾èµ–</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. ä½¿ç”¨ Turbo æ„å»ºæ‰€æœ‰åº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. æ„å»ºç‰¹å®šåº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter=app-editor</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="é˜¶æ®µäºŒ-docker-é•œåƒæ„å»º" tabindex="-1">é˜¶æ®µäºŒï¼šDocker é•œåƒæ„å»º <a class="header-anchor" href="#é˜¶æ®µäºŒ-docker-é•œåƒæ„å»º" aria-label="Permalink to &quot;é˜¶æ®µäºŒï¼šDocker é•œåƒæ„å»º&quot;">â€‹</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»ºå•ä¸ªåº”ç”¨çš„é•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/app-editor/Dockerfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æˆ–ä½¿ç”¨ Turbo ç®¡ç†</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker:build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter=app-editor</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h2 id="å››ã€é…ç½®è¯¦è§£" tabindex="-1">å››ã€é…ç½®è¯¦è§£ <a class="header-anchor" href="#å››ã€é…ç½®è¯¦è§£" aria-label="Permalink to &quot;å››ã€é…ç½®è¯¦è§£&quot;">â€‹</a></h2><h3 id="_4-1-pnpm-workspace-é…ç½®" tabindex="-1">4.1 pnpm workspace é…ç½® <a class="header-anchor" href="#_4-1-pnpm-workspace-é…ç½®" aria-label="Permalink to &quot;4.1 pnpm workspace é…ç½®&quot;">â€‹</a></h3><p><strong>pnpm-workspace.yamlï¼š</strong></p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">packages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;apps/*&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;packages/*&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>æ ¹ç›®å½• package.jsonï¼š</strong></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;monorepo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;private&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;turbo build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;docker:build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;turbo docker:build&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;devDependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;turbo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^1.10.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_4-2-turbo-é…ç½®" tabindex="-1">4.2 Turbo é…ç½® <a class="header-anchor" href="#_4-2-turbo-é…ç½®" aria-label="Permalink to &quot;4.2 Turbo é…ç½®&quot;">â€‹</a></h3><p><strong>turbo.jsonï¼š</strong></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;$schema&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://turbo.build/schema.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;pipeline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;dependsOn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;outputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dist/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.next/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;docker:build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;dependsOn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>è¯´æ˜ï¼š</strong></p><ul><li><code>build</code> ä»»åŠ¡ä¼šå…ˆæ„å»ºä¾èµ–çš„åŒ…ï¼ˆ<code>^build</code>ï¼‰</li><li><code>docker:build</code> ä»»åŠ¡ä¾èµ–äº <code>build</code> ä»»åŠ¡</li><li><code>build</code> ä»»åŠ¡å¯ç”¨ç¼“å­˜ï¼Œ<code>docker:build</code> ä¸ç¼“å­˜</li></ul><h3 id="_4-3-åº”ç”¨-package-json-é…ç½®" tabindex="-1">4.3 åº”ç”¨ package.json é…ç½® <a class="header-anchor" href="#_4-3-åº”ç”¨-package-json-é…ç½®" aria-label="Permalink to &quot;4.3 åº”ç”¨ package.json é…ç½®&quot;">â€‹</a></h3><p><strong>apps/app-editor/package.jsonï¼š</strong></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app-editor&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;next dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;next build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;next start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;docker:build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docker build -f Dockerfile -t app-editor:latest ../../&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@monorepo/ui-components&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workspace:*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@monorepo/utils&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workspace:*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;next&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^13.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;react&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^18.0.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>å…³é”®ç‚¹ï¼š</strong></p><ul><li><code>docker:build</code> è„šæœ¬æ„å»º Docker é•œåƒ</li><li>ä½¿ç”¨ <code>workspace:*</code> å¼•ç”¨ monorepo å†…çš„åŒ…</li><li>Docker æ„å»ºä¸Šä¸‹æ–‡æ˜¯ä»“åº“æ ¹ç›®å½•ï¼ˆ<code>../../</code>ï¼‰</li></ul><hr><h2 id="äº”ã€dockerfile-æœ€ä½³å®è·µ" tabindex="-1">äº”ã€Dockerfile æœ€ä½³å®è·µ <a class="header-anchor" href="#äº”ã€dockerfile-æœ€ä½³å®è·µ" aria-label="Permalink to &quot;äº”ã€Dockerfile æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="_5-1-å¤šé˜¶æ®µæ„å»º-dockerfile" tabindex="-1">5.1 å¤šé˜¶æ®µæ„å»º Dockerfile <a class="header-anchor" href="#_5-1-å¤šé˜¶æ®µæ„å»º-dockerfile" aria-label="Permalink to &quot;5.1 å¤šé˜¶æ®µæ„å»º Dockerfile&quot;">â€‹</a></h3><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> éœ€è¦åœ¨ Docker ä¸­å®Œæ•´æ„å»ºçš„åœºæ™¯</p><p><strong>apps/app-editor/Dockerfileï¼š</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é˜¶æ®µ 1: åŸºç¡€ä¾èµ–å®‰è£…</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:18-alpine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®‰è£… pnpm</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm install -g pnpm@8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é˜¶æ®µ 2: å®‰è£…ä¾èµ–</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dependencies</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤åˆ¶ workspace é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm-workspace.yaml package.json pnpm-lock.yaml ./</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤åˆ¶æ‰€æœ‰ package.jsonï¼ˆåŒ…æ‹¬ä¾èµ–çš„ packagesï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apps/app-editor/package.json ./apps/app-editor/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> packages/*/package.json ./packages/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®‰è£…ä¾èµ–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm install --frozen-lockfile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é˜¶æ®µ 3: æ„å»ºåº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä»ä¾èµ–é˜¶æ®µå¤åˆ¶ node_modules</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=dependencies /app/node_modules ./node_modules</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=dependencies /app/apps ./apps</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=dependencies /app/packages ./packages</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤åˆ¶æºä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apps/app-editor ./apps/app-editor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> packages ./packages</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»ºåº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm --filter=app-editor build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é˜¶æ®µ 4: ç”Ÿäº§è¿è¡Œç¯å¢ƒ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:18-alpine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> runner</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºé root ç”¨æˆ·</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> addgroup --system --gid 1001 nodejs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adduser --system --uid 1001 nextjs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤åˆ¶æ„å»ºäº§ç‰©</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/apps/app-editor/public ./public</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder --chown=nextjs:nodejs /app/apps/app-editor/.next ./.next</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/node_modules ./node_modules</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/apps/app-editor/package.json ./package.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nextjs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PORT 3000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NODE_ENV production</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node_modules/.bin/next&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h3 id="_5-2-é¢„æ„å»º-dockerfile-æ¨è" tabindex="-1">5.2 é¢„æ„å»º Dockerfileï¼ˆæ¨èï¼‰ <a class="header-anchor" href="#_5-2-é¢„æ„å»º-dockerfile-æ¨è" aria-label="Permalink to &quot;5.2 é¢„æ„å»º Dockerfileï¼ˆæ¨èï¼‰&quot;">â€‹</a></h3><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> åˆ©ç”¨ Turbo é¢„æ„å»ºï¼Œåªåœ¨ Docker ä¸­æ‰“åŒ…è¿è¡Œç¯å¢ƒ</p><p><strong>apps/app-editor/Dockerfileï¼š</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é˜¶æ®µ 1: ç”Ÿäº§ä¾èµ–å®‰è£…</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:18-alpine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dependencies</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®‰è£… pnpm</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm install -g pnpm@8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤åˆ¶ package.json å’Œ lock æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm-workspace.yaml package.json pnpm-lock.yaml ./</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apps/app-editor/package.json ./apps/app-editor/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> packages/*/package.json ./packages/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åªå®‰è£…ç”Ÿäº§ä¾èµ–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm install --prod --frozen-lockfile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é˜¶æ®µ 2: è¿è¡Œç¯å¢ƒ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ============================================</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:18-alpine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> runner</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºé root ç”¨æˆ·</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> addgroup --system --gid 1001 nodejs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adduser --system --uid 1001 nextjs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä»ä¾èµ–é˜¶æ®µå¤åˆ¶ node_modules</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=dependencies /app/node_modules ./node_modules</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤åˆ¶é¢„æ„å»ºçš„äº§ç‰©ï¼ˆåœ¨æœ¬åœ°é€šè¿‡ Turbo æ„å»ºï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apps/app-editor/dist ./dist</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apps/app-editor/public ./public</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apps/app-editor/package.json ./package.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nextjs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PORT 3000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NODE_ENV production</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dist/server.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p><strong>æ„å»ºå‘½ä»¤ï¼š</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. å…ˆç”¨ Turbo æ„å»º</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter=app-editor</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. å†æ„å»º Docker é•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/app-editor/Dockerfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_5-3-dockerignore-é…ç½®" tabindex="-1">5.3 .dockerignore é…ç½® <a class="header-anchor" href="#_5-3-dockerignore-é…ç½®" aria-label="Permalink to &quot;5.3 .dockerignore é…ç½®&quot;">â€‹</a></h3><p><strong>apps/app-editor/.dockerignoreï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># å¿½ç•¥å¼€å‘ä¾èµ–</span></span>
<span class="line"><span>node_modules</span></span>
<span class="line"><span>.pnpm-store</span></span>
<span class="line"><span></span></span>
<span class="line"><span># å¿½ç•¥æ„å»ºäº§ç‰©ï¼ˆå¦‚æœä½¿ç”¨é¢„æ„å»ºï¼‰</span></span>
<span class="line"><span># dist</span></span>
<span class="line"><span># .next</span></span>
<span class="line"><span></span></span>
<span class="line"><span># å¿½ç•¥å¼€å‘æ–‡ä»¶</span></span>
<span class="line"><span>.git</span></span>
<span class="line"><span>.gitignore</span></span>
<span class="line"><span>.env.local</span></span>
<span class="line"><span>.env.development</span></span>
<span class="line"><span></span></span>
<span class="line"><span># å¿½ç•¥æ–‡æ¡£å’Œæµ‹è¯•</span></span>
<span class="line"><span>*.md</span></span>
<span class="line"><span>*.test.ts</span></span>
<span class="line"><span>*.spec.ts</span></span>
<span class="line"><span>__tests__</span></span>
<span class="line"><span>coverage</span></span>
<span class="line"><span></span></span>
<span class="line"><span># å¿½ç•¥ IDE é…ç½®</span></span>
<span class="line"><span>.vscode</span></span>
<span class="line"><span>.idea</span></span>
<span class="line"><span>*.swp</span></span>
<span class="line"><span>*.swo</span></span>
<span class="line"><span></span></span>
<span class="line"><span># å¿½ç•¥æ—¥å¿—</span></span>
<span class="line"><span>*.log</span></span>
<span class="line"><span>npm-debug.log*</span></span>
<span class="line"><span>pnpm-debug.log*</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><hr><h2 id="å…­ã€æ„å»ºä¼˜åŒ–ç­–ç•¥" tabindex="-1">å…­ã€æ„å»ºä¼˜åŒ–ç­–ç•¥ <a class="header-anchor" href="#å…­ã€æ„å»ºä¼˜åŒ–ç­–ç•¥" aria-label="Permalink to &quot;å…­ã€æ„å»ºä¼˜åŒ–ç­–ç•¥&quot;">â€‹</a></h2><h3 id="_6-1-åˆ©ç”¨æ„å»ºç¼“å­˜" tabindex="-1">6.1 åˆ©ç”¨æ„å»ºç¼“å­˜ <a class="header-anchor" href="#_6-1-åˆ©ç”¨æ„å»ºç¼“å­˜" aria-label="Permalink to &quot;6.1 åˆ©ç”¨æ„å»ºç¼“å­˜&quot;">â€‹</a></h3><h4 id="docker-å±‚ç¼“å­˜" tabindex="-1">Docker å±‚ç¼“å­˜ <a class="header-anchor" href="#docker-å±‚ç¼“å­˜" aria-label="Permalink to &quot;Docker å±‚ç¼“å­˜&quot;">â€‹</a></h4><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># âŒ ä¸å¥½çš„åšæ³•ï¼šä¸€æ¬¡æ€§å¤åˆ¶æ‰€æœ‰æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . .</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># âœ… å¥½çš„åšæ³•ï¼šåˆ†å±‚å¤åˆ¶ï¼Œåˆ©ç”¨ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> package.json pnpm-lock.yaml ./</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm install</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="turbo-ç¼“å­˜" tabindex="-1">Turbo ç¼“å­˜ <a class="header-anchor" href="#turbo-ç¼“å­˜" aria-label="Permalink to &quot;Turbo ç¼“å­˜&quot;">â€‹</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è®¾ç½®è¿œç¨‹ç¼“å­˜ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter=app-editor</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cache-dir=.turbo-cache</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ Turborepo Remote Cache</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TURBO_TOKEN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">your-token</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TURBO_TEAM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">your-team</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_6-2-å¹¶è¡Œæ„å»º" tabindex="-1">6.2 å¹¶è¡Œæ„å»º <a class="header-anchor" href="#_6-2-å¹¶è¡Œæ„å»º" aria-label="Permalink to &quot;6.2 å¹¶è¡Œæ„å»º&quot;">â€‹</a></h3><p><strong>æ„å»ºå¤šä¸ªåº”ç”¨ï¼š</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¹¶è¡Œæ„å»ºæ‰€æœ‰åº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¹¶è¡Œæ„å»ºæŒ‡å®šåº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter=app-editor</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter=app-admin</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>å¹¶è¡Œæ„å»º Docker é•œåƒï¼š</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ Turbo å¹¶è¡Œæ„å»ºé•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker:build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æˆ–ä½¿ç”¨ Docker Compose</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --parallel</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_6-3-å‡å°é•œåƒä½“ç§¯" tabindex="-1">6.3 å‡å°é•œåƒä½“ç§¯ <a class="header-anchor" href="#_6-3-å‡å°é•œåƒä½“ç§¯" aria-label="Permalink to &quot;6.3 å‡å°é•œåƒä½“ç§¯&quot;">â€‹</a></h3><p><strong>æŠ€å·§ä¸€ï¼šä½¿ç”¨ Alpine åŸºç¡€é•œåƒ</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:18-alpine  # ä½“ç§¯å°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># vs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:18         # ä½“ç§¯å¤§</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>æŠ€å·§äºŒï¼šå¤šé˜¶æ®µæ„å»º</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»ºé˜¶æ®µä½¿ç”¨å®Œæ•´é•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:18 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿è¡Œé˜¶æ®µä½¿ç”¨ç²¾ç®€é•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:18-alpine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> runner</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/dist ./dist</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>æŠ€å·§ä¸‰ï¼šæ¸…ç†ç¼“å­˜</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm install --prod --frozen-lockfile \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; pnpm store prune \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; rm -rf /root/.pnpm-store</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>æŠ€å·§å››ï¼šåªå¤åˆ¶å¿…è¦æ–‡ä»¶</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åªå¤åˆ¶ç”Ÿäº§ä¾èµ–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=dependencies /app/node_modules ./node_modules</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åªå¤åˆ¶æ„å»ºäº§ç‰©</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/dist ./dist</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h2 id="ä¸ƒã€ci-cd-é›†æˆ" tabindex="-1">ä¸ƒã€CI/CD é›†æˆ <a class="header-anchor" href="#ä¸ƒã€ci-cd-é›†æˆ" aria-label="Permalink to &quot;ä¸ƒã€CI/CD é›†æˆ&quot;">â€‹</a></h2><h3 id="_7-1-github-actions-ç¤ºä¾‹" tabindex="-1">7.1 GitHub Actions ç¤ºä¾‹ <a class="header-anchor" href="#_7-1-github-actions-ç¤ºä¾‹" aria-label="Permalink to &quot;7.1 GitHub Actions ç¤ºä¾‹&quot;">â€‹</a></h3><p><strong>.github/workflows/docker-build.ymlï¼š</strong></p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Build Docker Images</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  pull_request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Checkout</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup Node.js</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;18&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Install pnpm</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Install dependencies</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm install --frozen-lockfile</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Build with Turbo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          TURBO_TOKEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.TURBO_TOKEN }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          TURBO_TEAM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.TURBO_TEAM }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Set up Docker Buildx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker/setup-buildx-action@v2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Login to Container Registry</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker/login-action@v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          registry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">registry.gaoding.com</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          username</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.DOCKER_USERNAME }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.DOCKER_PASSWORD }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Build and push Docker images</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          # è·å–å˜æ›´çš„åº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          CHANGED_APPS=$(pnpm turbo run docker:build --dry=json | jq -r &#39;.packages[]&#39;)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          # æ„å»ºæ¯ä¸ªå˜æ›´çš„åº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          for app in $CHANGED_APPS; do</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            echo &quot;Building $app...&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            pnpm turbo docker:build --filter=$app</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            # æ¨é€é•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            docker push registry.gaoding.com/$app:\${{ github.sha }}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            docker push registry.gaoding.com/$app:latest</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          done</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h3 id="_7-2-gitlab-ci-ç¤ºä¾‹" tabindex="-1">7.2 GitLab CI ç¤ºä¾‹ <a class="header-anchor" href="#_7-2-gitlab-ci-ç¤ºä¾‹" aria-label="Permalink to &quot;7.2 GitLab CI ç¤ºä¾‹&quot;">â€‹</a></h3><p><strong>.gitlab-ci.ymlï¼š</strong></p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">stages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">variables</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  DOCKER_DRIVER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">overlay2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  DOCKER_TLS_CERTDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/certs&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»ºåº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node:18</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node_modules/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.turbo/</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">npm install -g pnpm@8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm install --frozen-lockfile</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  artifacts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/*/dist/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/*/.next/</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    expire_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1 hour</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»º Docker é•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">docker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker:dind</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      for app in apps/*; do</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        app_name=$(basename $app)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        docker build -f $app/Dockerfile -t $CI_REGISTRY_IMAGE/$app_name:$CI_COMMIT_SHA .</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        docker push $CI_REGISTRY_IMAGE/$app_name:$CI_COMMIT_SHA</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      done</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  only</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tags</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><hr><h2 id="å…«ã€æœ¬åœ°å¼€å‘ä¸è°ƒè¯•" tabindex="-1">å…«ã€æœ¬åœ°å¼€å‘ä¸è°ƒè¯• <a class="header-anchor" href="#å…«ã€æœ¬åœ°å¼€å‘ä¸è°ƒè¯•" aria-label="Permalink to &quot;å…«ã€æœ¬åœ°å¼€å‘ä¸è°ƒè¯•&quot;">â€‹</a></h2><h3 id="_8-1-æœ¬åœ°æ„å»ºéªŒè¯" tabindex="-1">8.1 æœ¬åœ°æ„å»ºéªŒè¯ <a class="header-anchor" href="#_8-1-æœ¬åœ°æ„å»ºéªŒè¯" aria-label="Permalink to &quot;8.1 æœ¬åœ°æ„å»ºéªŒè¯&quot;">â€‹</a></h3><p><strong>æ­¥éª¤ä¸€ï¼šæ„å»ºåº”ç”¨</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»ºå•ä¸ªåº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter=app-editor</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥çœ‹æ„å»ºäº§ç‰©</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -la</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/app-editor/dist/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>æ­¥éª¤äºŒï¼šæ„å»ºé•œåƒ</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»º Docker é•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/app-editor/Dockerfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥çœ‹é•œåƒä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> images</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>æ­¥éª¤ä¸‰ï¼šè¿è¡Œå®¹å™¨</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿è¡Œå®¹å™¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3000:3000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æˆ–ä½¿ç”¨ docker-compose</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_8-2-docker-compose-é…ç½®" tabindex="-1">8.2 Docker Compose é…ç½® <a class="header-anchor" href="#_8-2-docker-compose-é…ç½®" aria-label="Permalink to &quot;8.2 Docker Compose é…ç½®&quot;">â€‹</a></h3><p><strong>docker-compose.ymlï¼š</strong></p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3.8&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  app-editor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      dockerfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/app-editor/Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3000:3000&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NODE_ENV=production</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DATABASE_URL=\${DATABASE_URL}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  app-admin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      dockerfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/app-admin/Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3001:3000&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NODE_ENV=production</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  postgres</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres:15-alpine</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">POSTGRES_PASSWORD=password</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres-data:/var/lib/postgresql/data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  postgres-data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><strong>ä½¿ç”¨ï¼š</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»ºæ‰€æœ‰æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯åŠ¨æ‰€æœ‰æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯åŠ¨ç‰¹å®šæœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åå°è¿è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_8-3-è°ƒè¯•æŠ€å·§" tabindex="-1">8.3 è°ƒè¯•æŠ€å·§ <a class="header-anchor" href="#_8-3-è°ƒè¯•æŠ€å·§" aria-label="Permalink to &quot;8.3 è°ƒè¯•æŠ€å·§&quot;">â€‹</a></h3><h4 id="æŸ¥çœ‹æ„å»ºè¿‡ç¨‹" tabindex="-1">æŸ¥çœ‹æ„å»ºè¿‡ç¨‹ <a class="header-anchor" href="#æŸ¥çœ‹æ„å»ºè¿‡ç¨‹" aria-label="Permalink to &quot;æŸ¥çœ‹æ„å»ºè¿‡ç¨‹&quot;">â€‹</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¯¦ç»†æ„å»ºæ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/app-editor/Dockerfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --progress=plain</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¸ä½¿ç”¨ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-cache</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/app-editor/Dockerfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="è¿›å…¥å®¹å™¨è°ƒè¯•" tabindex="-1">è¿›å…¥å®¹å™¨è°ƒè¯• <a class="header-anchor" href="#è¿›å…¥å®¹å™¨è°ƒè¯•" aria-label="Permalink to &quot;è¿›å…¥å®¹å™¨è°ƒè¯•&quot;">â€‹</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿è¡Œå®¹å™¨å¹¶è¿›å…¥ shell</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥çœ‹å®¹å™¨å†…æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -la</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">container-i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="åˆ†æé•œåƒå¤§å°" tabindex="-1">åˆ†æé•œåƒå¤§å° <a class="header-anchor" href="#åˆ†æé•œåƒå¤§å°" aria-label="Permalink to &quot;åˆ†æé•œåƒå¤§å°&quot;">â€‹</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥çœ‹é•œåƒå±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> history</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ†æé•œåƒå¤§å°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> images</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ dive å·¥å…·åˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dive</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-editor:dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><hr><h2 id="ä¹ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" tabindex="-1">ä¹ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ <a class="header-anchor" href="#ä¹ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" aria-label="Permalink to &quot;ä¹ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ&quot;">â€‹</a></h2><h3 id="_9-1-ä¾èµ–å®‰è£…é—®é¢˜" tabindex="-1">9.1 ä¾èµ–å®‰è£…é—®é¢˜ <a class="header-anchor" href="#_9-1-ä¾èµ–å®‰è£…é—®é¢˜" aria-label="Permalink to &quot;9.1 ä¾èµ–å®‰è£…é—®é¢˜&quot;">â€‹</a></h3><p><strong>é—®é¢˜ï¼š</strong> pnpm install åœ¨ Docker ä¸­å¤±è´¥</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ pnpm ç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm install -g pnpm@8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ frozen-lockfile ç¡®ä¿ä¸€è‡´æ€§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm install --frozen-lockfile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œé…ç½®é•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm config set registry https://registry.npmmirror.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_9-2-workspace-ä¾èµ–é—®é¢˜" tabindex="-1">9.2 workspace ä¾èµ–é—®é¢˜ <a class="header-anchor" href="#_9-2-workspace-ä¾èµ–é—®é¢˜" aria-label="Permalink to &quot;9.2 workspace ä¾èµ–é—®é¢˜&quot;">â€‹</a></h3><p><strong>é—®é¢˜ï¼š</strong> æ‰¾ä¸åˆ° workspace åŒ…</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¡®ä¿å¤åˆ¶äº† pnpm-workspace.yaml</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm-workspace.yaml ./</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¡®ä¿å¤åˆ¶äº†æ‰€æœ‰ä¾èµ–åŒ…çš„ package.json</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> packages/*/package.json ./packages/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¡®ä¿ workspace åè®®æ­£ç¡®</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># package.json ä¸­ä½¿ç”¨ &quot;workspace:*&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_9-3-æ„å»ºç¼“å­˜å¤±æ•ˆ" tabindex="-1">9.3 æ„å»ºç¼“å­˜å¤±æ•ˆ <a class="header-anchor" href="#_9-3-æ„å»ºç¼“å­˜å¤±æ•ˆ" aria-label="Permalink to &quot;9.3 æ„å»ºç¼“å­˜å¤±æ•ˆ&quot;">â€‹</a></h3><p><strong>é—®é¢˜ï¼š</strong> æ¯æ¬¡æ„å»ºéƒ½é‡æ–°å®‰è£…ä¾èµ–</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å…ˆå¤åˆ¶ä¾èµ–ç›¸å…³æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> package.json pnpm-lock.yaml ./</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®‰è£…ä¾èµ–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æœ€åå¤åˆ¶æºä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_9-4-é•œåƒä½“ç§¯è¿‡å¤§" tabindex="-1">9.4 é•œåƒä½“ç§¯è¿‡å¤§ <a class="header-anchor" href="#_9-4-é•œåƒä½“ç§¯è¿‡å¤§" aria-label="Permalink to &quot;9.4 é•œåƒä½“ç§¯è¿‡å¤§&quot;">â€‹</a></h3><p><strong>é—®é¢˜ï¼š</strong> é•œåƒä½“ç§¯è¶…è¿‡ 1GB</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>ä½¿ç”¨ Alpine åŸºç¡€é•œåƒ</li><li>ä½¿ç”¨å¤šé˜¶æ®µæ„å»º</li><li>åªå®‰è£…ç”Ÿäº§ä¾èµ–</li><li>æ¸…ç†æ„å»ºç¼“å­˜</li><li>ä½¿ç”¨ .dockerignore</li></ol><p><strong>ä¼˜åŒ–ç¤ºä¾‹ï¼š</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤šé˜¶æ®µæ„å»ºï¼Œåªä¿ç•™å¿…è¦æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:18-alpine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> runner</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/dist ./dist</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=dependencies /app/node_modules ./node_modules</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rm -rf /usr/local/lib/node_modules/npm</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr><h2 id="åã€æœ€ä½³å®è·µæ€»ç»“" tabindex="-1">åã€æœ€ä½³å®è·µæ€»ç»“ <a class="header-anchor" href="#åã€æœ€ä½³å®è·µæ€»ç»“" aria-label="Permalink to &quot;åã€æœ€ä½³å®è·µæ€»ç»“&quot;">â€‹</a></h2><h3 id="_10-1-æ„å»ºæµç¨‹æœ€ä½³å®è·µ" tabindex="-1">10.1 æ„å»ºæµç¨‹æœ€ä½³å®è·µ <a class="header-anchor" href="#_10-1-æ„å»ºæµç¨‹æœ€ä½³å®è·µ" aria-label="Permalink to &quot;10.1 æ„å»ºæµç¨‹æœ€ä½³å®è·µ&quot;">â€‹</a></h3><p><strong>Doï¼š</strong></p><ul><li>âœ… ä½¿ç”¨é¢„æ„å»ºç­–ç•¥ï¼Œåˆ©ç”¨ Turbo ç¼“å­˜</li><li>âœ… æ¯ä¸ªåº”ç”¨ç‹¬ç«‹ Dockerfile</li><li>âœ… ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°é•œåƒä½“ç§¯</li><li>âœ… åˆ©ç”¨ Docker å±‚ç¼“å­˜</li><li>âœ… é…ç½® .dockerignore æ’é™¤ä¸å¿…è¦æ–‡ä»¶</li></ul><p><strong>Don&#39;tï¼š</strong></p><ul><li>âŒ åœ¨ Docker ä¸­å®‰è£…å¼€å‘ä¾èµ–</li><li>âŒ ä¸€æ¬¡æ€§å¤åˆ¶æ‰€æœ‰æ–‡ä»¶</li><li>âŒ ä½¿ç”¨è¿‡å¤§çš„åŸºç¡€é•œåƒ</li><li>âŒ å¿½ç•¥å®‰å…¨æœ€ä½³å®è·µï¼ˆå¦‚ä½¿ç”¨ root ç”¨æˆ·ï¼‰</li></ul><h3 id="_10-2-æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ" tabindex="-1">10.2 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ <a class="header-anchor" href="#_10-2-æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ" aria-label="Permalink to &quot;10.2 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ&quot;">â€‹</a></h3><p><strong>æ„å»ºæ€§èƒ½ï¼š</strong></p><ul><li>åˆ©ç”¨ Turbo ç¼“å­˜åŠ é€Ÿæ„å»º</li><li>å¹¶è¡Œæ„å»ºå¤šä¸ªåº”ç”¨</li><li>ä½¿ç”¨ Docker Buildx ç¼“å­˜</li></ul><p><strong>è¿è¡Œæ€§èƒ½ï¼š</strong></p><ul><li>ä½¿ç”¨ç”Ÿäº§æ¨¡å¼è¿è¡Œ</li><li>é…ç½®åˆç†çš„èµ„æºé™åˆ¶</li><li>ä½¿ç”¨å¥åº·æ£€æŸ¥</li></ul><p><strong>é•œåƒå¤§å°ï¼š</strong></p><ul><li>ä½¿ç”¨ Alpine é•œåƒ</li><li>åªå®‰è£…å¿…è¦ä¾èµ–</li><li>æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œç¼“å­˜</li></ul><h3 id="_10-3-å®‰å…¨æœ€ä½³å®è·µ" tabindex="-1">10.3 å®‰å…¨æœ€ä½³å®è·µ <a class="header-anchor" href="#_10-3-å®‰å…¨æœ€ä½³å®è·µ" aria-label="Permalink to &quot;10.3 å®‰å…¨æœ€ä½³å®è·µ&quot;">â€‹</a></h3><p><strong>Doï¼š</strong></p><ul><li>âœ… ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œ</li><li>âœ… æ‰«æé•œåƒæ¼æ´</li><li>âœ… ä½¿ç”¨æœ€æ–°çš„åŸºç¡€é•œåƒ</li><li>âœ… ä¸åœ¨é•œåƒä¸­åŒ…å«æ•æ„Ÿä¿¡æ¯</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºé root ç”¨æˆ·</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> addgroup --system --gid 1001 nodejs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adduser --system --uid 1001 nextjs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nextjs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¥åº·æ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HEALTHCHECK</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --interval=30s --timeout=3s \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node healthcheck.js</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h2 id="åä¸€ã€å‚è€ƒèµ„æº" tabindex="-1">åä¸€ã€å‚è€ƒèµ„æº <a class="header-anchor" href="#åä¸€ã€å‚è€ƒèµ„æº" aria-label="Permalink to &quot;åä¸€ã€å‚è€ƒèµ„æº&quot;">â€‹</a></h2><h3 id="_11-1-å®˜æ–¹æ–‡æ¡£" tabindex="-1">11.1 å®˜æ–¹æ–‡æ¡£ <a class="header-anchor" href="#_11-1-å®˜æ–¹æ–‡æ¡£" aria-label="Permalink to &quot;11.1 å®˜æ–¹æ–‡æ¡£&quot;">â€‹</a></h3><ul><li><strong>pnpm</strong>ï¼š<a href="https://pnpm.io/" target="_blank" rel="noreferrer">https://pnpm.io/</a></li><li><strong>Turborepo</strong>ï¼š<a href="https://turbo.build/repo" target="_blank" rel="noreferrer">https://turbo.build/repo</a></li><li><strong>Docker</strong>ï¼š<a href="https://docs.docker.com/" target="_blank" rel="noreferrer">https://docs.docker.com/</a></li></ul><h3 id="_11-2-æœ€ä½³å®è·µæŒ‡å—" tabindex="-1">11.2 æœ€ä½³å®è·µæŒ‡å— <a class="header-anchor" href="#_11-2-æœ€ä½³å®è·µæŒ‡å—" aria-label="Permalink to &quot;11.2 æœ€ä½³å®è·µæŒ‡å—&quot;">â€‹</a></h3><ul><li><strong>Docker å¤šé˜¶æ®µæ„å»º</strong>ï¼š<a href="https://docs.docker.com/build/building/multi-stage/" target="_blank" rel="noreferrer">https://docs.docker.com/build/building/multi-stage/</a></li><li><strong>Node.js Docker æœ€ä½³å®è·µ</strong>ï¼š<a href="https://github.com/nodejs/docker-node/blob/main/docs/BestPractices.md" target="_blank" rel="noreferrer">https://github.com/nodejs/docker-node/blob/main/docs/BestPractices.md</a></li><li><strong>Monorepo Docker æ„å»º</strong>ï¼š<a href="https://turbo.build/repo/docs/handbook/deploying-with-docker" target="_blank" rel="noreferrer">https://turbo.build/repo/docs/handbook/deploying-with-docker</a></li></ul><h3 id="_11-3-å·¥å…·æ¨è" tabindex="-1">11.3 å·¥å…·æ¨è <a class="header-anchor" href="#_11-3-å·¥å…·æ¨è" aria-label="Permalink to &quot;11.3 å·¥å…·æ¨è&quot;">â€‹</a></h3><ul><li><strong>dive</strong>ï¼šDocker é•œåƒåˆ†æå·¥å…·</li><li><strong>hadolint</strong>ï¼šDockerfile linter</li><li><strong>docker-slim</strong>ï¼šé•œåƒä¼˜åŒ–å·¥å…·</li></ul><hr><h2 id="åäºŒã€æ€»ç»“" tabindex="-1">åäºŒã€æ€»ç»“ <a class="header-anchor" href="#åäºŒã€æ€»ç»“" aria-label="Permalink to &quot;åäºŒã€æ€»ç»“&quot;">â€‹</a></h2><h3 id="_12-1-æ ¸å¿ƒè¦ç‚¹" tabindex="-1">12.1 æ ¸å¿ƒè¦ç‚¹ <a class="header-anchor" href="#_12-1-æ ¸å¿ƒè¦ç‚¹" aria-label="Permalink to &quot;12.1 æ ¸å¿ƒè¦ç‚¹&quot;">â€‹</a></h3><ol><li><strong>é¢„æ„å»ºç­–ç•¥</strong>ï¼šåˆ©ç”¨ Turbo å…ˆæ„å»ºï¼Œå†æ‰“åŒ…åˆ° Docker</li><li><strong>ç‹¬ç«‹ Dockerfile</strong>ï¼šæ¯ä¸ªåº”ç”¨æœ‰è‡ªå·±çš„ Dockerfile</li><li><strong>å¤šé˜¶æ®µæ„å»º</strong>ï¼šåˆ†ç¦»æ„å»ºå’Œè¿è¡Œç¯å¢ƒ</li><li><strong>å……åˆ†ç¼“å­˜</strong>ï¼šåˆ©ç”¨ Turbo å’Œ Docker çš„ç¼“å­˜æœºåˆ¶</li></ol><h3 id="_12-2-å·¥ä½œæµç¨‹" tabindex="-1">12.2 å·¥ä½œæµç¨‹ <a class="header-anchor" href="#_12-2-å·¥ä½œæµç¨‹" aria-label="Permalink to &quot;12.2 å·¥ä½œæµç¨‹&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. pnpm install          # å®‰è£…ä¾èµ–</span></span>
<span class="line"><span>   â†“</span></span>
<span class="line"><span>2. pnpm turbo build      # Turbo æ„å»ºï¼ˆå¸¦ç¼“å­˜ï¼‰</span></span>
<span class="line"><span>   â†“</span></span>
<span class="line"><span>3. docker build          # æ„å»ºé•œåƒï¼ˆåªæ‰“åŒ…äº§ç‰©ï¼‰</span></span>
<span class="line"><span>   â†“</span></span>
<span class="line"><span>4. docker push           # æ¨é€é•œåƒ</span></span>
<span class="line"><span>   â†“</span></span>
<span class="line"><span>5. éƒ¨ç½²è¿è¡Œ              # åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_12-3-é¢„æœŸæ”¶ç›Š" tabindex="-1">12.3 é¢„æœŸæ”¶ç›Š <a class="header-anchor" href="#_12-3-é¢„æœŸæ”¶ç›Š" aria-label="Permalink to &quot;12.3 é¢„æœŸæ”¶ç›Š&quot;">â€‹</a></h3><p><strong>æ•ˆç‡æå‡ï¼š</strong></p><ul><li>Turbo ç¼“å­˜åŠ é€Ÿæ„å»º</li><li>Docker å±‚ç¼“å­˜å‡å°‘é‡å¤å·¥ä½œ</li><li>å¹¶è¡Œæ„å»ºæé«˜ååé‡</li></ul><p><strong>æˆæœ¬é™ä½ï¼š</strong></p><ul><li>é•œåƒä½“ç§¯æ›´å°ï¼Œå­˜å‚¨æˆæœ¬é™ä½</li><li>æ„å»ºæ—¶é—´æ›´çŸ­ï¼ŒCI/CD æˆæœ¬é™ä½</li><li>ç»Ÿä¸€æµç¨‹ï¼Œç»´æŠ¤æˆæœ¬é™ä½</li></ul><p><strong>è´¨é‡ä¿éšœï¼š</strong></p><ul><li>ä¸€è‡´çš„æ„å»ºæµç¨‹</li><li>å¯é‡å¤çš„æ„å»ºç»“æœ</li><li>æ›´å¥½çš„è°ƒè¯•ä½“éªŒ</li></ul><hr><p><em>æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0</em><br><em>æœ€åæ›´æ–°ï¼š2025-01-25</em><br><em>åŸºäº AI å»ºè®®å’Œæœ€ä½³å®è·µæ•´ç†</em></p>`,149))])}const C=l(c,[["render",b]]);export{F as __pageData,C as default};
