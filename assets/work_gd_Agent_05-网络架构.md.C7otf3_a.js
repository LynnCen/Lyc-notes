import{_ as r,C as k,c as E,o as i,a7 as n,b as p,w as a,a as e,G as t,a9 as h}from"./chunks/framework.BQb8NfN9.js";const m=JSON.parse('{"title":"ç½‘ç»œæ¶æ„æ·±å…¥åŸç†","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/Agent/05-ç½‘ç»œæ¶æ„.md","filePath":"work/gd/Agent/05-ç½‘ç»œæ¶æ„.md","lastUpdated":1770085732000}'),d={name:"work/gd/Agent/05-ç½‘ç»œæ¶æ„.md"};function g(o,s,c,b,y,u){const l=k("Mermaid");return i(),E("div",null,[s[3]||(s[3]=n(`<h1 id="ç½‘ç»œæ¶æ„æ·±å…¥åŸç†" tabindex="-1">ç½‘ç»œæ¶æ„æ·±å…¥åŸç† <a class="header-anchor" href="#ç½‘ç»œæ¶æ„æ·±å…¥åŸç†" aria-label="Permalink to &quot;ç½‘ç»œæ¶æ„æ·±å…¥åŸç†&quot;">â€‹</a></h1><blockquote><p><strong>ä»ç³»ç»Ÿè®¾è®¡ç†è§£åˆ†å±‚æ¶æ„çš„æœ¬è´¨</strong></p></blockquote><hr><h2 id="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·çš„æ¶æ„" tabindex="-1">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·çš„æ¶æ„ï¼Ÿ <a class="header-anchor" href="#ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·çš„æ¶æ„" aria-label="Permalink to &quot;ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·çš„æ¶æ„ï¼Ÿ&quot;">â€‹</a></h2><h3 id="_1-1-ä»å•ä½“åˆ°åˆ†å±‚" tabindex="-1">1.1 ä»å•ä½“åˆ°åˆ†å±‚ <a class="header-anchor" href="#_1-1-ä»å•ä½“åˆ°åˆ†å±‚" aria-label="Permalink to &quot;1.1 ä»å•ä½“åˆ°åˆ†å±‚&quot;">â€‹</a></h3><p><strong>ä¼ ç»Ÿå•ä½“æ¶æ„çš„é—®é¢˜</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  å•ä½“ Agent æœåŠ¡              â”‚</span></span>
<span class="line"><span>â”‚  - å¤„ç†ç”¨æˆ·è¯·æ±‚               â”‚</span></span>
<span class="line"><span>â”‚  - è°ƒç”¨ LLM                  â”‚</span></span>
<span class="line"><span>â”‚  - è°ƒç”¨å·¥å…·                  â”‚</span></span>
<span class="line"><span>â”‚  - é•¿è¿æ¥ç®¡ç†                â”‚</span></span>
<span class="line"><span>â”‚  - çŸ­è¿æ¥å¤„ç†                â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>é—®é¢˜</strong>ï¼š</p><ol><li><strong>èµ„æºç«äº‰</strong>ï¼šé•¿è¿æ¥å’ŒçŸ­è¿æ¥äº‰æŠ¢èµ„æº</li><li><strong>æ‰©å±•å›°éš¾</strong>ï¼šæ— æ³•é’ˆå¯¹ä¸åŒåœºæ™¯ç‹¬ç«‹æ‰©å®¹</li><li><strong>æ•…éšœä¼ å¯¼</strong>ï¼šä¸€ä¸ªæ¨¡å—æ•…éšœå½±å“å…¨å±€</li><li><strong>è¶…æ—¶å†²çª</strong>ï¼šé•¿çŸ­è¿æ¥éœ€è¦ä¸åŒçš„è¶…æ—¶é…ç½®</li></ol><h3 id="_1-2-åˆ†å±‚æ¶æ„çš„è®¾è®¡æ€æƒ³" tabindex="-1">1.2 åˆ†å±‚æ¶æ„çš„è®¾è®¡æ€æƒ³ <a class="header-anchor" href="#_1-2-åˆ†å±‚æ¶æ„çš„è®¾è®¡æ€æƒ³" aria-label="Permalink to &quot;1.2 åˆ†å±‚æ¶æ„çš„è®¾è®¡æ€æƒ³&quot;">â€‹</a></h3><blockquote><p>ğŸ’¡ <strong>æ ¸å¿ƒæ´å¯Ÿ</strong><br> åˆ†å±‚æ¶æ„çš„æœ¬è´¨æ˜¯ï¼š<strong>æŒ‰ç…§èŒè´£å’Œç‰¹æ€§è¿›è¡Œå‚ç›´æ‹†åˆ†ï¼ŒæŒ‰ç…§è´Ÿè½½ç‰¹å¾è¿›è¡Œæ°´å¹³éš”ç¦»</strong>ã€‚</p></blockquote><p><strong>è®¾è®¡åŸåˆ™</strong>ï¼š</p><ol><li><p><strong>èŒè´£åˆ†ç¦»</strong><br> ç½‘å…³ã€æœåŠ¡ã€AI èƒ½åŠ›ã€LLM å„å¸å…¶èŒ</p></li><li><p><strong>ç‰¹æ€§éš”ç¦»</strong><br> é•¿è¿æ¥å’ŒçŸ­è¿æ¥é›†ç¾¤ç‰©ç†éš”ç¦»</p></li><li><p><strong>ç»Ÿä¸€æ¥å…¥</strong><br> AI Gateway ç»Ÿä¸€ LLM æ¥å…¥</p></li><li><p><strong>å¼¹æ€§æ‰©å±•</strong><br> æ¯å±‚ç‹¬ç«‹æ‰©ç¼©å®¹</p></li></ol><hr><h2 id="äºŒã€æ•´ä½“æ¶æ„è§£æ" tabindex="-1">äºŒã€æ•´ä½“æ¶æ„è§£æ <a class="header-anchor" href="#äºŒã€æ•´ä½“æ¶æ„è§£æ" aria-label="Permalink to &quot;äºŒã€æ•´ä½“æ¶æ„è§£æ&quot;">â€‹</a></h2><h3 id="_2-1-å®Œæ•´æ¶æ„å›¾" tabindex="-1">2.1 å®Œæ•´æ¶æ„å›¾ <a class="header-anchor" href="#_2-1-å®Œæ•´æ¶æ„å›¾" aria-label="Permalink to &quot;2.1 å®Œæ•´æ¶æ„å›¾&quot;">â€‹</a></h3>`,16)),(i(),p(h,null,{default:a(()=>[t(l,{id:"mermaid-84",class:"mermaid",graph:"graph%20TD%0Asubgraph%20%22%E7%9F%AD%E8%BF%9E%E6%8E%A5%E9%AB%98%20QPS%20%E6%9C%8D%E5%8A%A1%EF%BC%8C%E9%BB%98%E8%AE%A4%E9%9B%86%E7%BE%A4%22%0Adirection%20TB%0Asubgraph%20%22%E7%9F%AD%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%22%0Agdesign-tool%5B%22gdesign-tool%0A(%E7%9F%AD%E8%BF%9E%E6%8E%A5%2C%20%E9%AB%98%20QPS)%0A%22%5D%0Alightboat%5B%22%E8%BD%BB%E8%88%9F%0A(%E7%9F%AD%E8%BF%9E%E6%8E%A5%2C%20%E9%AB%98%20QPS)%22%5D%0Acrc%5B%22CRC%0A(%E7%9F%AD%E8%BF%9E%E6%8E%A5%2C%20%E9%AB%98%20QPS)%22%5D%0Aend%0Aend%0A%0Asubgraph%20%22%E9%9D%A2%E5%90%91%20Agent%20%E4%B8%9A%E5%8A%A1%E7%9A%84%E9%9B%86%E7%BE%A4%22%0Adirection%20TB%0A%0Aagent%5B%22Agent%20%E6%9C%8D%E5%8A%A1%22%5D%0Agdesign-tool-async%5B%22gdesign-tool%0A(%E9%95%BF%E8%BF%9E%E6%8E%A5%E9%9B%86%E7%BE%A4)%0AAgent%20%E5%B7%A5%E5%85%B7%E6%9C%8D%E5%8A%A1%22%5D%0Aend%0A%0Asubgraph%20%22AI%20%E8%83%BD%E5%8A%9B%E5%AF%B9%E6%8E%A5%E5%B1%82%22%0Adirection%20TB%0A%0Aai-gateway%5B%22AI%20Gateway%0A(LLM%20%E7%BD%91%E5%85%B3)%22%5D%0A%0Adify%5B%22Dify%20%E5%BA%94%E7%94%A8%E5%B9%B3%E5%8F%B0%22%5D%0Aend%0A%0Asubgraph%20%22%20%22%0A%0Asubgraph%20%22LLM%20%E5%B9%B3%E5%8F%B0%22%0Avolc%5B%22%E7%81%AB%E5%B1%B1%E5%BC%95%E6%93%8E%22%5D%0Aali%5B%22%E9%98%BF%E9%87%8C%E7%99%BE%E7%82%BC%22%5D%0Aplatform%5B%22%E5%85%B6%E4%BB%96%E5%B9%B3%E5%8F%B0%22%5D%0Aend%0A%0Asubgraph%20%22%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%9E%8B%22%0Adoubao%5B%22Doubao%22%5D%0Aqwen%5B%22Qwen%22%5D%0Amodel%5B%22%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9E%8B%22%5D%0Aend%0Aend%0A%0Asubgraph%20%22%E7%BD%91%E5%85%B3%E5%B1%82%22%0Akong%5B%22Kong%20%E7%BD%91%E5%85%B3%0A(%E7%9F%AD%E8%BF%9E%E6%8E%A5)%22%5D%0Akong-sse%5B%22Kong%20%E7%BD%91%E5%85%B3%0A(SSE%20%E4%B8%93%E7%94%A8%2C%20%E9%95%BF%E8%BF%9E%E6%8E%A5)%22%5D%0Aend%0A%0A%25%25%20%E7%9F%AD%E8%BF%9E%E6%8E%A5%E9%93%BE%E8%B7%AF%0Akong%20--%3E%7C%E7%9F%AD%E8%BF%9E%E6%8E%A5%0A%E8%B6%85%E6%97%B6%3A%2060s%0A%E9%AB%98%20QPS%7C%20gdesign-tool%0Agdesign-tool%20--%3E%7C%E8%B0%83%E7%94%A8%7C%20lightboat%0Agdesign-tool%20--%3E%7C%E8%B0%83%E7%94%A8%7C%20crc%0Agdesign-tool%20--%3E%7C%E8%B0%83%E7%94%A8%7C%20dify%0A%0A%25%25%20%E9%95%BF%E8%BF%9E%E6%8E%A5%E9%93%BE%E8%B7%AF%0Akong-sse%20--%3E%7C%E9%95%BF%E8%BF%9E%E6%8E%A5%0A%E8%B6%85%E6%97%B6%3A%2015mins%0ASSE%7C%20agent%0Aagent%20--%3E%7C%E9%95%BF%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86%0A%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%7C%20gdesign-tool-async%0Agdesign-tool-async%20--%3E%7C%E8%B0%83%E7%94%A8%7C%20dify%0Agdesign-tool-async%20--%3E%7C%E8%B0%83%E7%94%A8%7C%20lightboat%0A%0A%25%25%20LLM%E8%B0%83%E7%94%A8%E9%93%BE%E8%B7%AF%0Adify%20--%3E%7C%E8%B7%AF%E7%94%B1%7C%20ai-gateway%0Aai-gateway%20--%3E%7C%E6%A8%A1%E5%9E%8B%E8%B7%AF%E7%94%B1%7C%20volc%0Aai-gateway%20--%3E%7C%E6%A8%A1%E5%9E%8B%E8%B7%AF%E7%94%B1%7C%20ali%0Aai-gateway%20--%3E%7C%E6%A8%A1%E5%9E%8B%E8%B7%AF%E7%94%B1%7C%20platform%0Avolc%20--%3E%7C%E5%BA%95%E5%B1%82%E6%A8%A1%E5%9E%8B%7C%20doubao%0Aali%20--%3E%7C%E5%BA%95%E5%B1%82%E6%A8%A1%E5%9E%8B%7C%20qwen%0Aplatform%20--%3E%7C%E5%BA%95%E5%B1%82%E6%A8%A1%E5%9E%8B%7C%20model%0A%0Aagent%20--%3E%7C%E9%95%BF%E6%97%B6%E5%A4%84%E7%90%86%0ALLM%20%E8%B0%83%E7%94%A8%7C%20ai-gateway%0A%0AclassDef%20shortConnection%20fill%3A%23e8f5e8%2Cstroke%3A%234caf50%0AclassDef%20longConnection%20fill%3A%23fff3e0%2Cstroke%3A%23ff9800%0AclassDef%20gateway%20fill%3A%23e3f2fd%2Cstroke%3A%232196f3%0AclassDef%20mainEntry%20fill%3A%23e8f5e8%2Cstroke%3A%23ff5722%2Cstroke-width%3A2px%0AclassDef%20platformService%20fill%3A%23f3e5f5%2Cstroke%3A%239c27b0%0AclassDef%20llmService%20fill%3A%23f3f3f3%2Cstroke%3A%23a3a3a3%0A%0Aclass%20lightboat%2Ccrc%20shortConnection%0Aclass%20agent%20longConnection%0Aclass%20kong%2Ckong-sse%20gateway%0Aclass%20gdesign-tool%2Cgdesign-tool-async%20mainEntry%0Aclass%20dify%2Cai-gateway%20platformService%0Aclass%20volc%2Cali%2Cplatform%2Cdoubao%2Cqwen%2Cmodel%20llmService%0A"})]),fallback:a(()=>s[0]||(s[0]=[e(" Loading... ")])),_:1})),s[4]||(s[4]=n(`<h3 id="_2-2-ä¸ºä»€ä¹ˆæ˜¯å››å±‚æ¶æ„" tabindex="-1">2.2 ä¸ºä»€ä¹ˆæ˜¯å››å±‚æ¶æ„ï¼Ÿ <a class="header-anchor" href="#_2-2-ä¸ºä»€ä¹ˆæ˜¯å››å±‚æ¶æ„" aria-label="Permalink to &quot;2.2 ä¸ºä»€ä¹ˆæ˜¯å››å±‚æ¶æ„ï¼Ÿ&quot;">â€‹</a></h3><p><strong>Layer 1: ç½‘å…³å±‚</strong></p><ul><li><strong>èŒè´£</strong>ï¼šæµé‡å…¥å£ã€è·¯ç”±è½¬å‘ã€åè®®è½¬æ¢</li><li><strong>ä»·å€¼</strong>ï¼šç»Ÿä¸€å…¥å£ã€å®‰å…¨æ§åˆ¶ã€æµé‡æ²»ç†</li></ul><p><strong>Layer 2: æœåŠ¡å±‚</strong></p><ul><li><strong>èŒè´£</strong>ï¼šä¸šåŠ¡é€»è¾‘ã€çŠ¶æ€ç®¡ç†ã€å·¥å…·ç¼–æ’</li><li><strong>ä»·å€¼</strong>ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€å¯ç‹¬ç«‹æ¼”è¿›</li></ul><p><strong>Layer 3: AI èƒ½åŠ›å±‚</strong></p><ul><li><strong>èŒè´£</strong>ï¼šLLM æ¥å…¥ã€åº”ç”¨ç¼–æ’ã€èƒ½åŠ›å°è£…</li><li><strong>ä»·å€¼</strong>ï¼šæŠ½è±¡ AI èƒ½åŠ›ã€å±è”½å¹³å°å·®å¼‚</li></ul><p><strong>Layer 4: LLM å¹³å°å±‚</strong></p><ul><li><strong>èŒè´£</strong>ï¼šæä¾›åŸºç¡€æ¨¡å‹èƒ½åŠ›</li><li><strong>ä»·å€¼</strong>ï¼šå¤šæ¨¡å‹æ”¯æŒã€æˆæœ¬ä¼˜åŒ–</li></ul><hr><h2 id="ä¸‰ã€å…³é”®è®¾è®¡å†³ç­–æ·±åº¦è§£æ" tabindex="-1">ä¸‰ã€å…³é”®è®¾è®¡å†³ç­–æ·±åº¦è§£æ <a class="header-anchor" href="#ä¸‰ã€å…³é”®è®¾è®¡å†³ç­–æ·±åº¦è§£æ" aria-label="Permalink to &quot;ä¸‰ã€å…³é”®è®¾è®¡å†³ç­–æ·±åº¦è§£æ&quot;">â€‹</a></h2><h3 id="_3-1-ä¸ºä»€ä¹ˆåˆ†ç¦»çŸ­è¿æ¥å’Œé•¿è¿æ¥é›†ç¾¤" tabindex="-1">3.1 ä¸ºä»€ä¹ˆåˆ†ç¦»çŸ­è¿æ¥å’Œé•¿è¿æ¥é›†ç¾¤ï¼Ÿ <a class="header-anchor" href="#_3-1-ä¸ºä»€ä¹ˆåˆ†ç¦»çŸ­è¿æ¥å’Œé•¿è¿æ¥é›†ç¾¤" aria-label="Permalink to &quot;3.1 ä¸ºä»€ä¹ˆåˆ†ç¦»çŸ­è¿æ¥å’Œé•¿è¿æ¥é›†ç¾¤ï¼Ÿ&quot;">â€‹</a></h3><h4 id="è´Ÿè½½ç‰¹æ€§å¯¹æ¯”" tabindex="-1">è´Ÿè½½ç‰¹æ€§å¯¹æ¯” <a class="header-anchor" href="#è´Ÿè½½ç‰¹æ€§å¯¹æ¯”" aria-label="Permalink to &quot;è´Ÿè½½ç‰¹æ€§å¯¹æ¯”&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>ç»´åº¦</th><th>çŸ­è¿æ¥</th><th>é•¿è¿æ¥ (SSE)</th></tr></thead><tbody><tr><td><strong>QPS</strong></td><td>é«˜ï¼ˆ1000+ï¼‰</td><td>ä½ï¼ˆ10-100ï¼‰</td></tr><tr><td><strong>è¿æ¥æ—¶é•¿</strong></td><td>ç§’çº§</td><td>åˆ†é’Ÿçº§ï¼ˆæœ€é•¿15åˆ†é’Ÿï¼‰</td></tr><tr><td><strong>èµ„æºå ç”¨</strong></td><td>ä½ï¼ˆå¿«é€Ÿé‡Šæ”¾ï¼‰</td><td>é«˜ï¼ˆé•¿æ—¶æŒæœ‰ï¼‰</td></tr><tr><td><strong>å¹¶å‘æ•°</strong></td><td>é«˜</td><td>ä½</td></tr><tr><td><strong>è¶…æ—¶é…ç½®</strong></td><td>60s</td><td>15mins</td></tr><tr><td><strong>å…¸å‹åœºæ™¯</strong></td><td>çŠ¶æ€æŸ¥è¯¢ã€å¿«é€Ÿå·¥å…·è°ƒç”¨</td><td>å¤æ‚å¯¹è¯ã€æµå¼ç”Ÿæˆ</td></tr></tbody></table><h4 id="ä¸åˆ†ç¦»çš„é—®é¢˜" tabindex="-1">ä¸åˆ†ç¦»çš„é—®é¢˜ <a class="header-anchor" href="#ä¸åˆ†ç¦»çš„é—®é¢˜" aria-label="Permalink to &quot;ä¸åˆ†ç¦»çš„é—®é¢˜&quot;">â€‹</a></h4><p><strong>é—®é¢˜ 1ï¼šè¿æ¥èµ„æºè€—å°½</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å‡è®¾æœåŠ¡å™¨æœ€å¤§è¿æ¥æ•° = 10,000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æƒ…å†µ Aï¼ˆæ··åˆéƒ¨ç½²ï¼‰ï¼š</span></span>
<span class="line"><span>- çŸ­è¿æ¥è¯·æ±‚ï¼šQPS 1000ï¼Œæ¯ä¸ªæŒç»­ 0.1s</span></span>
<span class="line"><span>- é•¿è¿æ¥è¯·æ±‚ï¼šQPS 10ï¼Œæ¯ä¸ªæŒç»­ 300sï¼ˆ5åˆ†é’Ÿï¼‰</span></span>
<span class="line"><span>- é•¿è¿æ¥å ç”¨ï¼š10 * 300 = 3,000 è¿æ¥</span></span>
<span class="line"><span>- çŸ­è¿æ¥å¯ç”¨ï¼š7,000 è¿æ¥</span></span>
<span class="line"><span>- çŸ­è¿æ¥ QPS ä¸Šé™ï¼š7,000 / 0.1 = 700 QPS âŒ</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æƒ…å†µ Bï¼ˆé›†ç¾¤éš”ç¦»ï¼‰ï¼š</span></span>
<span class="line"><span>- çŸ­è¿æ¥é›†ç¾¤ï¼š10,000 è¿æ¥ â†’ æ”¯æŒ 1000 QPS âœ…</span></span>
<span class="line"><span>- é•¿è¿æ¥é›†ç¾¤ï¼š1,000 è¿æ¥ â†’ æ”¯æŒ 10 QPS âœ…</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>é—®é¢˜ 2ï¼šCPU/å†…å­˜èµ„æºäº‰æŠ¢</strong></p><p>é•¿è¿æ¥ä»»åŠ¡é€šå¸¸æ¶‰åŠï¼š</p><ul><li>å¤šæ¬¡ LLM è°ƒç”¨</li><li>å¤šæ¬¡å·¥å…·è°ƒç”¨</li><li>å¤æ‚çš„çŠ¶æ€ç®¡ç†</li></ul><p>è¿™ä¼šå ç”¨å¤§é‡ CPU å’Œå†…å­˜ï¼Œå½±å“çŸ­è¿æ¥çš„å¿«é€Ÿå“åº”ã€‚</p><h4 id="éš”ç¦»çš„æ”¶ç›Š" tabindex="-1">éš”ç¦»çš„æ”¶ç›Š <a class="header-anchor" href="#éš”ç¦»çš„æ”¶ç›Š" aria-label="Permalink to &quot;éš”ç¦»çš„æ”¶ç›Š&quot;">â€‹</a></h4><ol><li><p><strong>èµ„æºéš”ç¦»</strong><br> å„è‡ªç‹¬ç«‹çš„èµ„æºæ± ï¼Œäº’ä¸å½±å“</p></li><li><p><strong>ç‹¬ç«‹æ‰©å®¹</strong><br> æ ¹æ®è´Ÿè½½ç‰¹æ€§ç‹¬ç«‹æ‰©ç¼©å®¹</p></li><li><p><strong>æ•…éšœéš”ç¦»</strong><br> é•¿è¿æ¥é›†ç¾¤æ•…éšœä¸å½±å“çŸ­è¿æ¥</p></li><li><p><strong>ç›‘æ§ç‹¬ç«‹</strong><br> ä¸åŒçš„ç›‘æ§ç­–ç•¥å’Œå‘Šè­¦è§„åˆ™</p></li></ol><h3 id="_3-2-ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ª-kong-ç½‘å…³" tabindex="-1">3.2 ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ª Kong ç½‘å…³ï¼Ÿ <a class="header-anchor" href="#_3-2-ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ª-kong-ç½‘å…³" aria-label="Permalink to &quot;3.2 ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ª Kong ç½‘å…³ï¼Ÿ&quot;">â€‹</a></h3><h4 id="sse-çš„ç‰¹æ®Šæ€§" tabindex="-1">SSE çš„ç‰¹æ®Šæ€§ <a class="header-anchor" href="#sse-çš„ç‰¹æ®Šæ€§" aria-label="Permalink to &quot;SSE çš„ç‰¹æ®Šæ€§&quot;">â€‹</a></h4><p><strong>Server-Sent Events (SSE)</strong> æ˜¯ä¸€ç§ç‰¹æ®Šçš„ HTTP é•¿è¿æ¥ï¼š</p><div class="language-http vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HTTP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> text/event-stream</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Cache-Control</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no-cache</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Connection</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> keep-alive</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;type&quot;: &quot;chunk&quot;, &quot;content&quot;: &quot;ä½ å¥½&quot;}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;type&quot;: &quot;chunk&quot;, &quot;content&quot;: &quot;ï¼Œæˆ‘æ˜¯&quot;}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {&quot;type&quot;: &quot;chunk&quot;, &quot;content&quot;: &quot;AI Agent&quot;}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>å•å‘æ¨é€ï¼ˆæœåŠ¡å™¨â†’å®¢æˆ·ç«¯ï¼‰</li><li>é•¿è¿æ¥ä¿æŒ</li><li>æµå¼ä¼ è¾“</li></ul><h4 id="kong-é…ç½®å·®å¼‚" tabindex="-1">Kong é…ç½®å·®å¼‚ <a class="header-anchor" href="#kong-é…ç½®å·®å¼‚" aria-label="Permalink to &quot;Kong é…ç½®å·®å¼‚&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>é…ç½®é¡¹</th><th>çŸ­è¿æ¥ç½‘å…³</th><th>SSE é•¿è¿æ¥ç½‘å…³</th></tr></thead><tbody><tr><td><code>upstream_connect_timeout</code></td><td>60s</td><td>900s (15min)</td></tr><tr><td><code>upstream_send_timeout</code></td><td>60s</td><td>900s</td></tr><tr><td><code>upstream_read_timeout</code></td><td>60s</td><td>900s</td></tr><tr><td><code>client_body_timeout</code></td><td>60s</td><td>900s</td></tr><tr><td><code>send_timeout</code></td><td>60s</td><td>900s</td></tr><tr><td><code>keepalive_timeout</code></td><td>75s</td><td>900s</td></tr></tbody></table><p><strong>ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ï¼Ÿ</strong></p><ol><li><p><strong>è¶…æ—¶é…ç½®å†²çª</strong><br> çŸ­è¿æ¥å’Œé•¿è¿æ¥éœ€è¦å®Œå…¨ä¸åŒçš„è¶…æ—¶é…ç½®</p></li><li><p><strong>è¿æ¥æ± ç®¡ç†</strong><br> SSE éœ€è¦ç‰¹æ®Šçš„è¿æ¥æ± ç®¡ç†ç­–ç•¥</p></li><li><p><strong>è´Ÿè½½å‡è¡¡ç­–ç•¥</strong><br> é•¿è¿æ¥éœ€è¦æ›´ç¨³å®šçš„è·¯ç”±ç­–ç•¥ï¼ˆé¿å…é¢‘ç¹åˆ‡æ¢ï¼‰</p></li><li><p><strong>ç›‘æ§å’Œå‘Šè­¦</strong><br> ä¸åŒçš„ç›‘æ§æŒ‡æ ‡å’Œå‘Šè­¦è§„åˆ™</p></li></ol><h3 id="_3-3-ä¸ºä»€ä¹ˆéœ€è¦-ai-gateway" tabindex="-1">3.3 ä¸ºä»€ä¹ˆéœ€è¦ AI Gatewayï¼Ÿ <a class="header-anchor" href="#_3-3-ä¸ºä»€ä¹ˆéœ€è¦-ai-gateway" aria-label="Permalink to &quot;3.3 ä¸ºä»€ä¹ˆéœ€è¦ AI Gatewayï¼Ÿ&quot;">â€‹</a></h3><h4 id="é—®é¢˜-ç›´æ¥è°ƒç”¨-llm-å¹³å°çš„ç—›ç‚¹" tabindex="-1">é—®é¢˜ï¼šç›´æ¥è°ƒç”¨ LLM å¹³å°çš„ç—›ç‚¹ <a class="header-anchor" href="#é—®é¢˜-ç›´æ¥è°ƒç”¨-llm-å¹³å°çš„ç—›ç‚¹" aria-label="Permalink to &quot;é—®é¢˜ï¼šç›´æ¥è°ƒç”¨ LLM å¹³å°çš„ç—›ç‚¹&quot;">â€‹</a></h4><p><strong>ç—›ç‚¹ 1ï¼šAPI ä¸ç»Ÿä¸€</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è°ƒç”¨ Doubao</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doubao_client.complete(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;doubao-pro-128k&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è°ƒç”¨ Qwen</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qwen_client.chat.completions.create(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;qwen-turbo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è°ƒç”¨ OpenAI</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> openai_client.chat.completions.create(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>æ¯ä¸ªå¹³å°çš„ API éƒ½ä¸åŒï¼Œéœ€è¦é€‚é…å±‚ã€‚</p><p><strong>ç—›ç‚¹ 2ï¼šæ— æ³•ç»Ÿä¸€ç®¡ç†</strong></p><ul><li>æ— æ³•ç»Ÿä¸€ç›‘æ§</li><li>æ— æ³•ç»Ÿä¸€é™æµ</li><li>æ— æ³•ç»Ÿä¸€é™çº§</li></ul><p><strong>ç—›ç‚¹ 3ï¼šåˆ‡æ¢æˆæœ¬é«˜</strong></p><p>æ›´æ¢ LLM éœ€è¦æ”¹ä»£ç ã€‚</p><h4 id="ai-gateway-çš„ä»·å€¼" tabindex="-1">AI Gateway çš„ä»·å€¼ <a class="header-anchor" href="#ai-gateway-çš„ä»·å€¼" aria-label="Permalink to &quot;AI Gateway çš„ä»·å€¼&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»Ÿä¸€çš„ API Gateway</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ai_gateway.complete(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;doubao-pro-128k&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æˆ– &quot;qwen-turbo&quot;, &quot;gpt-4&quot;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>ä»·å€¼ 1ï¼šç»Ÿä¸€æ¥å£</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AIGateway</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> complete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, messages: List[Dict]) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 1. æ ¹æ®æ¨¡å‹åè·¯ç”±åˆ°å¯¹åº”å¹³å°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        platform </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.get_platform(model)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 2. è½¬æ¢è¯·æ±‚æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        platform_request </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.convert_request(messages, platform)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 3. è°ƒç”¨å¹³å° API</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> platform.call(platform_request)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 4. è½¬æ¢å“åº”æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        unified_response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.convert_response(response, platform)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> unified_response</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>ä»·å€¼ 2ï¼šç»Ÿä¸€ç›‘æ§</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœ¨ Gateway å±‚ç»Ÿä¸€åŸ‹ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@monitor_llm_call</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> complete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, messages: List[Dict]) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    start_time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.time()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._call_llm(model, messages)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è®°å½•æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        metrics.llm_call_success.inc()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        metrics.llm_call_latency.observe(time.time() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> start_time)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        metrics.llm_token_usage.inc(response.usage.total_tokens)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è®°å½•å¤±è´¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        metrics.llm_call_failed.inc()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        raise</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>ä»·å€¼ 3ï¼šç»Ÿä¸€é™æµå’Œé™çº§</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AIGateway</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> complete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, messages: List[Dict]) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 1. é™æµæ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.rate_limiter.acquire(model):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RateLimitError()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 2. å°è¯•è°ƒç”¨ä¸»æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._call_primary(model, messages)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 3. é™çº§åˆ°å¤‡ç”¨æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            logger.warning(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Primary model </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> failed, fallback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._call_fallback(model, messages)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>ä»·å€¼ 4ï¼šæˆæœ¬ä¼˜åŒ–</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åŸºäºæˆæœ¬çš„æ¨¡å‹è·¯ç”±</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CostBasedRouter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> select_model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, task_complexity: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> task_complexity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;simple&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;doubao-lite&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ä¾¿å®œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        elif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> task_complexity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;medium&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;qwen-turbo&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # ä¸­ç­‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;doubao-pro&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # é«˜è´¨é‡</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h2 id="å››ã€è°ƒç”¨é“¾è·¯æ·±åº¦å‰–æ" tabindex="-1">å››ã€è°ƒç”¨é“¾è·¯æ·±åº¦å‰–æ <a class="header-anchor" href="#å››ã€è°ƒç”¨é“¾è·¯æ·±åº¦å‰–æ" aria-label="Permalink to &quot;å››ã€è°ƒç”¨é“¾è·¯æ·±åº¦å‰–æ&quot;">â€‹</a></h2><h3 id="_4-1-çŸ­è¿æ¥é“¾è·¯" tabindex="-1">4.1 çŸ­è¿æ¥é“¾è·¯ <a class="header-anchor" href="#_4-1-çŸ­è¿æ¥é“¾è·¯" aria-label="Permalink to &quot;4.1 çŸ­è¿æ¥é“¾è·¯&quot;">â€‹</a></h3><p><strong>å®Œæ•´æµç¨‹</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·æµè§ˆå™¨</span></span>
<span class="line"><span>  â†“ [HTTPS]</span></span>
<span class="line"><span>Kong çŸ­è¿æ¥ç½‘å…³ (60s è¶…æ—¶)</span></span>
<span class="line"><span>  â†“ [HTTP]</span></span>
<span class="line"><span>gdesign-tool (çŸ­è¿æ¥é›†ç¾¤)</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>  â”œâ†’ è½»èˆŸ (è®¾è®¡å·¥å…·)</span></span>
<span class="line"><span>  â”œâ†’ CRC (å®¡æ ¸æœåŠ¡)</span></span>
<span class="line"><span>  â””â†’ Dify (AI åº”ç”¨)</span></span>
<span class="line"><span>      â†“ [HTTP]</span></span>
<span class="line"><span>    AI Gateway</span></span>
<span class="line"><span>      â†“ [HTTP]</span></span>
<span class="line"><span>    ç«å±±å¼•æ“ / é˜¿é‡Œç™¾ç‚¼</span></span>
<span class="line"><span>      â†“</span></span>
<span class="line"><span>    Doubao / Qwen</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>æ—¶åºå›¾</strong>ï¼š</p>`,58)),(i(),p(h,null,{default:a(()=>[t(l,{id:"mermaid-513",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20Kong%0A%20%20%20%20participant%20Tool%20as%20gdesign-tool%0A%20%20%20%20participant%20Dify%0A%20%20%20%20participant%20Gateway%20as%20AI%20Gateway%0A%20%20%20%20participant%20LLM%20as%20Doubao%2FQwen%0A%0A%20%20%20%20User-%3E%3EKong%3A%20POST%20%2Fapi%2Ftool%2Fquick%0A%20%20%20%20Kong-%3E%3ETool%3A%20%E8%BD%AC%E5%8F%91%E8%AF%B7%E6%B1%82%20(60s%20%E8%B6%85%E6%97%B6)%0A%20%20%20%20Tool-%3E%3EDify%3A%20%E8%B0%83%E7%94%A8%20Dify%20%E5%BA%94%E7%94%A8%0A%20%20%20%20Dify-%3E%3EGateway%3A%20%E8%B0%83%E7%94%A8%20LLM%0A%20%20%20%20Gateway-%3E%3ELLM%3A%20%E7%BB%9F%E4%B8%80%20API%0A%20%20%20%20LLM--%3E%3EGateway%3A%20%E5%93%8D%E5%BA%94%0A%20%20%20%20Gateway--%3E%3EDify%3A%20%E7%BB%9F%E4%B8%80%E6%A0%BC%E5%BC%8F%0A%20%20%20%20Dify--%3E%3ETool%3A%20%E7%BB%93%E6%9E%9C%0A%20%20%20%20Tool--%3E%3EKong%3A%20%E5%93%8D%E5%BA%94%0A%20%20%20%20Kong--%3E%3EUser%3A%20%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%0A"})]),fallback:a(()=>s[1]||(s[1]=[e(" Loading... ")])),_:1})),s[5]||(s[5]=n(`<p><strong>å…³é”®æŒ‡æ ‡</strong>ï¼š</p><ul><li><strong>P99 å»¶è¿Ÿ</strong>ï¼š&lt; 2s</li><li><strong>QPS</strong>ï¼š1000+</li><li><strong>æˆåŠŸç‡</strong>ï¼š&gt; 99%</li></ul><h3 id="_4-2-é•¿è¿æ¥é“¾è·¯-sse" tabindex="-1">4.2 é•¿è¿æ¥é“¾è·¯ï¼ˆSSEï¼‰ <a class="header-anchor" href="#_4-2-é•¿è¿æ¥é“¾è·¯-sse" aria-label="Permalink to &quot;4.2 é•¿è¿æ¥é“¾è·¯ï¼ˆSSEï¼‰&quot;">â€‹</a></h3><p><strong>å®Œæ•´æµç¨‹</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·æµè§ˆå™¨</span></span>
<span class="line"><span>  â†“ [SSE]</span></span>
<span class="line"><span>Kong SSE ç½‘å…³ (15min è¶…æ—¶)</span></span>
<span class="line"><span>  â†“ [SSE]</span></span>
<span class="line"><span>Agent æœåŠ¡</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>  â”œâ†’ gdesign-tool (é•¿è¿æ¥é›†ç¾¤)</span></span>
<span class="line"><span>  â”‚   â”œâ†’ è½»èˆŸ</span></span>
<span class="line"><span>  â”‚   â””â†’ Dify â†’ AI Gateway â†’ LLM</span></span>
<span class="line"><span>  â”‚</span></span>
<span class="line"><span>  â””â†’ AI Gateway â†’ LLM</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>æ—¶åºå›¾</strong>ï¼š</p>`,6)),(i(),p(h,null,{default:a(()=>[t(l,{id:"mermaid-544",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20Kong%20as%20Kong%20SSE%0A%20%20%20%20participant%20Agent%0A%20%20%20%20participant%20Tool%20as%20gdesign-tool%20(%E9%95%BF%E8%BF%9E%E6%8E%A5)%0A%20%20%20%20participant%20Gateway%20as%20AI%20Gateway%0A%20%20%20%20participant%20LLM%0A%0A%20%20%20%20User-%3E%3EKong%3A%20POST%20%2Fapi%2Fagent%2Fchat%20(SSE)%0A%20%20%20%20Kong-%3E%3EAgent%3A%20%E5%BB%BA%E7%AB%8B%20SSE%20%E8%BF%9E%E6%8E%A5%0A%20%20%20%20%0A%20%20%20%20Agent-%3E%3EGateway%3A%20%E8%B0%83%E7%94%A8%20LLM%20(stream)%0A%20%20%20%20Gateway-%3E%3ELLM%3A%20%E6%B5%81%E5%BC%8F%E8%AF%B7%E6%B1%82%0A%20%20%20%20%0A%20%20%20%20loop%20%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA%0A%20%20%20%20%20%20%20%20LLM--%3E%3EGateway%3A%20chunk%0A%20%20%20%20%20%20%20%20Gateway--%3E%3EAgent%3A%20chunk%0A%20%20%20%20%20%20%20%20Agent--%3E%3EKong%3A%20SSE%3A%20data%0A%20%20%20%20%20%20%20%20Kong--%3E%3EUser%3A%20%E6%B5%81%E5%BC%8F%E6%98%BE%E7%A4%BA%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20Note%20over%20Agent%3A%20%E6%A3%80%E6%B5%8B%E5%88%B0%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%0A%20%20%20%20%0A%20%20%20%20Agent-%3E%3ETool%3A%20%E6%89%A7%E8%A1%8C%E5%B7%A5%E5%85%B7%0A%20%20%20%20Tool-%3E%3EGateway%3A%20%E5%8F%AF%E8%83%BD%E5%86%8D%E6%AC%A1%E8%B0%83%E7%94%A8%20LLM%0A%20%20%20%20Gateway-%3E%3ELLM%3A%20%E8%AF%B7%E6%B1%82%0A%20%20%20%20LLM--%3E%3EGateway%3A%20%E5%93%8D%E5%BA%94%0A%20%20%20%20Gateway--%3E%3ETool%3A%20%E7%BB%93%E6%9E%9C%0A%20%20%20%20Tool--%3E%3EAgent%3A%20%E5%B7%A5%E5%85%B7%E7%BB%93%E6%9E%9C%0A%20%20%20%20%0A%20%20%20%20Agent-%3E%3EGateway%3A%20%E6%9C%80%E7%BB%88%20LLM%20%E8%B0%83%E7%94%A8%0A%20%20%20%20Gateway-%3E%3ELLM%3A%20%E8%AF%B7%E6%B1%82%0A%20%20%20%20LLM--%3E%3EGateway%3A%20%E5%93%8D%E5%BA%94%0A%20%20%20%20Gateway--%3E%3EAgent%3A%20%E6%9C%80%E7%BB%88%E7%BB%93%E6%9E%9C%0A%20%20%20%20Agent--%3E%3EKong%3A%20SSE%3A%20final%20data%0A%20%20%20%20Kong--%3E%3EUser%3A%20%E5%AE%8C%E6%88%90%0A"})]),fallback:a(()=>s[2]||(s[2]=[e(" Loading... ")])),_:1})),s[6]||(s[6]=n(`<p><strong>å…³é”®æŒ‡æ ‡</strong>ï¼š</p><ul><li><strong>P99 å»¶è¿Ÿ</strong>ï¼š&lt; 30sï¼ˆé¦–å­—æ—¶é—´ï¼‰</li><li><strong>QPS</strong>ï¼š10-100</li><li><strong>è¿æ¥æ—¶é•¿</strong>ï¼šå¹³å‡ 2-5 åˆ†é’Ÿï¼Œæœ€é•¿ 15 åˆ†é’Ÿ</li><li><strong>æˆåŠŸç‡</strong>ï¼š&gt; 95%</li></ul><hr><h2 id="äº”ã€æ€§èƒ½ä¸å¯ç”¨æ€§è®¾è®¡" tabindex="-1">äº”ã€æ€§èƒ½ä¸å¯ç”¨æ€§è®¾è®¡ <a class="header-anchor" href="#äº”ã€æ€§èƒ½ä¸å¯ç”¨æ€§è®¾è®¡" aria-label="Permalink to &quot;äº”ã€æ€§èƒ½ä¸å¯ç”¨æ€§è®¾è®¡&quot;">â€‹</a></h2><h3 id="_5-1-è¶…æ—¶ç­–ç•¥è®¾è®¡" tabindex="-1">5.1 è¶…æ—¶ç­–ç•¥è®¾è®¡ <a class="header-anchor" href="#_5-1-è¶…æ—¶ç­–ç•¥è®¾è®¡" aria-label="Permalink to &quot;5.1 è¶…æ—¶ç­–ç•¥è®¾è®¡&quot;">â€‹</a></h3><p><strong>è¶…æ—¶çš„æœ¬è´¨</strong>ï¼š<strong>é˜²æ­¢èµ„æºè¢«é•¿æ—¶é—´å ç”¨</strong></p><p><strong>å¤šå±‚è¶…æ—¶è®¾è®¡</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·è¶…æ—¶ (å‰ç«¯)</span></span>
<span class="line"><span>  â†“ 60s</span></span>
<span class="line"><span>Kong è¶…æ—¶ (ç½‘å…³)</span></span>
<span class="line"><span>  â†“ 50s</span></span>
<span class="line"><span>gdesign-tool è¶…æ—¶ (æœåŠ¡)</span></span>
<span class="line"><span>  â†“ 40s</span></span>
<span class="line"><span>LLM è¶…æ—¶ (AI Gateway)</span></span>
<span class="line"><span>  â†“ 30s</span></span>
<span class="line"><span>LLM å¹³å°è¶…æ—¶ (åº•å±‚)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆé€å±‚é€’å‡ï¼Ÿ</strong></p><p>ç¡®ä¿ä¸Šå±‚èƒ½å¤Ÿæ„ŸçŸ¥åˆ°ä¸‹å±‚çš„è¶…æ—¶ï¼Œè€Œä¸æ˜¯è‡ªå·±å…ˆè¶…æ—¶ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é”™è¯¯çš„è¶…æ—¶é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kong_timeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> 30s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">service_timeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> 60s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # âŒ æ¯”ç½‘å…³é•¿</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ­£ç¡®çš„è¶…æ—¶é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kong_timeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> 60s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">service_timeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> 50s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # âœ… æ¯”ç½‘å…³çŸ­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm_timeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> 40s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # âœ… æ¯”æœåŠ¡çŸ­</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_5-2-é«˜å¯ç”¨è®¾è®¡" tabindex="-1">5.2 é«˜å¯ç”¨è®¾è®¡ <a class="header-anchor" href="#_5-2-é«˜å¯ç”¨è®¾è®¡" aria-label="Permalink to &quot;5.2 é«˜å¯ç”¨è®¾è®¡&quot;">â€‹</a></h3><p><strong>æœåŠ¡å±‚é¢</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¥åº·æ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@app.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/health&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> health_check</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 1. æ£€æŸ¥æœåŠ¡è‡ªèº«</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> self_check():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        raise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTPException(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status_code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">503</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 2. æ£€æŸ¥ä¾èµ–æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> check_dependencies():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        raise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTPException(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status_code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">503</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;healthy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è‡ªåŠ¨é‡å¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœ¨ K8s ä¸­é…ç½® livenessProbe å’Œ readinessProbe</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">livenessProbe:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  httpGet:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    path: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">health</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    port: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  initialDelaySeconds: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  periodSeconds: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>ç½‘å…³å±‚é¢</strong>ï¼š</p><div class="language-nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Kong ç†”æ–­é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> agent_service </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent-1:8000 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_fails</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fail_timeout=30s;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent-2:8000 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_fails</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fail_timeout=30s;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agent-3:8000 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_fails</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fail_timeout=30s;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    keepalive </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>LLM å±‚é¢</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AIGateway</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> complete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, messages: List[Dict]) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 1. å°è¯•ä¸»æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._call_llm(model, messages)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        except</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RateLimitError:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 2. é™çº§åˆ°å¤‡ç”¨æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            logger.warning(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Model </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate limited, fallback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            fallback_model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.get_fallback_model(model)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._call_llm(fallback_model, messages)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 3. æœ€åçš„å…œåº•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            logger.error(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;All models failed: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;æŠ±æ­‰ï¼ŒæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><hr><h2 id="å…­ã€æ‰©å±•æ€§è®¾è®¡" tabindex="-1">å…­ã€æ‰©å±•æ€§è®¾è®¡ <a class="header-anchor" href="#å…­ã€æ‰©å±•æ€§è®¾è®¡" aria-label="Permalink to &quot;å…­ã€æ‰©å±•æ€§è®¾è®¡&quot;">â€‹</a></h2><h3 id="_6-1-æ¨ªå‘æ‰©å±•" tabindex="-1">6.1 æ¨ªå‘æ‰©å±• <a class="header-anchor" href="#_6-1-æ¨ªå‘æ‰©å±•" aria-label="Permalink to &quot;6.1 æ¨ªå‘æ‰©å±•&quot;">â€‹</a></h3><p><strong>æœåŠ¡æ‰©å±•</strong>ï¼š</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># K8s HPA (Horizontal Pod Autoscaler)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">autoscaling/v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">HorizontalPodAutoscaler</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">agent-service-hpa</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  scaleTargetRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">agent-service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  minReplicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  maxReplicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  metrics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Resource</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cpu</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Utilization</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        averageUtilization</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">70</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Resource</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">memory</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Utilization</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        averageUtilization</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>LLM æ‰©å±•</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ·»åŠ æ–°çš„ LLM å¹³å°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AIGateway</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.platforms </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;doubao&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: DoubaoAdapter(),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;qwen&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: QwenAdapter(),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;claude&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ClaudeAdapter(),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ–°å¢</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;gpt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: GPTAdapter(),        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ–°å¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_platform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; LLMAdapter:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> platform_name, adapter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.platforms.items():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> platform_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.lower():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adapter</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ValueError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Unknown model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_6-2-åŠŸèƒ½æ‰©å±•" tabindex="-1">6.2 åŠŸèƒ½æ‰©å±• <a class="header-anchor" href="#_6-2-åŠŸèƒ½æ‰©å±•" aria-label="Permalink to &quot;6.2 åŠŸèƒ½æ‰©å±•&quot;">â€‹</a></h3><p><strong>å·¥å…·ç”Ÿæ€æ‰©å±•</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ³¨å†Œæ–°å·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@tool_registry.register</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NewTool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;new_tool&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æ–°å·¥å…·çš„æè¿°&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            parameters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs) -&gt; Dict:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å·¥å…·å®ç°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        pass</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><hr><h2 id="ä¸ƒã€ç›‘æ§ä¸å‘Šè­¦" tabindex="-1">ä¸ƒã€ç›‘æ§ä¸å‘Šè­¦ <a class="header-anchor" href="#ä¸ƒã€ç›‘æ§ä¸å‘Šè­¦" aria-label="Permalink to &quot;ä¸ƒã€ç›‘æ§ä¸å‘Šè­¦&quot;">â€‹</a></h2><h3 id="_7-1-ç›‘æ§æŒ‡æ ‡" tabindex="-1">7.1 ç›‘æ§æŒ‡æ ‡ <a class="header-anchor" href="#_7-1-ç›‘æ§æŒ‡æ ‡" aria-label="Permalink to &quot;7.1 ç›‘æ§æŒ‡æ ‡&quot;">â€‹</a></h3><p><strong>ç½‘å…³å±‚</strong>ï¼š</p><ul><li>QPSï¼ˆæŒ‰è·¯å¾„ã€çŠ¶æ€ç ï¼‰</li><li>P50/P95/P99 å»¶è¿Ÿ</li><li>é”™è¯¯ç‡</li><li>è¿æ¥æ•°</li></ul><p><strong>æœåŠ¡å±‚</strong>ï¼š</p><ul><li>å¯ç”¨æ€§ï¼ˆå¥åº·æ£€æŸ¥ï¼‰</li><li>è¯·æ±‚æˆåŠŸç‡</li><li>å¤„ç†å»¶è¿Ÿ</li><li>å¹¶å‘æ•°</li></ul><p><strong>LLM å±‚</strong>ï¼š</p><ul><li>API è°ƒç”¨æˆåŠŸç‡</li><li>Token æ¶ˆè€—</li><li>è°ƒç”¨å»¶è¿Ÿ</li><li>æˆæœ¬</li></ul><h3 id="_7-2-å‘Šè­¦è§„åˆ™" tabindex="-1">7.2 å‘Šè­¦è§„åˆ™ <a class="header-anchor" href="#_7-2-å‘Šè­¦è§„åˆ™" aria-label="Permalink to &quot;7.2 å‘Šè­¦è§„åˆ™&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>æŒ‡æ ‡</th><th>é˜ˆå€¼</th><th>å‘Šè­¦çº§åˆ«</th></tr></thead><tbody><tr><td>æœåŠ¡å¯ç”¨æ€§</td><td>&lt; 99%</td><td>P0</td></tr><tr><td>è¯·æ±‚æˆåŠŸç‡</td><td>&lt; 95%</td><td>P1</td></tr><tr><td>P99 å»¶è¿Ÿ</td><td>&gt; 10s</td><td>P2</td></tr><tr><td>LLM è°ƒç”¨å¤±è´¥ç‡</td><td>&gt; 10%</td><td>P1</td></tr><tr><td>ç¨¿è±†æ¶ˆè€—å¼‚å¸¸</td><td>&gt; é˜ˆå€¼</td><td>P2</td></tr></tbody></table><hr><h2 id="å…«ã€æ€»ç»“" tabindex="-1">å…«ã€æ€»ç»“ <a class="header-anchor" href="#å…«ã€æ€»ç»“" aria-label="Permalink to &quot;å…«ã€æ€»ç»“&quot;">â€‹</a></h2><h3 id="_8-1-æ ¸å¿ƒè®¾è®¡" tabindex="-1">8.1 æ ¸å¿ƒè®¾è®¡ <a class="header-anchor" href="#_8-1-æ ¸å¿ƒè®¾è®¡" aria-label="Permalink to &quot;8.1 æ ¸å¿ƒè®¾è®¡&quot;">â€‹</a></h3><ol><li><strong>å››å±‚æ¶æ„</strong>ï¼šç½‘å…³ã€æœåŠ¡ã€AI èƒ½åŠ›ã€LLM å¹³å°</li><li><strong>é›†ç¾¤éš”ç¦»</strong>ï¼šçŸ­è¿æ¥å’Œé•¿è¿æ¥ç‰©ç†éš”ç¦»</li><li><strong>ç½‘å…³åˆ†ç¦»</strong>ï¼šSSE ä¸“ç”¨ç½‘å…³ç‹¬ç«‹éƒ¨ç½²</li><li><strong>ç»Ÿä¸€æ¥å…¥</strong>ï¼šAI Gateway ç»Ÿä¸€ LLM ç®¡ç†</li></ol><h3 id="_8-2-æ¶æ„ä¼˜åŠ¿" tabindex="-1">8.2 æ¶æ„ä¼˜åŠ¿ <a class="header-anchor" href="#_8-2-æ¶æ„ä¼˜åŠ¿" aria-label="Permalink to &quot;8.2 æ¶æ„ä¼˜åŠ¿&quot;">â€‹</a></h3><ul><li>âœ… <strong>é«˜æ€§èƒ½</strong>ï¼šçŸ­è¿æ¥é«˜ QPSï¼Œé•¿è¿æ¥æµå¼è¾“å‡º</li><li>âœ… <strong>é«˜å¯ç”¨</strong>ï¼šå¤šå±‚çº§æ•…éšœéš”ç¦»ï¼Œè‡ªåŠ¨é™çº§</li><li>âœ… <strong>æ˜“æ‰©å±•</strong>ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒæ¨ªå‘æ‰©å±•</li><li>âœ… <strong>å¯è§‚æµ‹</strong>ï¼šå®Œæ•´çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»</li></ul><hr><p><em>æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0</em><br><em>æœ€åæ›´æ–°ï¼š2026-01-26</em></p><p><strong>ä¸Šä¸€ç¯‡</strong>ï¼š<a href="./04-å·¥ä½œæµç¼–æ’">â† å·¥ä½œæµç¼–æ’</a> | <strong>ä¸‹ä¸€ç¯‡</strong>ï¼š<a href="./06-ä¸­æ–­ä¸æ¢å¤">ä¸­æ–­ä¸æ¢å¤ â†’</a></p>`,49))])}const F=r(d,[["render",g]]);export{m as __pageData,F as default};
