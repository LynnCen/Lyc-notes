import{_ as a,c as i,o as n,a7 as l}from"./chunks/framework.BQb8NfN9.js";const c=JSON.parse('{"title":"ä¸»ä½“é€‰æ‹©åŠŸèƒ½ï¼šå®Œæ•´æµç¨‹ä¸èŒè´£åˆ’åˆ†è¯¦è§£","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/SAM/ä¸»ä½“é€‰æ‹©åŠŸèƒ½å®Œæ•´æµç¨‹ä¸èŒè´£åˆ’åˆ†.md","filePath":"work/gd/SAM/ä¸»ä½“é€‰æ‹©åŠŸèƒ½å®Œæ•´æµç¨‹ä¸èŒè´£åˆ’åˆ†.md","lastUpdated":1770085732000}'),p={name:"work/gd/SAM/ä¸»ä½“é€‰æ‹©åŠŸèƒ½å®Œæ•´æµç¨‹ä¸èŒè´£åˆ’åˆ†.md"};function e(t,s,h,k,r,d){return n(),i("div",null,s[0]||(s[0]=[l(`<h1 id="ä¸»ä½“é€‰æ‹©åŠŸèƒ½-å®Œæ•´æµç¨‹ä¸èŒè´£åˆ’åˆ†è¯¦è§£" tabindex="-1">ä¸»ä½“é€‰æ‹©åŠŸèƒ½ï¼šå®Œæ•´æµç¨‹ä¸èŒè´£åˆ’åˆ†è¯¦è§£ <a class="header-anchor" href="#ä¸»ä½“é€‰æ‹©åŠŸèƒ½-å®Œæ•´æµç¨‹ä¸èŒè´£åˆ’åˆ†è¯¦è§£" aria-label="Permalink to &quot;ä¸»ä½“é€‰æ‹©åŠŸèƒ½ï¼šå®Œæ•´æµç¨‹ä¸èŒè´£åˆ’åˆ†è¯¦è§£&quot;">â€‹</a></h1><h2 id="ğŸ“‹-ç›®å½•" tabindex="-1">ğŸ“‹ ç›®å½• <a class="header-anchor" href="#ğŸ“‹-ç›®å½•" aria-label="Permalink to &quot;ğŸ“‹ ç›®å½•&quot;">â€‹</a></h2><ol><li><a href="#ä¸€æµç¨‹çº æ­£ä¸è¡¥å……">æµç¨‹çº æ­£ä¸è¡¥å……</a></li><li><a href="#äºŒèŒè´£åˆ’åˆ†legosam-vs-é¡¹ç›®å®ç°">èŒè´£åˆ’åˆ†ï¼šlego/sam vs é¡¹ç›®å®ç°</a></li><li><a href="#ä¸‰layeré«˜äº®å®ç°åŸç†">Layeré«˜äº®å®ç°åŸç†</a></li></ol><hr><h2 id="ä¸€ã€æµç¨‹çº æ­£ä¸è¡¥å……" tabindex="-1">ä¸€ã€æµç¨‹çº æ­£ä¸è¡¥å…… <a class="header-anchor" href="#ä¸€ã€æµç¨‹çº æ­£ä¸è¡¥å……" aria-label="Permalink to &quot;ä¸€ã€æµç¨‹çº æ­£ä¸è¡¥å……&quot;">â€‹</a></h2><h3 id="_1-1-æ‚¨ç†è§£çš„æµç¨‹-éƒ¨åˆ†æ­£ç¡®" tabindex="-1">1.1 æ‚¨ç†è§£çš„æµç¨‹ï¼ˆéƒ¨åˆ†æ­£ç¡®ï¼‰ <a class="header-anchor" href="#_1-1-æ‚¨ç†è§£çš„æµç¨‹-éƒ¨åˆ†æ­£ç¡®" aria-label="Permalink to &quot;1.1 æ‚¨ç†è§£çš„æµç¨‹ï¼ˆéƒ¨åˆ†æ­£ç¡®ï¼‰&quot;">â€‹</a></h3><p>æ‚¨æåˆ°çš„æ­¥éª¤ï¼š</p><ol><li>âœ… è·å–åˆ°å›¾ç‰‡ä¿¡æ¯</li><li>âœ… è°ƒç”¨åç«¯æ¥å£è·å–åˆ°SAMå¤„ç†åçš„åˆ†åŒºç‰¹å¾ä¿¡æ¯</li><li>âœ… é¼ æ ‡hoveråˆ°å›¾ç‰‡ä¹‹åï¼Œè¿›è¡Œåæ ‡è½¬æ¢</li><li>âœ… åˆ¤æ–­å½“å‰hoverä½ç½®å±äºå“ªä¸€éƒ¨åˆ†åˆ†åŒºï¼Œå¹¶è¿”å›å¯¹åº”åˆ†åŒºçš„layer</li><li>âœ… å°†å¯¹åº”åˆ†åŒºçš„layeré«˜äº®</li></ol><p><strong>è¯„ä»·ï¼š</strong> æ•´ä½“æ€è·¯æ­£ç¡®ï¼Œä½†ç¼ºå°‘ä¸€äº›å…³é”®æ­¥éª¤å’Œç»†èŠ‚ã€‚</p><h3 id="_1-2-å®Œæ•´æµç¨‹-çº æ­£ä¸è¡¥å……" tabindex="-1">1.2 å®Œæ•´æµç¨‹ï¼ˆçº æ­£ä¸è¡¥å……ï¼‰ <a class="header-anchor" href="#_1-2-å®Œæ•´æµç¨‹-çº æ­£ä¸è¡¥å……" aria-label="Permalink to &quot;1.2 å®Œæ•´æµç¨‹ï¼ˆçº æ­£ä¸è¡¥å……ï¼‰&quot;">â€‹</a></h3><h4 id="é˜¶æ®µä¸€-åˆå§‹åŒ–å‡†å¤‡" tabindex="-1"><strong>é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–å‡†å¤‡</strong> <a class="header-anchor" href="#é˜¶æ®µä¸€-åˆå§‹åŒ–å‡†å¤‡" aria-label="Permalink to &quot;**é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–å‡†å¤‡**&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ­¥éª¤1ï¼šç”¨æˆ·é€‰æ‹©&quot;ä¸»ä½“é€‰æ‹©&quot;å·¥å…·</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>æ­¥éª¤2ï¼šè·å–å›¾ç‰‡URLå’Œå°ºå¯¸ä¿¡æ¯</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>æ­¥éª¤3ï¼šæ£€æŸ¥ç¼“å­˜ï¼ˆjsonMapï¼‰</span></span>
<span class="line"><span>  - å¦‚æœå·²ç¼“å­˜ï¼Œç›´æ¥ä½¿ç”¨</span></span>
<span class="line"><span>  - å¦‚æœæœªç¼“å­˜ï¼Œç»§ç»­ä¸‹ä¸€æ­¥</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>æ­¥éª¤4ï¼šè°ƒç”¨åç«¯APIè·å–SAMåˆ†åŒºæ•°æ®</span></span>
<span class="line"><span>  - API: factory.apiService.autoMasks(imageUrl)</span></span>
<span class="line"><span>  - è¿”å›: IAutoMask[] æ•°ç»„ï¼ˆå¤šä¸ªå€™é€‰åˆ†åŒºï¼‰</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>æ­¥éª¤5ï¼šåˆ›å»ºAutoMaskModelå®ä¾‹</span></span>
<span class="line"><span>  - factory.createAutoMaskModel(imageUrl, maskData)</span></span>
<span class="line"><span>  - å†…éƒ¨ä¼šä¸ºæ¯ä¸ªmaskåˆ›å»ºAutoMaskLayerå¯¹è±¡</span></span>
<span class="line"><span>  - æ¯ä¸ªLayeråŒ…å«ï¼šidã€maskCanvasã€areaç­‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>å…³é”®ä»£ç ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts (72-96è¡Œ)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _getAutoMasks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IAutoMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">factory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    factory.apiService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">autoMasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      ossUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_url, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        width: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        height: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        useDpr: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        forcePngResize: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">promise </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> getAutoMasks.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IAutoMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">factory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createAutoMaskModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, data), </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆ›å»ºæ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="é˜¶æ®µäºŒ-äº¤äº’å¤„ç†-æ‚¨æåˆ°çš„éƒ¨åˆ†" tabindex="-1"><strong>é˜¶æ®µäºŒï¼šäº¤äº’å¤„ç†ï¼ˆæ‚¨æåˆ°çš„éƒ¨åˆ†ï¼‰</strong> <a class="header-anchor" href="#é˜¶æ®µäºŒ-äº¤äº’å¤„ç†-æ‚¨æåˆ°çš„éƒ¨åˆ†" aria-label="Permalink to &quot;**é˜¶æ®µäºŒï¼šäº¤äº’å¤„ç†ï¼ˆæ‚¨æåˆ°çš„éƒ¨åˆ†ï¼‰**&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ­¥éª¤6ï¼šé¼ æ ‡hoveräº‹ä»¶è§¦å‘</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>æ­¥éª¤7ï¼šåæ ‡è½¬æ¢ï¼ˆå±å¹•åæ ‡ â†’ å›¾åƒåæ ‡ï¼‰</span></span>
<span class="line"><span>  - è€ƒè™‘canvasç¼©æ”¾ã€åç§»ã€pixelRatio</span></span>
<span class="line"><span>  - è½¬æ¢åˆ°åŸå§‹å›¾åƒå°ºå¯¸</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>æ­¥éª¤8ï¼šè°ƒç”¨pickLayer(x, y)æŸ¥æ‰¾layer</span></span>
<span class="line"><span>  - éå†æ‰€æœ‰AutoMaskLayer</span></span>
<span class="line"><span>  - æ£€æŸ¥åæ ‡æ˜¯å¦åœ¨layerçš„maskåŒºåŸŸå†…</span></span>
<span class="line"><span>  - è¿”å›æœ€ä¸Šå±‚çš„layerï¼ˆæ”¯æŒé‡å ï¼‰</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>æ­¥éª¤9ï¼šé«˜äº®æ˜¾ç¤ºlayer</span></span>
<span class="line"><span>  - æ¸…ç©ºselectionCanvas</span></span>
<span class="line"><span>  - åœ¨layer.maskCanvaså‘¨å›´ç»˜åˆ¶è¾¹æ¡†</span></span>
<span class="line"><span>  - ä½¿ç”¨å†…é˜´å½±æŠ€æœ¯å®ç°é«˜äº®æ•ˆæœ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>å…³é”®ä»£ç ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts (117-141è¡Œ)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleHoverMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MouseEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> autoMaskModel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getAutoMaskModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enabled.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">autoMaskModel) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤7ï¼šåæ ‡è½¬æ¢</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pointFormEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    width: autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSourceImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().naturalWidth,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    height: autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSourceImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().naturalHeight,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤8ï¼šæŸ¥æ‰¾layerï¼ˆlego/samæä¾›ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> layer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pickLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤9ï¼šé«˜äº®æ˜¾ç¤ºï¼ˆé¡¹ç›®å®ç°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hoverCanvasRef.value?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ctx?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clearRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.width, hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.height);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layer) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    addBorderToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layer.maskCanvas, hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      borderWidth:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layer.maskCanvas.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pixelRatio.value,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      borderColor: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AUTO_MASK_HOVER_BORDER_COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é’è‰² #33C8E6</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="é˜¶æ®µä¸‰-ç‚¹å‡»ç¡®è®¤-æ‚¨é—æ¼çš„éƒ¨åˆ†" tabindex="-1"><strong>é˜¶æ®µä¸‰ï¼šç‚¹å‡»ç¡®è®¤ï¼ˆæ‚¨é—æ¼çš„éƒ¨åˆ†ï¼‰</strong> <a class="header-anchor" href="#é˜¶æ®µä¸‰-ç‚¹å‡»ç¡®è®¤-æ‚¨é—æ¼çš„éƒ¨åˆ†" aria-label="Permalink to &quot;**é˜¶æ®µä¸‰ï¼šç‚¹å‡»ç¡®è®¤ï¼ˆæ‚¨é—æ¼çš„éƒ¨åˆ†ï¼‰**&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ­¥éª¤10ï¼šç”¨æˆ·ç‚¹å‡»layer</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>æ­¥éª¤11ï¼šåˆ‡æ¢layeré€‰ä¸­çŠ¶æ€</span></span>
<span class="line"><span>  - toggleLayerMode(x, y)</span></span>
<span class="line"><span>  - å¦‚æœå·²é€‰ä¸­ï¼Œåˆ™å–æ¶ˆé€‰ä¸­</span></span>
<span class="line"><span>  - å¦‚æœæœªé€‰ä¸­ï¼Œåˆ™æ·»åŠ åˆ°é€‰ä¸­åˆ—è¡¨</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>æ­¥éª¤12ï¼šåˆå¹¶æ‰€æœ‰é€‰ä¸­çš„layer</span></span>
<span class="line"><span>  - getMaskResult()</span></span>
<span class="line"><span>  - å°†æ‰€æœ‰é€‰ä¸­layerçš„maskCanvasåˆå¹¶</span></span>
<span class="line"><span>  - ç”Ÿæˆæœ€ç»ˆçš„maskç»“æœ</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>æ­¥éª¤13ï¼šæ›´æ–°maskCanvas</span></span>
<span class="line"><span>  - è°ƒç”¨maskResultChangeå›è°ƒ</span></span>
<span class="line"><span>  - å°†åˆå¹¶åçš„maskç»˜åˆ¶åˆ°maskCanvas</span></span>
<span class="line"><span>  - é€šçŸ¥çˆ¶ç»„ä»¶æ›´æ–°UI</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>å…³é”®ä»£ç ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts (143-156è¡Œ)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handlePickMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MouseEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> autoMaskModel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getAutoMaskModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enabled.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">autoMaskModel) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pointFormEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    width: autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSourceImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().naturalWidth,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    height: autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSourceImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().naturalHeight,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤11ï¼šåˆ‡æ¢é€‰ä¸­çŠ¶æ€ï¼ˆlego/samæä¾›ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toggleLayerMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤12ï¼šè·å–åˆå¹¶åçš„maskï¼ˆlego/samæä¾›ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> maskResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMaskResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤13ï¼šæ›´æ–°maskCanvasï¼ˆé¡¹ç›®å®ç°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  options.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">maskResultChange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?.(maskResult?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AUTO_MASK_COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSnapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç»§ç»­æ˜¾ç¤ºé«˜äº®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  handleHoverMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_1-3-æµç¨‹å¯¹æ¯”æ€»ç»“" tabindex="-1">1.3 æµç¨‹å¯¹æ¯”æ€»ç»“ <a class="header-anchor" href="#_1-3-æµç¨‹å¯¹æ¯”æ€»ç»“" aria-label="Permalink to &quot;1.3 æµç¨‹å¯¹æ¯”æ€»ç»“&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>æ‚¨çš„ç†è§£</th><th>å®Œæ•´æµç¨‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>âœ… è·å–å›¾ç‰‡ä¿¡æ¯</td><td>âœ… æ­¥éª¤1-2</td><td>æ­£ç¡®</td></tr><tr><td>âœ… è°ƒç”¨åç«¯è·å–åˆ†åŒº</td><td>âœ… æ­¥éª¤4</td><td>æ­£ç¡®ï¼Œä½†éœ€è¦å…ˆæ£€æŸ¥ç¼“å­˜</td></tr><tr><td>âœ… åæ ‡è½¬æ¢</td><td>âœ… æ­¥éª¤7</td><td>æ­£ç¡®</td></tr><tr><td>âœ… åˆ¤æ–­åˆ†åŒºå¹¶è¿”å›layer</td><td>âœ… æ­¥éª¤8</td><td>æ­£ç¡®ï¼Œä½†ç”±lego/samå®ç°</td></tr><tr><td>âœ… é«˜äº®layer</td><td>âœ… æ­¥éª¤9</td><td>æ­£ç¡®ï¼Œä½†å®ç°æ–¹å¼éœ€è¦è¯¦ç»†è¯´æ˜</td></tr><tr><td>âŒ ç¼ºå¤±</td><td>âœ… æ­¥éª¤10-13</td><td><strong>ç‚¹å‡»ç¡®è®¤å’Œmaskåˆå¹¶æµç¨‹</strong></td></tr></tbody></table><hr><h2 id="äºŒã€èŒè´£åˆ’åˆ†-lego-sam-vs-é¡¹ç›®å®ç°" tabindex="-1">äºŒã€èŒè´£åˆ’åˆ†ï¼šlego/sam vs é¡¹ç›®å®ç° <a class="header-anchor" href="#äºŒã€èŒè´£åˆ’åˆ†-lego-sam-vs-é¡¹ç›®å®ç°" aria-label="Permalink to &quot;äºŒã€èŒè´£åˆ’åˆ†ï¼šlego/sam vs é¡¹ç›®å®ç°&quot;">â€‹</a></h2><h3 id="_2-1-lego-sam-çš„èŒè´£-åº•å±‚èƒ½åŠ›" tabindex="-1">2.1 lego/sam çš„èŒè´£ï¼ˆåº•å±‚èƒ½åŠ›ï¼‰ <a class="header-anchor" href="#_2-1-lego-sam-çš„èŒè´£-åº•å±‚èƒ½åŠ›" aria-label="Permalink to &quot;2.1 lego/sam çš„èŒè´£ï¼ˆåº•å±‚èƒ½åŠ›ï¼‰&quot;">â€‹</a></h3><p><strong>lego/sam</strong> æ˜¯ä¸€ä¸ªå°è£…å¥½çš„SAMæ¨¡å‹åº“ï¼Œæä¾›ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š</p><h4 id="_1-æ•°æ®æ¨¡å‹ç®¡ç†" tabindex="-1"><strong>1. æ•°æ®æ¨¡å‹ç®¡ç†</strong> <a class="header-anchor" href="#_1-æ•°æ®æ¨¡å‹ç®¡ç†" aria-label="Permalink to &quot;**1. æ•°æ®æ¨¡å‹ç®¡ç†**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// lego/sam æä¾›</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> autoMaskLayers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç®¡ç†æ‰€æœ‰layer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> layerMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AutoMaskLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¿«é€ŸæŸ¥æ‰¾</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">autoMasks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IAutoMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLImageElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å°†åç«¯è¿”å›çš„IAutoMask[]è½¬æ¢ä¸ºAutoMaskLayer[]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ¯ä¸ªlayeråŒ…å«ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - id: å”¯ä¸€æ ‡è¯†</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - maskCanvas: è¯¥åˆ†åŒºçš„maskå›¾åƒï¼ˆCanvasï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - area: é¢ç§¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - mode: é€‰ä¸­çŠ¶æ€ï¼ˆnull | &#39;source-over&#39; | &#39;destination-out&#39;ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>æ•°æ®ç»“æ„ï¼š</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AutoMaskLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å”¯ä¸€ID</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// RGBAé¢œè‰²</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source-over&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;destination-out&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é€‰ä¸­çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¢ç§¯</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  maskCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¯¥åˆ†åŒºçš„maskå›¾åƒ</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  segmentation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    counts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// RLEç¼–ç æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å°ºå¯¸</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_2-åæ ‡æ‹¾å–-æ ¸å¿ƒç®—æ³•" tabindex="-1"><strong>2. åæ ‡æ‹¾å–ï¼ˆæ ¸å¿ƒç®—æ³•ï¼‰</strong> <a class="header-anchor" href="#_2-åæ ‡æ‹¾å–-æ ¸å¿ƒç®—æ³•" aria-label="Permalink to &quot;**2. åæ ‡æ‹¾å–ï¼ˆæ ¸å¿ƒç®—æ³•ï¼‰**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// lego/sam æä¾›</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pickLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x: number, y: number): AutoMaskLayer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å®ç°é€»è¾‘ï¼ˆä¼ªä»£ç ï¼‰ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. éå†æ‰€æœ‰layerï¼ˆä»åå¾€å‰ï¼Œå¤„ç†é‡å ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. æ£€æŸ¥åæ ‡(x, y)æ˜¯å¦åœ¨layer.maskCanvasçš„éé€æ˜åŒºåŸŸå†…</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. ä½¿ç”¨Canvasçš„isPointInPathæˆ–åƒç´ æ£€æµ‹</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4. è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„layerï¼ˆæœ€ä¸Šå±‚ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 5. å¦‚æœéƒ½ä¸åŒ¹é…ï¼Œè¿”å›null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>æŠ€æœ¯ç»†èŠ‚ï¼š</strong></p><ul><li>ä½¿ç”¨RLEï¼ˆRun-Length Encodingï¼‰å‹ç¼©çš„segmentationæ•°æ®</li><li>å¿«é€Ÿåˆ¤æ–­ç‚¹æ˜¯å¦åœ¨maskåŒºåŸŸå†…</li><li>æ”¯æŒå¤šä¸ªlayeré‡å çš„æƒ…å†µ</li></ul><h4 id="_3-é€‰ä¸­çŠ¶æ€ç®¡ç†" tabindex="-1"><strong>3. é€‰ä¸­çŠ¶æ€ç®¡ç†</strong> <a class="header-anchor" href="#_3-é€‰ä¸­çŠ¶æ€ç®¡ç†" aria-label="Permalink to &quot;**3. é€‰ä¸­çŠ¶æ€ç®¡ç†**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// lego/sam æä¾›</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toggleLayerMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x: number, y: number): AutoMaskResult </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. è°ƒç”¨pickLayeræ‰¾åˆ°å¯¹åº”çš„layer</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. åˆ‡æ¢layer.modeçŠ¶æ€ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    - null â†’ &#39;source-over&#39; (é€‰ä¸­)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    - &#39;source-over&#39; â†’ null (å–æ¶ˆé€‰ä¸­)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. è¿”å›åˆå¹¶åçš„maskç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMaskResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): AutoMaskResult </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆå¹¶æ‰€æœ‰mode === &#39;source-over&#39;çš„layer</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è¿”å›æœ€ç»ˆçš„mask Canvas</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_4-å¿«ç…§ç®¡ç†-æ’¤é”€-é‡åš" tabindex="-1"><strong>4. å¿«ç…§ç®¡ç†ï¼ˆæ’¤é”€/é‡åšï¼‰</strong> <a class="header-anchor" href="#_4-å¿«ç…§ç®¡ç†-æ’¤é”€-é‡åš" aria-label="Permalink to &quot;**4. å¿«ç…§ç®¡ç†ï¼ˆæ’¤é”€/é‡åšï¼‰**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// lego/sam æä¾›</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSimpleAutoMasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): Pick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AutoMaskLayer, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mode&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è¿”å›å½“å‰æ‰€æœ‰layerçš„é€‰ä¸­çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç”¨äºä¿å­˜å¿«ç…§</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSimpleAutoMasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(autoMasks: Pick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AutoMaskLayer, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mode&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]): </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ¢å¤layerçš„é€‰ä¸­çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç”¨äºæ’¤é”€/é‡åš</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2-2-é¡¹ç›®å®ç°çš„èŒè´£-ä¸šåŠ¡é€»è¾‘" tabindex="-1">2.2 é¡¹ç›®å®ç°çš„èŒè´£ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰ <a class="header-anchor" href="#_2-2-é¡¹ç›®å®ç°çš„èŒè´£-ä¸šåŠ¡é€»è¾‘" aria-label="Permalink to &quot;2.2 é¡¹ç›®å®ç°çš„èŒè´£ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰&quot;">â€‹</a></h3><p><strong>é¡¹ç›®ä»£ç </strong>è´Ÿè´£ä»¥ä¸‹ä¸šåŠ¡é€»è¾‘ï¼š</p><h4 id="_1-apiè°ƒç”¨ä¸æ•°æ®è·å–" tabindex="-1"><strong>1. APIè°ƒç”¨ä¸æ•°æ®è·å–</strong> <a class="header-anchor" href="#_1-apiè°ƒç”¨ä¸æ•°æ®è·å–" aria-label="Permalink to &quot;**1. APIè°ƒç”¨ä¸æ•°æ®è·å–**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts (é¡¹ç›®å®ç°)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _getAutoMasks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. å›¾ç‰‡é¢„å¤„ç†ï¼ˆå‹ç¼©ã€æ ¼å¼è½¬æ¢ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> processedUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ossUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_url, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    width: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    height: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    useDpr: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    forcePngResize: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. è°ƒç”¨åç«¯API</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IAutoMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> factory.apiService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">autoMasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(processedUrl);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 3. ç¼“å­˜ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  jsonMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_url, res);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>èŒè´£ï¼š</strong></p><ul><li>å›¾ç‰‡é¢„å¤„ç†ï¼ˆå°ºå¯¸é™åˆ¶ã€æ ¼å¼è½¬æ¢ï¼‰</li><li>è°ƒç”¨åç«¯API</li><li>ç»“æœç¼“å­˜ï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰</li><li>é”™è¯¯å¤„ç†</li></ul><h4 id="_2-åæ ‡è½¬æ¢" tabindex="-1"><strong>2. åæ ‡è½¬æ¢</strong> <a class="header-anchor" href="#_2-åæ ‡è½¬æ¢" aria-label="Permalink to &quot;**2. åæ ‡è½¬æ¢**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts (é¡¹ç›®å®ç°)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pointFormEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  width: autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSourceImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().naturalWidth,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  height: autoMaskModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSourceImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().naturalHeight,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>èŒè´£ï¼š</strong></p><ul><li>å±å¹•åæ ‡ â†’ å›¾åƒåæ ‡</li><li>è€ƒè™‘canvasç¼©æ”¾ã€åç§»ã€pixelRatio</li><li>å¤„ç†ä¸åŒè®¾å¤‡çš„DPIå·®å¼‚</li></ul><h4 id="_3-äº‹ä»¶å¤„ç†ä¸uiäº¤äº’" tabindex="-1"><strong>3. äº‹ä»¶å¤„ç†ä¸UIäº¤äº’</strong> <a class="header-anchor" href="#_3-äº‹ä»¶å¤„ç†ä¸uiäº¤äº’" aria-label="Permalink to &quot;**3. äº‹ä»¶å¤„ç†ä¸UIäº¤äº’**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts (é¡¹ç›®å®ç°)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(hoverCanvasRef, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mousemove&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handleHoverMask);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(hoverCanvasRef, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mouseleave&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handleMouseLeave);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(hoverCanvasRef, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;click&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handlePickMask);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>èŒè´£ï¼š</strong></p><ul><li>ç»‘å®šé¼ æ ‡äº‹ä»¶</li><li>å¤„ç†hoverã€clickã€leaveç­‰äº¤äº’</li><li>æ§åˆ¶loadingçŠ¶æ€</li><li>ç®¡ç†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</li></ul><h4 id="_4-layeré«˜äº®æ¸²æŸ“" tabindex="-1"><strong>4. Layeré«˜äº®æ¸²æŸ“</strong> <a class="header-anchor" href="#_4-layeré«˜äº®æ¸²æŸ“" aria-label="Permalink to &quot;**4. Layeré«˜äº®æ¸²æŸ“**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts (é¡¹ç›®å®ç°)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layer) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  addBorderToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layer.maskCanvas, hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    borderWidth: calculatedWidth,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    borderColor: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AUTO_MASK_HOVER_BORDER_COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>èŒè´£ï¼š</strong></p><ul><li>åœ¨selectionCanvasä¸Šç»˜åˆ¶é«˜äº®æ•ˆæœ</li><li>ä½¿ç”¨å†…é˜´å½±æŠ€æœ¯å®ç°è¾¹æ¡†</li><li>å“åº”å¼è¾¹æ¡†å®½åº¦è®¡ç®—</li></ul><h4 id="_5-maskç»“æœå¤„ç†" tabindex="-1"><strong>5. Maskç»“æœå¤„ç†</strong> <a class="header-anchor" href="#_5-maskç»“æœå¤„ç†" aria-label="Permalink to &quot;**5. Maskç»“æœå¤„ç†**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts (é¡¹ç›®å®ç°)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">maskResultChange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?.(maskResult?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AUTO_MASK_COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSnapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>èŒè´£ï¼š</strong></p><ul><li>å°†lego/samè¿”å›çš„maskç»“æœä¼ é€’ç»™çˆ¶ç»„ä»¶</li><li>æ›´æ–°maskCanvas</li><li>ä¿å­˜å¿«ç…§ç”¨äºæ’¤é”€/é‡åš</li></ul><h3 id="_2-3-èŒè´£åˆ’åˆ†æ€»ç»“è¡¨" tabindex="-1">2.3 èŒè´£åˆ’åˆ†æ€»ç»“è¡¨ <a class="header-anchor" href="#_2-3-èŒè´£åˆ’åˆ†æ€»ç»“è¡¨" aria-label="Permalink to &quot;2.3 èŒè´£åˆ’åˆ†æ€»ç»“è¡¨&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>åŠŸèƒ½</th><th>lego/sam</th><th>é¡¹ç›®å®ç°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ•°æ®æ¨¡å‹</strong></td><td>âœ… AutoMaskModelã€AutoMaskLayer</td><td>âŒ</td><td>lego/samç®¡ç†æ‰€æœ‰layeræ•°æ®</td></tr><tr><td><strong>åæ ‡æ‹¾å–</strong></td><td>âœ… pickLayer(x, y)</td><td>âŒ</td><td>lego/samå®ç°æ ¸å¿ƒç®—æ³•</td></tr><tr><td><strong>é€‰ä¸­ç®¡ç†</strong></td><td>âœ… toggleLayerMode()</td><td>âŒ</td><td>lego/samç®¡ç†é€‰ä¸­çŠ¶æ€</td></tr><tr><td><strong>Maskåˆå¹¶</strong></td><td>âœ… getMaskResult()</td><td>âŒ</td><td>lego/samåˆå¹¶é€‰ä¸­çš„layer</td></tr><tr><td><strong>APIè°ƒç”¨</strong></td><td>âŒ</td><td>âœ… è°ƒç”¨factory.apiService.autoMasks()</td><td>é¡¹ç›®è´Ÿè´£ç½‘ç»œè¯·æ±‚</td></tr><tr><td><strong>åæ ‡è½¬æ¢</strong></td><td>âŒ</td><td>âœ… pointFormEvent()</td><td>é¡¹ç›®è´Ÿè´£åæ ‡ç³»ç»Ÿè½¬æ¢</td></tr><tr><td><strong>äº‹ä»¶å¤„ç†</strong></td><td>âŒ</td><td>âœ… useEventListener</td><td>é¡¹ç›®è´Ÿè´£UIäº¤äº’</td></tr><tr><td><strong>é«˜äº®æ¸²æŸ“</strong></td><td>âŒ</td><td>âœ… addBorderToCanvas()</td><td>é¡¹ç›®è´Ÿè´£è§†è§‰æ•ˆæœ</td></tr><tr><td><strong>ç¼“å­˜ç®¡ç†</strong></td><td>âŒ</td><td>âœ… jsonMap</td><td>é¡¹ç›®è´Ÿè´£æ€§èƒ½ä¼˜åŒ–</td></tr><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>âŒ</td><td>âœ… watchã€onMounted</td><td>é¡¹ç›®è´Ÿè´£ç»„ä»¶ç®¡ç†</td></tr></tbody></table><p><strong>æ ¸å¿ƒåŸåˆ™ï¼š</strong></p><ul><li><strong>lego/sam</strong>ï¼šæä¾›åº•å±‚ç®—æ³•å’Œæ•°æ®æ¨¡å‹ï¼ˆ&quot;åšä»€ä¹ˆ&quot;ï¼‰</li><li><strong>é¡¹ç›®å®ç°</strong>ï¼šæä¾›ä¸šåŠ¡é€»è¾‘å’ŒUIäº¤äº’ï¼ˆ&quot;æ€ä¹ˆåš&quot;ï¼‰</li></ul><hr><h2 id="ä¸‰ã€layeré«˜äº®å®ç°åŸç†" tabindex="-1">ä¸‰ã€Layeré«˜äº®å®ç°åŸç† <a class="header-anchor" href="#ä¸‰ã€layeré«˜äº®å®ç°åŸç†" aria-label="Permalink to &quot;ä¸‰ã€Layeré«˜äº®å®ç°åŸç†&quot;">â€‹</a></h2><h3 id="_3-1-é«˜äº®éœ€æ±‚åˆ†æ" tabindex="-1">3.1 é«˜äº®éœ€æ±‚åˆ†æ <a class="header-anchor" href="#_3-1-é«˜äº®éœ€æ±‚åˆ†æ" aria-label="Permalink to &quot;3.1 é«˜äº®éœ€æ±‚åˆ†æ&quot;">â€‹</a></h3><p><strong>éœ€æ±‚ï¼š</strong></p><ul><li>å½“é¼ æ ‡æ‚¬åœåœ¨æŸä¸ªlayerä¸Šæ—¶ï¼Œæ˜¾ç¤ºè¯¥layerçš„è¾¹ç•Œ</li><li>è¾¹ç•Œè¦æ¸…æ™°å¯è§ï¼Œä¸å—èƒŒæ™¯å½±å“</li><li>æ€§èƒ½è¦å¥½ï¼Œä¸èƒ½å¡é¡¿</li></ul><p><strong>æŒ‘æˆ˜ï¼š</strong></p><ul><li>Canvasæ²¡æœ‰åŸç”Ÿçš„&quot;æè¾¹&quot;APIï¼ˆstrokeåªèƒ½æè·¯å¾„ï¼Œä¸èƒ½æå›¾åƒï¼‰</li><li>éœ€è¦å¤„ç†é€æ˜åŒºåŸŸï¼ˆåªæéé€æ˜éƒ¨åˆ†çš„è¾¹ç•Œï¼‰</li><li>éœ€è¦é€‚é…ä¸åŒå°ºå¯¸çš„mask</li></ul><h3 id="_3-2-canvasæè¾¹çš„æŠ€æœ¯å›°å¢ƒè¯¦è§£" tabindex="-1">3.2 Canvasæè¾¹çš„æŠ€æœ¯å›°å¢ƒè¯¦è§£ <a class="header-anchor" href="#_3-2-canvasæè¾¹çš„æŠ€æœ¯å›°å¢ƒè¯¦è§£" aria-label="Permalink to &quot;3.2 Canvasæè¾¹çš„æŠ€æœ¯å›°å¢ƒè¯¦è§£&quot;">â€‹</a></h3><p>åœ¨æ·±å…¥å®ç°ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä¸ºä»€ä¹ˆè¿™ä¸ªçœ‹ä¼¼ç®€å•çš„éœ€æ±‚åœ¨æŠ€æœ¯ä¸Šå´å¾ˆæœ‰æŒ‘æˆ˜æ€§ã€‚</p><h4 id="canvasçš„ä¸¤ç§ç»˜åˆ¶æ¨¡å¼" tabindex="-1">Canvasçš„ä¸¤ç§ç»˜åˆ¶æ¨¡å¼ <a class="header-anchor" href="#canvasçš„ä¸¤ç§ç»˜åˆ¶æ¨¡å¼" aria-label="Permalink to &quot;Canvasçš„ä¸¤ç§ç»˜åˆ¶æ¨¡å¼&quot;">â€‹</a></h4><p>Canvas APIæä¾›äº†ä¸¤ç§å®Œå…¨ä¸åŒçš„ç»˜åˆ¶æ–¹å¼ï¼š</p><p><strong>1. çŸ¢é‡ç»˜åˆ¶ï¼ˆVector Drawingï¼‰</strong></p><p>è¿™æ˜¯Canvasçš„ä¼ ç»Ÿå¼ºé¡¹ï¼Œä½¿ç”¨è·¯å¾„ï¼ˆPathï¼‰APIæ¥ç»˜åˆ¶å‡ ä½•å›¾å½¢ï¼š</p><ul><li><code>moveTo()</code>, <code>lineTo()</code> - ç»˜åˆ¶çº¿æ¡</li><li><code>arc()</code>, <code>arcTo()</code> - ç»˜åˆ¶åœ†å¼§</li><li><code>bezierCurveTo()</code> - ç»˜åˆ¶è´å¡å°”æ›²çº¿</li><li><code>rect()</code> - ç»˜åˆ¶çŸ©å½¢</li></ul><p>è¿™äº›æ–¹æ³•çš„ç‰¹ç‚¹æ˜¯ï¼šå®ƒä»¬å®šä¹‰çš„æ˜¯&quot;å½¢çŠ¶çš„æ•°å­¦æè¿°&quot;ï¼Œè€Œä¸æ˜¯å…·ä½“çš„åƒç´ ã€‚å®Œæˆè·¯å¾„å®šä¹‰åï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p><ul><li><code>stroke()</code> - æè¾¹ï¼ˆç»˜åˆ¶è½®å»“ï¼‰</li><li><code>fill()</code> - å¡«å……ï¼ˆå¡«å……å†…éƒ¨ï¼‰</li></ul><p><strong>2. ä½å›¾ç»˜åˆ¶ï¼ˆBitmap Drawingï¼‰</strong></p><p>è¿™æ˜¯å¤„ç†å›¾åƒæ•°æ®çš„æ–¹å¼ï¼š</p><ul><li><code>drawImage()</code> - å°†å›¾åƒç»˜åˆ¶åˆ°canvas</li><li><code>putImageData()</code> - ç›´æ¥æ“ä½œåƒç´ æ•°æ®</li><li><code>getImageData()</code> - è¯»å–åƒç´ æ•°æ®</li></ul><p>è¿™äº›æ–¹æ³•çš„ç‰¹ç‚¹æ˜¯ï¼šå®ƒä»¬å¤„ç†çš„æ˜¯&quot;å·²ç»ç¡®å®šçš„åƒç´ &quot;ï¼Œä¸æ˜¯æ•°å­¦å½¢çŠ¶ã€‚</p><h4 id="æˆ‘ä»¬çš„å›°å¢ƒ-maskæ˜¯ä½å›¾-ä¸æ˜¯çŸ¢é‡" tabindex="-1">æˆ‘ä»¬çš„å›°å¢ƒï¼šMaskæ˜¯ä½å›¾ï¼Œä¸æ˜¯çŸ¢é‡ <a class="header-anchor" href="#æˆ‘ä»¬çš„å›°å¢ƒ-maskæ˜¯ä½å›¾-ä¸æ˜¯çŸ¢é‡" aria-label="Permalink to &quot;æˆ‘ä»¬çš„å›°å¢ƒï¼šMaskæ˜¯ä½å›¾ï¼Œä¸æ˜¯çŸ¢é‡&quot;">â€‹</a></h4><p>SAMæ¨¡å‹è¿”å›çš„maskæ•°æ®æ˜¯<strong>åƒç´ çº§åˆ«çš„åˆ†å‰²ç»“æœ</strong>ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€å¼ ä½å›¾ï¼ˆbitmapï¼‰ï¼š</p><ul><li>æ¯ä¸ªåƒç´ è¦ä¹ˆé€æ˜ï¼ˆä¸å±äºè¯¥åˆ†åŒºï¼‰</li><li>è¦ä¹ˆä¸é€æ˜ï¼ˆå±äºè¯¥åˆ†åŒºï¼‰</li></ul><p>è¿™äº›maskå­˜å‚¨åœ¨Canvasä¸­ï¼Œæ˜¯çº¯ç²¹çš„åƒç´ æ•°æ®ã€‚å®ƒä»¬ä¸æ˜¯çŸ¢é‡è·¯å¾„ï¼Œæ²¡æœ‰&quot;è¾¹ç•Œçº¿&quot;çš„æ•°å­¦æè¿°ï¼Œåªæœ‰ä¸€å †åƒç´ ç‚¹ã€‚</p><h4 id="ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ç”¨stroke" tabindex="-1">ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ç”¨stroke()ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ç”¨stroke" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ç”¨stroke()ï¼Ÿ&quot;">â€‹</a></h4><p>Canvasçš„<code>stroke()</code>æ–¹æ³•åªèƒ½æç»˜è·¯å¾„ï¼Œè€Œä¸èƒ½æç»˜ä½å›¾ã€‚æˆ‘ä»¬æœ‰çš„æ˜¯è¿™æ ·çš„æ•°æ®ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>åƒç´ æ•°æ®ï¼ˆmaskï¼‰ï¼š</span></span>
<span class="line"><span>[0, 0, 0, 255, 255, 255, ...]  // 0=é€æ˜ï¼Œ255=ä¸é€æ˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è€Œ<code>stroke()</code>éœ€è¦çš„æ˜¯è¿™æ ·çš„æ•°æ®ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>è·¯å¾„æ•°æ®ï¼ˆpathï¼‰ï¼š</span></span>
<span class="line"><span>moveTo(10, 20)</span></span>
<span class="line"><span>lineTo(30, 40)</span></span>
<span class="line"><span>bezierCurveTo(50, 60, 70, 80, 90, 100)</span></span>
<span class="line"><span>...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>ç†è®ºä¸Šçš„è§£å†³æ–¹æ¡ˆ1ï¼šå°†ä½å›¾è½¬æ¢ä¸ºçŸ¢é‡è·¯å¾„</strong></p><p>å¯ä»¥é€šè¿‡ç®—æ³•å°†maskçš„è¾¹ç•Œè½¬æ¢ä¸ºçŸ¢é‡è·¯å¾„ï¼ˆæ¯”å¦‚ä½¿ç”¨Marching Squaresç®—æ³•ï¼‰ï¼Œç„¶åç”¨<code>stroke()</code>æè¾¹ã€‚</p><p>ä½†è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜æ˜¯ï¼š</p><ul><li>âŒ ç®—æ³•å¤æ‚åº¦é«˜ï¼Œæ€§èƒ½å¼€é”€å¤§</li><li>âŒ å¯¹äºå¤æ‚å½¢çŠ¶ï¼ˆå¦‚å¤´å‘ä¸ï¼‰ï¼Œä¼šç”Ÿæˆå¤§é‡çš„æ§åˆ¶ç‚¹</li><li>âŒ éœ€è¦é¢å¤–çš„åº“æˆ–æ‰‹å†™å¤æ‚ç®—æ³•</li><li>âŒ å®æ—¶å“åº”ï¼ˆhoveræ—¶ï¼‰ä¼šé€ æˆå¡é¡¿</li></ul><p><strong>ç†è®ºä¸Šçš„è§£å†³æ–¹æ¡ˆ2ï¼šé€åƒç´ ç»˜åˆ¶è¾¹ç•Œ</strong></p><p>éå†maskçš„æ¯ä¸ªåƒç´ ï¼Œæ£€æµ‹è¾¹ç•Œç‚¹ï¼ˆé€æ˜åƒç´ æ—è¾¹çš„ä¸é€æ˜åƒç´ ï¼‰ï¼Œç„¶åé€ä¸ªç»˜åˆ¶è¾¹æ¡†åƒç´ ã€‚</p><p>ä½†è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜æ˜¯ï¼š</p><ul><li>âŒ éœ€è¦åŒé‡å¾ªç¯éå†æ‰€æœ‰åƒç´ ï¼Œæ€§èƒ½æå·®</li><li>âŒ ç»˜åˆ¶å‡ºçš„è¾¹æ¡†æ²¡æœ‰æŠ—é”¯é½¿æ•ˆæœï¼Œå¾ˆç²—ç³™</li><li>âŒ è¾¹æ¡†å®½åº¦éš¾ä»¥æ§åˆ¶ï¼ˆåªèƒ½æ˜¯1åƒç´ çš„æ•´æ•°å€ï¼‰</li></ul><h4 id="æˆ‘ä»¬çš„å·§å¦™è§£å†³æ–¹æ¡ˆ-å†…é˜´å½±æŠ€æœ¯" tabindex="-1">æˆ‘ä»¬çš„å·§å¦™è§£å†³æ–¹æ¡ˆï¼šå†…é˜´å½±æŠ€æœ¯ <a class="header-anchor" href="#æˆ‘ä»¬çš„å·§å¦™è§£å†³æ–¹æ¡ˆ-å†…é˜´å½±æŠ€æœ¯" aria-label="Permalink to &quot;æˆ‘ä»¬çš„å·§å¦™è§£å†³æ–¹æ¡ˆï¼šå†…é˜´å½±æŠ€æœ¯&quot;">â€‹</a></h4><p>æ—¢ç„¶æ­£é¢è¿›æ”»ä¸å¯è¡Œï¼Œæˆ‘ä»¬æ¢ä¸€ä¸ªæ€è·¯ï¼š<strong>ä¸ç›´æ¥æè¾¹ï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ª&quot;çœ‹èµ·æ¥åƒè¾¹æ¡†&quot;çš„è§†è§‰æ•ˆæœ</strong>ã€‚</p><p>å…³é”®æ´å¯Ÿï¼š<strong>å†…é˜´å½±åœ¨è¾¹ç¼˜çš„æ•ˆæœï¼Œè§†è§‰ä¸Šç­‰åŒäºè¾¹æ¡†</strong></p><p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªç±»æ¯”ï¼š</p><ul><li>ä¸€ä¸ªä¸é€æ˜çš„å›¾å½¢ï¼Œå¦‚æœåœ¨è¾¹ç¼˜å†…ä¾§æœ‰ä¸€åœˆé˜´å½±</li><li>ä»è§†è§‰ä¸Šçœ‹ï¼Œè¿™åœˆé˜´å½±å°±åƒæ˜¯&quot;è¾¹æ¡†&quot;</li></ul><p>è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„æŠ€æœ¯ï¼š<strong>ä¸æ˜¯çœŸçš„æè¾¹ï¼Œè€Œæ˜¯åœ¨maskè¾¹ç¼˜ç”Ÿæˆå†…é˜´å½±</strong>ã€‚</p><h3 id="_3-3-å†…é˜´å½±æŠ€æœ¯çš„å®ç°åŸç†" tabindex="-1">3.3 å†…é˜´å½±æŠ€æœ¯çš„å®ç°åŸç† <a class="header-anchor" href="#_3-3-å†…é˜´å½±æŠ€æœ¯çš„å®ç°åŸç†" aria-label="Permalink to &quot;3.3 å†…é˜´å½±æŠ€æœ¯çš„å®ç°åŸç†&quot;">â€‹</a></h3><h4 id="æ ¸å¿ƒæ€è·¯" tabindex="-1">æ ¸å¿ƒæ€è·¯ <a class="header-anchor" href="#æ ¸å¿ƒæ€è·¯" aria-label="Permalink to &quot;æ ¸å¿ƒæ€è·¯&quot;">â€‹</a></h4><p>é¡¹ç›®ä½¿ç”¨**å†…é˜´å½±ï¼ˆInset Shadowï¼‰**æŠ€æœ¯å®ç°é«˜äº®ï¼Œæ•´ä½“æµç¨‹æ˜¯ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. å°†layer.maskCanvasä½œä¸º&quot;é®ç½©&quot;ï¼ˆå®šä¹‰å“ªäº›åŒºåŸŸéœ€è¦æ•ˆæœï¼‰</span></span>
<span class="line"><span>2. åˆ©ç”¨Canvasçš„shadowBlur APIåœ¨è¾¹ç¼˜ç”Ÿæˆæ¨¡ç³Šé˜´å½±</span></span>
<span class="line"><span>3. é€šè¿‡destination-inæ··åˆæ¨¡å¼ï¼Œå°†é˜´å½±é™åˆ¶åœ¨maskåŒºåŸŸå†…</span></span>
<span class="line"><span>4. é‡å¤å åŠ å¤šæ¬¡ï¼Œå¢å¼ºè¾¹æ¡†å¯è§åº¦</span></span>
<span class="line"><span>5. å°†æœ€ç»ˆç»“æœç»˜åˆ¶åˆ°selectionCanvasä¸Šæ˜¾ç¤º</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆå¯è¡Œ" tabindex="-1">ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆå¯è¡Œï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆå¯è¡Œ" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆå¯è¡Œï¼Ÿ&quot;">â€‹</a></h4><p>Canvasæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„é˜´å½±APIï¼š</p><ul><li><code>shadowBlur</code> - é˜´å½±çš„æ¨¡ç³ŠåŠå¾„</li><li><code>shadowColor</code> - é˜´å½±çš„é¢œè‰²</li><li><code>shadowOffsetX/Y</code> - é˜´å½±çš„åç§»</li></ul><p>è¿™ä¸ªAPIåŸæœ¬æ˜¯ç”¨æ¥ç»™å›¾å½¢æ·»åŠ æŠ•å½±æ•ˆæœçš„ï¼ˆç±»ä¼¼CSSçš„<code>box-shadow</code>ï¼‰ï¼Œä½†æˆ‘ä»¬å¯ä»¥&quot;æ»¥ç”¨&quot;å®ƒæ¥åˆ›é€ è¾¹æ¡†æ•ˆæœã€‚</p><p>å…³é”®æŠ€å·§ï¼š</p><ol><li>ä½¿ç”¨maskä½œä¸ºé®ç½©ï¼Œé™åˆ¶é˜´å½±åªå‡ºç°åœ¨maskåŒºåŸŸå†…</li><li>è®¾ç½®<code>shadowOffsetX/Y = 0</code>ï¼Œè®©é˜´å½±ä¸åç§»</li><li>è®¾ç½®è¾ƒå¤§çš„<code>shadowBlur</code>ï¼Œè®©é˜´å½±åœ¨è¾¹ç¼˜æ‰©æ•£</li><li>å¡«å……æ•´ä¸ªåŒºåŸŸï¼Œè§¦å‘é˜´å½±æ•ˆæœ</li><li>ç”±äºæ··åˆæ¨¡å¼é™åˆ¶ï¼Œé˜´å½±åªä¼šå‡ºç°åœ¨è¾¹ç¼˜ï¼ˆä¸­å¿ƒè¢«é®æŒ¡ï¼‰</li></ol><h3 id="_3-4-å®ç°æ–¹æ¡ˆ-å†…é˜´å½±æŠ€æœ¯" tabindex="-1">3.4 å®ç°æ–¹æ¡ˆï¼šå†…é˜´å½±æŠ€æœ¯ <a class="header-anchor" href="#_3-4-å®ç°æ–¹æ¡ˆ-å†…é˜´å½±æŠ€æœ¯" aria-label="Permalink to &quot;3.4 å®ç°æ–¹æ¡ˆï¼šå†…é˜´å½±æŠ€æœ¯&quot;">â€‹</a></h3><p>é¡¹ç›®ä½¿ç”¨**å†…é˜´å½±ï¼ˆInset Shadowï¼‰**æŠ€æœ¯å®ç°é«˜äº®ï¼Œæ ¸å¿ƒæ€è·¯ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. å°†layer.maskCanvasä½œä¸º&quot;é®ç½©&quot;</span></span>
<span class="line"><span>2. ä½¿ç”¨å†…é˜´å½±åœ¨é®ç½©è¾¹ç¼˜ç”Ÿæˆè¾¹æ¡†æ•ˆæœ</span></span>
<span class="line"><span>3. å°†ç»“æœç»˜åˆ¶åˆ°selectionCanvasä¸Š</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-3-æ ¸å¿ƒä»£ç è§£æ" tabindex="-1">3.3 æ ¸å¿ƒä»£ç è§£æ <a class="header-anchor" href="#_3-3-æ ¸å¿ƒä»£ç è§£æ" aria-label="Permalink to &quot;3.3 æ ¸å¿ƒä»£ç è§£æ&quot;">â€‹</a></h3><h4 id="æ­¥éª¤1-addbordertocanvaså…¥å£" tabindex="-1"><strong>æ­¥éª¤1ï¼šaddBorderToCanvaså…¥å£</strong> <a class="header-anchor" href="#æ­¥éª¤1-addbordertocanvaså…¥å£" aria-label="Permalink to &quot;**æ­¥éª¤1ï¼šaddBorderToCanvaså…¥å£**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// use-auto-masks.ts (132-137è¡Œ)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addBorderToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layer.maskCanvas, hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  borderWidth:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layer.maskCanvas.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pixelRatio.value,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  borderColor: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AUTO_MASK_HOVER_BORDER_COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// #33C8E6 é’è‰²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p><ul><li><code>layer.maskCanvas</code>ï¼šæºmaskå›¾åƒï¼ˆè¦æè¾¹çš„å›¾åƒï¼‰</li><li><code>hoverCanvasRef.value!</code>ï¼šç›®æ ‡canvasï¼ˆæ˜¾ç¤ºé«˜äº®çš„canvasï¼‰</li><li><code>borderWidth</code>ï¼šè¾¹æ¡†å®½åº¦ï¼ˆå“åº”å¼è®¡ç®—ï¼‰</li><li><code>borderColor</code>ï¼šè¾¹æ¡†é¢œè‰²ï¼ˆé’è‰²ï¼‰</li></ul><h4 id="æ­¥éª¤2-å†…é˜´å½±ç”Ÿæˆ" tabindex="-1"><strong>æ­¥éª¤2ï¼šå†…é˜´å½±ç”Ÿæˆ</strong> <a class="header-anchor" href="#æ­¥éª¤2-å†…é˜´å½±ç”Ÿæˆ" aria-label="Permalink to &quot;**æ­¥éª¤2ï¼šå†…é˜´å½±ç”Ÿæˆ**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// utils/canvas.ts (114-145è¡Œ)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addBorderToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  sourceCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// layer.maskCanvas</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  targetCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// selectionCanvas</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    borderColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    borderWidth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> targetCtx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> targetCanvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤2.1ï¼šç”Ÿæˆå†…é˜´å½±</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> insetShadowCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addInsetShadowToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, targetCanvas, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    blur: options.borderWidth, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¨¡ç³ŠåŠå¾„ = è¾¹æ¡†å®½åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    color: options.borderColor, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾¹æ¡†é¢œè‰²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    offsetX: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    offsetY: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤2.2ï¼šå¼ºåŒ–è¾¹æ¡†æ•ˆæœï¼ˆå¤šæ¬¡ç»˜åˆ¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> insetShadowCtx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> insetShadowCanvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // é‡å¤ç»˜åˆ¶50æ¬¡ï¼Œå¢å¼ºæ•ˆæœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    insetShadowCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      insetShadowCanvas,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      insetShadowCanvas.width,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      insetShadowCanvas.height,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤2.3ï¼šç»˜åˆ¶åˆ°ç›®æ ‡canvas</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  targetCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(insetShadowCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, targetCanvas.width, targetCanvas.height);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cleanCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(insetShadowCanvas);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h4 id="æ­¥éª¤3-å†…é˜´å½±æ ¸å¿ƒç®—æ³•" tabindex="-1"><strong>æ­¥éª¤3ï¼šå†…é˜´å½±æ ¸å¿ƒç®—æ³•</strong> <a class="header-anchor" href="#æ­¥éª¤3-å†…é˜´å½±æ ¸å¿ƒç®—æ³•" aria-label="Permalink to &quot;**æ­¥éª¤3ï¼šå†…é˜´å½±æ ¸å¿ƒç®—æ³•**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// utils/canvas.ts (56-109è¡Œ)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addInsetShadowToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  sourceCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  targetCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLCanvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">blur</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">offsetX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">offsetY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> targetCanvas;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(width, height);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resultCtx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resultCanvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤3.1ï¼šç»˜åˆ¶æºå›¾åƒï¼ˆä½œä¸ºé®ç½©ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤3.2ï¼šè®¾ç½®æ··åˆæ¨¡å¼ä¸º&quot;destination-in&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ•ˆæœï¼šåªä¿ç•™æºå›¾åƒçš„éé€æ˜åŒºåŸŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.globalCompositeOperation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;destination-in&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤3.3ï¼šæ¢å¤æ··åˆæ¨¡å¼ï¼Œç»˜åˆ¶é˜´å½±</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.globalCompositeOperation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;source-over&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤3.4ï¼šåº”ç”¨é˜´å½±æ»¤é•œï¼ˆæ¨¡æ‹Ÿå†…é˜´å½±ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.shadowBlur </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> options.blur;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.shadowColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> options.color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.shadowOffsetX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> options.offsetX;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.shadowOffsetY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> options.offsetY;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤3.5ï¼šç»˜åˆ¶å¡«å……ï¼ˆè§¦å‘é˜´å½±ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.fillStyle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> options.color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ­¥éª¤3.6ï¼šåº”ç”¨é¢œè‰²ï¼ˆå¯é€‰ï¼Œç”¨äºé¢„è§ˆï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> colorCanvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> colorizeCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resultCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AUTO_MASK_HOVER_FILL_COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clearRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(colorCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cleanCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(colorCanvas);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resultCanvas;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="_3-4-æŠ€æœ¯åŸç†å›¾è§£" tabindex="-1">3.4 æŠ€æœ¯åŸç†å›¾è§£ <a class="header-anchor" href="#_3-4-æŠ€æœ¯åŸç†å›¾è§£" aria-label="Permalink to &quot;3.4 æŠ€æœ¯åŸç†å›¾è§£&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>åŸå§‹maskCanvasï¼ˆé»‘ç™½maskï¼‰</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>[æ­¥éª¤1] ç»˜åˆ¶åˆ°ä¸´æ—¶canvas</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>[æ­¥éª¤2] ä½¿ç”¨destination-inæ··åˆæ¨¡å¼</span></span>
<span class="line"><span>    â†“  ï¼ˆåªä¿ç•™éé€æ˜åŒºåŸŸï¼‰</span></span>
<span class="line"><span>[æ­¥éª¤3] åº”ç”¨å†…é˜´å½±</span></span>
<span class="line"><span>    â†“  ï¼ˆshadowBluråœ¨è¾¹ç¼˜ç”Ÿæˆå…‰æ™•ï¼‰</span></span>
<span class="line"><span>[æ­¥éª¤4] é‡å¤ç»˜åˆ¶50æ¬¡</span></span>
<span class="line"><span>    â†“  ï¼ˆå¼ºåŒ–è¾¹æ¡†æ•ˆæœï¼‰</span></span>
<span class="line"><span>[æ­¥éª¤5] ç»˜åˆ¶åˆ°selectionCanvas</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>æœ€ç»ˆæ•ˆæœï¼šé’è‰²è¾¹æ¡†é«˜äº®</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-5-å…³é”®æŠ€æœ¯ç‚¹" tabindex="-1">3.5 å…³é”®æŠ€æœ¯ç‚¹ <a class="header-anchor" href="#_3-5-å…³é”®æŠ€æœ¯ç‚¹" aria-label="Permalink to &quot;3.5 å…³é”®æŠ€æœ¯ç‚¹&quot;">â€‹</a></h3><h4 id="_1-æ··åˆæ¨¡å¼-destination-in" tabindex="-1"><strong>1. æ··åˆæ¨¡å¼ï¼šdestination-in</strong> <a class="header-anchor" href="#_1-æ··åˆæ¨¡å¼-destination-in" aria-label="Permalink to &quot;**1. æ··åˆæ¨¡å¼ï¼šdestination-in**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.globalCompositeOperation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;destination-in&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong></p><ul><li>åªä¿ç•™ç›®æ ‡canvasä¸­ä¸æºå›¾åƒé‡å çš„éé€æ˜åŒºåŸŸ</li><li>ç›¸å½“äº&quot;é®ç½©&quot;æ•ˆæœ</li><li>ç¡®ä¿é˜´å½±åªåœ¨maskåŒºåŸŸå†…æ˜¾ç¤º</li></ul><h4 id="_2-å†…é˜´å½±æ¨¡æ‹Ÿ" tabindex="-1"><strong>2. å†…é˜´å½±æ¨¡æ‹Ÿ</strong> <a class="header-anchor" href="#_2-å†…é˜´å½±æ¨¡æ‹Ÿ" aria-label="Permalink to &quot;**2. å†…é˜´å½±æ¨¡æ‹Ÿ**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.shadowBlur </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> options.borderWidth;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.shadowColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> options.borderColor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>åŸç†ï¼š</strong></p><ul><li>Canvasçš„<code>shadowBlur</code>ä¼šåœ¨ç»˜åˆ¶å†…å®¹çš„è¾¹ç¼˜ç”Ÿæˆæ¨¡ç³Šé˜´å½±</li><li>é€šè¿‡å¡«å……æ•´ä¸ªcanvasï¼Œåœ¨maskè¾¹ç¼˜ç”Ÿæˆå…‰æ™•æ•ˆæœ</li><li>æ¨¡æ‹Ÿ&quot;å†…é˜´å½±&quot;çš„è§†è§‰æ•ˆæœ</li></ul><h4 id="_3-é‡å¤ç»˜åˆ¶å¼ºåŒ–" tabindex="-1"><strong>3. é‡å¤ç»˜åˆ¶å¼ºåŒ–</strong> <a class="header-anchor" href="#_3-é‡å¤ç»˜åˆ¶å¼ºåŒ–" aria-label="Permalink to &quot;**3. é‡å¤ç»˜åˆ¶å¼ºåŒ–**&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    insetShadowCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(insetShadowCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>ç›®çš„ï¼š</strong></p><ul><li>å¤šæ¬¡å åŠ é˜´å½±ï¼Œä½¿è¾¹æ¡†æ›´æ˜æ˜¾</li><li>å¢å¼ºè§†è§‰æ•ˆæœ</li><li>è™½ç„¶æ€§èƒ½æœ‰æŸè€—ï¼Œä½†hoveræ“ä½œé¢‘ç‡ä½ï¼Œå¯æ¥å—</li></ul><h3 id="_3-6-å“åº”å¼è¾¹æ¡†å®½åº¦" tabindex="-1">3.6 å“åº”å¼è¾¹æ¡†å®½åº¦ <a class="header-anchor" href="#_3-6-å“åº”å¼è¾¹æ¡†å®½åº¦" aria-label="Permalink to &quot;3.6 å“åº”å¼è¾¹æ¡†å®½åº¦&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">borderWidth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layer.maskCanvas.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  pixelRatio.value;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>è®¡ç®—é€»è¾‘ï¼š</strong></p><ul><li><code>2 * layer.maskCanvas.width / hoverCanvasRef.value!.width</code>ï¼šæ ¹æ®canvasç¼©æ”¾æ¯”ä¾‹è®¡ç®—</li><li><code>* pixelRatio.value</code>ï¼šè€ƒè™‘è®¾å¤‡DPI</li><li><code>Math.max(1, ...)</code>ï¼šç¡®ä¿æœ€å°1pxï¼Œé¿å…é«˜DPIè®¾å¤‡è¾¹æ¡†è¿‡ç»†</li></ul><h3 id="_3-7-æ€§èƒ½ä¼˜åŒ–è€ƒè™‘" tabindex="-1">3.7 æ€§èƒ½ä¼˜åŒ–è€ƒè™‘ <a class="header-anchor" href="#_3-7-æ€§èƒ½ä¼˜åŒ–è€ƒè™‘" aria-label="Permalink to &quot;3.7 æ€§èƒ½ä¼˜åŒ–è€ƒè™‘&quot;">â€‹</a></h3><p><strong>å½“å‰å®ç°ï¼š</strong></p><ul><li>âœ… ä½¿ç”¨èŠ‚æµï¼šhoveräº‹ä»¶æœ¬èº«ä¸éœ€è¦èŠ‚æµï¼ˆå·²ç”±æµè§ˆå™¨ä¼˜åŒ–ï¼‰</li><li>âœ… ç¦»å±canvasï¼šä½¿ç”¨ä¸´æ—¶canvasï¼Œé¿å…æ±¡æŸ“ä¸»canvas</li><li>âœ… åŠæ—¶æ¸…ç†ï¼šä½¿ç”¨<code>cleanCanvas</code>é‡Šæ”¾å†…å­˜</li></ul><p><strong>æ½œåœ¨ä¼˜åŒ–ï¼š</strong></p><ul><li>âš ï¸ é‡å¤ç»˜åˆ¶50æ¬¡å¯èƒ½å½±å“æ€§èƒ½ï¼ˆä½†hoveré¢‘ç‡ä½ï¼Œå¯æ¥å—ï¼‰</li><li>ğŸ’¡ å¯ä»¥è€ƒè™‘ä½¿ç”¨WebGLåŠ é€Ÿ</li><li>ğŸ’¡ å¯ä»¥ç¼“å­˜é«˜äº®ç»“æœï¼ˆç›¸åŒlayerä¸é‡å¤è®¡ç®—ï¼‰</li></ul><h3 id="_3-8-é«˜äº®å®ç°çš„æ·±åº¦è§£æ-è¯¦ç»†æ–‡å­—è¯´æ˜" tabindex="-1">3.8 é«˜äº®å®ç°çš„æ·±åº¦è§£æï¼ˆè¯¦ç»†æ–‡å­—è¯´æ˜ï¼‰ <a class="header-anchor" href="#_3-8-é«˜äº®å®ç°çš„æ·±åº¦è§£æ-è¯¦ç»†æ–‡å­—è¯´æ˜" aria-label="Permalink to &quot;3.8 é«˜äº®å®ç°çš„æ·±åº¦è§£æï¼ˆè¯¦ç»†æ–‡å­—è¯´æ˜ï¼‰&quot;">â€‹</a></h3><h4 id="ä¸ºä»€ä¹ˆcanvasæè¾¹è¿™ä¹ˆå›°éš¾" tabindex="-1">ä¸ºä»€ä¹ˆCanvasæè¾¹è¿™ä¹ˆå›°éš¾ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆcanvasæè¾¹è¿™ä¹ˆå›°éš¾" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆCanvasæè¾¹è¿™ä¹ˆå›°éš¾ï¼Ÿ&quot;">â€‹</a></h4><p>åœ¨Canvasä¸­ï¼Œå¦‚æœè¦ç»™çŸ©å½¢æˆ–åœ†å½¢æè¾¹éå¸¸ç®€å•ï¼Œä½†æˆ‘ä»¬é¢å¯¹çš„maskæ˜¯<strong>åƒç´ ä½å›¾</strong>â€”â€”æˆåƒä¸Šä¸‡ä¸ªåƒç´ ç‚¹ç»„æˆçš„ä¸è§„åˆ™å½¢çŠ¶ï¼ˆäººç‰©è½®å»“ã€å¤´å‘ä¸ã€æ‰‹æŒ‡ç­‰ï¼‰ï¼Œæ ¹æœ¬æ²¡æœ‰ç®€å•çš„å‡ ä½•è·¯å¾„å¯ä»¥æè¿°ã€‚</p><p><strong>æ ¸å¿ƒçŸ›ç›¾ï¼š</strong> Canvasçš„<code>stroke()</code>åªèƒ½æè·¯å¾„ï¼Œä¸èƒ½æä½å›¾çš„è¾¹ç•Œã€‚</p><p>è™½ç„¶ç†è®ºä¸Šå¯ä»¥é€šè¿‡ç®—æ³•å°†ä½å›¾è¾¹ç•Œæå–ä¸ºçŸ¢é‡è·¯å¾„ï¼Œä½†è¿™ä¼šå¸¦æ¥ï¼šè®¡ç®—é‡å¤§ã€è·¯å¾„å¤æ‚ã€å®æ—¶æ€§å·®ã€æŠ—é”¯é½¿å·®ç­‰é—®é¢˜ã€‚åœ¨ç”¨æˆ·hoveræ—¶éœ€è¦ç«‹å³å“åº”ï¼Œæ²¡æœ‰æ—¶é—´åšå¤æ‚è®¡ç®—ã€‚</p><h4 id="å†…é˜´å½±æŠ€æœ¯çš„å·§å¦™æ€è·¯" tabindex="-1">å†…é˜´å½±æŠ€æœ¯çš„å·§å¦™æ€è·¯ <a class="header-anchor" href="#å†…é˜´å½±æŠ€æœ¯çš„å·§å¦™æ€è·¯" aria-label="Permalink to &quot;å†…é˜´å½±æŠ€æœ¯çš„å·§å¦™æ€è·¯&quot;">â€‹</a></h4><p>æ—¢ç„¶æ­£é¢æè¾¹å¾ˆéš¾ï¼Œæˆ‘ä»¬æ¢ä¸ªæ€è·¯ï¼š<strong>èƒ½ä¸èƒ½åˆ›é€ ä¸€ä¸ª&quot;çœ‹èµ·æ¥åƒè¾¹æ¡†&quot;çš„è§†è§‰æ•ˆæœï¼Ÿ</strong></p><p>å¦‚æœåœ¨maskçš„è¾¹ç¼˜å†…ä¾§ç”Ÿæˆä¸€åœˆæ¨¡ç³Šçš„é¢œè‰²ï¼Œä»è§†è§‰ä¸Šçœ‹ï¼Œè¿™å°±æ˜¯&quot;è¾¹æ¡†&quot;ï¼è¿™å°±æ˜¯<strong>å†…é˜´å½±ï¼ˆInset Shadowï¼‰æŠ€æœ¯</strong>çš„æ ¸å¿ƒæ€æƒ³ã€‚</p><h4 id="ç®—æ³•çš„é€æ­¥å·¥ä½œåŸç†" tabindex="-1">ç®—æ³•çš„é€æ­¥å·¥ä½œåŸç† <a class="header-anchor" href="#ç®—æ³•çš„é€æ­¥å·¥ä½œåŸç†" aria-label="Permalink to &quot;ç®—æ³•çš„é€æ­¥å·¥ä½œåŸç†&quot;">â€‹</a></h4><p><strong>æ­¥éª¤1ï¼šåˆ›å»ºæ²™ç›’ç¯å¢ƒï¼ˆä¸´æ—¶canvasï¼‰</strong></p><p>å°±åƒåšèœè¦å…ˆå‡†å¤‡æ¡ˆæ¿ï¼Œæˆ‘ä»¬åˆ›å»ºä¸´æ—¶ç”»å¸ƒï¼ˆresultCanvasï¼‰ï¼Œåœ¨ä¸Šé¢å®Œæˆæ‰€æœ‰æ“ä½œï¼Œé¿å…&quot;æ±¡æŸ“&quot;ç›®æ ‡ç”»å¸ƒã€‚è¿™æ ·ä¸‡ä¸€å‡ºé”™å¯ä»¥å®‰å…¨å›é€€ã€‚</p><p><strong>æ­¥éª¤2ï¼šå»ºç«‹&quot;ä¸å¯é€¾è¶Šçš„è¾¹ç•Œ&quot;ï¼ˆdestination-inæ··åˆæ¨¡å¼ï¼‰</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.globalCompositeOperation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;destination-in&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™ä¸€æ­¥çœ‹èµ·æ¥å¥‡æ€ªâ€”â€”ä¸ºä»€ä¹ˆæŠŠåŒä¸€ä¸ªå›¾åƒå†ç”»ä¸€éï¼Ÿ</p><p>æƒ³è±¡ä½ åœ¨çº¸ä¸Šç”»äº†äººç‰©è½®å»“ï¼Œè¦ç»™è½®å»“æ¶‚è‰²ï¼Œä½†é¢œè‰²ç»å¯¹ä¸èƒ½è¶…å‡ºè½®å»“çº¿ã€‚ä½ ä¼šå…ˆç”¨é€æ˜èƒ¶å¸¦æŠŠè½®å»“çº¿å¤–çš„åŒºåŸŸå…¨éƒ¨å°ä½ã€‚</p><p><code>destination-in</code>æ··åˆæ¨¡å¼å°±æ˜¯è¿™ä¸ª&quot;é€æ˜èƒ¶å¸¦&quot;ï¼Œå®ƒçš„è§„åˆ™æ˜¯ï¼š<strong>åªä¿ç•™ä¸maské‡å çš„ä¸é€æ˜åŒºåŸŸ</strong>ã€‚è™½ç„¶è§†è§‰ä¸Šæ²¡å˜åŒ–ï¼Œä½†canvaså·²ç»è¢«&quot;åŠ å¯†&quot;äº†â€”â€”åç»­ä»»ä½•ç»˜åˆ¶éƒ½ä¼šè¢«é™åˆ¶åœ¨maskåŒºåŸŸå†…ï¼Œå»ºç«‹äº†ä¸€ä¸ª&quot;ä¸å¯é€¾è¶Šçš„è¾¹ç•Œ&quot;ã€‚</p><p><strong>æ­¥éª¤3ï¼šé…ç½®é˜´å½±å‚æ•°</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.shadowBlur </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¨¡ç³ŠåŠå¾„4åƒç´ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.shadowColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;#33C8E6&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é’è‰²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.shadowOffset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸åç§»</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¿™ä¸€æ­¥æ˜¯åœ¨&quot;è®¾ç½®é­”æ³•å’’è¯­&quot;ã€‚æˆ‘ä»¬å‘Šè¯‰Canvasï¼š&quot;æ¥ä¸‹æ¥å¦‚æœæœ‰ä¸œè¥¿è¢«ç”»å‡ºæ¥ï¼Œè¯·è‡ªåŠ¨ç»™å®ƒåŠ ä¸Šé˜´å½±&quot;ã€‚ä½†è¿™åªæ˜¯è®¾ç½®ï¼Œè¿˜æ²¡æœ‰çœŸæ­£ç”»ä¸œè¥¿ã€‚</p><p>å…³é”®ç‚¹ï¼š</p><ul><li><code>shadowBlur</code>æ§åˆ¶æ¨¡ç³Šç¨‹åº¦ï¼Œå€¼è¶Šå¤§æ‰©æ•£è¶Šè¿œ</li><li><code>shadowColor</code>ç”¨é’è‰²ï¼ˆä¸æ˜¯ä¼ ç»Ÿçš„é»‘è‰²æŠ•å½±ï¼‰ï¼Œå› ä¸ºè¦åšé«˜äº®</li><li><code>shadowOffset = 0</code>ä¸åç§»ï¼Œè®©é˜´å½±å›´ç»•å¯¹è±¡å‡åŒ€æ‰©æ•£</li></ul><p><strong>å½“é˜´å½±ä¸åç§»æ—¶ï¼Œå®ƒä¼šåœ¨å¯¹è±¡è¾¹ç¼˜å‡åŒ€æ‰©æ•£ï¼Œè¿™åœ¨è§†è§‰ä¸Šå°±æ˜¯&quot;è¾¹æ¡†&quot;ï¼</strong></p><p><strong>æ­¥éª¤4ï¼šè§¦å‘é˜´å½±æ•ˆæœ</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resultCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ç”¨é’è‰²å¡«å……æ•´ä¸ªcanvasã€‚ç­‰ç­‰ï¼Œè¿™ä¸ä¼šæŠŠæ•´ä¸ªç”»å¸ƒéƒ½æ¶‚æˆé’è‰²å—ï¼Ÿ</p><p>ä¸ä¼šï¼å› ä¸ºæ­¥éª¤2çš„&quot;é€æ˜èƒ¶å¸¦&quot;ä¿æŠ¤ï¼Œåªæœ‰maskçš„ä¸é€æ˜åŒºåŸŸä¼šè¢«æ¶‚è‰²ã€‚</p><p><strong>é˜´å½±çš„è§¦å‘æœºåˆ¶ï¼š</strong> Canvasçš„é˜´å½±åªæœ‰åœ¨&quot;ç»˜åˆ¶æ“ä½œ&quot;å‘ç”Ÿæ—¶æ‰ä¼šè§¦å‘ã€‚<code>fillRect</code>å°±æ˜¯è¿™ä¸ªè§¦å‘åŠ¨ä½œã€‚Canvasä¼šåœ¨è¢«å¡«å……åŒºåŸŸçš„è¾¹ç¼˜è‡ªåŠ¨ç”Ÿæˆé˜´å½±ã€‚</p><p><strong>ä¸ºä»€ä¹ˆé˜´å½±åªåœ¨è¾¹ç¼˜ï¼Ÿ</strong> é˜´å½±å‘å†…å¤–ä¸¤ä¾§æ‰©æ•£ï¼Œå¤–ä¾§è¢«maskè¾¹ç•Œæˆªæ–­ï¼Œå†…ä¾§ä¿ç•™ä¸‹æ¥å½¢æˆ&quot;å†…é˜´å½±&quot;ï¼Œè€Œä¸­å¿ƒè¢«å¡«å……é¢œè‰²è¦†ç›–çœ‹ä¸åˆ°é˜´å½±ã€‚</p><p><strong>æ­¥éª¤5ï¼šå¼ºåŒ–æ•ˆæœï¼ˆé‡å¤ç»˜åˆ¶50æ¬¡ï¼‰</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  insetShadowCtx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(insetShadowCanvas, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¿™çœ‹èµ·æ¥å¾ˆå¥‡æ€ªâ€”â€”æŠŠcanvasç”»åˆ°è‡ªå·±èº«ä¸Š50æ¬¡ï¼Ÿ</p><p>æƒ³è±¡ç”¨æ°´å½©ç¬”ç”»ç”»ï¼šä¸€æ¬¡æ¶‚æŠ¹é¢œè‰²å¾ˆæ·¡ï¼Œæ¶‚50æ¬¡é¢œè‰²éå¸¸é²œè‰³ã€‚</p><p><strong>é—®é¢˜ï¼š</strong> åˆå§‹é˜´å½±å¤ªæ·¡ï¼ˆå› ä¸ºæ¨¡ç³Šç®—æ³•ä¼šé™ä½ä¸é€æ˜åº¦ï¼‰ <strong>è§£å†³ï¼š</strong> é€šè¿‡å åŠ ç»˜åˆ¶ç´¯ç§¯ä¸é€æ˜åº¦ï¼Œè®©è¾¹æ¡†ä»æ·¡é’è‰²å˜æˆæ¸…æ™°çš„é’è‰²è¾¹æ¡†</p><p>50æ¬¡æ˜¯ç»éªŒå€¼ï¼Œåœ¨&quot;æ¸…æ™°åº¦&quot;å’Œ&quot;æ€§èƒ½&quot;ä¹‹é—´å–å¾—å¹³è¡¡ã€‚</p><h4 id="è¾¹æ¡†å®½åº¦çš„è‡ªé€‚åº”è®¡ç®—" tabindex="-1">è¾¹æ¡†å®½åº¦çš„è‡ªé€‚åº”è®¡ç®— <a class="header-anchor" href="#è¾¹æ¡†å®½åº¦çš„è‡ªé€‚åº”è®¡ç®—" aria-label="Permalink to &quot;è¾¹æ¡†å®½åº¦çš„è‡ªé€‚åº”è®¡ç®—&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">borderWidth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layer.maskCanvas.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hoverCanvasRef.value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.width) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  pixelRatio.value;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™ä¸ªå…¬å¼çš„ç›®çš„ï¼š<strong>è®©è¾¹æ¡†åœ¨ä»»ä½•ç¼©æ”¾çº§åˆ«å’Œä»»ä½•è®¾å¤‡ä¸Šéƒ½&quot;çœ‹èµ·æ¥ä¸€æ ·ç²—&quot;</strong>ã€‚</p><p>å¦‚æœå›ºå®š4åƒç´ ï¼šåŸå§‹mask 2000pxå®½æ—¶è¾¹æ¡†å 0.2%ï¼Œç¼©å°åˆ°500pxæ—¶è¾¹æ¡†è¿˜æ˜¯4pxï¼Œå æ¯”å˜æˆ0.8%ï¼Œçœ‹èµ·æ¥å˜ç²—äº†4å€ï¼</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ¹æ®ç¼©æ”¾æ¯”ä¾‹è°ƒæ•´ï¼ˆmaskç¼©å°4å€ï¼Œè¾¹æ¡†å°±æ”¾å¤§8å€ï¼‰</li><li>ç¬¬äºŒéƒ¨åˆ†ï¼š<code>Math.max(1, ...)</code>ç¡®ä¿è‡³å°‘1åƒç´ </li><li>ç¬¬ä¸‰éƒ¨åˆ†ï¼š<code>* pixelRatio</code>é€‚é…é«˜DPIå±å¹•ï¼ˆRetinaå±å¹•ç¿»å€ï¼‰</li></ul><p>æœ€ç»ˆç»“æœï¼šæ— è®ºä»€ä¹ˆè®¾å¤‡ã€ä»€ä¹ˆç¼©æ”¾ï¼Œè¾¹æ¡†çš„è§†è§‰ç²—ç»†éƒ½ä¿æŒä¸€è‡´ã€‚</p><h4 id="å®Œæ•´æµç¨‹çš„è§†è§‰å˜åŒ–" tabindex="-1">å®Œæ•´æµç¨‹çš„è§†è§‰å˜åŒ– <a class="header-anchor" href="#å®Œæ•´æµç¨‹çš„è§†è§‰å˜åŒ–" aria-label="Permalink to &quot;å®Œæ•´æµç¨‹çš„è§†è§‰å˜åŒ–&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ­¥éª¤</th><th>è§†è§‰æ•ˆæœ</th><th>æ ¸å¿ƒå˜åŒ–</th></tr></thead><tbody><tr><td>æ­¥éª¤1</td><td>ç™½è‰²äººç‰©è½®å»“</td><td>å¤åˆ¶maskåˆ°ä¸´æ—¶canvas</td></tr><tr><td>æ­¥éª¤2</td><td>ç™½è‰²äººç‰©è½®å»“ï¼ˆçœ‹ä¼¼æ²¡å˜ï¼‰</td><td><strong>å†…éƒ¨å»ºç«‹è¾¹ç•Œè§„åˆ™ï¼ˆå…³é”®ï¼ï¼‰</strong></td></tr><tr><td>æ­¥éª¤3-4</td><td>ç™½è‰²äººç‰©è½®å»“</td><td>é…ç½®é˜´å½±å‚æ•°</td></tr><tr><td>æ­¥éª¤5</td><td>é’è‰²è½®å»“ + æ·¡é’è‰²è¾¹ç¼˜å…‰æ™•</td><td><strong>è§¦å‘é˜´å½±ï¼Œç”Ÿæˆå†…è¾¹æ¡†ï¼ˆå…³é”®ï¼ï¼‰</strong></td></tr><tr><td>æ­¥éª¤6</td><td>é’è‰²è½®å»“ + <strong>æ¸…æ™°çš„</strong>é’è‰²è¾¹æ¡†</td><td><strong>å¼ºåŒ–50æ¬¡ï¼Œè¾¹æ¡†æ˜æ˜¾ï¼ˆå…³é”®ï¼ï¼‰</strong></td></tr></tbody></table><p>å…³é”®è½¬æŠ˜ç‚¹åœ¨æ­¥éª¤2ï¼ˆå»ºç«‹è¾¹ç•Œï¼‰ã€æ­¥éª¤5ï¼ˆè§¦å‘é˜´å½±ï¼‰ã€æ­¥éª¤6ï¼ˆå¼ºåŒ–æ•ˆæœï¼‰ã€‚</p><h4 id="è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿" tabindex="-1">è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿ <a class="header-anchor" href="#è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿" aria-label="Permalink to &quot;è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿&quot;">â€‹</a></h4><ol><li><strong>æ€§èƒ½å¥½ï¼š</strong> åˆ©ç”¨CanvasåŸç”Ÿé˜´å½±APIï¼ŒGPUåŠ é€Ÿï¼Œå®æ—¶å“åº”</li><li><strong>æ•ˆæœå¥½ï¼š</strong> è‡ªç„¶çš„æ¨¡ç³Šè¾¹ç¼˜ï¼ŒæŠ—é”¯é½¿ï¼Œè§†è§‰èˆ’é€‚</li><li><strong>é€‚åº”æ€§å¼ºï¼š</strong> å¯å¤„ç†ä»»æ„å¤æ‚å½¢çŠ¶ï¼ˆå¤´å‘ä¸ã€æ‰‹æŒ‡ç­‰ï¼‰</li><li><strong>å®ç°ç®€å•ï¼š</strong> ä¸éœ€è¦å¤æ‚çš„è¾¹ç•Œæå–ç®—æ³•</li><li><strong>å¯æ§æ€§å¼ºï¼š</strong> è¾¹æ¡†å®½åº¦ã€é¢œè‰²ã€æ¨¡ç³Šåº¦éƒ½å¯çµæ´»è°ƒæ•´</li></ol><p><strong>æ ¸å¿ƒæ´å¯Ÿï¼š</strong> é€šè¿‡&quot;æ»¥ç”¨&quot;Canvasçš„é˜´å½±APIï¼Œå°†ä¼ ç»Ÿçš„æŠ•å½±æ•ˆæœè½¬åŒ–ä¸ºè¾¹æ¡†æ•ˆæœã€‚è¿™ç§&quot;è·¨ç•Œä½¿ç”¨&quot;æ­£æ˜¯ç®—æ³•å·§å¦™ä¹‹å¤„ã€‚</p><hr><h2 id="å››ã€å®Œæ•´æµç¨‹å›¾" tabindex="-1">å››ã€å®Œæ•´æµç¨‹å›¾ <a class="header-anchor" href="#å››ã€å®Œæ•´æµç¨‹å›¾" aria-label="Permalink to &quot;å››ã€å®Œæ•´æµç¨‹å›¾&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–                                          â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚  1. ç”¨æˆ·é€‰æ‹©&quot;ä¸»ä½“é€‰æ‹©&quot;å·¥å…·                               â”‚</span></span>
<span class="line"><span>â”‚  2. è·å–å›¾ç‰‡URL                                          â”‚</span></span>
<span class="line"><span>â”‚  3. æ£€æŸ¥ç¼“å­˜ï¼ˆjsonMapï¼‰                                  â”‚</span></span>
<span class="line"><span>â”‚  4. è°ƒç”¨åç«¯APIè·å–SAMåˆ†åŒºæ•°æ®                           â”‚</span></span>
<span class="line"><span>â”‚     factory.apiService.autoMasks(imageUrl)              â”‚</span></span>
<span class="line"><span>â”‚  5. åˆ›å»ºAutoMaskModelå®ä¾‹                                â”‚</span></span>
<span class="line"><span>â”‚     factory.createAutoMaskModel(url, maskData)          â”‚</span></span>
<span class="line"><span>â”‚     â†’ ç”Ÿæˆå¤šä¸ªAutoMaskLayerå¯¹è±¡                          â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                          â†“</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  é˜¶æ®µäºŒï¼šäº¤äº’å¤„ç†ï¼ˆHoverï¼‰                               â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚  6. é¼ æ ‡hoveräº‹ä»¶è§¦å‘                                    â”‚</span></span>
<span class="line"><span>â”‚     useEventListener(&#39;mousemove&#39;, handleHoverMask)      â”‚</span></span>
<span class="line"><span>â”‚  7. åæ ‡è½¬æ¢ï¼ˆé¡¹ç›®å®ç°ï¼‰                                 â”‚</span></span>
<span class="line"><span>â”‚     pointFormEvent(e) â†’ {x, y}                          â”‚</span></span>
<span class="line"><span>â”‚     å±å¹•åæ ‡ â†’ å›¾åƒåæ ‡                                   â”‚</span></span>
<span class="line"><span>â”‚  8. æŸ¥æ‰¾layerï¼ˆlego/samæä¾›ï¼‰                            â”‚</span></span>
<span class="line"><span>â”‚     autoMaskModel.pickLayer(x, y)                       â”‚</span></span>
<span class="line"><span>â”‚     â†’ è¿”å›AutoMaskLayer | null                           â”‚</span></span>
<span class="line"><span>â”‚  9. é«˜äº®æ˜¾ç¤ºï¼ˆé¡¹ç›®å®ç°ï¼‰                                 â”‚</span></span>
<span class="line"><span>â”‚     addBorderToCanvas(layer.maskCanvas, ...)            â”‚</span></span>
<span class="line"><span>â”‚     â†’ åœ¨selectionCanvasä¸Šç»˜åˆ¶é’è‰²è¾¹æ¡†                    â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                          â†“</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  é˜¶æ®µä¸‰ï¼šç‚¹å‡»ç¡®è®¤                                        â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚  10. ç”¨æˆ·ç‚¹å‡»layer                                       â”‚</span></span>
<span class="line"><span>â”‚      useEventListener(&#39;click&#39;, handlePickMask)          â”‚</span></span>
<span class="line"><span>â”‚  11. åˆ‡æ¢é€‰ä¸­çŠ¶æ€ï¼ˆlego/samæä¾›ï¼‰                        â”‚</span></span>
<span class="line"><span>â”‚      autoMaskModel.toggleLayerMode(x, y)                â”‚</span></span>
<span class="line"><span>â”‚      â†’ æ›´æ–°layer.modeï¼ˆnull â†” &#39;source-over&#39;ï¼‰           â”‚</span></span>
<span class="line"><span>â”‚  12. åˆå¹¶é€‰ä¸­çš„layerï¼ˆlego/samæä¾›ï¼‰                    â”‚</span></span>
<span class="line"><span>â”‚      autoMaskModel.getMaskResult()                      â”‚</span></span>
<span class="line"><span>â”‚      â†’ è¿”å›åˆå¹¶åçš„mask Canvas                           â”‚</span></span>
<span class="line"><span>â”‚  13. æ›´æ–°maskCanvasï¼ˆé¡¹ç›®å®ç°ï¼‰                          â”‚</span></span>
<span class="line"><span>â”‚      maskResultChange(maskResult.getMask(...))          â”‚</span></span>
<span class="line"><span>â”‚      â†’ ç»˜åˆ¶åˆ°maskCanvasï¼Œé€šçŸ¥çˆ¶ç»„ä»¶                      â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><hr><h2 id="äº”ã€æ€»ç»“" tabindex="-1">äº”ã€æ€»ç»“ <a class="header-anchor" href="#äº”ã€æ€»ç»“" aria-label="Permalink to &quot;äº”ã€æ€»ç»“&quot;">â€‹</a></h2><h3 id="_5-1-æµç¨‹ç†è§£çº æ­£" tabindex="-1">5.1 æµç¨‹ç†è§£çº æ­£ <a class="header-anchor" href="#_5-1-æµç¨‹ç†è§£çº æ­£" aria-label="Permalink to &quot;5.1 æµç¨‹ç†è§£çº æ­£&quot;">â€‹</a></h3><p><strong>æ‚¨çš„ç†è§£åŸºæœ¬æ­£ç¡®ï¼Œä½†ç¼ºå°‘ï¼š</strong></p><ol><li>âŒ åˆå§‹åŒ–é˜¶æ®µçš„ç¼“å­˜æ£€æŸ¥</li><li>âŒ ç‚¹å‡»ç¡®è®¤å’Œmaskåˆå¹¶æµç¨‹</li><li>âŒ åæ ‡è½¬æ¢çš„ç»†èŠ‚ï¼ˆpixelRatioã€ç¼©æ”¾ç­‰ï¼‰</li></ol><h3 id="_5-2-èŒè´£åˆ’åˆ†æ ¸å¿ƒ" tabindex="-1">5.2 èŒè´£åˆ’åˆ†æ ¸å¿ƒ <a class="header-anchor" href="#_5-2-èŒè´£åˆ’åˆ†æ ¸å¿ƒ" aria-label="Permalink to &quot;5.2 èŒè´£åˆ’åˆ†æ ¸å¿ƒ&quot;">â€‹</a></h3><p><strong>lego/samè´Ÿè´£ï¼š</strong></p><ul><li>æ•°æ®æ¨¡å‹ç®¡ç†ï¼ˆAutoMaskModelã€AutoMaskLayerï¼‰</li><li>æ ¸å¿ƒç®—æ³•ï¼ˆpickLayerã€toggleLayerModeï¼‰</li><li>Maskåˆå¹¶ï¼ˆgetMaskResultï¼‰</li></ul><p><strong>é¡¹ç›®è´Ÿè´£ï¼š</strong></p><ul><li>APIè°ƒç”¨ä¸ç¼“å­˜</li><li>åæ ‡è½¬æ¢</li><li>äº‹ä»¶å¤„ç†</li><li>UIæ¸²æŸ“ï¼ˆé«˜äº®æ•ˆæœï¼‰</li><li>ä¸šåŠ¡é€»è¾‘</li></ul><h3 id="_5-3-é«˜äº®å®ç°æ ¸å¿ƒ" tabindex="-1">5.3 é«˜äº®å®ç°æ ¸å¿ƒ <a class="header-anchor" href="#_5-3-é«˜äº®å®ç°æ ¸å¿ƒ" aria-label="Permalink to &quot;5.3 é«˜äº®å®ç°æ ¸å¿ƒ&quot;">â€‹</a></h3><p><strong>æŠ€æœ¯æ–¹æ¡ˆï¼š</strong> å†…é˜´å½±æŠ€æœ¯</p><ul><li>ä½¿ç”¨<code>destination-in</code>æ··åˆæ¨¡å¼ä½œä¸ºé®ç½©</li><li>ä½¿ç”¨<code>shadowBlur</code>ç”Ÿæˆè¾¹ç¼˜å…‰æ™•</li><li>é‡å¤ç»˜åˆ¶å¼ºåŒ–æ•ˆæœ</li><li>å“åº”å¼è¾¹æ¡†å®½åº¦è®¡ç®—</li></ul><p><strong>å…³é”®æ–‡ä»¶ï¼š</strong></p><ul><li><code>use-auto-masks.ts</code>ï¼šä¸šåŠ¡é€»è¾‘</li><li><code>utils/canvas.ts</code>ï¼šé«˜äº®æ¸²æŸ“ç®—æ³•</li><li><code>@lego/sam</code>ï¼šåº•å±‚èƒ½åŠ›</li></ul><hr><p><strong>æ–‡æ¡£ç‰ˆæœ¬</strong>ï¼šv1.0<br><strong>æœ€åæ›´æ–°</strong>ï¼š2026-01-15</p>`,222)]))}const g=a(p,[["render",e]]);export{c as __pageData,g as default};
