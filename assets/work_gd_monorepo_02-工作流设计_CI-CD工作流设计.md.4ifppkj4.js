import{_ as p,C as e,c as t,o as a,a7 as n,b as h,w as i,a as r,G as k,a9 as E}from"./chunks/framework.BQb8NfN9.js";const d="/Lyc-notes/assets/image2025-2-13_23-15-49.DslPBqv9.png",C=JSON.parse('{"title":"RFC 17: Monorepo 包和应用 CI/CD 工作流设计","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/monorepo/02-工作流设计/CI-CD工作流设计.md","filePath":"work/gd/monorepo/02-工作流设计/CI-CD工作流设计.md","lastUpdated":1770085732000}'),c={name:"work/gd/monorepo/02-工作流设计/CI-CD工作流设计.md"};function o(g,s,b,u,m,y){const l=e("Mermaid");return a(),t("div",null,[s[1]||(s[1]=n('<h1 id="rfc-17-monorepo-包和应用-ci-cd-工作流设计" tabindex="-1">RFC 17: Monorepo 包和应用 CI/CD 工作流设计 <a class="header-anchor" href="#rfc-17-monorepo-包和应用-ci-cd-工作流设计" aria-label="Permalink to &quot;RFC 17: Monorepo 包和应用 CI/CD 工作流设计&quot;">​</a></h1><h2 id="一、文档概述" tabindex="-1">一、文档概述 <a class="header-anchor" href="#一、文档概述" aria-label="Permalink to &quot;一、文档概述&quot;">​</a></h2><h3 id="_1-1-方案背景" tabindex="-1">1.1 方案背景 <a class="header-anchor" href="#_1-1-方案背景" aria-label="Permalink to &quot;1.1 方案背景&quot;">​</a></h3><blockquote><p>📌 <strong>重要说明</strong><br> 这份方案是在过去内部讨论的共识基础上进一步完善而来：基于人和系统的维度，提出包和应用发布的完整自动化工作流，以便对齐自动化系统实施的细节；通过持续完善后，这份文档也将会发展为一线开发的指南。</p></blockquote><h3 id="_1-2-理念依据" tabindex="-1">1.2 理念依据 <a class="header-anchor" href="#_1-2-理念依据" aria-label="Permalink to &quot;1.2 理念依据&quot;">​</a></h3><blockquote><p>📖 <strong>IaC 理念</strong><br> 现代 DevOps 的基础设施通常等于代码，即—— IaC。IaC 推崇将配置、流程等采用代码协作的方式进行，以适应复杂的环境、不断复杂的工程规模，是提高研发过程中自动化程度的最佳实践。</p></blockquote><p>这份提案遵循 IaC 的理念，遵循行业中持续集成、持续交付的最佳实践。</p><p><strong>更多背景信息见</strong>：<a href="./../01-核心概念/主干开发与最佳实践">主干开发与最佳实践</a></p><h3 id="_1-3-平台说明" tabindex="-1">1.3 平台说明 <a class="header-anchor" href="#_1-3-平台说明" aria-label="Permalink to &quot;1.3 平台说明&quot;">​</a></h3><blockquote><p>ℹ️ <strong>术语说明</strong><br> 虽然我们即将要迁移到 GitLab，但由于这份文档最初是基于 GitHub 创建的，所以相关术语依然采用 GitHub 的术语，但这些工作流也适用于 GitLab。</p></blockquote><p><strong>MVP 验证仓库：</strong> 目前提案已经在实施阶段，在一个独立的仓库中部署自动化脚本，验证 MVP： <a href="https://gitlab.gaoding.com/gdesign/monorepo-workflows-example" target="_blank" rel="noreferrer">https://gitlab.gaoding.com/gdesign/monorepo-workflows-example</a></p><hr><h2 id="二、核心约定" tabindex="-1">二、核心约定 <a class="header-anchor" href="#二、核心约定" aria-label="Permalink to &quot;二、核心约定&quot;">​</a></h2><h3 id="_2-1-版本管理约定" tabindex="-1">2.1 版本管理约定 <a class="header-anchor" href="#_2-1-版本管理约定" aria-label="Permalink to &quot;2.1 版本管理约定&quot;">​</a></h3><h4 id="语义化版本规范" tabindex="-1">语义化版本规范 <a class="header-anchor" href="#语义化版本规范" aria-label="Permalink to &quot;语义化版本规范&quot;">​</a></h4><ul><li>包和应用遵循 <strong>语义化版本</strong> 规范</li><li>版本号格式：<code>MAJOR.MINOR.PATCH</code><ul><li><code>MAJOR</code>：重大更新，不兼容的 API 修改</li><li><code>MINOR</code>：功能更新，向后兼容的功能新增</li><li><code>PATCH</code>：问题修正，向后兼容的错误修复</li></ul></li></ul><h4 id="发布前提" tabindex="-1">发布前提 <a class="header-anchor" href="#发布前提" aria-label="Permalink to &quot;发布前提&quot;">​</a></h4><ul><li>无论是包还是应用，有 <strong>变更集（Changeset）</strong> 才能发布</li><li>变更集记录了改动内容和影响范围</li><li>变更集决定版本号如何变化</li></ul><h3 id="_2-2-分支模型约定" tabindex="-1">2.2 分支模型约定 <a class="header-anchor" href="#_2-2-分支模型约定" aria-label="Permalink to &quot;2.2 分支模型约定&quot;">​</a></h3><h4 id="主分支" tabindex="-1">主分支 <a class="header-anchor" href="#主分支" aria-label="Permalink to &quot;主分支&quot;">​</a></h4><ul><li>采用 <strong>基于主干的开发</strong> 模式</li><li>以 <strong>main</strong> 作为主分支</li></ul><blockquote><p>⚠️ <strong>注意事项</strong><br> 由于大多数项目当前默认分支为 <code>master</code>，使用 <code>main</code> 作为新的主分支可以减少迁移过程和旧的工作流冲突。</p></blockquote><h4 id="分支类型" tabindex="-1">分支类型 <a class="header-anchor" href="#分支类型" aria-label="Permalink to &quot;分支类型&quot;">​</a></h4><ol><li><strong>主干分支（main）</strong>：唯一的长期分支</li><li><strong>特性分支（feature/*）</strong>：短期分支，用于开发新特性</li><li><strong>修复分支（bugfix/*）</strong>：短期分支，用于修复问题</li><li><strong>发布分支（release/*）</strong>：自动创建，用于版本发布</li></ol><hr><h2 id="三、分支模型" tabindex="-1">三、分支模型 <a class="header-anchor" href="#三、分支模型" aria-label="Permalink to &quot;三、分支模型&quot;">​</a></h2><h3 id="_3-1-分支模型图示" tabindex="-1">3.1 分支模型图示 <a class="header-anchor" href="#_3-1-分支模型图示" aria-label="Permalink to &quot;3.1 分支模型图示&quot;">​</a></h3><p><img src="'+d+`" alt="分支模型"></p><details><summary>查看详细分支流程</summary><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gitGraph</span></span>
<span class="line"><span>commit id: &quot;Trunk (main)&quot;</span></span>
<span class="line"><span>branch feature/1</span></span>
<span class="line"><span>checkout feature/1</span></span>
<span class="line"><span>commit id: &quot;Dev A: Feature 1 Work&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>checkout main</span></span>
<span class="line"><span>merge feature/1 id: &quot;Merge PR: Feature 1&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>branch feature/2</span></span>
<span class="line"><span>checkout feature/2</span></span>
<span class="line"><span>commit id: &quot;Dev B: Feature 2 Work&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>checkout main</span></span>
<span class="line"><span>merge feature/2 id: &quot;Merge PR: Feature 2&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>branch release/1.0.0</span></span>
<span class="line"><span>checkout release/1.0.0</span></span>
<span class="line"><span>commit id: &quot;Release 1.0 Stabilization&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>checkout main</span></span>
<span class="line"><span>branch bugfix/1</span></span>
<span class="line"><span>checkout bugfix/1</span></span>
<span class="line"><span>commit id: &quot;Dev C: Bugfix 1 Work&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>checkout main</span></span>
<span class="line"><span>merge bugfix/1 id: &quot;Merge PR: Bugfix 1&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>branch release/1.0.1</span></span>
<span class="line"><span>checkout release/1.0.1</span></span>
<span class="line"><span>commit id: &quot;Release 1.0.1 Stabilization&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>checkout main</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div></details><h3 id="_3-2-分支约束" tabindex="-1">3.2 分支约束 <a class="header-anchor" href="#_3-2-分支约束" aria-label="Permalink to &quot;3.2 分支约束&quot;">​</a></h3><p><strong>允许的操作：</strong></p><ul><li>✅ 从 main 创建短期特性分支</li><li>✅ 特性分支允许&quot;结对编程&quot;</li><li>✅ 自动化工具创建发布分支</li></ul><p><strong>禁止的操作：</strong></p><ul><li>❌ 除了&quot;结对编程&quot;之外，不允许在主干分支之外的共享分支</li><li>❌ 不允许主干之外的长期分支，发布分支要定期清理</li><li>❌ 不允许开发者在发布分支上提交代码</li></ul><hr><h2 id="四、角色定义" tabindex="-1">四、角色定义 <a class="header-anchor" href="#四、角色定义" aria-label="Permalink to &quot;四、角色定义&quot;">​</a></h2><h3 id="_4-1-人类角色" tabindex="-1">4.1 人类角色 <a class="header-anchor" href="#_4-1-人类角色" aria-label="Permalink to &quot;4.1 人类角色&quot;">​</a></h3><h4 id="pr-author-pr-作者" tabindex="-1">PR Author（PR 作者） <a class="header-anchor" href="#pr-author-pr-作者" aria-label="Permalink to &quot;PR Author（PR 作者）&quot;">​</a></h4><ul><li><strong>职责</strong>：创建和维护 PR</li><li><strong>工作</strong>： <ul><li>完成代码变更</li><li>运行 <code>pnpm changeset</code> 添加变更记录</li><li>推送分支，创建 PR</li><li>响应评审意见</li></ul></li></ul><h4 id="pr-reviewer-pr-评审者" tabindex="-1">PR Reviewer（PR 评审者） <a class="header-anchor" href="#pr-reviewer-pr-评审者" aria-label="Permalink to &quot;PR Reviewer（PR 评审者）&quot;">​</a></h4><ul><li><strong>职责</strong>：代码评审和质量把关</li><li><strong>工作</strong>： <ul><li>进行代码评审</li><li>提出改进意见</li><li>批准 PR</li></ul></li></ul><h4 id="pr-assignee-pr-处理者" tabindex="-1">PR Assignee（PR 处理者） <a class="header-anchor" href="#pr-assignee-pr-处理者" aria-label="Permalink to &quot;PR Assignee（PR 处理者）&quot;">​</a></h4><ul><li><strong>职责</strong>：PR 的最终合并决策</li><li><strong>工作</strong>： <ul><li>确认一切就绪</li><li>合并来自 Author 的特性 PR</li><li>合并来自 Action 的版本 PR</li></ul></li></ul><h3 id="_4-2-自动化系统角色" tabindex="-1">4.2 自动化系统角色 <a class="header-anchor" href="#_4-2-自动化系统角色" aria-label="Permalink to &quot;4.2 自动化系统角色&quot;">​</a></h3><h4 id="action-工作流任务脚本" tabindex="-1">Action（工作流任务脚本） <a class="header-anchor" href="#action-工作流任务脚本" aria-label="Permalink to &quot;Action（工作流任务脚本）&quot;">​</a></h4><ul><li><strong>职责</strong>：自动化构建、测试、发布</li><li><strong>工作</strong>： <ul><li>运行代码检查和单元测试</li><li>发布预览版包和应用</li><li>收集变更集，生成版本号</li><li>创建版本 PR</li><li>发布正式版包和应用</li><li>创建 Git Tags</li><li>通知部署系统</li></ul></li></ul><h4 id="deploysystem-应用部署系统" tabindex="-1">DeploySystem（应用部署系统） <a class="header-anchor" href="#deploysystem-应用部署系统" aria-label="Permalink to &quot;DeploySystem（应用部署系统）&quot;">​</a></h4><ul><li><strong>职责</strong>：应用的部署和运维</li><li><strong>工作</strong>： <ul><li>部署至预览环境</li><li>部署审批</li><li>部署至生产环境</li><li>服务监控和健康检查</li></ul></li></ul><hr><h2 id="五、发布工作流" tabindex="-1">五、发布工作流 <a class="header-anchor" href="#五、发布工作流" aria-label="Permalink to &quot;五、发布工作流&quot;">​</a></h2><h3 id="_5-1-完整流程图" tabindex="-1">5.1 完整流程图 <a class="header-anchor" href="#_5-1-完整流程图" aria-label="Permalink to &quot;5.1 完整流程图&quot;">​</a></h3>`,51)),(a(),h(E,null,{default:i(()=>[k(l,{id:"mermaid-409",class:"mermaid",graph:"graph%20TD%0Asubgraph%20PR%20Author%0AA1%5B%E8%BF%90%E8%A1%8C%20pnpm%20changeset%20%E6%8F%90%E4%BA%A4%E5%8F%98%E6%9B%B4%E9%9B%86%5D%20--%3E%20A2%5B%E6%8E%A8%E9%80%81%E5%88%86%E6%94%AF%2C%20%E5%88%9B%E5%BB%BA%20PR%5D%0Aend%0A%0Asubgraph%20Action%0AY1%5B%E6%94%B6%E9%9B%86%E5%8F%98%E6%9B%B4%E9%9B%86-%E7%94%9F%E6%88%90%E7%89%88%E6%9C%AC%E5%8F%B7%E4%B8%8E%E7%89%88%E6%9C%AC%E6%8F%8F%E8%BF%B0-%E5%88%9B%E5%BB%BA%E7%89%88%E6%9C%AC%20PR%5D%0AB1%5B%E5%8F%91%E5%B8%83%E9%A2%84%E8%A7%88%E7%89%88%E5%8C%85%E5%88%B0%20npm%5D%20--%3E%20B2%5B%E5%8F%91%E5%B8%83%E9%A2%84%E8%A7%88%E7%89%88%E5%BA%94%E7%94%A8%E9%95%9C%E5%83%8F%5D%20--%3E%20B3%5B%E9%80%9A%E7%9F%A5%20DeploySystem%20%E9%83%A8%E7%BD%B2%E9%A2%84%E8%A7%88%E7%8E%AF%E5%A2%83%5D%0AG1%5B%E5%8F%91%E5%B8%83%E5%8C%85%E5%88%B0%20npm%5D%20--%3E%20G2%5B%E5%88%9B%E5%BB%BA%20Git%20Tags%5D%20--%3E%20G3%5B%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8%E9%95%9C%E5%83%8F%5D%20--%3E%20G4%5B%E9%80%9A%E7%9F%A5%20DeploySystem%20%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%5D%0A%0Aend%0A%0Asubgraph%20DeploySystem%0AC1%5B%E9%83%A8%E7%BD%B2%E8%87%B3%E9%A2%84%E8%A7%88%E7%8E%AF%E5%A2%83%5D%0AH1%5B%E5%AE%A1%E6%89%B9%5D--%3EH2%5B%E9%83%A8%E7%BD%B2%E8%87%B3%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%5D%0Aend%0A%0Asubgraph%20PR%20Reviewer%0AD1%5B%E4%BB%A3%E7%A0%81%E8%AF%84%E5%AE%A1%5D%20--%3E%20D2%5B%E6%89%B9%E5%87%86%20PR%5D%0Aend%0A%0Asubgraph%20PR%20Assignee%0AE1%5B%E5%90%88%E5%B9%B6%20PR%5D%0AG0%5B%E5%90%88%E5%B9%B6%E7%89%88%E6%9C%AC%20PR%5D%0Aend%0A%0AA2%20--%3E%7C%E7%AD%89%E5%BE%85%7C%20D1%0AA2%20--%3E%20B1%0AB3%20--%3E%20C1%0AY1%20--%3E%7C%E7%AD%89%E5%BE%85%7C%20G0%0AD2%20--%3E%7C%E7%AD%89%E5%BE%85%7C%20E1%0AE1%20--%3E%20Y1%0AG0%20--%3E%20G1%0AG4%20--%3E%20H1%0A"})]),fallback:i(()=>s[0]||(s[0]=[r(" Loading... ")])),_:1})),s[2]||(s[2]=n(`<blockquote><p>ℹ️ <strong>说明</strong><br> 为了突出核心部分，流程图中省略了代码检查、单元测试等流程。</p></blockquote><h3 id="_5-2-开发阶段" tabindex="-1">5.2 开发阶段 <a class="header-anchor" href="#_5-2-开发阶段" aria-label="Permalink to &quot;5.2 开发阶段&quot;">​</a></h3><h4 id="步骤-1-完成代码变更" tabindex="-1">步骤 1：完成代码变更 <a class="header-anchor" href="#步骤-1-完成代码变更" aria-label="Permalink to &quot;步骤 1：完成代码变更&quot;">​</a></h4><p><strong>PR Author</strong> 完成代码变更后，运行 <code>pnpm changeset</code> 添加变更记录。</p><p><strong>操作示例：</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加变更集</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changeset</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 选择变更类型</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> What kind of change is this </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @gaoding/package-a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ❯</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> patch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (bug </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">fix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    minor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (feature)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    major</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (breaking </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">change</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 填写变更描述</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Please enter a summary </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> this change:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Fix:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 修复按钮点击无响应的问题</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #PINGCODE-1234</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>变更集文件示例：</strong></p><div class="language-markdown vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">---</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@gaoding/package-a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">patch</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">---</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Fix: 修复按钮点击无响应的问题 #PINGCODE-1234</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="步骤-2-推送分支到远程后发起-pr" tabindex="-1">步骤 2：推送分支到远程后发起 PR <a class="header-anchor" href="#步骤-2-推送分支到远程后发起-pr" aria-label="Permalink to &quot;步骤 2：推送分支到远程后发起 PR&quot;">​</a></h4><p><strong>PR Author</strong> 推送分支到远程后发起 PR。</p><p><strong>操作示例：</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 推送分支</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> feature/fix-button-click</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在 GitHub/GitLab 上创建 PR</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PR 标题：Fix: 修复按钮点击无响应的问题</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PR 描述：关联 PingCode 任务 #PINGCODE-1234</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_5-3-测试阶段" tabindex="-1">5.3 测试阶段 <a class="header-anchor" href="#_5-3-测试阶段" aria-label="Permalink to &quot;5.3 测试阶段&quot;">​</a></h3><h4 id="步骤-1-发布预览版" tabindex="-1">步骤 1：发布预览版 <a class="header-anchor" href="#步骤-1-发布预览版" aria-label="Permalink to &quot;步骤 1：发布预览版&quot;">​</a></h4><p><strong>Action</strong> 自动执行以下操作：</p><ol><li>发布预览包到 npm</li><li>发布预览应用镜像到指定平台</li></ol><p><strong>预览版本号格式：</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1.2.3-pr-123.1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="步骤-2-通知部署系统" tabindex="-1">步骤 2：通知部署系统 <a class="header-anchor" href="#步骤-2-通知部署系统" aria-label="Permalink to &quot;步骤 2：通知部署系统&quot;">​</a></h4><p><strong>Action</strong> 通知 DeploySystem 平台部署预览环境。</p><h4 id="步骤-3-部署预览环境" tabindex="-1">步骤 3：部署预览环境 <a class="header-anchor" href="#步骤-3-部署预览环境" aria-label="Permalink to &quot;步骤 3：部署预览环境&quot;">​</a></h4><p><strong>DeploySystem</strong> 将镜像部署到云平台、启动服务。</p><blockquote><p>⚠️ <strong>注意</strong><br> 由于 <code>stage</code> 是公共的测试环境，会存在占用的可能，因此需要沟通。</p></blockquote><p><strong>预览环境信息：</strong></p><ul><li>环境 URL：<code>https://pr-123.preview.gaoding.com</code></li><li>有效期：PR 关闭后自动销毁</li><li>数据：使用测试数据，不影响生产数据</li></ul><h3 id="_5-4-发布阶段" tabindex="-1">5.4 发布阶段 <a class="header-anchor" href="#_5-4-发布阶段" aria-label="Permalink to &quot;5.4 发布阶段&quot;">​</a></h3><h4 id="步骤-1-代码评审" tabindex="-1">步骤 1：代码评审 <a class="header-anchor" href="#步骤-1-代码评审" aria-label="Permalink to &quot;步骤 1：代码评审&quot;">​</a></h4><p><strong>PR Reviewer</strong> 进行代码评审：</p><ul><li>检查代码质量</li><li>验证变更集内容</li><li>确认测试通过</li><li>批准 PR</li></ul><h4 id="步骤-2-合并特性-pr" tabindex="-1">步骤 2：合并特性 PR <a class="header-anchor" href="#步骤-2-合并特性-pr" aria-label="Permalink to &quot;步骤 2：合并特性 PR&quot;">​</a></h4><p><strong>PR Assignee</strong> 确认一切就绪后合并来自 Author 的特性 PR。</p><p><strong>合并方式：</strong></p><ul><li>使用 Squash and Merge（推荐）</li><li>保持主干提交历史清晰</li></ul><h4 id="步骤-3-生成版本-pr" tabindex="-1">步骤 3：生成版本 PR <a class="header-anchor" href="#步骤-3-生成版本-pr" aria-label="Permalink to &quot;步骤 3：生成版本 PR&quot;">​</a></h4><p><strong>Action</strong> 自动执行：</p><ol><li>收集变更集</li><li>生成版本号与版本描述</li><li>创建版本 PR</li></ol><p><strong>版本 PR 示例：</strong></p><div class="language-markdown vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Title: chore: version packages</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## Releases</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @gaoding/package-a@1.2.4</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @gaoding/app-editor@2.0.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## Changes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### @gaoding/package-a@1.2.4</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Fix: 修复按钮点击无响应的问题 #PINGCODE-1234</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### @gaoding/app-editor@2.0.1</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Fix: 修复编辑器保存失败的问题 #PINGCODE-1235</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="步骤-4-合并版本-pr" tabindex="-1">步骤 4：合并版本 PR <a class="header-anchor" href="#步骤-4-合并版本-pr" aria-label="Permalink to &quot;步骤 4：合并版本 PR&quot;">​</a></h4><p><strong>PR Assignee</strong> 确认一切就绪后合并来自 Action 的版本 PR。</p><p><strong>确认项：</strong></p><ul><li>✅ 版本号正确</li><li>✅ 变更描述清晰</li><li>✅ 没有遗漏的变更</li><li>✅ CI 检查通过</li></ul><h4 id="步骤-5-发布包和镜像" tabindex="-1">步骤 5：发布包和镜像 <a class="header-anchor" href="#步骤-5-发布包和镜像" aria-label="Permalink to &quot;步骤 5：发布包和镜像&quot;">​</a></h4><p><strong>Action</strong> 自动执行：</p><ol><li>打包版本</li><li>发布包到 npm</li><li>创建版本 Git Tags</li><li>推送 Docker Image 到指定平台</li></ol><p><strong>npm 发布示例：</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 发布包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> publish</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./packages/*&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建 Git Tags</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @gaoding/package-a@1.2.4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @gaoding/app-editor@2.0.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 推送 Tags</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tags</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="步骤-6-通知部署系统" tabindex="-1">步骤 6：通知部署系统 <a class="header-anchor" href="#步骤-6-通知部署系统" aria-label="Permalink to &quot;步骤 6：通知部署系统&quot;">​</a></h4><p><strong>Action</strong> 通知 DeploySystem 平台部署。</p><p><strong>通知信息：</strong></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;application&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app-editor&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;registry.gaoding.com/app-editor:2.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;environment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;production&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;changelog&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Fix: 修复编辑器保存失败的问题 #PINGCODE-1235&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="步骤-7-生产环境部署" tabindex="-1">步骤 7：生产环境部署 <a class="header-anchor" href="#步骤-7-生产环境部署" aria-label="Permalink to &quot;步骤 7：生产环境部署&quot;">​</a></h4><p><strong>DeploySystem</strong> 审批后将镜像部署到云平台、启动服务。</p><p><strong>部署流程：</strong></p><ol><li>审批（由运维或负责人审批）</li><li>灰度发布（先发布到部分节点）</li><li>监控验证（检查服务健康状态）</li><li>全量发布（发布到所有节点）</li><li>发布完成（通知相关人员）</li></ol><hr><h2 id="六、变更集-changeset-管理" tabindex="-1">六、变更集（Changeset）管理 <a class="header-anchor" href="#六、变更集-changeset-管理" aria-label="Permalink to &quot;六、变更集（Changeset）管理&quot;">​</a></h2><h3 id="_6-1-什么是变更集" tabindex="-1">6.1 什么是变更集 <a class="header-anchor" href="#_6-1-什么是变更集" aria-label="Permalink to &quot;6.1 什么是变更集&quot;">​</a></h3><p><strong>变更集（Changeset）</strong> 是一个描述代码变更的 Markdown 文件，包含：</p><ul><li>变更的包名</li><li>变更类型（patch、minor、major）</li><li>变更描述</li></ul><h3 id="_6-2-创建变更集" tabindex="-1">6.2 创建变更集 <a class="header-anchor" href="#_6-2-创建变更集" aria-label="Permalink to &quot;6.2 创建变更集&quot;">​</a></h3><p><strong>命令：</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changeset</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>交互流程：</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>? Which packages would you like to include?</span></span>
<span class="line"><span>  ◯ @gaoding/package-a</span></span>
<span class="line"><span>  ◯ @gaoding/package-b</span></span>
<span class="line"><span>  ◉ @gaoding/app-editor</span></span>
<span class="line"><span></span></span>
<span class="line"><span>? What kind of change is this for @gaoding/app-editor?</span></span>
<span class="line"><span>  ◯ patch</span></span>
<span class="line"><span>  ◯ minor</span></span>
<span class="line"><span>  ◉ major</span></span>
<span class="line"><span></span></span>
<span class="line"><span>? Please enter a summary for this change:</span></span>
<span class="line"><span>  Breaking: 重构编辑器核心架构 #PINGCODE-2000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>生成的文件：</strong></p><div class="language-markdown vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;"># .changeset/gentle-foxes-dance.md</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">---</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&quot;@gaoding/app-editor&quot;: major</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">---</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Breaking: 重构编辑器核心架构 #PINGCODE-2000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_6-3-如何关联-pingcode-任务" tabindex="-1">6.3 如何关联 PingCode 任务 <a class="header-anchor" href="#_6-3-如何关联-pingcode-任务" aria-label="Permalink to &quot;6.3 如何关联 PingCode 任务&quot;">​</a></h3><p>在变更集中填写 <code>#PingCodeID</code> 即可，正如在 GitHub 关联 issues 一样简单。</p><p><strong>示例：</strong></p><div class="language-markdown vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">---</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@gaoding/package-a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">patch</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">---</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Fix: 修复按钮样式问题 #PINGCODE-1234</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_6-4-变更集的生命周期" tabindex="-1">6.4 变更集的生命周期 <a class="header-anchor" href="#_6-4-变更集的生命周期" aria-label="Permalink to &quot;6.4 变更集的生命周期&quot;">​</a></h3><ol><li><strong>创建</strong>：开发者运行 <code>pnpm changeset</code> 创建</li><li><strong>提交</strong>：随代码一起提交到 Git</li><li><strong>审查</strong>：作为 PR 的一部分进行审查</li><li><strong>收集</strong>：Action 收集所有变更集</li><li><strong>生成版本</strong>：根据变更集生成版本号和 CHANGELOG</li><li><strong>清理</strong>：发布后自动删除</li></ol><hr><h2 id="七、ci-cd-流水线详解" tabindex="-1">七、CI/CD 流水线详解 <a class="header-anchor" href="#七、ci-cd-流水线详解" aria-label="Permalink to &quot;七、CI/CD 流水线详解&quot;">​</a></h2><h3 id="_7-1-pr-检查流水线" tabindex="-1">7.1 PR 检查流水线 <a class="header-anchor" href="#_7-1-pr-检查流水线" aria-label="Permalink to &quot;7.1 PR 检查流水线&quot;">​</a></h3><p><strong>触发时机：</strong></p><ul><li>创建 PR 时</li><li>PR 更新时</li></ul><p><strong>执行步骤：</strong></p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PR Check</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  pull_request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  check</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Checkout</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup Node.js</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;18&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Install dependencies</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm install</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Lint</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm lint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Type check</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm type-check</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Unit tests</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm test</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_7-2-预览发布流水线" tabindex="-1">7.2 预览发布流水线 <a class="header-anchor" href="#_7-2-预览发布流水线" aria-label="Permalink to &quot;7.2 预览发布流水线&quot;">​</a></h3><p><strong>触发时机：</strong></p><ul><li>PR 创建或更新时</li></ul><p><strong>执行步骤：</strong></p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Preview Release</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  pull_request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  preview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Checkout</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup Node.js</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Install dependencies</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm install</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm build</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Publish preview packages</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm publish -r --tag pr-\${{ github.event.pull_request.number }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Build Docker image</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker build -t app:pr-\${{ github.event.pull_request.number }} .</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Push Docker image</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker push app:pr-\${{ github.event.pull_request.number }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Notify deploy system</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          curl -X POST \${{ secrets.DEPLOY_WEBHOOK_URL }} \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            -H &quot;Content-Type: application/json&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            -d &#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              &quot;pr&quot;: &quot;\${{ github.event.pull_request.number }}&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              &quot;image&quot;: &quot;app:pr-\${{ github.event.pull_request.number }}&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              &quot;environment&quot;: &quot;preview&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            }&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="_7-3-版本管理流水线" tabindex="-1">7.3 版本管理流水线 <a class="header-anchor" href="#_7-3-版本管理流水线" aria-label="Permalink to &quot;7.3 版本管理流水线&quot;">​</a></h3><p><strong>触发时机：</strong></p><ul><li>PR 合并到 main 时</li></ul><p><strong>执行步骤：</strong></p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Version Management</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Checkout</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          fetch-depth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup Node.js</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Install dependencies</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm install</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Create version PR</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          pnpm changeset version</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          # 如果有版本变更，创建 PR</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          if [[ -n $(git status -s) ]]; then</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            git config user.name &quot;github-actions[bot]&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            git config user.email &quot;github-actions[bot]@users.noreply.github.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            git checkout -b changeset-release/main</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            git add .</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            git commit -m &quot;chore: version packages&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            git push origin changeset-release/main</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            # 创建 PR</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            gh pr create \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              --title &quot;chore: version packages&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              --body &quot;This PR was automatically generated by changeset&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              --base main \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              --head changeset-release/main</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          fi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="_7-4-正式发布流水线" tabindex="-1">7.4 正式发布流水线 <a class="header-anchor" href="#_7-4-正式发布流水线" aria-label="Permalink to &quot;7.4 正式发布流水线&quot;">​</a></h3><p><strong>触发时机：</strong></p><ul><li>版本 PR 合并到 main 时</li></ul><p><strong>执行步骤：</strong></p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Release</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.changeset/**&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;packages/**/package.json&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  release</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Checkout</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup Node.js</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Install dependencies</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm install</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm build</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Publish to npm</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm publish -r</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          NPM_TOKEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.NPM_TOKEN }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Create Git tags</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          git config user.name &quot;github-actions[bot]&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          git config user.email &quot;github-actions[bot]@users.noreply.github.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          # 为每个发布的包创建 tag</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          pnpm changeset tag</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          git push --tags</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Build Docker images</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          for app in apps/*; do</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            docker build -t $app:$(cat $app/package.json | jq -r .version) $app</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          done</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Push Docker images</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker push --all-tags</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Notify deploy system</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          curl -X POST \${{ secrets.DEPLOY_WEBHOOK_URL }} \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            -H &quot;Content-Type: application/json&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            -d @release-info.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><hr><h2 id="八、环境管理" tabindex="-1">八、环境管理 <a class="header-anchor" href="#八、环境管理" aria-label="Permalink to &quot;八、环境管理&quot;">​</a></h2><h3 id="_8-1-环境类型" tabindex="-1">8.1 环境类型 <a class="header-anchor" href="#_8-1-环境类型" aria-label="Permalink to &quot;8.1 环境类型&quot;">​</a></h3><table tabindex="0"><thead><tr><th>环境</th><th>用途</th><th>数据</th><th>访问权限</th></tr></thead><tbody><tr><td><strong>开发环境（dev）</strong></td><td>本地开发</td><td>本地数据/测试数据</td><td>开发者</td></tr><tr><td><strong>预览环境（preview）</strong></td><td>PR 预览</td><td>测试数据</td><td>内部团队</td></tr><tr><td><strong>测试环境（stage）</strong></td><td>集成测试</td><td>测试数据</td><td>内部团队</td></tr><tr><td><strong>生产环境（production）</strong></td><td>正式服务</td><td>生产数据</td><td>所有用户</td></tr></tbody></table><h3 id="_8-2-环境配置管理" tabindex="-1">8.2 环境配置管理 <a class="header-anchor" href="#_8-2-环境配置管理" aria-label="Permalink to &quot;8.2 环境配置管理&quot;">​</a></h3><p><strong>使用 GitHub/GitLab 环境功能：</strong></p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .github/workflows/deploy.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  deploy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://app.gaoding.com</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deploy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">deploy.sh</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          DATABASE_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.DATABASE_URL }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          API_KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.API_KEY }}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>环境变量管理：</strong></p><ul><li>敏感信息使用 Secrets 管理</li><li>非敏感配置可以放在代码中</li><li>不同环境使用不同的配置文件</li></ul><hr><h2 id="九、最佳实践" tabindex="-1">九、最佳实践 <a class="header-anchor" href="#九、最佳实践" aria-label="Permalink to &quot;九、最佳实践&quot;">​</a></h2><h3 id="_9-1-变更集最佳实践" tabindex="-1">9.1 变更集最佳实践 <a class="header-anchor" href="#_9-1-变更集最佳实践" aria-label="Permalink to &quot;9.1 变更集最佳实践&quot;">​</a></h3><p><strong>Do：</strong></p><ul><li>✅ 每个 PR 都包含变更集</li><li>✅ 变更描述清晰明了</li><li>✅ 关联 PingCode 任务</li><li>✅ 选择正确的变更类型</li></ul><p><strong>Don&#39;t：</strong></p><ul><li>❌ 忘记创建变更集</li><li>❌ 变更描述过于简单</li><li>❌ 选错变更类型</li><li>❌ 一个变更集包含多个不相关的改动</li></ul><h3 id="_9-2-pr-最佳实践" tabindex="-1">9.2 PR 最佳实践 <a class="header-anchor" href="#_9-2-pr-最佳实践" aria-label="Permalink to &quot;9.2 PR 最佳实践&quot;">​</a></h3><p><strong>Do：</strong></p><ul><li>✅ PR 保持小而专注</li><li>✅ PR 标题清晰</li><li>✅ PR 描述完整</li><li>✅ 及时响应评审意见</li></ul><p><strong>Don&#39;t：</strong></p><ul><li>❌ 大而全的 PR</li><li>❌ PR 标题不清晰</li><li>❌ PR 缺少描述</li><li>❌ 长时间不响应评审</li></ul><h3 id="_9-3-发布最佳实践" tabindex="-1">9.3 发布最佳实践 <a class="header-anchor" href="#_9-3-发布最佳实践" aria-label="Permalink to &quot;9.3 发布最佳实践&quot;">​</a></h3><p><strong>Do：</strong></p><ul><li>✅ 定期发布，避免积累</li><li>✅ 发布前充分测试</li><li>✅ 准备好回滚方案</li><li>✅ 发布后监控服务状态</li></ul><p><strong>Don&#39;t：</strong></p><ul><li>❌ 长时间不发布</li><li>❌ 测试不充分就发布</li><li>❌ 没有回滚方案</li><li>❌ 发布后不监控</li></ul><hr><h2 id="十、参考资料" tabindex="-1">十、参考资料 <a class="header-anchor" href="#十、参考资料" aria-label="Permalink to &quot;十、参考资料&quot;">​</a></h2><h3 id="_10-1-模式相关" tabindex="-1">10.1 模式相关 <a class="header-anchor" href="#_10-1-模式相关" aria-label="Permalink to &quot;10.1 模式相关&quot;">​</a></h3><ul><li><strong>基于主干的开发模式</strong> - 参见 <a href="./../01-核心概念/主干开发与最佳实践">主干开发与最佳实践</a></li><li><strong>DevOps 基础设施即代码</strong> - IaC 最佳实践</li></ul><h3 id="_10-2-具体实践相关" tabindex="-1">10.2 具体实践相关 <a class="header-anchor" href="#_10-2-具体实践相关" aria-label="Permalink to &quot;10.2 具体实践相关&quot;">​</a></h3><ul><li><strong>GitHub: 管理部署环境</strong> - GitHub Actions 环境管理</li><li><strong>GitHub: 触发工作流事件-workflow_dispatch</strong> - 手动触发工作流</li><li><strong>changesets: 自动化变更集</strong> - Changesets 官方文档</li><li><strong>changesets: 预发布版本</strong> - 预发布版本管理</li><li><strong>changesets: 快照发布</strong> - 快照版本发布</li><li><strong>changesets: 发布应用</strong> - 应用发布流程</li><li><strong>React 的每日构建版本</strong> - React 的发布实践</li></ul><hr><h2 id="十一、总结" tabindex="-1">十一、总结 <a class="header-anchor" href="#十一、总结" aria-label="Permalink to &quot;十一、总结&quot;">​</a></h2><h3 id="_11-1-工作流核心" tabindex="-1">11.1 工作流核心 <a class="header-anchor" href="#_11-1-工作流核心" aria-label="Permalink to &quot;11.1 工作流核心&quot;">​</a></h3><ol><li><strong>变更集驱动</strong>：所有发布都基于变更集</li><li><strong>自动化优先</strong>：尽可能自动化每个环节</li><li><strong>主干开发</strong>：基于主干的开发模式</li><li><strong>快速反馈</strong>：PR 预览提供快速反馈</li><li><strong>质量保障</strong>：代码审查和自动化测试</li></ol><h3 id="_11-2-角色职责" tabindex="-1">11.2 角色职责 <a class="header-anchor" href="#_11-2-角色职责" aria-label="Permalink to &quot;11.2 角色职责&quot;">​</a></h3><p><strong>开发者：</strong></p><ul><li>创建变更集</li><li>提交 PR</li><li>响应评审</li></ul><p><strong>评审者：</strong></p><ul><li>代码评审</li><li>批准 PR</li></ul><p><strong>自动化系统：</strong></p><ul><li>运行检查</li><li>发布预览</li><li>生成版本</li><li>部署应用</li></ul><h3 id="_11-3-预期收益" tabindex="-1">11.3 预期收益 <a class="header-anchor" href="#_11-3-预期收益" aria-label="Permalink to &quot;11.3 预期收益&quot;">​</a></h3><p><strong>效率提升：</strong></p><ul><li>自动化减少手工操作</li><li>预览环境加快验证</li><li>快速发布缩短周期</li></ul><p><strong>质量保障：</strong></p><ul><li>代码审查确保质量</li><li>自动化测试覆盖</li><li>灰度发布降低风险</li></ul><p><strong>团队协作：</strong></p><ul><li>流程透明可追溯</li><li>职责清晰明确</li><li>沟通成本降低</li></ul><hr><p><em>文档版本：v1.0</em><br><em>最后更新：2025-01-25</em></p>`,147))])}const A=p(c,[["render",o]]);export{C as __pageData,A as default};
