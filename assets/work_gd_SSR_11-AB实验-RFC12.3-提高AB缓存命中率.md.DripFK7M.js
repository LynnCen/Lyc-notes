import{_ as a,c as n,o as i,a7 as p}from"./chunks/framework.BQb8NfN9.js";const l="/Lyc-notes/assets/image2025-3-13_11-43-3.BBcAX6_B.png",e="/Lyc-notes/assets/image2025-3-13_11-58-47.tA9ujlyZ.png",t="/Lyc-notes/assets/image2025-3-13_11-59-23.CojiPtIi.png",r="/Lyc-notes/assets/image2025-3-13_13-45-17.DMmVTlUj.png",h="/Lyc-notes/assets/image2025-3-13_14-12-8.BvHceAeZ.png",k="/Lyc-notes/assets/image2025-3-13_14-1-22.ocQaYt24.png",d="/Lyc-notes/assets/image2025-3-12_16-18-54.BDNk844j.png",c="/Lyc-notes/assets/image2025-3-19_9-46-21.B_9UfssM.png",b="/Lyc-notes/assets/image2025-3-19_9-45-55.DVbJictU.png",E="/Lyc-notes/assets/image2025-3-19_9-53-17.CszSIBYx.png",g="/Lyc-notes/assets/image2025-3-19_9-54-17.zS97pJIp.png",o="/Lyc-notes/assets/image2025-3-19_9-55-26.LA7mankl.png",u="/Lyc-notes/assets/image2025-3-19_9-55-58.C6cTSXeY.png",m="/Lyc-notes/assets/image2025-3-19_9-56-39.BmusWYVZ.png",y="/Lyc-notes/assets/image2025-3-19_10-1-20.sRDanQHt.png",F="/Lyc-notes/assets/image2025-3-19_9-58-27.tGquJ-0W.png",f=JSON.parse('{"title":"RFC 12.3: æé«˜ AB ç¼“å­˜å‘½ä¸­ç‡","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/SSR/11-ABå®éªŒ-RFC12.3-æé«˜ABç¼“å­˜å‘½ä¸­ç‡.md","filePath":"work/gd/SSR/11-ABå®éªŒ-RFC12.3-æé«˜ABç¼“å­˜å‘½ä¸­ç‡.md","lastUpdated":1770089359000}'),C={name:"work/gd/SSR/11-ABå®éªŒ-RFC12.3-æé«˜ABç¼“å­˜å‘½ä¸­ç‡.md"};function A(v,s,B,D,_,q){return i(),n("div",null,s[0]||(s[0]=[p(`<h1 id="rfc-12-3-æé«˜-ab-ç¼“å­˜å‘½ä¸­ç‡" tabindex="-1">RFC 12.3: æé«˜ AB ç¼“å­˜å‘½ä¸­ç‡ <a class="header-anchor" href="#rfc-12-3-æé«˜-ab-ç¼“å­˜å‘½ä¸­ç‡" aria-label="Permalink to &quot;RFC 12.3: æé«˜ AB ç¼“å­˜å‘½ä¸­ç‡&quot;">â€‹</a></h1><blockquote><p><strong>æ–‡æ¡£æ¥æº</strong><br> Confluence: <a href="https://doc.huanleguang.com/pages/viewpage.action?pageId=438705960" target="_blank" rel="noreferrer">https://doc.huanleguang.com/pages/viewpage.action?pageId=438705960</a></p></blockquote><hr><h2 id="æ–‡æ¡£æ¦‚è¿°" tabindex="-1">æ–‡æ¡£æ¦‚è¿° <a class="header-anchor" href="#æ–‡æ¡£æ¦‚è¿°" aria-label="Permalink to &quot;æ–‡æ¡£æ¦‚è¿°&quot;">â€‹</a></h2><p>æœ¬ RFC ä¸“æ³¨äºè§£å†³ <strong>AB å®éªŒå¯¼è‡´çš„ç¼“å­˜ç¢ç‰‡åŒ–é—®é¢˜</strong>ï¼Œé€šè¿‡ä¼˜åŒ–ç¼“å­˜ç­–ç•¥æ˜¾è‘—æå‡ç™»å½•æ€ä¸‹çš„é¡µé¢ç¼“å­˜å‘½ä¸­ç‡ã€‚</p><p><strong>æ ¸å¿ƒç›®æ ‡</strong>ï¼š</p><ul><li>ğŸ“ˆ æå‡ç™»å½•æ€ç¼“å­˜å‘½ä¸­ç‡ï¼šä» 10-15% â†’ 40-50%</li><li>ğŸ¯ è§£å†³ç¼“å­˜ç¢ç‰‡åŒ–é—®é¢˜</li><li>âš¡ æ”¹å–„é¡µé¢æ€§èƒ½æŒ‡æ ‡ï¼ˆTTFBã€LCPï¼‰</li><li>ğŸ”§ åŒºåˆ†å…¬å…±å®éªŒå’Œç§æœ‰å®éªŒ</li></ul><p><strong>ç›¸å…³æ–‡æ¡£</strong>ï¼š</p><ul><li>å‰ç½®ï¼š<a href="./09-ABå®éªŒ-RFC12.1-SSRåœºæ™¯ä¸‹çš„ABå®éªŒä¸ç¼“å­˜ç­–ç•¥æ”¹è¿›">RFC 12.1: AB å®éªŒä¸ç¼“å­˜ç­–ç•¥æ”¹è¿›</a></li><li>å‰ç½®ï¼š<a href="./10-ABå®éªŒ-RFC12.2-SSRåœºæ™¯ä¸‹çš„ABå®éªŒæ•°æ®è·å–ä¼˜åŒ–">RFC 12.2: AB å®éªŒæ•°æ®è·å–ä¼˜åŒ–</a></li></ul><hr><h2 id="ä¸€ã€èƒŒæ™¯ä¸é—®é¢˜" tabindex="-1">ä¸€ã€èƒŒæ™¯ä¸é—®é¢˜ <a class="header-anchor" href="#ä¸€ã€èƒŒæ™¯ä¸é—®é¢˜" aria-label="Permalink to &quot;ä¸€ã€èƒŒæ™¯ä¸é—®é¢˜&quot;">â€‹</a></h2><h3 id="_1-1-æ€§èƒ½ä¸‹é™ç°è±¡" tabindex="-1">1.1 æ€§èƒ½ä¸‹é™ç°è±¡ <a class="header-anchor" href="#_1-1-æ€§èƒ½ä¸‹é™ç°è±¡" aria-label="Permalink to &quot;1.1 æ€§èƒ½ä¸‹é™ç°è±¡&quot;">â€‹</a></h3><p><strong>æ•°æ®è§‚å¯Ÿ</strong>ï¼šä» 2025 å¹´ç¬¬ 5 å‘¨å¼€å§‹ï¼Œé¦–é¡µå’Œæ¨¡æ¿é¡µç­‰ SSR é¡µé¢çš„æ€§èƒ½æŒç»­ä¸‹é™</p><p><strong>æ€§èƒ½æŒ‡æ ‡è¶‹åŠ¿</strong>ï¼š</p><table tabindex="0"><thead><tr><th>æ€§èƒ½æŒ‡æ ‡</th><th>ç¬¬3å‘¨</th><th>ç¬¬4å‘¨</th><th>ç¬¬5å‘¨</th><th>ç¬¬6å‘¨</th><th>ç¬¬7å‘¨</th><th>ç¬¬8å‘¨</th><th>ç¬¬9å‘¨</th></tr></thead><tbody><tr><td><strong>é¦–é¡µ TTFB</strong></td><td>611 ms</td><td>798 ms</td><td><strong>1070.5 ms</strong></td><td>1027 ms</td><td>1104.8 ms</td><td>1203.6 ms</td><td>1201.6 ms</td></tr><tr><td><strong>é¦–é¡µ LCP</strong></td><td>1556.5 ms</td><td>1695.5 ms</td><td><strong>2145.3 ms</strong></td><td>1956.3 ms</td><td>2147.5 ms</td><td>2239.9 ms</td><td>2244 ms</td></tr></tbody></table><p><strong>è¶‹åŠ¿åˆ†æ</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>TTFB: 611ms â†’ 1201ms (â¬†ï¸ 96%)</span></span>
<span class="line"><span>LCP:  1556ms â†’ 2244ms (â¬†ï¸ 44%)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>å½±å“</strong>ï¼š</p><ul><li>ğŸ”´ TTFB å¢åŠ è¿‘ 100%</li><li>ğŸ”´ LCP ä»ä¼˜ç§€ï¼ˆ&lt; 1.5sï¼‰é™åˆ°ä¸åŠæ ¼ï¼ˆ&gt; 2sï¼‰</li><li>ğŸ”´ ç”¨æˆ·ä½“éªŒæ˜æ˜¾ä¸‹é™</li></ul><p><img src="`+l+`" alt="æ€§èƒ½æŒ‡æ ‡è¶‹åŠ¿"></p><h3 id="_1-2-é—®é¢˜åˆ†æ" tabindex="-1">1.2 é—®é¢˜åˆ†æ <a class="header-anchor" href="#_1-2-é—®é¢˜åˆ†æ" aria-label="Permalink to &quot;1.2 é—®é¢˜åˆ†æ&quot;">â€‹</a></h3><h4 id="åˆ†ææ­¥éª¤" tabindex="-1">åˆ†ææ­¥éª¤ <a class="header-anchor" href="#åˆ†ææ­¥éª¤" aria-label="Permalink to &quot;åˆ†ææ­¥éª¤&quot;">â€‹</a></h4><p><strong>æ­¥éª¤ 1ï¼šå…³è”åˆ†æ</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>è§‚å¯Ÿï¼šæ€§èƒ½ä¸‹é™ å’Œ ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™ è¶‹åŠ¿ä¸€è‡´</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç»“è®ºï¼šæ€€ç–‘ç¼“å­˜å‘½ä¸­ç‡å½±å“äº†æ€§èƒ½</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>æ­¥éª¤ 2ï¼šå®éªŒéªŒè¯</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å®éªŒï¼šç¬¬ 11 å‘¨ï¼Œå…³é—­é¦–é¡µçš„ AB ç¼“å­˜ key</span></span>
<span class="line"><span>   â†“</span></span>
<span class="line"><span>è§‚å¯Ÿï¼š</span></span>
<span class="line"><span>   - ç¼“å­˜å‘½ä¸­ç‡ä¸Šå‡ âœ…</span></span>
<span class="line"><span>   - TTFB å’Œ LCP ä¸‹é™ âœ…</span></span>
<span class="line"><span>   â†“</span></span>
<span class="line"><span>ç»“è®ºï¼šAB ç¼“å­˜ key ç¡®å®å½±å“æ€§èƒ½</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>æ­¥éª¤ 3ï¼šè¯¦ç»†åˆ†æ</strong></p><table tabindex="0"><thead><tr><th>ç»´åº¦</th><th>ç¼“å­˜å‘½ä¸­ç‡</th><th>ç»“è®º</th></tr></thead><tbody><tr><td><strong>æœªç™»å½•æ€</strong></td><td>~60%</td><td>ğŸŸ¢ å¯æ¥å—</td></tr><tr><td><strong>å·²ç™»å½•æ€</strong></td><td>~10-15%</td><td>ğŸ”´ ä¸¥é‡é—®é¢˜</td></tr><tr><td><strong>æ•´ä½“</strong></td><td>~35%</td><td>ğŸŸ¡ éœ€æ”¹å–„</td></tr></tbody></table><p><strong>å…³é”®å‘ç°</strong>ï¼šå…³é—­ AB ç¼“å­˜ key åï¼Œ<strong>ç™»å½•æ€çš„ç¼“å­˜å‘½ä¸­ç‡æå‡æ˜æ˜¾</strong></p><p><img src="`+e+'" alt="ç¼“å­˜å‘½ä¸­ç‡å¯¹æ¯”"><img src="'+t+'" alt="é¡µé¢æ€§èƒ½å¯¹æ¯”"><img src="'+r+`" alt="ç™»å½•æ€ç¼“å­˜åˆ†æ"></p><h4 id="æ ¹æœ¬åŸå› " tabindex="-1">æ ¹æœ¬åŸå›  <a class="header-anchor" href="#æ ¹æœ¬åŸå› " aria-label="Permalink to &quot;æ ¹æœ¬åŸå› &quot;">â€‹</a></h4><p><strong>æœªç™»å½•æ€</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç¼“å­˜ Key = hash(URL + ab-test-id)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span>- ç”¨æˆ·ä¹‹é—´å¯ä»¥å…±äº«ç¼“å­˜</span></span>
<span class="line"><span>- ç¼“å­˜å‘½ä¸­ç‡ç›¸å¯¹è¾ƒé«˜ï¼ˆ~60%ï¼‰</span></span>
<span class="line"><span>- AB è°ƒæ•´ä¼šå½±å“ï¼Œä½†å½±å“é¢å¹¿ï¼Œæ–°ç¼“å­˜å¿«é€Ÿç§¯ç´¯</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>å·²ç™»å½•æ€</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç¼“å­˜ Key = hash(URL + userId + orgId + ab-test-id)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>é—®é¢˜ï¼š</span></span>
<span class="line"><span>1. userId å’Œ orgId å¯¼è‡´æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹ç¼“å­˜</span></span>
<span class="line"><span>2. ab-test-id è¿›ä¸€æ­¥åˆ†è£‚ç¼“å­˜</span></span>
<span class="line"><span>3. AB è°ƒæ•´åï¼Œæ‰€æœ‰ç”¨æˆ·çš„ç¼“å­˜éƒ½å¤±æ•ˆ</span></span>
<span class="line"><span>4. ç”¨æˆ·æ•°å¤šï¼Œç¼“å­˜ç¢ç‰‡åŒ–ä¸¥é‡</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç»“æœï¼š</span></span>
<span class="line"><span>- ç¼“å­˜å‘½ä¸­ç‡æä½ï¼ˆ~10-15%ï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>ç¼“å­˜ç¢ç‰‡åŒ–è®¡ç®—</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å‡è®¾ï¼š</span></span>
<span class="line"><span>- 10,000 ä¸ªæ´»è·ƒç™»å½•ç”¨æˆ·</span></span>
<span class="line"><span>- 3 ä¸ª AB å®éªŒï¼Œæ¯ä¸ª 2 ç§æƒ…å†µ</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç¼“å­˜ç‰ˆæœ¬æ•° = 10,000 Ã— 2^3 = 80,000 ä¸ªç‰ˆæœ¬ âŒ</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¯ä¸ªç‰ˆæœ¬çš„å‘½ä¸­æ¦‚ç‡ = 1 / 80,000 â‰ˆ 0.00125%</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>é—®é¢˜æ€»ç»“</strong>ï¼š</p><table tabindex="0"><thead><tr><th>å› ç´ </th><th>å½±å“</th><th>ç¨‹åº¦</th></tr></thead><tbody><tr><td><strong>userId éš”ç¦»</strong></td><td>ç”¨æˆ·é—´æ— æ³•å…±äº«ç¼“å­˜</td><td>ğŸ”´ é«˜</td></tr><tr><td><strong>AB åˆ†è£‚</strong></td><td>æ¯ä¸ªå®éªŒ Ã— 2 ç‰ˆæœ¬</td><td>ğŸ”´ é«˜</td></tr><tr><td><strong>AB è°ƒæ•´</strong></td><td>æ—§ç¼“å­˜å…¨éƒ¨å¤±æ•ˆ</td><td>ğŸ”´ é«˜</td></tr></tbody></table><hr><h2 id="äºŒã€è§£å†³æ–¹æ¡ˆæ¢ç´¢" tabindex="-1">äºŒã€è§£å†³æ–¹æ¡ˆæ¢ç´¢ <a class="header-anchor" href="#äºŒã€è§£å†³æ–¹æ¡ˆæ¢ç´¢" aria-label="Permalink to &quot;äºŒã€è§£å†³æ–¹æ¡ˆæ¢ç´¢&quot;">â€‹</a></h2><h3 id="_2-1-æ–¹æ¡ˆä¸€-ç™»å½•æ€ä¸‹ç§»é™¤-ab-test-id" tabindex="-1">2.1 æ–¹æ¡ˆä¸€ï¼šç™»å½•æ€ä¸‹ç§»é™¤ ab-test-id <a class="header-anchor" href="#_2-1-æ–¹æ¡ˆä¸€-ç™»å½•æ€ä¸‹ç§»é™¤-ab-test-id" aria-label="Permalink to &quot;2.1 æ–¹æ¡ˆä¸€ï¼šç™»å½•æ€ä¸‹ç§»é™¤ ab-test-id&quot;">â€‹</a></h3><h4 id="æ ¸å¿ƒæ€è·¯" tabindex="-1">æ ¸å¿ƒæ€è·¯ <a class="header-anchor" href="#æ ¸å¿ƒæ€è·¯" aria-label="Permalink to &quot;æ ¸å¿ƒæ€è·¯&quot;">â€‹</a></h4><p><strong>ç†è®ºä¾æ®</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>userId + orgId å·²ç»æ ‡è¯†äº†ç”¨æˆ·çš„å”¯ä¸€æ€§</span></span>
<span class="line"><span>   â†“</span></span>
<span class="line"><span>åŒä¸€ç”¨æˆ·åœ¨åŒä¸€æ—¶åˆ»åªä¼šå‘½ä¸­ä¸€ç§ AB ç»„</span></span>
<span class="line"><span>   â†“</span></span>
<span class="line"><span>ç†è®ºä¸Šä¸éœ€è¦ ab-test-id åŒºåˆ†ç¼“å­˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>å®æ–½æ–¹æ¡ˆ</strong>ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®¡ç®—ç¼“å­˜ Key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getCacheKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">orgId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">abTestId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">isLoggedIn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isLoggedIn) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç™»å½•æ€ï¼šä¸ä½¿ç”¨ ab-test-id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orgId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æœªç™»å½•æ€ï¼šä½¿ç”¨ ab-test-id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> abTestId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>é¢„æœŸæ•ˆæœ</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç¼“å­˜ç‰ˆæœ¬æ•° = 10,000 (ä»…æŒ‰ userId)</span></span>
<span class="line"><span>   vs</span></span>
<span class="line"><span>æ—§æ–¹æ¡ˆ = 10,000 Ã— 8 = 80,000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç¼“å­˜ç¢ç‰‡åŒ–å‡å°‘ 8 å€ âœ…</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="é—®é¢˜å‘ç°-å…¬å…±ç»„ä»¶ä¸ä¸€è‡´" tabindex="-1">é—®é¢˜å‘ç°ï¼šå…¬å…±ç»„ä»¶ä¸ä¸€è‡´ <a class="header-anchor" href="#é—®é¢˜å‘ç°-å…¬å…±ç»„ä»¶ä¸ä¸€è‡´" aria-label="Permalink to &quot;é—®é¢˜å‘ç°ï¼šå…¬å…±ç»„ä»¶ä¸ä¸€è‡´&quot;">â€‹</a></h4><p><strong>æµ‹è¯•å‘ç°</strong>ï¼šå»æ‰ ab-test-id åï¼Œ<strong>å…¬å…±ç»„ä»¶åœ¨ä¸åŒé¡µé¢æ˜¾ç¤ºä¸ä¸€è‡´</strong></p><p><strong>æ¡ˆä¾‹</strong>ï¼šä¾§è¾¹èœå•æ å®éªŒ</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·è®¿é—®é¦–é¡µï¼š</span></span>
<span class="line"><span>   â”œâ”€ ç¼“å­˜çŠ¶æ€ï¼šHITï¼ˆ1 åˆ†é’Ÿå‰ç¼“å­˜ï¼‰</span></span>
<span class="line"><span>   â”œâ”€ AB å®éªŒç‰ˆæœ¬ï¼šX</span></span>
<span class="line"><span>   â””â”€ ä¾§è¾¹èœå•æ ï¼šX ç‰ˆæœ¬</span></span>
<span class="line"><span></span></span>
<span class="line"><span>åŒä¸€ç”¨æˆ·è®¿é—®æ¨¡æ¿é¡µï¼š</span></span>
<span class="line"><span>   â”œâ”€ ç¼“å­˜çŠ¶æ€ï¼šMISSï¼ˆæ–°é¡µé¢æ— ç¼“å­˜ï¼‰</span></span>
<span class="line"><span>   â”œâ”€ AB å®éªŒç‰ˆæœ¬ï¼šYï¼ˆé…ç½®åˆšè°ƒæ•´ï¼‰</span></span>
<span class="line"><span>   â””â”€ ä¾§è¾¹èœå•æ ï¼šY ç‰ˆæœ¬</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç»“æœï¼š</span></span>
<span class="line"><span>   é¦–é¡µå’Œæ¨¡æ¿é¡µçš„ä¾§è¾¹æ ä¸ä¸€è‡´ âŒ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="`+h+'" alt="é¦–é¡µä¾§è¾¹æ "><img src="'+k+`" alt="æ¨¡æ¿é¡µä¾§è¾¹æ "></p><p><strong>åŸå› åˆ†æ</strong>ï¼š</p><p><strong>ç¼“å­˜ä¼˜å…ˆç­–ç•¥</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Cache-Control: max-age=600, stale-while-revalidate=604800, stale-if-error=604800</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å«ä¹‰ï¼š</span></span>
<span class="line"><span>- æ–°é²œæœŸï¼š10 åˆ†é’Ÿ</span></span>
<span class="line"><span>- é™ˆæ—§å¯ç”¨æœŸï¼š7 å¤©ï¼ˆåå°æ›´æ–°ï¼‰</span></span>
<span class="line"><span>- é”™è¯¯é™çº§æœŸï¼š7 å¤©</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>ç¼“å­˜è¡Œä¸º</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>0-10 åˆ†é’Ÿï¼š</span></span>
<span class="line"><span>   â† ç›´æ¥è¿”å›ç¼“å­˜ï¼ˆæ–°é²œï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>10 åˆ†é’Ÿ - 7 å¤©ï¼š</span></span>
<span class="line"><span>   â† å…ˆè¿”å›æ—§ç¼“å­˜ï¼ˆé™ˆæ—§ä½†å¯ç”¨ï¼‰</span></span>
<span class="line"><span>   â† åŒæ—¶åå°è§¦å‘æ›´æ–°</span></span>
<span class="line"><span>   â† ä¸‹æ¬¡è®¿é—®è¿”å›æ–°ç¼“å­˜</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&gt; 7 å¤©ï¼š</span></span>
<span class="line"><span>   â† ç¼“å­˜è¿‡æœŸï¼Œå¼ºåˆ¶æ›´æ–°</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>é—®é¢˜åœºæ™¯</strong>ï¼š</p><table tabindex="0"><thead><tr><th>æƒ…å†µ</th><th>é¡µé¢ A</th><th>é¡µé¢ B</th><th>å…¬å…±ç»„ä»¶</th><th>ä¸€è‡´æ€§</th></tr></thead><tbody><tr><td><strong>æƒ…å†µ 1</strong></td><td>MISS</td><td>MISS</td><td>éƒ½æ˜¯æ–°ç‰ˆæœ¬</td><td>âœ… ä¸€è‡´</td></tr><tr><td><strong>æƒ…å†µ 2</strong></td><td>HIT (æ—§)</td><td>MISS</td><td>A æ—§ã€B æ–°</td><td>âŒ ä¸ä¸€è‡´</td></tr><tr><td><strong>æƒ…å†µ 3</strong></td><td>MISS</td><td>HIT (æ—§)</td><td>A æ–°ã€B æ—§</td><td>âŒ ä¸ä¸€è‡´</td></tr></tbody></table><p><strong>å…¬å…±å®éªŒå®šä¹‰</strong>ï¼š</p><blockquote><p><strong>å…¬å…±å®éªŒ</strong>ï¼šé¡µé¢ SSR æ¸²æŸ“å…±åŒä¾èµ–çš„ç»„ä»¶å®éªŒ</p></blockquote><p><strong>ç¤ºä¾‹</strong>ï¼š</p><table tabindex="0"><thead><tr><th>ç±»å‹</th><th>æ˜¯å¦å…¬å…±å®éªŒ</th><th>åŸå› </th></tr></thead><tbody><tr><td><strong>ä¾§è¾¹èœå•æ </strong></td><td>âœ… æ˜¯</td><td>åœ¨ SSR ä¸­æ¸²æŸ“ï¼Œå½±å“ HTML</td></tr><tr><td><strong>é¡¶éƒ¨å¯¼èˆªæ </strong></td><td>âœ… æ˜¯</td><td>åœ¨ SSR ä¸­æ¸²æŸ“ï¼Œå½±å“ HTML</td></tr><tr><td><strong>å¼¹çª—ç»„ä»¶</strong></td><td>âŒ å¦</td><td>CSR æ¸²æŸ“ï¼Œä¸å½±å“ç¼“å­˜</td></tr><tr><td><strong>å¼‚æ­¥åŠ è½½å†…å®¹</strong></td><td>âŒ å¦</td><td>å®¢æˆ·ç«¯è·å–ï¼Œä¸å½±å“ç¼“å­˜</td></tr></tbody></table><h4 id="æ–¹æ¡ˆä¸€ç»“è®º" tabindex="-1">æ–¹æ¡ˆä¸€ç»“è®º <a class="header-anchor" href="#æ–¹æ¡ˆä¸€ç»“è®º" aria-label="Permalink to &quot;æ–¹æ¡ˆä¸€ç»“è®º&quot;">â€‹</a></h4><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>âœ… å¤§å¹…å‡å°‘ç¼“å­˜ç¢ç‰‡åŒ–</li><li>âœ… æå‡ç¼“å­˜å‘½ä¸­ç‡</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>âŒ å…¬å…±ç»„ä»¶åœ¨ä¸åŒé¡µé¢å¯èƒ½ä¸ä¸€è‡´</li><li>âŒ ç”¨æˆ·ä½“éªŒå›°æƒ‘</li></ul><p><strong>å†³ç­–</strong>ï¼šâŒ <strong>ä¸å¯æ¥å—</strong>ï¼Œéœ€è¦å…¶ä»–æ–¹æ¡ˆ</p><hr><h3 id="_2-2-æ–¹æ¡ˆäºŒ-è°ƒæ•´-ab-test-id-ç”Ÿæˆè§„åˆ™-æ¨è-â­" tabindex="-1">2.2 æ–¹æ¡ˆäºŒï¼šè°ƒæ•´ ab-test-id ç”Ÿæˆè§„åˆ™ï¼ˆæ¨èï¼‰â­ <a class="header-anchor" href="#_2-2-æ–¹æ¡ˆäºŒ-è°ƒæ•´-ab-test-id-ç”Ÿæˆè§„åˆ™-æ¨è-â­" aria-label="Permalink to &quot;2.2 æ–¹æ¡ˆäºŒï¼šè°ƒæ•´ ab-test-id ç”Ÿæˆè§„åˆ™ï¼ˆæ¨èï¼‰â­&quot;">â€‹</a></h3><h4 id="æ ¸å¿ƒæ€è·¯-1" tabindex="-1">æ ¸å¿ƒæ€è·¯ <a class="header-anchor" href="#æ ¸å¿ƒæ€è·¯-1" aria-label="Permalink to &quot;æ ¸å¿ƒæ€è·¯&quot;">â€‹</a></h4><p><strong>è§‚å¯Ÿ</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>é—®é¢˜çš„å…³é”®åœ¨äºï¼š</span></span>
<span class="line"><span>   æ‰€æœ‰å®éªŒéƒ½å½±å“ ab-test-id</span></span>
<span class="line"><span>      â†“</span></span>
<span class="line"><span>   ä½†åªæœ‰å…¬å…±å®éªŒä¼šå¯¼è‡´ä¸ä¸€è‡´</span></span>
<span class="line"><span>      â†“</span></span>
<span class="line"><span>   è§£å†³æ–¹æ¡ˆï¼š</span></span>
<span class="line"><span>   åªå°†å…¬å…±å®éªŒçº³å…¥ ab-test-id è®¡ç®—</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>æ–¹æ¡ˆè®¾è®¡</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç™»å½•æ€ä¸‹ï¼š</span></span>
<span class="line"><span>   ab-test-id = hash(ä»…å…¬å…±å®éªŒçš„æ•°æ®)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æœªç™»å½•æ€ï¼š</span></span>
<span class="line"><span>   ab-test-id = hash(æ‰€æœ‰å®éªŒçš„æ•°æ®) (ä¿æŒä¸å˜)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="æ•ˆæœåˆ†æ" tabindex="-1">æ•ˆæœåˆ†æ <a class="header-anchor" href="#æ•ˆæœåˆ†æ" aria-label="Permalink to &quot;æ•ˆæœåˆ†æ&quot;">â€‹</a></h4><p><strong>å‡è®¾åœºæ™¯</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å®éªŒé…ç½®ï¼š</span></span>
<span class="line"><span>   A: ä¾§è¾¹èœå•æ å®éªŒï¼ˆå…¬å…±ï¼‰</span></span>
<span class="line"><span>   B: é¦–é¡µæ¨èç®—æ³•ï¼ˆéå…¬å…±ï¼‰</span></span>
<span class="line"><span>   C: æ¨¡æ¿åˆ—è¡¨æ ·å¼ï¼ˆéå…¬å…±ï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¯ä¸ªå®éªŒ 2 ç§æƒ…å†µï¼šA1/A2, B1/B2, C1/C2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>æ‰€æœ‰å®éªŒå‚ä¸ vs ä»…å…¬å…±å®éªŒå‚ä¸</strong>ï¼š</p><table tabindex="0"><thead><tr><th>å®éªŒç»„åˆ</th><th>A (å…¬å…±)</th><th>B</th><th>C</th><th>æ‰€æœ‰å®éªŒ ab-test-id</th><th>å…¬å…±å®éªŒ ab-test-id</th></tr></thead><tbody><tr><td>ç‰ˆæœ¬ 1</td><td>A1</td><td>B1</td><td>C1</td><td>hash(A1B1C1)</td><td>hash(A1)</td></tr><tr><td>ç‰ˆæœ¬ 2</td><td>A1</td><td>B1</td><td>C2</td><td>hash(A1B1C2)</td><td>hash(A1)</td></tr><tr><td>ç‰ˆæœ¬ 3</td><td>A1</td><td>B2</td><td>C1</td><td>hash(A1B2C1)</td><td>hash(A1)</td></tr><tr><td>ç‰ˆæœ¬ 4</td><td>A1</td><td>B2</td><td>C2</td><td>hash(A1B2C2)</td><td>hash(A1)</td></tr><tr><td>ç‰ˆæœ¬ 5</td><td>A2</td><td>B1</td><td>C1</td><td>hash(A2B1C1)</td><td>hash(A2)</td></tr><tr><td>ç‰ˆæœ¬ 6</td><td>A2</td><td>B1</td><td>C2</td><td>hash(A2B1C2)</td><td>hash(A2)</td></tr><tr><td>ç‰ˆæœ¬ 7</td><td>A2</td><td>B2</td><td>C1</td><td>hash(A2B2C1)</td><td>hash(A2)</td></tr><tr><td>ç‰ˆæœ¬ 8</td><td>A2</td><td>B2</td><td>C2</td><td>hash(A2B2C2)</td><td>hash(A2)</td></tr></tbody></table><p><strong>ç¼“å­˜ç‰ˆæœ¬æ•°å¯¹æ¯”</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ‰€æœ‰å®éªŒï¼š2^3 = 8 ä¸ªç‰ˆæœ¬</span></span>
<span class="line"><span>å…¬å…±å®éªŒï¼š2^1 = 2 ä¸ªç‰ˆæœ¬</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å‡å°‘ï¼š8 / 2 = 4 å€ âœ…</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ä¸€èˆ¬å…¬å¼</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>n ä¸ªå®éªŒï¼Œå…¶ä¸­ m ä¸ªå…¬å…±å®éªŒ</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ‰€æœ‰å®éªŒï¼š2^n ä¸ªç‰ˆæœ¬</span></span>
<span class="line"><span>å…¬å…±å®éªŒï¼š2^m ä¸ªç‰ˆæœ¬</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç¢ç‰‡åŒ–å‡å°‘ï¼š2^n / 2^m = 2^(n-m) å€</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>å®é™…æ¡ˆä¾‹</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å‡è®¾ï¼š5 ä¸ªå®éªŒï¼Œå…¶ä¸­ 1 ä¸ªå…¬å…±å®éªŒ</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ‰€æœ‰å®éªŒï¼š2^5 = 32 ä¸ªç‰ˆæœ¬</span></span>
<span class="line"><span>å…¬å…±å®éªŒï¼š2^1 = 2 ä¸ªç‰ˆæœ¬</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å‡å°‘ï¼š32 / 2 = 16 å€ âœ…</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç¼“å­˜å‘½ä¸­ç‡ï¼š</span></span>
<span class="line"><span>   æ—§æ–¹æ¡ˆï¼š1/32 â‰ˆ 3%</span></span>
<span class="line"><span>   æ–°æ–¹æ¡ˆï¼š1/2 = 50%</span></span>
<span class="line"><span>   æå‡ï¼š16 å€ ğŸš€</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="æ–¹æ¡ˆæµç¨‹è®¾è®¡" tabindex="-1">æ–¹æ¡ˆæµç¨‹è®¾è®¡ <a class="header-anchor" href="#æ–¹æ¡ˆæµç¨‹è®¾è®¡" aria-label="Permalink to &quot;æ–¹æ¡ˆæµç¨‹è®¾è®¡&quot;">â€‹</a></h4><p><strong>åŒºåˆ†ç™»å½•æ€</strong>ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç”Ÿæˆ ab-test-id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generateABTestId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">abData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">isLoggedIn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isLoggedIn) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç™»å½•æ€ï¼šåªä½¿ç”¨å…¬å…±å®éªŒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> commonExperiments</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> filterCommonExperiments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(abData);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(commonExperiments));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æœªç™»å½•æ€ï¼šä½¿ç”¨æ‰€æœ‰å®éªŒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(abData));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¿‡æ»¤å…¬å…±å®éªŒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> filterCommonExperiments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">abData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> commonExperiments</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">entries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(abData)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ£€æŸ¥å®éªŒçš„ tag</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (value.tags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value.tags.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;common&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      commonExperiments[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> commonExperiments;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>Redis å­˜å‚¨ç­–ç•¥</strong>ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç™»å½•æ€å­˜å‚¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> storeABDataForLoggedIn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">abData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ab-test-common-id: åªåŒ…å«å…¬å…±å®éªŒçš„ hash</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> commonExperiments</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> filterCommonExperiments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(abData);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> abTestCommonId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(commonExperiments));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Redis Key åŒ…å« userIdï¼Œé¿å…ä¸åŒç”¨æˆ·å†²çª</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> redisKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`ab:\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">userId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">abTestCommonId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Value ä»ç„¶æ˜¯å®Œæ•´çš„ AB æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(redisKey, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(abData));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> abTestCommonId;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>æ•°æ®ç¤ºä¾‹</strong>ï¼š</p><table tabindex="0"><thead><tr><th>å®éªŒ</th><th>ç”¨æˆ· ID</th><th>A (å…¬å…±)</th><th>B</th><th>AB æ•°æ®</th><th>ab-test-id</th><th>Redis Key</th></tr></thead><tbody><tr><td>ç”¨æˆ· 1</td><td>xxxx1</td><td>A1</td><td>B1</td><td><code>{A:A1, B:B1}</code></td><td>hash(A1)</td><td><code>ab:xxxx1:hash(A1)</code></td></tr><tr><td>ç”¨æˆ· 2</td><td>xxxx2</td><td>A1</td><td>B2</td><td><code>{A:A1, B:B2}</code></td><td>hash(A1)</td><td><code>ab:xxxx2:hash(A1)</code></td></tr></tbody></table><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li>âœ… ä¸¤ä¸ªç”¨æˆ·çš„ ab-test-id ç›¸åŒï¼ˆéƒ½æ˜¯ hash(A1)ï¼‰</li><li>âœ… å¯ä»¥å…±äº«é¡µé¢ç¼“å­˜</li><li>âœ… Redis Key ä¸åŒï¼ˆåŒ…å« userIdï¼‰ï¼Œé¿å…æ•°æ®å†²çª</li></ul><p><strong>ç¼“å­˜ Key è®¡ç®—</strong>ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç™»å½•æ€ç¼“å­˜ Key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getCacheKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">orgId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">abTestCommonId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">isLoggedIn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isLoggedIn) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orgId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> abTestCommonId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> abTestId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="å®Œæ•´æµç¨‹å›¾" tabindex="-1">å®Œæ•´æµç¨‹å›¾ <a class="header-anchor" href="#å®Œæ•´æµç¨‹å›¾" aria-label="Permalink to &quot;å®Œæ•´æµç¨‹å›¾&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚              ç”¨æˆ·è¯·æ±‚                         â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                 â”‚</span></span>
<span class="line"><span>                 â–¼</span></span>
<span class="line"><span>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>        â”‚  æ£€æŸ¥ç™»å½•æ€    â”‚</span></span>
<span class="line"><span>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                 â”‚</span></span>
<span class="line"><span>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>        â”‚                 â”‚</span></span>
<span class="line"><span>        â–¼                 â–¼</span></span>
<span class="line"><span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>  â”‚ æœªç™»å½•æ€  â”‚      â”‚ å·²ç™»å½•æ€  â”‚</span></span>
<span class="line"><span>  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>        â”‚                 â”‚</span></span>
<span class="line"><span>        â–¼                 â–¼</span></span>
<span class="line"><span>  æ‰€æœ‰å®éªŒå‚ä¸      ä»…å…¬å…±å®éªŒå‚ä¸</span></span>
<span class="line"><span>  ab-test-id       ab-test-common-id</span></span>
<span class="line"><span>        â”‚                 â”‚</span></span>
<span class="line"><span>        â”‚                 â”‚</span></span>
<span class="line"><span>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                 â”‚</span></span>
<span class="line"><span>                 â–¼</span></span>
<span class="line"><span>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>        â”‚  å­˜å…¥ Redis    â”‚</span></span>
<span class="line"><span>        â”‚                â”‚</span></span>
<span class="line"><span>        â”‚  Key:          â”‚</span></span>
<span class="line"><span>        â”‚  - æœªç™»å½•:     â”‚</span></span>
<span class="line"><span>        â”‚    ab:{id}     â”‚</span></span>
<span class="line"><span>        â”‚  - å·²ç™»å½•:     â”‚</span></span>
<span class="line"><span>        â”‚    ab:{userId}:â”‚</span></span>
<span class="line"><span>        â”‚    {commonId}  â”‚</span></span>
<span class="line"><span>        â”‚                â”‚</span></span>
<span class="line"><span>        â”‚  Value:        â”‚</span></span>
<span class="line"><span>        â”‚    å®Œæ•´ABæ•°æ®   â”‚</span></span>
<span class="line"><span>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                 â”‚</span></span>
<span class="line"><span>                 â–¼</span></span>
<span class="line"><span>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>        â”‚  è®¡ç®—ç¼“å­˜Key    â”‚</span></span>
<span class="line"><span>        â”‚                â”‚</span></span>
<span class="line"><span>        â”‚  - æœªç™»å½•:     â”‚</span></span>
<span class="line"><span>        â”‚    url + id    â”‚</span></span>
<span class="line"><span>        â”‚  - å·²ç™»å½•:     â”‚</span></span>
<span class="line"><span>        â”‚    url + uid + â”‚</span></span>
<span class="line"><span>        â”‚    commonId    â”‚</span></span>
<span class="line"><span>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                 â”‚</span></span>
<span class="line"><span>                 â–¼</span></span>
<span class="line"><span>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>        â”‚  SSR æ¸²æŸ“      â”‚</span></span>
<span class="line"><span>        â”‚                â”‚</span></span>
<span class="line"><span>        â”‚  ä» Redis è·å– â”‚</span></span>
<span class="line"><span>        â”‚  å®Œæ•´ABæ•°æ®     â”‚</span></span>
<span class="line"><span>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                 â”‚</span></span>
<span class="line"><span>                 â–¼</span></span>
<span class="line"><span>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>        â”‚  CSR ä½¿ç”¨      â”‚</span></span>
<span class="line"><span>        â”‚                â”‚</span></span>
<span class="line"><span>        â”‚  window.       â”‚</span></span>
<span class="line"><span>        â”‚  GD_AB_DATA    â”‚</span></span>
<span class="line"><span>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h4 id="csr-æ•°æ®ä½¿ç”¨" tabindex="-1">CSR æ•°æ®ä½¿ç”¨ <a class="header-anchor" href="#csr-æ•°æ®ä½¿ç”¨" aria-label="Permalink to &quot;CSR æ•°æ®ä½¿ç”¨&quot;">â€‹</a></h4><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å®¢æˆ·ç«¯ AB SDK</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ABClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ä¼˜å…ˆä½¿ç”¨ SSR æ³¨å…¥çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (window.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GD_AB_DATA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.abData </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> window.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GD_AB_DATA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">syncToLocalStorage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ£€æŸ¥ localStorage ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cachedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getFromLocalStorage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cachedData </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isValid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cachedData)) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.abData </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cachedData.data;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // é™çº§ï¼šé‡æ–°è·å–</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchABData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  syncToLocalStorage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> abTestId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCookie</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;x-ab-test-id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ab-experiments&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      id: abTestId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      data: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.abData,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      timestamp: Date.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  isValid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cachedData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ£€æŸ¥ ab-test-id æ˜¯å¦ä¸€è‡´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> currentId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCookie</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;x-ab-test-id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cachedData.id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> currentId;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åŸ‹ç‚¹ä¸ŠæŠ¥ä½¿ç”¨å®Œæ•´æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  trackEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">extra</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(eventName, {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">extra,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ab_experiments: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.abData </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å®Œæ•´çš„ AB æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ¥å£è¯·æ±‚æºå¸¦ AB æ ‡è¯†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> apiRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      headers: {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options.headers,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;X-AB-Experiments&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.abData)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ol><li><p>âœ… <strong>ç¼“å­˜ Key åªç”¨å…¬å…±å®éªŒ</strong></p><ul><li>å¤§å¹…å‡å°‘ç¢ç‰‡åŒ–</li><li>æå‡å‘½ä¸­ç‡</li></ul></li><li><p>âœ… <strong>Redis å­˜å‚¨å®Œæ•´æ•°æ®</strong></p><ul><li>CSR èƒ½è·å–æ‰€æœ‰å®éªŒ</li><li>åŸ‹ç‚¹å’Œæ¥å£æ­£å¸¸å·¥ä½œ</li></ul></li><li><p>âœ… <strong>ç”¨æˆ·éš”ç¦»</strong></p><ul><li>Redis Key åŒ…å« userId</li><li>é¿å…æ•°æ®å†²çª</li></ul></li></ol><hr><h2 id="ä¸‰ã€ab-å¹³å°æ”¯æŒ" tabindex="-1">ä¸‰ã€AB å¹³å°æ”¯æŒ <a class="header-anchor" href="#ä¸‰ã€ab-å¹³å°æ”¯æŒ" aria-label="Permalink to &quot;ä¸‰ã€AB å¹³å°æ”¯æŒ&quot;">â€‹</a></h2><h3 id="_3-1-å®éªŒæ ‡ç­¾ç³»ç»Ÿ" tabindex="-1">3.1 å®éªŒæ ‡ç­¾ç³»ç»Ÿ <a class="header-anchor" href="#_3-1-å®éªŒæ ‡ç­¾ç³»ç»Ÿ" aria-label="Permalink to &quot;3.1 å®éªŒæ ‡ç­¾ç³»ç»Ÿ&quot;">â€‹</a></h3><p>ä¸ºäº†æ”¯æŒ&quot;å…¬å…±å®éªŒ&quot;çš„åŒºåˆ†ï¼Œéœ€è¦ AB å¹³å°æä¾›<strong>å®éªŒæ ‡ç­¾</strong>åŠŸèƒ½ã€‚</p><h4 id="æ ‡ç­¾è®¾è®¡" tabindex="-1">æ ‡ç­¾è®¾è®¡ <a class="header-anchor" href="#æ ‡ç­¾è®¾è®¡" aria-label="Permalink to &quot;æ ‡ç­¾è®¾è®¡&quot;">â€‹</a></h4><p><strong>åœ¨åˆ›å»ºå®éªŒæ—¶è®¾ç½®æ ‡ç­¾</strong>ï¼š</p><p><img src="`+d+`" alt="AB å¹³å°æ ‡ç­¾è®¾ç½®"></p><p><strong>æ ‡ç­¾å‘½åè§„èŒƒ</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ä½¿ç”¨ç®€å†™é¿å…æ•°æ®é‡è¿‡å¤§ï¼š</span></span>
<span class="line"><span>   s_ =&gt; sidebar_</span></span>
<span class="line"><span>   h_ =&gt; header_</span></span>
<span class="line"><span>   c_ =&gt; content_</span></span>
<span class="line"><span>   f_ =&gt; footer_</span></span>
<span class="line"><span>   e_ =&gt; editor_</span></span>
<span class="line"><span>   u_ =&gt; user_</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="æ ‡ç­¾åˆ—è¡¨" tabindex="-1">æ ‡ç­¾åˆ—è¡¨ <a class="header-anchor" href="#æ ‡ç­¾åˆ—è¡¨" aria-label="Permalink to &quot;æ ‡ç­¾åˆ—è¡¨&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ ‡ç­¾å</th><th>æ ‡ç­¾å€¼</th><th>æ ‡ç­¾å«ä¹‰</th><th>æ˜¯å¦å…¬å…±</th><th>ç¤ºä¾‹æˆªå›¾</th></tr></thead><tbody><tr><td><strong>ä¾§è¾¹èœå•æ </strong></td><td><code>s_menu</code></td><td>ä¾§è¾¹æ èœå•</td><td>âœ… æ˜¯</td><td><img src="`+c+'" alt="ä¾§è¾¹èœå•æ "></td></tr><tr><td><strong>å¤´éƒ¨å¯¼èˆªæ </strong></td><td><code>h_nav</code></td><td>é¡¶éƒ¨å¯¼èˆª</td><td>âœ… æ˜¯</td><td><img src="'+b+'" alt="å¤´éƒ¨å¯¼èˆªæ "></td></tr><tr><td><strong>é¦–é¡µå†…å®¹</strong></td><td><code>c_home</code></td><td>é¦–é¡µä¸»ä½“å†…å®¹</td><td>âœ… æ˜¯</td><td><img src="'+E+'" alt="é¦–é¡µå†…å®¹"></td></tr><tr><td><strong>æˆ‘çš„ç©ºé—´</strong></td><td><code>c_dam</code></td><td>æˆ‘çš„ç©ºé—´å†…å®¹</td><td>âœ… æ˜¯</td><td><img src="'+g+'" alt="æˆ‘çš„ç©ºé—´"></td></tr><tr><td><strong>æ¨¡æ¿é¡µå†…å®¹</strong></td><td><code>c_temp</code></td><td>æ¨¡æ¿åˆ—è¡¨é¡µ</td><td>âœ… æ˜¯</td><td><img src="'+o+'" alt="æ¨¡æ¿é¡µå†…å®¹"></td></tr><tr><td><strong>ç´ æé¡µå†…å®¹</strong></td><td><code>c_materials</code></td><td>ç´ æåˆ—è¡¨é¡µ</td><td>âœ… æ˜¯</td><td><img src="'+u+'" alt="ç´ æé¡µå†…å®¹"></td></tr><tr><td><strong>å›¢é˜Ÿç©ºé—´å†…å®¹</strong></td><td><code>c_dam_team</code></td><td>å›¢é˜Ÿç©ºé—´</td><td>âœ… æ˜¯</td><td><img src="'+m+'" alt="å›¢é˜Ÿç©ºé—´å†…å®¹"></td></tr><tr><td><strong>é¡µè„šå¯¼èˆª</strong></td><td><code>f_nav</code></td><td>é¡µè„š</td><td>âœ… æ˜¯</td><td><img src="'+y+'" alt="é¡µè„šå¯¼èˆª"></td></tr><tr><td><strong>ç¼–è¾‘å™¨</strong></td><td><code>e_design</code></td><td>æ‰€æœ‰ç¼–è¾‘å™¨</td><td>âš ï¸ ç‰¹æ®Š</td><td><img src="'+F+`" alt="ç¼–è¾‘å™¨"></td></tr><tr><td><strong>ç™»å½•</strong></td><td><code>u_login</code></td><td>ç™»å½•æµç¨‹</td><td>âš ï¸ ç‰¹æ®Š</td><td>-</td></tr></tbody></table><h4 id="æ¥å£æ•°æ®æ ¼å¼" tabindex="-1">æ¥å£æ•°æ®æ ¼å¼ <a class="header-anchor" href="#æ¥å£æ•°æ®æ ¼å¼" aria-label="Permalink to &quot;æ¥å£æ•°æ®æ ¼å¼&quot;">â€‹</a></h4><p><strong>AB æ¥å£è¿”å›çš„æ•°æ®ç»“æ„</strong>ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// GET /api/ab-experiments</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;experiments&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;sidebar_menu_redesign&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;variant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;s_menu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// â† æ ‡ç­¾æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;homepage_recommendation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;variant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;c_home&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;template_list_style&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;variant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;c_temp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// â† éå…¬å…±å®éªŒï¼Œæ—  &quot;common&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>æ ‡ç­¾è§„åˆ™</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å…¬å…±å®éªŒæ ‡ç­¾åŒ…å« &quot;common&quot;</span></span>
<span class="line"><span>   â†“</span></span>
<span class="line"><span>ç”¨äºç”Ÿæˆ ab-test-common-id</span></span>
<span class="line"><span></span></span>
<span class="line"><span>éå…¬å…±å®éªŒæ ‡ç­¾ä¸åŒ…å« &quot;common&quot;</span></span>
<span class="line"><span>   â†“</span></span>
<span class="line"><span>ä¸å‚ä¸ ab-test-common-id è®¡ç®—</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-2-åˆ¤æ–­å…¬å…±å®éªŒ" tabindex="-1">3.2 åˆ¤æ–­å…¬å…±å®éªŒ <a class="header-anchor" href="#_3-2-åˆ¤æ–­å…¬å…±å®éªŒ" aria-label="Permalink to &quot;3.2 åˆ¤æ–­å…¬å…±å®éªŒ&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¿‡æ»¤å…¬å…±å®éªŒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> filterCommonExperiments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">experiments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> commonExperiments</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">entries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(experiments)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ£€æŸ¥æ˜¯å¦æœ‰ &quot;common&quot; æ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (value.tags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value.tags.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;common&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      commonExperiments[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> commonExperiments;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> allExperiments</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;sidebar_menu_redesign&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;variant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;s_menu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;template_list_style&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;variant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;c_temp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> commonExperiments</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> filterCommonExperiments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(allExperiments);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// â†’ { &quot;sidebar_menu_redesign&quot;: { &quot;variant&quot;: &quot;b&quot;, &quot;tags&quot;: [...] } }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> abTestCommonId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(commonExperiments));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><hr><h2 id="å››ã€æ–¹æ¡ˆå¯¹æ¯”" tabindex="-1">å››ã€æ–¹æ¡ˆå¯¹æ¯” <a class="header-anchor" href="#å››ã€æ–¹æ¡ˆå¯¹æ¯”" aria-label="Permalink to &quot;å››ã€æ–¹æ¡ˆå¯¹æ¯”&quot;">â€‹</a></h2><h3 id="_4-1-ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”" tabindex="-1">4.1 ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯” <a class="header-anchor" href="#_4-1-ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”" aria-label="Permalink to &quot;4.1 ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>ç»´åº¦</th><th>æ–¹æ¡ˆä¸€ï¼šå®Œå…¨ç§»é™¤</th><th>æ–¹æ¡ˆäºŒï¼šä»…å…¬å…±å®éªŒ</th><th>å½“å‰ï¼ˆæ‰€æœ‰å®éªŒï¼‰</th></tr></thead><tbody><tr><td><strong>ç¼“å­˜ç‰ˆæœ¬æ•°</strong></td><td>10,000</td><td>10,000 Ã— 2</td><td>10,000 Ã— 8</td></tr><tr><td><strong>ç¼“å­˜å‘½ä¸­ç‡</strong></td><td>~80%</td><td>~50%</td><td>~10-15%</td></tr><tr><td><strong>å…¬å…±ç»„ä»¶ä¸€è‡´æ€§</strong></td><td>âŒ ä¸ä¸€è‡´</td><td>âœ… ä¸€è‡´</td><td>âœ… ä¸€è‡´</td></tr><tr><td><strong>å®æ–½å¤æ‚åº¦</strong></td><td>ä½</td><td>ä¸­</td><td>-</td></tr><tr><td><strong>AB å¹³å°æ”¹é€ </strong></td><td>æ— </td><td>éœ€è¦æ ‡ç­¾ç³»ç»Ÿ</td><td>-</td></tr><tr><td><strong>æ¨èåº¦</strong></td><td>âŒ ä¸å¯è¡Œ</td><td>â­â­â­ æ¨è</td><td>-</td></tr></tbody></table><h3 id="_4-2-æ€§èƒ½æ”¶ç›Šé¢„ä¼°" tabindex="-1">4.2 æ€§èƒ½æ”¶ç›Šé¢„ä¼° <a class="header-anchor" href="#_4-2-æ€§èƒ½æ”¶ç›Šé¢„ä¼°" aria-label="Permalink to &quot;4.2 æ€§èƒ½æ”¶ç›Šé¢„ä¼°&quot;">â€‹</a></h3><p><strong>ç¼“å­˜å‘½ä¸­ç‡æå‡</strong>ï¼š</p><table tabindex="0"><thead><tr><th>åœºæ™¯</th><th>å½“å‰</th><th>æ–¹æ¡ˆäºŒ</th><th>æå‡</th></tr></thead><tbody><tr><td><strong>æœªç™»å½•æ€</strong></td><td>60%</td><td>60%</td><td>æ— å˜åŒ–</td></tr><tr><td><strong>å·²ç™»å½•æ€</strong></td><td>10-15%</td><td><strong>40-50%</strong></td><td>â¬†ï¸ 3-4x</td></tr><tr><td><strong>æ•´ä½“</strong></td><td>35%</td><td><strong>55%</strong></td><td>â¬†ï¸ 1.6x</td></tr></tbody></table><p><strong>æ€§èƒ½æŒ‡æ ‡æ”¹å–„</strong>ï¼ˆé¢„ä¼°ï¼‰ï¼š</p><table tabindex="0"><thead><tr><th>æŒ‡æ ‡</th><th>å½“å‰</th><th>ä¼˜åŒ–å</th><th>æ”¹å–„</th></tr></thead><tbody><tr><td><strong>TTFB (P50)</strong></td><td>1200 ms</td><td><strong>700 ms</strong></td><td>â¬‡ï¸ 42%</td></tr><tr><td><strong>TTFB (P95)</strong></td><td>2500 ms</td><td><strong>1400 ms</strong></td><td>â¬‡ï¸ 44%</td></tr><tr><td><strong>LCP (P50)</strong></td><td>2200 ms</td><td><strong>1600 ms</strong></td><td>â¬‡ï¸ 27%</td></tr><tr><td><strong>LCP (P95)</strong></td><td>3500 ms</td><td><strong>2300 ms</strong></td><td>â¬‡ï¸ 34%</td></tr></tbody></table><p><strong>æˆæœ¬èŠ‚çœ</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç¼“å­˜å‘½ä¸­ç‡æå‡ â†’ SSR æ¸²æŸ“æ¬¡æ•°å‡å°‘ â†’ æœåŠ¡å™¨è´Ÿè½½é™ä½</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å‡è®¾ï¼š</span></span>
<span class="line"><span>   - æ—¥å‡ PV: 1,000,000</span></span>
<span class="line"><span>   - æœªå‘½ä¸­æˆæœ¬: 200ms CPU æ—¶é—´</span></span>
<span class="line"><span>   - å‘½ä¸­ç‡æå‡: 35% â†’ 55% (+20%)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>èŠ‚çœï¼š</span></span>
<span class="line"><span>   1,000,000 Ã— 20% Ã— 200ms = 40,000 ç§’ CPU æ—¶é—´/å¤©</span></span>
<span class="line"><span>   â‰ˆ 11 å°æ—¶ CPU æ—¶é—´/å¤©</span></span>
<span class="line"><span>   â‰ˆ 30% æœåŠ¡å™¨èµ„æº</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><hr><h2 id="äº”ã€å®æ–½æ–¹æ¡ˆ" tabindex="-1">äº”ã€å®æ–½æ–¹æ¡ˆ <a class="header-anchor" href="#äº”ã€å®æ–½æ–¹æ¡ˆ" aria-label="Permalink to &quot;äº”ã€å®æ–½æ–¹æ¡ˆ&quot;">â€‹</a></h2><h3 id="_5-1-åˆ†é˜¶æ®µå®æ–½" tabindex="-1">5.1 åˆ†é˜¶æ®µå®æ–½ <a class="header-anchor" href="#_5-1-åˆ†é˜¶æ®µå®æ–½" aria-label="Permalink to &quot;5.1 åˆ†é˜¶æ®µå®æ–½&quot;">â€‹</a></h3><p><strong>é˜¶æ®µ 1ï¼šAB å¹³å°æ”¹é€ </strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ä»»åŠ¡ï¼š</span></span>
<span class="line"><span>1. âœ… æ·»åŠ å®éªŒæ ‡ç­¾å­—æ®µ</span></span>
<span class="line"><span>2. âœ… å®éªŒåˆ›å»ºé¡µé¢å¢åŠ æ ‡ç­¾é€‰æ‹©</span></span>
<span class="line"><span>3. âœ… AB æ¥å£è¿”å›æ ‡ç­¾ä¿¡æ¯</span></span>
<span class="line"><span></span></span>
<span class="line"><span>è´Ÿè´£ï¼šæ•°æ®å›¢é˜Ÿ @å†·æœˆ</span></span>
<span class="line"><span>æ—¶é—´ï¼š1 å‘¨</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>é˜¶æ®µ 2ï¼šWorker å±‚æ”¹é€ </strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ä»»åŠ¡ï¼š</span></span>
<span class="line"><span>1. âœ… åŒºåˆ†ç™»å½•æ€å’Œæœªç™»å½•æ€</span></span>
<span class="line"><span>2. âœ… ç™»å½•æ€è¿‡æ»¤å…¬å…±å®éªŒ</span></span>
<span class="line"><span>3. âœ… ç”Ÿæˆ ab-test-common-id</span></span>
<span class="line"><span>4. âœ… Redis å­˜å‚¨ç­–ç•¥è°ƒæ•´</span></span>
<span class="line"><span></span></span>
<span class="line"><span>è´Ÿè´£ï¼šåŸºå»ºå›¢é˜Ÿ</span></span>
<span class="line"><span>æ—¶é—´ï¼š1 å‘¨</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>é˜¶æ®µ 3ï¼šBFF/SSR æ”¹é€ </strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ä»»åŠ¡ï¼š</span></span>
<span class="line"><span>1. âœ… ç¼“å­˜ Key è®¡ç®—é€»è¾‘è°ƒæ•´</span></span>
<span class="line"><span>2. âœ… Redis è¯»å–é€»è¾‘è°ƒæ•´</span></span>
<span class="line"><span>3. âœ… ç›‘æ§åŸ‹ç‚¹æ·»åŠ </span></span>
<span class="line"><span></span></span>
<span class="line"><span>è´Ÿè´£ï¼šåŸºå»ºå›¢é˜Ÿ</span></span>
<span class="line"><span>æ—¶é—´ï¼š1 å‘¨</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>é˜¶æ®µ 4ï¼šCSR é€‚é…</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ä»»åŠ¡ï¼š</span></span>
<span class="line"><span>1. âœ… å®¢æˆ·ç«¯ SDK é€‚é…</span></span>
<span class="line"><span>2. âœ… localStorage ç¼“å­˜é€»è¾‘</span></span>
<span class="line"><span>3. âœ… åŸ‹ç‚¹å’Œæ¥å£è°ƒç”¨é€‚é…</span></span>
<span class="line"><span></span></span>
<span class="line"><span>è´Ÿè´£ï¼šåŸºå»ºå›¢é˜Ÿ</span></span>
<span class="line"><span>æ—¶é—´ï¼š1 å‘¨</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>é˜¶æ®µ 5ï¼šç°åº¦éªŒè¯</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ä»»åŠ¡ï¼š</span></span>
<span class="line"><span>1. âœ… å°æµé‡éªŒè¯ï¼ˆ5%ï¼‰</span></span>
<span class="line"><span>2. âœ… ç›‘æ§æ•°æ®è§‚å¯Ÿ</span></span>
<span class="line"><span>3. âœ… é—®é¢˜ä¿®å¤</span></span>
<span class="line"><span>4. âœ… é€æ­¥æ”¾é‡</span></span>
<span class="line"><span></span></span>
<span class="line"><span>è´Ÿè´£ï¼šåŸºå»º + ä¸šåŠ¡å›¢é˜Ÿ</span></span>
<span class="line"><span>æ—¶é—´ï¼š2 å‘¨</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_5-2-é™çº§æ–¹æ¡ˆ" tabindex="-1">5.2 é™çº§æ–¹æ¡ˆ <a class="header-anchor" href="#_5-2-é™çº§æ–¹æ¡ˆ" aria-label="Permalink to &quot;5.2 é™çº§æ–¹æ¡ˆ&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é…ç½®å¼€å…³</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CONFIG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  useCommonExperimentsOnly: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸»å¼€å…³</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fallbackToAllExperiments: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // é™çº§å¼€å…³</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Worker å±‚é™çº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generateABTestId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">abData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">isLoggedIn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.useCommonExperimentsOnly) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // é™çº§ï¼šä½¿ç”¨æ‰€æœ‰å®éªŒï¼ˆæ—§é€»è¾‘ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(abData));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isLoggedIn) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> commonExperiments</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> filterCommonExperiments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(abData);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">keys</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(commonExperiments).</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ²¡æœ‰å…¬å…±å®éªŒï¼Œé™çº§</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;No common experiments found, fallback&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONFIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.fallbackToAllExperiments) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(abData));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(commonExperiments));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(abData));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Generate AB test ID failed, fallback&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(abData));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_5-3-ç›‘æ§æŒ‡æ ‡" tabindex="-1">5.3 ç›‘æ§æŒ‡æ ‡ <a class="header-anchor" href="#_5-3-ç›‘æ§æŒ‡æ ‡" aria-label="Permalink to &quot;5.3 ç›‘æ§æŒ‡æ ‡&quot;">â€‹</a></h3><p><strong>æ ¸å¿ƒæŒ‡æ ‡</strong>ï¼š</p><table tabindex="0"><thead><tr><th>æŒ‡æ ‡</th><th>è¯´æ˜</th><th>ç›®æ ‡</th><th>å‘Šè­¦é˜ˆå€¼</th></tr></thead><tbody><tr><td><strong>ç¼“å­˜å‘½ä¸­ç‡ï¼ˆæœªç™»å½•ï¼‰</strong></td><td>æœªç™»å½•ç”¨æˆ·ç¼“å­˜å‘½ä¸­ç‡</td><td>â‰¥ 60%</td><td>&lt; 50%</td></tr><tr><td><strong>ç¼“å­˜å‘½ä¸­ç‡ï¼ˆå·²ç™»å½•ï¼‰</strong></td><td>å·²ç™»å½•ç”¨æˆ·ç¼“å­˜å‘½ä¸­ç‡</td><td>â‰¥ 45%</td><td>&lt; 30%</td></tr><tr><td><strong>ç¼“å­˜å‘½ä¸­ç‡ï¼ˆæ•´ä½“ï¼‰</strong></td><td>æ•´ä½“ç¼“å­˜å‘½ä¸­ç‡</td><td>â‰¥ 55%</td><td>&lt; 45%</td></tr><tr><td><strong>TTFB (P50)</strong></td><td>é¦–å­—èŠ‚æ—¶é—´ä¸­ä½æ•°</td><td>â‰¤ 700 ms</td><td>&gt; 900 ms</td></tr><tr><td><strong>LCP (P50)</strong></td><td>æœ€å¤§å†…å®¹ç»˜åˆ¶ä¸­ä½æ•°</td><td>â‰¤ 1600 ms</td><td>&gt; 2000 ms</td></tr><tr><td><strong>å…¬å…±å®éªŒæ¯”ä¾‹</strong></td><td>æ ‡è®°ä¸º common çš„å®éªŒå æ¯”</td><td>20-30%</td><td>&gt; 50%</td></tr><tr><td><strong>ab-test-id é•¿åº¦</strong></td><td>ab-test-id å­—ç¬¦ä¸²é•¿åº¦</td><td>&lt; 64</td><td>&gt; 128</td></tr></tbody></table><p><strong>ç›‘æ§é¢æ¿</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>AB ç¼“å­˜ä¼˜åŒ–ç›‘æ§</span></span>
<span class="line"><span></span></span>
<span class="line"><span>1. ç¼“å­˜å‘½ä¸­ç‡</span></span>
<span class="line"><span>   â”œâ”€ æœªç™»å½•: 62% (ç›®æ ‡ â‰¥60%) âœ…</span></span>
<span class="line"><span>   â”œâ”€ å·²ç™»å½•: 47% (ç›®æ ‡ â‰¥45%) âœ…</span></span>
<span class="line"><span>   â””â”€ æ•´ä½“: 57% (ç›®æ ‡ â‰¥55%) âœ…</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. æ€§èƒ½æŒ‡æ ‡</span></span>
<span class="line"><span>   â”œâ”€ TTFB P50: 680ms (ç›®æ ‡ â‰¤700ms) âœ…</span></span>
<span class="line"><span>   â”œâ”€ TTFB P95: 1350ms</span></span>
<span class="line"><span>   â”œâ”€ LCP P50: 1580ms (ç›®æ ‡ â‰¤1600ms) âœ…</span></span>
<span class="line"><span>   â””â”€ LCP P95: 2250ms</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3. AB å®éªŒç»Ÿè®¡</span></span>
<span class="line"><span>   â”œâ”€ æ€»å®éªŒæ•°: 12</span></span>
<span class="line"><span>   â”œâ”€ å…¬å…±å®éªŒæ•°: 3 (25%)</span></span>
<span class="line"><span>   â”œâ”€ ç¼“å­˜ç¢ç‰‡åŒ–: 2^3 = 8 ç‰ˆæœ¬</span></span>
<span class="line"><span>   â””â”€ å¦‚æœæ‰€æœ‰å®éªŒ: 2^12 = 4096 ç‰ˆæœ¬</span></span>
<span class="line"><span></span></span>
<span class="line"><span>4. å¼‚å¸¸ç›‘æ§</span></span>
<span class="line"><span>   â”œâ”€ å…¬å…±ç»„ä»¶ä¸ä¸€è‡´: 0 æ¬¡</span></span>
<span class="line"><span>   â”œâ”€ ab-test-id ç”Ÿæˆå¤±è´¥: 0 æ¬¡</span></span>
<span class="line"><span>   â””â”€ Redis è¯»å–å¤±è´¥: 2 æ¬¡ (0.01%)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><hr><h2 id="å…­ã€æ€»ç»“" tabindex="-1">å…­ã€æ€»ç»“ <a class="header-anchor" href="#å…­ã€æ€»ç»“" aria-label="Permalink to &quot;å…­ã€æ€»ç»“&quot;">â€‹</a></h2><h3 id="_6-1-æ ¸å¿ƒä»·å€¼" tabindex="-1">6.1 æ ¸å¿ƒä»·å€¼ <a class="header-anchor" href="#_6-1-æ ¸å¿ƒä»·å€¼" aria-label="Permalink to &quot;6.1 æ ¸å¿ƒä»·å€¼&quot;">â€‹</a></h3><p><strong>é—®é¢˜è§£å†³</strong>ï¼š</p><ol><li><p>âœ… <strong>ç¼“å­˜ç¢ç‰‡åŒ–</strong></p><ul><li>ä» 2^n é™åˆ° 2^m (m &lt;&lt; n)</li><li>ç™»å½•æ€ç¼“å­˜å‘½ä¸­ç‡æå‡ 3-4 å€</li></ul></li><li><p>âœ… <strong>æ€§èƒ½æ”¹å–„</strong></p><ul><li>TTFB é™ä½ 40%+</li><li>LCP é™ä½ 30%+</li><li>å›åˆ°ä¼˜ç§€æ°´å¹³ï¼ˆ&lt; 1.5sï¼‰</li></ul></li><li><p>âœ… <strong>æˆæœ¬èŠ‚çœ</strong></p><ul><li>SSR æ¸²æŸ“æ¬¡æ•°å‡å°‘ 20%</li><li>æœåŠ¡å™¨èµ„æºèŠ‚çœ 30%</li></ul></li><li><p>âœ… <strong>ä½“éªŒæå‡</strong></p><ul><li>é¡µé¢åŠ è½½æ›´å¿«</li><li>å…¬å…±ç»„ä»¶ä¿æŒä¸€è‡´</li></ul></li></ol><h3 id="_6-2-å…³é”®è¦ç‚¹" tabindex="-1">6.2 å…³é”®è¦ç‚¹ <a class="header-anchor" href="#_6-2-å…³é”®è¦ç‚¹" aria-label="Permalink to &quot;6.2 å…³é”®è¦ç‚¹&quot;">â€‹</a></h3><p><strong>æŠ€æœ¯è¦ç‚¹</strong>ï¼š</p><ol><li><p>âœ… <strong>åŒºåˆ†å…¬å…±å®éªŒå’Œç§æœ‰å®éªŒ</strong></p><ul><li>å…¬å…±å®éªŒï¼šSSR æ¸²æŸ“çš„å…±äº«ç»„ä»¶</li><li>ç§æœ‰å®éªŒï¼šé¡µé¢ç‰¹å®šæˆ– CSR ç»„ä»¶</li></ul></li><li><p>âœ… <strong>ç™»å½•æ€å’Œæœªç™»å½•æ€åˆ†åˆ«å¤„ç†</strong></p><ul><li>æœªç™»å½•ï¼šæ‰€æœ‰å®éªŒå‚ä¸ï¼ˆç”¨æˆ·å¯å…±äº«ç¼“å­˜ï¼‰</li><li>å·²ç™»å½•ï¼šä»…å…¬å…±å®éªŒå‚ä¸ï¼ˆå‡å°‘ç¢ç‰‡åŒ–ï¼‰</li></ul></li><li><p>âœ… <strong>å®Œæ•´æ•°æ®å­˜å‚¨</strong></p><ul><li>Redis å­˜å‚¨å®Œæ•´ AB æ•°æ®</li><li>CSR å¯è·å–æ‰€æœ‰å®éªŒä¿¡æ¯</li><li>åŸ‹ç‚¹å’Œæ¥å£æ­£å¸¸å·¥ä½œ</li></ul></li><li><p>âœ… <strong>ç”¨æˆ·éš”ç¦»</strong></p><ul><li>Redis Key åŒ…å« userId</li><li>é¿å…ä¸åŒç”¨æˆ·æ•°æ®å†²çª</li></ul></li></ol><h3 id="_6-3-æœ€ä½³å®è·µå»ºè®®" tabindex="-1">6.3 æœ€ä½³å®è·µå»ºè®® <a class="header-anchor" href="#_6-3-æœ€ä½³å®è·µå»ºè®®" aria-label="Permalink to &quot;6.3 æœ€ä½³å®è·µå»ºè®®&quot;">â€‹</a></h3><p><strong>å®éªŒè®¾è®¡</strong>ï¼š</p><ol><li><p>â­ <strong>æ§åˆ¶å…¬å…±å®éªŒæ•°é‡</strong></p><ul><li>å»ºè®®ï¼šâ‰¤ 3 ä¸ªåŒæ—¶è¿›è¡Œ</li><li>é¿å…è¿‡åº¦ç¢ç‰‡åŒ–</li></ul></li><li><p>â­ <strong>ä¼˜å…ˆä½¿ç”¨ç§æœ‰å®éªŒ</strong></p><ul><li>é¡µé¢ç‰¹å®šåŠŸèƒ½ç”¨ç§æœ‰å®éªŒ</li><li>ä¸å½±å“ç¼“å­˜</li></ul></li><li><p>â­ <strong>å®éªŒç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></p><ul><li>åŠæ—¶ä¸‹çº¿å®Œæˆçš„å®éªŒ</li><li>é¿å…é•¿æœŸå ç”¨</li></ul></li></ol><p><strong>ç›‘æ§å’Œè¿ç»´</strong>ï¼š</p><ol><li>âœ… å®æ—¶ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡</li><li>âœ… å®šæœŸå®¡æŸ¥å…¬å…±å®éªŒåˆ—è¡¨</li><li>âœ… è¯„ä¼°å®éªŒå¯¹ç¼“å­˜çš„å½±å“</li></ol><hr><p><strong>æ–‡æ¡£ç»´æŠ¤</strong>ï¼šå‰ç«¯åŸºå»ºå›¢é˜Ÿ<br><strong>RFC ä½œè€…</strong>ï¼šå‰ç«¯æ¶æ„ç»„<br><strong>æ•°æ®æ”¯æŒ</strong>ï¼š@å†·æœˆ<br><strong>æ•´ç†æ—¥æœŸ</strong>ï¼š2025-01-25<br><strong>æ–‡æ¡£ç‰ˆæœ¬</strong>ï¼šv1.0</p>`,170)]))}const S=a(C,[["render",A]]);export{f as __pageData,S as default};
