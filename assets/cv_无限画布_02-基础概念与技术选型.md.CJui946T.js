import{_ as a,c as n,o as i,a7 as p}from"./chunks/framework.BQb8NfN9.js";const o=JSON.parse('{"title":"第2章：基础概念与技术选型","description":"","frontmatter":{},"headers":[],"relativePath":"cv/无限画布/02-基础概念与技术选型.md","filePath":"cv/无限画布/02-基础概念与技术选型.md","lastUpdated":1769693499000}'),l={name:"cv/无限画布/02-基础概念与技术选型.md"};function e(t,s,r,h,k,d){return i(),n("div",null,s[0]||(s[0]=[p(`<h1 id="第2章-基础概念与技术选型" tabindex="-1">第2章：基础概念与技术选型 <a class="header-anchor" href="#第2章-基础概念与技术选型" aria-label="Permalink to &quot;第2章：基础概念与技术选型&quot;">​</a></h1><hr><h2 id="_2-1-什么是无限画布" tabindex="-1">2.1 什么是无限画布 <a class="header-anchor" href="#_2-1-什么是无限画布" aria-label="Permalink to &quot;2.1 什么是无限画布&quot;">​</a></h2><p>无限画布（Infinite Canvas）是一种可以无限延伸、自由缩放的 2D 图形编辑界面。</p><p><strong>核心特征</strong>：</p><ul><li>画布范围理论上无限大</li><li>用户通过「视口」查看画布的一部分</li><li>支持平滑缩放（0.02x ~ 10x）</li><li>支持自由平移</li></ul><p><strong>典型产品</strong>：Figma、Miro、Canva、稿定设计</p><hr><h2 id="_2-2-传统-dom-渲染的瓶颈" tabindex="-1">2.2 传统 DOM 渲染的瓶颈 <a class="header-anchor" href="#_2-2-传统-dom-渲染的瓶颈" aria-label="Permalink to &quot;2.2 传统 DOM 渲染的瓶颈&quot;">​</a></h2><p>假设用户在画布上放置 1000 个元素：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>传统 DOM 方案：</span></span>
<span class="line"><span>1. 创建 1000 个 DOM 节点</span></span>
<span class="line"><span>2. 每次缩放，1000 个节点都要重新计算样式</span></span>
<span class="line"><span>3. 每次平移，1000 个节点都要重绘</span></span>
<span class="line"><span>4. 浏览器的渲染管线被严重阻塞</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>性能数据对比</strong>：</p><table tabindex="0"><thead><tr><th>元素数量</th><th>DOM 渲染 FPS</th><th>WebGL 渲染 FPS</th></tr></thead><tbody><tr><td>100</td><td>60</td><td>60</td></tr><tr><td>500</td><td>45</td><td>60</td></tr><tr><td>1000</td><td>20</td><td>60</td></tr><tr><td>5000</td><td>5</td><td>58</td></tr><tr><td>10000</td><td>卡死</td><td>55</td></tr></tbody></table><p>DOM 的本质问题：<strong>每个元素都是独立的渲染单元，无法批量处理</strong>。</p><hr><h2 id="_2-3-为什么选择-webgl" tabindex="-1">2.3 为什么选择 WebGL <a class="header-anchor" href="#_2-3-为什么选择-webgl" aria-label="Permalink to &quot;2.3 为什么选择 WebGL&quot;">​</a></h2><p>WebGL 是浏览器中直接操作 GPU 的接口。</p><p><strong>核心优势</strong>：</p><ol><li><strong>批量渲染</strong>：成百上千个元素可以在一次 GPU 调用中完成</li><li><strong>硬件加速</strong>：矩阵变换由 GPU 并行计算，而非 CPU 串行</li><li><strong>内存效率</strong>：纹理可在 GPU 显存中复用</li></ol><p><strong>一句话总结</strong>：DOM 是「逐个处理」，WebGL 是「批量处理」。</p><hr><h2 id="_2-4-渲染引擎选型-piso-pixijs-定制版" tabindex="-1">2.4 渲染引擎选型：Piso（PixiJS 定制版） <a class="header-anchor" href="#_2-4-渲染引擎选型-piso-pixijs-定制版" aria-label="Permalink to &quot;2.4 渲染引擎选型：Piso（PixiJS 定制版）&quot;">​</a></h2><p>项目基于 <strong>Piso</strong> —— 一个基于 PixiJS 深度定制的 2D WebGL 渲染引擎。</p><h3 id="为什么不直接用-pixijs" tabindex="-1">为什么不直接用 PixiJS？ <a class="header-anchor" href="#为什么不直接用-pixijs" aria-label="Permalink to &quot;为什么不直接用 PixiJS？&quot;">​</a></h3><p>PixiJS 是游戏引擎，而设计编辑器有特殊需求：</p><table tabindex="0"><thead><tr><th>需求</th><th>PixiJS</th><th>Piso</th></tr></thead><tbody><tr><td>高精度矢量</td><td>❌</td><td>✅ SkiaCanvas 支持</td></tr><tr><td>文字排版</td><td>基础</td><td>专业级 TypeTool</td></tr><tr><td>Mipmap 控制</td><td>自动</td><td>可动态切换</td></tr><tr><td>多渲染器</td><td>单一</td><td>Canvas/WebGL/Skia</td></tr></tbody></table><h3 id="piso-模块结构" tabindex="-1">Piso 模块结构 <a class="header-anchor" href="#piso-模块结构" aria-label="Permalink to &quot;Piso 模块结构&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@piso/core          ← 核心：Texture, Matrix, Point, Rectangle</span></span>
<span class="line"><span>@piso/display       ← 显示：Container, DisplayObject</span></span>
<span class="line"><span>@piso/graphics      ← 图形：Graphics（矢量绘制）</span></span>
<span class="line"><span>@piso/sprite        ← 精灵：Sprite（位图渲染）</span></span>
<span class="line"><span>@piso/app           ← 应用：Application, Ticker</span></span>
<span class="line"><span>@piso/math          ← 数学：Matrix, Polygon, 几何计算</span></span>
<span class="line"><span>@piso/sk-renderer   ← Skia 渲染器（高精度）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr><h2 id="_2-5-核心架构-三层结构" tabindex="-1">2.5 核心架构：三层结构 <a class="header-anchor" href="#_2-5-核心架构-三层结构" aria-label="Permalink to &quot;2.5 核心架构：三层结构&quot;">​</a></h2><p>无限画布渲染引擎采用三层架构：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────┐</span></span>
<span class="line"><span>│  Surface（画布表面）                          │</span></span>
<span class="line"><span>│  ─────────────────────────────────────────  │</span></span>
<span class="line"><span>│  职责：统筹全局，协调各组件                    │</span></span>
<span class="line"><span>└─────────────────────────────────────────────┘</span></span>
<span class="line"><span>          │</span></span>
<span class="line"><span>          ├─────────────┬─────────────┬─────────────┐</span></span>
<span class="line"><span>          ↓             ↓             ↓             ↓</span></span>
<span class="line"><span>    ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐</span></span>
<span class="line"><span>    │ Viewport │  │ VmEngine │  │ Processor│  │ Plugin   │</span></span>
<span class="line"><span>    │  视口    │  │ 视图引擎  │  │  处理器  │  │  插件    │</span></span>
<span class="line"><span>    └──────────┘  └──────────┘  └──────────┘  └──────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="各层职责" tabindex="-1">各层职责 <a class="header-anchor" href="#各层职责" aria-label="Permalink to &quot;各层职责&quot;">​</a></h3><p><strong>Surface</strong>：</p><ul><li>管理渲染循环（Ticker，16ms/帧）</li><li>创建和销毁各子系统</li><li>提供对外 API</li></ul><p><strong>Viewport</strong>：</p><ul><li>管理相机位置（position）和缩放（zoom）</li><li>坐标转换（屏幕坐标 ⇄ 世界坐标）</li><li>视口边界限制</li></ul><p><strong>VmEngine</strong>：</p><ul><li>数据模型 → 渲染对象映射</li><li>对象池管理</li><li>增量更新</li></ul><p><strong>Processor</strong>：</p><ul><li>处理 Action（add/remove/update/move）</li><li>驱动 VmEngine 更新</li></ul><p><strong>Plugin</strong>：</p><ul><li>扩展能力（参考线、标尺、轮廓等）</li></ul><hr><h2 id="_2-6-数据流-从数据到像素" tabindex="-1">2.6 数据流：从数据到像素 <a class="header-anchor" href="#_2-6-数据流-从数据到像素" aria-label="Permalink to &quot;2.6 数据流：从数据到像素&quot;">​</a></h2><p>用户操作如何最终显示在屏幕上？</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. 用户拖动元素</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>2. 编辑器框架更新数据模型（Model）</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>3. 生成 Action：{ type: &#39;update_elements&#39;, ... }</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>4. Surface.commit(action)</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>5. Processor 处理 Action</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>6. VmEngine 更新对应的 Vm</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>7. Vm.setState() 触发 render()</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>8. 下一帧 Ticker 执行，GPU 绘制</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>9. 像素显示在屏幕上</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>关键点</strong>：数据变更 → Action → Vm 更新 → 渲染。这是「响应式」设计。</p><hr><h2 id="_2-7-核心类关系图" tabindex="-1">2.7 核心类关系图 <a class="header-anchor" href="#_2-7-核心类关系图" aria-label="Permalink to &quot;2.7 核心类关系图&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>                     Surface</span></span>
<span class="line"><span>                        │</span></span>
<span class="line"><span>        ┌───────────────┼───────────────┐</span></span>
<span class="line"><span>        │               │               │</span></span>
<span class="line"><span>    Viewport        VmEngine       EventBoundary</span></span>
<span class="line"><span>        │               │               │</span></span>
<span class="line"><span>        │          ┌────┴────┐          │</span></span>
<span class="line"><span>        │          │         │          │</span></span>
<span class="line"><span>        ↓        PageVm    ElementVm    │</span></span>
<span class="line"><span>    Position       │         │          │</span></span>
<span class="line"><span>    Zoom           └────┬────┘          │</span></span>
<span class="line"><span>                        │               │</span></span>
<span class="line"><span>                        ↓               │</span></span>
<span class="line"><span>                   PixiJS Stage ←───────┘</span></span>
<span class="line"><span>                        │</span></span>
<span class="line"><span>                        ↓</span></span>
<span class="line"><span>                   WebGL Context</span></span>
<span class="line"><span>                        │</span></span>
<span class="line"><span>                        ↓</span></span>
<span class="line"><span>                      GPU</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><hr><h2 id="_2-8-关键代码入口" tabindex="-1">2.8 关键代码入口 <a class="header-anchor" href="#_2-8-关键代码入口" aria-label="Permalink to &quot;2.8 关键代码入口&quot;">​</a></h2><h3 id="surface-初始化" tabindex="-1">Surface 初始化 <a class="header-anchor" href="#surface-初始化" aria-label="Permalink to &quot;Surface 初始化&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// infinite-renderer/src/surfaces/surface.ts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(options: Partial</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ISurfaceOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. 创建视口</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._viewport </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Viewport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._viewport.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">initialize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PageVm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), renderOptions);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. 创建上下文</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pixelRatio: window.devicePixelRatio,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. 创建视图引擎</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vmEngine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VmEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        context: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.context,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4. 创建事件边界（碰撞检测）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.eventBoundary </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EventBoundary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        viewport: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.viewport,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 5. 创建插件系统</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._plugin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PluginSystem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        viewport: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.viewport,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vmEngine: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vmEngine,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        context: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.context,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        eventBoundary: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.eventBoundary,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 6. 启动渲染循环</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._context.ticker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.viewport.app.ticker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UPDATE_PRIORITY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="提交变更" tabindex="-1">提交变更 <a class="header-anchor" href="#提交变更" aria-label="Permalink to &quot;提交变更&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 处理数据变更</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">commit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(action: Action): </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.processor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(action);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 处理 Action</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">emit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;action&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, action);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 触发事件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="碰撞检测" tabindex="-1">碰撞检测 <a class="header-anchor" href="#碰撞检测" aria-label="Permalink to &quot;碰撞检测&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 判断点击命中哪个元素</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hitTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(point: IPointData): BaseElementModel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> target</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.eventBoundary.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hitTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(point);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> target </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> target.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h2 id="_2-9-与传统编辑器的本质区别" tabindex="-1">2.9 与传统编辑器的本质区别 <a class="header-anchor" href="#_2-9-与传统编辑器的本质区别" aria-label="Permalink to &quot;2.9 与传统编辑器的本质区别&quot;">​</a></h2><table tabindex="0"><thead><tr><th>维度</th><th>传统 DOM 编辑器</th><th>无限画布编辑器</th></tr></thead><tbody><tr><td><strong>渲染方式</strong></td><td>浏览器渲染管线</td><td>WebGL 直接绘制</td></tr><tr><td><strong>坐标系统</strong></td><td>CSS 像素</td><td>自定义世界坐标</td></tr><tr><td><strong>缩放实现</strong></td><td>transform: scale()</td><td>矩阵变换</td></tr><tr><td><strong>事件处理</strong></td><td>DOM 事件冒泡</td><td>自定义碰撞检测</td></tr><tr><td><strong>性能瓶颈</strong></td><td>DOM 节点数量</td><td>GPU 填充率</td></tr><tr><td><strong>内存模型</strong></td><td>DOM Tree</td><td>对象池 + 纹理缓存</td></tr></tbody></table><p><strong>本质区别</strong>：无限画布接管了浏览器的渲染职责，自己实现了一套「迷你浏览器」。</p><hr><h2 id="_2-10-本章小结" tabindex="-1">2.10 本章小结 <a class="header-anchor" href="#_2-10-本章小结" aria-label="Permalink to &quot;2.10 本章小结&quot;">​</a></h2><ol><li><strong>无限画布</strong>：可无限延伸、自由缩放的 2D 编辑界面</li><li><strong>DOM 瓶颈</strong>：节点数量增加时性能急剧下降</li><li><strong>WebGL 优势</strong>：批量渲染、GPU 加速</li><li><strong>Piso</strong>：基于 PixiJS 的定制渲染引擎</li><li><strong>三层架构</strong>：Surface → Viewport/VmEngine/Processor/Plugin</li><li><strong>数据流</strong>：Model → Action → Vm → Render → GPU</li></ol><hr><blockquote><p><strong>下一章</strong>：<a href="./03-坐标系统与矩阵变换">第3章：坐标系统与矩阵变换</a> —— 理解无限画布的数学基础</p></blockquote>`,68)]))}const b=a(l,[["render",e]]);export{o as __pageData,b as default};
