import{_ as h,C as o,c,o as e,a8 as t,b as r,j as a,w as n,a as i,G as p,a9 as d}from"./chunks/framework.B1-gFi6y.js";const y=JSON.parse('{"title":"Next.js 项目打包部署流程详解","description":"","frontmatter":{},"headers":[],"relativePath":"Next/deploy.md","filePath":"Next/deploy.md","lastUpdated":1766932869000}'),E={name:"Next/deploy.md"};function k(u,s,b,g,m,A){const l=o("Mermaid");return e(),c("div",null,[s[3]||(s[3]=t(`<h1 id="next-js-项目打包部署流程详解" tabindex="-1">Next.js 项目打包部署流程详解 <a class="header-anchor" href="#next-js-项目打包部署流程详解" aria-label="Permalink to &quot;Next.js 项目打包部署流程详解&quot;">​</a></h1><h2 id="📋-目录" tabindex="-1">📋 目录 <a class="header-anchor" href="#📋-目录" aria-label="Permalink to &quot;📋 目录&quot;">​</a></h2><ol><li><a href="#1-打包流程详解">打包流程详解</a></li><li><a href="#2-部署上线流程">部署上线流程</a></li><li><a href="#3-整体流程图">整体流程图</a></li><li><a href="#4-与传统-csr-项目的区别">与传统 CSR 项目的区别</a></li></ol><hr><h2 id="_1-打包流程详解" tabindex="-1">1. 打包流程详解 <a class="header-anchor" href="#_1-打包流程详解" aria-label="Permalink to &quot;1. 打包流程详解&quot;">​</a></h2><h3 id="_1-1-触发构建" tabindex="-1">1.1 触发构建 <a class="header-anchor" href="#_1-1-触发构建" aria-label="Permalink to &quot;1.1 触发构建&quot;">​</a></h3><p>构建通过 <strong>Jenkins CI/CD</strong> 触发，当代码推送到 GitLab 仓库时自动触发构建流程。</p><h3 id="_1-2-docker-多阶段构建" tabindex="-1">1.2 Docker 多阶段构建 <a class="header-anchor" href="#_1-2-docker-多阶段构建" aria-label="Permalink to &quot;1.2 Docker 多阶段构建&quot;">​</a></h3><p>项目使用 <strong>Docker 多阶段构建</strong>，分为三个阶段：</p><h4 id="阶段-1-依赖安装-deps" tabindex="-1">阶段 1：依赖安装（deps） <a class="header-anchor" href="#阶段-1-依赖安装-deps" aria-label="Permalink to &quot;阶段 1：依赖安装（deps）&quot;">​</a></h4><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> registry.cn-hangzhou.aliyuncs.com/gaodingx/docker-base-images:node-20-onbuild-ubuntu </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deps</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>执行步骤</strong>：</p><ol><li>复制 <code>package.json</code>、<code>package-lock.json</code>、<code>patches</code> 等依赖相关文件</li><li>安装 xprofiler（性能监控工具）</li><li>执行 <code>npm install</code> 安装所有依赖（包括 devDependencies）</li><li>删除 <code>.npmrc</code> 文件（安全考虑）</li></ol><p><strong>目的</strong>：利用 Docker 缓存机制，只有依赖文件变化时才重新安装依赖，提升构建速度。</p><h4 id="阶段-2-代码构建-builder" tabindex="-1">阶段 2：代码构建（builder） <a class="header-anchor" href="#阶段-2-代码构建-builder" aria-label="Permalink to &quot;阶段 2：代码构建（builder）&quot;">​</a></h4><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> registry.cn-hangzhou.aliyuncs.com/gaodingx/docker-base-images:node-20-onbuild-ubuntu </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>执行步骤</strong>：</p><ol><li><p><strong>复制代码和依赖</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . .</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=deps /app/node_modules ./node_modules</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>设置环境变量</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;NEXT_PUBLIC_DEPLOY_ENV=$DEPLOY_ENV&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &gt;&gt; .env</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;NEXT_PUBLIC_VERSION=$(date &#39;+%Y-%m-%d-%H&#39;)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &gt;&gt; .env</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>DEPLOY_ENV</code>：部署环境（dev/fat/stage/prod）</li><li><code>VERSION</code>：构建版本号（用于 CDN 缓存控制）</li></ul></li><li><p><strong>执行 Next.js 构建</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm run build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>Next.js 构建过程</strong>：</p><ul><li><p><strong>编译阶段</strong>：</p><ul><li>编译 TypeScript/JavaScript 代码</li><li>处理 Less/CSS 样式文件</li><li>代码分割和优化</li><li>生成服务端和客户端 bundle</li></ul></li><li><p><strong>输出产物</strong>（在 <code>build/</code> 目录）：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>build/</span></span>
<span class="line"><span>├── server/              # 服务端代码</span></span>
<span class="line"><span>│   ├── chunks/          # 服务端代码块</span></span>
<span class="line"><span>│   ├── pages/           # 页面服务端代码</span></span>
<span class="line"><span>│   └── app.js           # Next.js 服务端入口</span></span>
<span class="line"><span>├── static/              # 静态资源</span></span>
<span class="line"><span>│   ├── chunks/          # 客户端代码块</span></span>
<span class="line"><span>│   ├── css/             # CSS 文件</span></span>
<span class="line"><span>│   └── media/           # 图片等媒体文件</span></span>
<span class="line"><span>├── prerender-manifest.json  # 预渲染清单</span></span>
<span class="line"><span>├── routes-manifest.json     # 路由清单</span></span>
<span class="line"><span>└── build-manifest.json      # 构建清单</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ul></li><li><p><strong>上传静态资源到 CDN</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm run env ... &amp;&amp; npm run cdn</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>CDN 上传流程</strong>（<code>cdn.js</code>）：</p><ul><li>上传 <code>build/static/</code> → <code>_next/static/</code></li><li>上传 <code>public/</code> → <code>_next/public/\${DEPLOY_ENV}/</code></li><li>使用 OSS SDK 上传到阿里云 OSS</li><li>CDN 地址：<code>https://cdn.huaban.com</code></li></ul></li></ol><h4 id="阶段-3-生产镜像-production" tabindex="-1">阶段 3：生产镜像（production） <a class="header-anchor" href="#阶段-3-生产镜像-production" aria-label="Permalink to &quot;阶段 3：生产镜像（production）&quot;">​</a></h4><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> registry.cn-hangzhou.aliyuncs.com/gaodingx/docker-base-images:node-20-onbuild-ubuntu</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>执行步骤</strong>：</p><ol><li><p><strong>复制构建产物</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/build ./build</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/public ./public</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/server.js ./server.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/server ./server</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /app/node_modules ./node_modules</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>设置生产环境变量</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NODE_ENV production</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NODE_OPTIONS --max-old-space-size=2048</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>暴露端口</strong></p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PORT 3000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><h3 id="_1-3-构建产物说明" tabindex="-1">1.3 构建产物说明 <a class="header-anchor" href="#_1-3-构建产物说明" aria-label="Permalink to &quot;1.3 构建产物说明&quot;">​</a></h3><h4 id="next-js-构建产物" tabindex="-1">Next.js 构建产物 <a class="header-anchor" href="#next-js-构建产物" aria-label="Permalink to &quot;Next.js 构建产物&quot;">​</a></h4><ol><li><p><strong>服务端代码</strong>（<code>build/server/</code>）</p><ul><li>用于服务端渲染（SSR）</li><li>包含页面组件、API 路由的服务端代码</li><li>运行在 Node.js 环境中</li></ul></li><li><p><strong>客户端代码</strong>（<code>build/static/</code>）</p><ul><li>浏览器端运行的 JavaScript 和 CSS</li><li>已上传到 CDN，通过 CDN 加速访问</li><li>支持代码分割和懒加载</li></ul></li><li><p><strong>静态文件</strong>（<code>public/</code>）</p><ul><li>图标、字体、配置文件等</li><li>已上传到 CDN：<code>_next/public/\${DEPLOY_ENV}/</code></li></ul></li></ol><h4 id="与传统项目的区别" tabindex="-1">与传统项目的区别 <a class="header-anchor" href="#与传统项目的区别" aria-label="Permalink to &quot;与传统项目的区别&quot;">​</a></h4><ul><li><strong>传统 CSR</strong>：只有客户端 bundle，所有代码都在浏览器执行</li><li><strong>Next.js</strong>：同时包含服务端和客户端代码，支持 SSR/SSG</li></ul><hr><h2 id="_2-部署上线流程" tabindex="-1">2. 部署上线流程 <a class="header-anchor" href="#_2-部署上线流程" aria-label="Permalink to &quot;2. 部署上线流程&quot;">​</a></h2><h3 id="_2-1-jenkins-构建阶段" tabindex="-1">2.1 Jenkins 构建阶段 <a class="header-anchor" href="#_2-1-jenkins-构建阶段" aria-label="Permalink to &quot;2.1 Jenkins 构建阶段&quot;">​</a></h3><div class="language-groovy vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stage(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Build&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sh </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        dind-container-build \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            -a &quot;OSS_ACCESS_KEY=\${OSS_ACCESS_KEY}&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            -a &quot;DEPLOY_ENV=\${DEPLOY_ENV}&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            -a &quot;GIT_BRANCH=\${GIT_BRANCH}&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            -i &quot;\${GIT_COMMIT}&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>执行内容</strong>：</p><ol><li>使用 <code>dind-container-build</code> 命令构建 Docker 镜像</li><li>传入环境变量（OSS 凭证、部署环境等）</li><li>使用 Git Commit SHA 作为镜像标签</li><li>推送到容器镜像仓库</li></ol><h3 id="_2-2-jenkins-部署阶段" tabindex="-1">2.2 Jenkins 部署阶段 <a class="header-anchor" href="#_2-2-jenkins-部署阶段" aria-label="Permalink to &quot;2.2 Jenkins 部署阶段&quot;">​</a></h3><div class="language-groovy vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stage(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Deploy&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    when(whenHelper</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">checkRuntimeEnvNameIn([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;dev&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fat&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;stage&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;prod&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            dind-helm-upgrade-v3 \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                -i &quot;\${GIT_COMMIT}&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                -a &quot;\${HELM_APP_NAME_APP}&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                -r &quot;\${HELM_RELEASE_NAME_APP}&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                -c &quot;\${HELM_CHART_NAME}&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                --kubectx &quot;\${K8S_CONTEXT}&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                --kubens &quot;\${K8S_NAMESPACE}&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>执行内容</strong>：</p><ol><li>使用 Helm 部署到 Kubernetes 集群</li><li>根据环境（dev/fat/stage/prod）选择不同的 K8s 上下文</li><li>执行滚动更新，零停机部署</li></ol><h3 id="_2-3-kubernetes-部署" tabindex="-1">2.3 Kubernetes 部署 <a class="header-anchor" href="#_2-3-kubernetes-部署" aria-label="Permalink to &quot;2.3 Kubernetes 部署&quot;">​</a></h3><p><strong>部署配置</strong>（通过 Helm Chart）：</p><ul><li><strong>副本数</strong>：根据环境配置（生产环境通常 2+ 个 Pod）</li><li><strong>资源限制</strong>：CPU、内存限制</li><li><strong>健康检查</strong>：Liveness 和 Readiness 探针</li><li><strong>服务发现</strong>：通过 Service 暴露服务</li></ul><p><strong>启动流程</strong>：</p><ol><li>容器启动时执行 <code>service-entrypoint</code></li><li><code>service-entrypoint</code> 调用 <code>launch.js</code></li><li><code>launch.js</code> 复制环境变量文件并启动 <code>server.js</code></li><li><code>server.js</code> 启动 Koa 服务器，监听 3000 端口</li></ol><h3 id="_2-4-服务运行" tabindex="-1">2.4 服务运行 <a class="header-anchor" href="#_2-4-服务运行" aria-label="Permalink to &quot;2.4 服务运行&quot;">​</a></h3><p><strong>Next.js 服务端架构</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// server.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> next</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;next&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ dev: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> handle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRequestHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">prepare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> serve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Koa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 添加中间件：认证、缓存、日志等</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serve.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authTokenMiddleware);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serve.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pageCacheMiddleware);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serve.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>请求处理流程</strong>：</p><ol><li>请求到达 Koa 服务器</li><li>经过中间件处理（认证、缓存等）</li><li>转发给 Next.js 处理</li><li>Next.js 根据路由决定： <ul><li><strong>SSR 页面</strong>：服务端渲染 HTML</li><li><strong>静态页面</strong>：返回预生成的 HTML</li><li><strong>API 路由</strong>：执行服务端逻辑</li><li><strong>静态资源</strong>：返回文件或重定向到 CDN</li></ul></li></ol><hr><h2 id="_3-整体流程图" tabindex="-1">3. 整体流程图 <a class="header-anchor" href="#_3-整体流程图" aria-label="Permalink to &quot;3. 整体流程图&quot;">​</a></h2>`,49)),(e(),r(d,null,{default:n(()=>[p(l,{id:"mermaid-463",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5B%E5%BC%80%E5%8F%91%E8%80%85%E6%8E%A8%E9%80%81%E4%BB%A3%E7%A0%81%E5%88%B0%20GitLab%5D%20--%3E%20B%5BJenkins%20%E8%A7%A6%E5%8F%91%E6%9E%84%E5%BB%BA%5D%0A%20%20%20%20B%20--%3E%20C%5BDocker%20%E6%9E%84%E5%BB%BA%E5%BC%80%E5%A7%8B%5D%0A%20%20%20%20%0A%20%20%20%20C%20--%3E%20D%5B%E9%98%B6%E6%AE%B51%3A%20%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%5D%0A%20%20%20%20D%20--%3E%20E%5B%E9%98%B6%E6%AE%B52%3A%20%E6%9E%84%E5%BB%BA%E4%BB%A3%E7%A0%81%5D%0A%20%20%20%20%0A%20%20%20%20E%20--%3E%20F%5B%E6%89%A7%E8%A1%8C%20npm%20run%20build%5D%0A%20%20%20%20F%20--%3E%20G%5BNext.js%20%E7%BC%96%E8%AF%91%5D%0A%20%20%20%20G%20--%3E%20H%5B%E7%94%9F%E6%88%90%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81%5D%0A%20%20%20%20%0A%20%20%20%20H%20--%3E%20I%5B%E6%89%A7%E8%A1%8C%20npm%20run%20cdn%5D%0A%20%20%20%20I%20--%3E%20J%5B%E4%B8%8A%E4%BC%A0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%88%B0%20OSS%20CDN%5D%0A%20%20%20%20J%20--%3E%20K%5Bbuild%2Fstatic%20%E2%86%92%20_next%2Fstatic%2F%5D%0A%20%20%20%20J%20--%3E%20L%5Bpublic%20%E2%86%92%20_next%2Fpublic%2FENV%2F%5D%0A%20%20%20%20%0A%20%20%20%20K%20--%3E%20M%5B%E6%9E%84%E5%BB%BA%20Docker%20%E9%95%9C%E5%83%8F%5D%0A%20%20%20%20L%20--%3E%20M%0A%20%20%20%20M%20--%3E%20N%5B%E6%8E%A8%E9%80%81%E5%88%B0%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%5D%0A%20%20%20%20%0A%20%20%20%20N%20--%3E%20O%5BJenkins%20%E9%83%A8%E7%BD%B2%E9%98%B6%E6%AE%B5%5D%0A%20%20%20%20O%20--%3E%20P%5B%E4%BD%BF%E7%94%A8%20Helm%20%E9%83%A8%E7%BD%B2%E5%88%B0%20K8s%5D%0A%20%20%20%20P%20--%3E%20Q%5B%E5%88%9B%E5%BB%BA%2F%E6%9B%B4%E6%96%B0%20Deployment%5D%0A%20%20%20%20Q%20--%3E%20R%5BPod%20%E5%90%AF%E5%8A%A8%5D%0A%20%20%20%20%0A%20%20%20%20R%20--%3E%20S%5B%E6%89%A7%E8%A1%8C%20service-entrypoint%5D%0A%20%20%20%20S%20--%3E%20T%5B%E5%90%AF%E5%8A%A8%20server.js%5D%0A%20%20%20%20T%20--%3E%20U%5BKoa%20%2B%20Next.js%20%E6%9C%8D%E5%8A%A1%E8%BF%90%E8%A1%8C%5D%0A%20%20%20%20%0A%20%20%20%20U%20--%3E%20V%5B%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%5D%0A%20%20%20%20V%20--%3E%20W%7B%E8%AF%B7%E6%B1%82%E7%B1%BB%E5%9E%8B%7D%0A%20%20%20%20W%20--%3E%7CSSR%20%E9%A1%B5%E9%9D%A2%7C%20X%5B%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%20HTML%5D%0A%20%20%20%20W%20--%3E%7C%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2%7C%20Y%5B%E8%BF%94%E5%9B%9E%E9%A2%84%E7%94%9F%E6%88%90%20HTML%5D%0A%20%20%20%20W%20--%3E%7CAPI%20%E8%B7%AF%E7%94%B1%7C%20Z%5B%E6%89%A7%E8%A1%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%80%BB%E8%BE%91%5D%0A%20%20%20%20W%20--%3E%7C%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%7C%20AA%5B%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0%20CDN%5D%0A%20%20%20%20%0A%20%20%20%20style%20A%20fill%3A%23e1f5ff%0A%20%20%20%20style%20U%20fill%3A%23c8e6c9%0A%20%20%20%20style%20J%20fill%3A%23fff9c4%0A%20%20%20%20style%20P%20fill%3A%23f3e5f5%0A"})]),fallback:n(()=>s[0]||(s[0]=[i(" Loading... ")])),_:1})),s[4]||(s[4]=t('<h3 id="_3-1-关键时间点" tabindex="-1">3.1 关键时间点 <a class="header-anchor" href="#_3-1-关键时间点" aria-label="Permalink to &quot;3.1 关键时间点&quot;">​</a></h3><table tabindex="0"><thead><tr><th>阶段</th><th>操作</th><th>输出</th></tr></thead><tbody><tr><td><strong>构建时</strong></td><td><code>npm run build</code></td><td>生成 <code>build/</code> 目录</td></tr><tr><td><strong>构建时</strong></td><td><code>npm run cdn</code></td><td>上传到 CDN</td></tr><tr><td><strong>运行时</strong></td><td><code>node server.js</code></td><td>启动服务端</td></tr><tr><td><strong>运行时</strong></td><td>用户请求</td><td>SSR/SSG/API 响应</td></tr></tbody></table><hr><h2 id="_4-与传统-csr-项目的区别" tabindex="-1">4. 与传统 CSR 项目的区别 <a class="header-anchor" href="#_4-与传统-csr-项目的区别" aria-label="Permalink to &quot;4. 与传统 CSR 项目的区别&quot;">​</a></h2><h3 id="_4-1-构建产物对比" tabindex="-1">4.1 构建产物对比 <a class="header-anchor" href="#_4-1-构建产物对比" aria-label="Permalink to &quot;4.1 构建产物对比&quot;">​</a></h3><table tabindex="0"><thead><tr><th>特性</th><th>传统 CSR 项目</th><th>Next.js 项目</th></tr></thead><tbody><tr><td><strong>构建产物</strong></td><td>只有客户端 bundle</td><td>服务端 + 客户端代码</td></tr><tr><td><strong>HTML 生成</strong></td><td>静态 HTML 模板</td><td>服务端动态生成或预生成</td></tr><tr><td><strong>代码分割</strong></td><td>手动配置</td><td>自动按页面分割</td></tr><tr><td><strong>静态资源</strong></td><td>打包在 bundle 中</td><td>可上传到 CDN</td></tr></tbody></table><h3 id="_4-2-部署方式对比" tabindex="-1">4.2 部署方式对比 <a class="header-anchor" href="#_4-2-部署方式对比" aria-label="Permalink to &quot;4.2 部署方式对比&quot;">​</a></h3><h4 id="传统-csr-项目" tabindex="-1">传统 CSR 项目 <a class="header-anchor" href="#传统-csr-项目" aria-label="Permalink to &quot;传统 CSR 项目&quot;">​</a></h4>',8)),(e(),r(d,null,{default:n(()=>[p(l,{id:"mermaid-602",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5B%E6%9E%84%E5%BB%BA%5D%20--%3E%20B%5B%E7%94%9F%E6%88%90%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%5D%0A%20%20%20%20B%20--%3E%20C%5B%E4%B8%8A%E4%BC%A0%E5%88%B0%20Nginx%2FCDN%5D%0A%20%20%20%20C%20--%3E%20D%5B%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%5D%0A%20%20%20%20D%20--%3E%20E%5BNginx%20%E8%BF%94%E5%9B%9E%20HTML%5D%0A%20%20%20%20E%20--%3E%20F%5B%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8A%A0%E8%BD%BD%20JS%5D%0A%20%20%20%20F%20--%3E%20G%5B%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93%5D%0A"})]),fallback:n(()=>s[1]||(s[1]=[i(" Loading... ")])),_:1})),s[5]||(s[5]=a("p",null,[a("strong",null,"特点"),i("：")],-1)),s[6]||(s[6]=a("ul",null,[a("li",null,"构建后生成纯静态文件（HTML、JS、CSS）"),a("li",null,"部署到 Nginx 或静态服务器"),a("li",null,"所有渲染在浏览器端完成"),a("li",null,"首次加载需要下载所有 JS 代码")],-1)),s[7]||(s[7]=a("h4",{id:"next-js-项目",tabindex:"-1"},[i("Next.js 项目 "),a("a",{class:"header-anchor",href:"#next-js-项目","aria-label":'Permalink to "Next.js 项目"'},"​")],-1)),(e(),r(d,null,{default:n(()=>[p(l,{id:"mermaid-631",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5B%E6%9E%84%E5%BB%BA%5D%20--%3E%20B%5B%E7%94%9F%E6%88%90%E6%9C%8D%E5%8A%A1%E7%AB%AF%2B%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81%5D%0A%20%20%20%20B%20--%3E%20C%5B%E4%B8%8A%E4%BC%A0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%88%B0%20CDN%5D%0A%20%20%20%20B%20--%3E%20D%5B%E9%83%A8%E7%BD%B2%20Node.js%20%E6%9C%8D%E5%8A%A1%5D%0A%20%20%20%20D%20--%3E%20E%5B%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%5D%0A%20%20%20%20E%20--%3E%20F%5B%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%20HTML%5D%0A%20%20%20%20F%20--%3E%20G%5B%E8%BF%94%E5%9B%9E%20HTML%20%2B%20%E5%AE%A2%E6%88%B7%E7%AB%AF%20JS%5D%0A%20%20%20%20G%20--%3E%20H%5B%E6%B5%8F%E8%A7%88%E5%99%A8%E6%BF%80%E6%B4%BB%20Hydration%5D%0A"})]),fallback:n(()=>s[2]||(s[2]=[i(" Loading... ")])),_:1})),s[8]||(s[8]=t(`<p><strong>特点</strong>：</p><ul><li>构建后生成服务端和客户端代码</li><li>需要 Node.js 运行环境</li><li>支持服务端渲染（SSR）和静态生成（SSG）</li><li>首次加载即可看到内容，SEO 友好</li></ul><h3 id="_4-3-详细对比表" tabindex="-1">4.3 详细对比表 <a class="header-anchor" href="#_4-3-详细对比表" aria-label="Permalink to &quot;4.3 详细对比表&quot;">​</a></h3><table tabindex="0"><thead><tr><th>对比项</th><th>传统 CSR</th><th>Next.js</th></tr></thead><tbody><tr><td><strong>服务器要求</strong></td><td>Nginx/静态服务器</td><td>Node.js 服务器</td></tr><tr><td><strong>首次加载</strong></td><td>白屏 → 加载 JS → 渲染</td><td>直接显示 HTML</td></tr><tr><td><strong>SEO</strong></td><td>需要预渲染或 SSR</td><td>原生支持 SSR/SSG</td></tr><tr><td><strong>部署复杂度</strong></td><td>简单（静态文件）</td><td>复杂（需要 Node.js 环境）</td></tr><tr><td><strong>性能优化</strong></td><td>手动优化</td><td>自动代码分割、预加载</td></tr><tr><td><strong>API 路由</strong></td><td>需要单独后端</td><td>内置 API Routes</td></tr><tr><td><strong>缓存策略</strong></td><td>静态资源缓存</td><td>页面级缓存 + 静态资源缓存</td></tr><tr><td><strong>开发体验</strong></td><td>需要配置路由、构建工具</td><td>约定式路由，开箱即用</td></tr></tbody></table><h3 id="_4-4-性能对比" tabindex="-1">4.4 性能对比 <a class="header-anchor" href="#_4-4-性能对比" aria-label="Permalink to &quot;4.4 性能对比&quot;">​</a></h3><h4 id="传统-csr-项目-1" tabindex="-1">传统 CSR 项目 <a class="header-anchor" href="#传统-csr-项目-1" aria-label="Permalink to &quot;传统 CSR 项目&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户请求 → Nginx 返回 index.html</span></span>
<span class="line"><span>         → 浏览器解析 HTML</span></span>
<span class="line"><span>         → 下载并执行 JS（可能很大）</span></span>
<span class="line"><span>         → 发起 API 请求</span></span>
<span class="line"><span>         → 渲染页面内容</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>问题</strong>：</p><ul><li>首次加载时间长（需要下载所有 JS）</li><li>白屏时间长</li><li>SEO 不友好（搜索引擎无法抓取动态内容）</li></ul><h4 id="next-js-项目-1" tabindex="-1">Next.js 项目 <a class="header-anchor" href="#next-js-项目-1" aria-label="Permalink to &quot;Next.js 项目&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户请求 → Node.js 服务端渲染</span></span>
<span class="line"><span>         → 返回完整 HTML（包含内容）</span></span>
<span class="line"><span>         → 浏览器显示内容</span></span>
<span class="line"><span>         → 下载并执行客户端 JS（Hydration）</span></span>
<span class="line"><span>         → 页面可交互</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>优势</strong>：</p><ul><li>首次加载即可看到内容</li><li>SEO 友好（搜索引擎可抓取 HTML）</li><li>自动代码分割，只加载需要的代码</li><li>支持预渲染，进一步提升性能</li></ul><h3 id="_4-5-部署架构对比" tabindex="-1">4.5 部署架构对比 <a class="header-anchor" href="#_4-5-部署架构对比" aria-label="Permalink to &quot;4.5 部署架构对比&quot;">​</a></h3><h4 id="传统-csr-架构" tabindex="-1">传统 CSR 架构 <a class="header-anchor" href="#传统-csr-架构" aria-label="Permalink to &quot;传统 CSR 架构&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────┐</span></span>
<span class="line"><span>│  Nginx  │ ← 静态文件服务器</span></span>
<span class="line"><span>└─────────┘</span></span>
<span class="line"><span>     │</span></span>
<span class="line"><span>     ├─ index.html</span></span>
<span class="line"><span>     ├─ bundle.js (可能很大)</span></span>
<span class="line"><span>     └─ styles.css</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="next-js-架构" tabindex="-1">Next.js 架构 <a class="header-anchor" href="#next-js-架构" aria-label="Permalink to &quot;Next.js 架构&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────┐      ┌──────────┐</span></span>
<span class="line"><span>│   K8s Pod   │      │   CDN    │</span></span>
<span class="line"><span>│             │      │          │</span></span>
<span class="line"><span>│  Node.js    │ ←─── │ 静态资源  │</span></span>
<span class="line"><span>│  + Next.js  │      │ (JS/CSS) │</span></span>
<span class="line"><span>└─────────────┘      └──────────┘</span></span>
<span class="line"><span>     │</span></span>
<span class="line"><span>     ├─ SSR 页面</span></span>
<span class="line"><span>     ├─ SSG 页面</span></span>
<span class="line"><span>     └─ API 路由</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_4-6-缓存策略对比" tabindex="-1">4.6 缓存策略对比 <a class="header-anchor" href="#_4-6-缓存策略对比" aria-label="Permalink to &quot;4.6 缓存策略对比&quot;">​</a></h3><h4 id="传统-csr" tabindex="-1">传统 CSR <a class="header-anchor" href="#传统-csr" aria-label="Permalink to &quot;传统 CSR&quot;">​</a></h4><ul><li><strong>HTML</strong>：通常不缓存或短缓存</li><li><strong>JS/CSS</strong>：通过文件名 hash 实现长期缓存</li><li><strong>API 数据</strong>：客户端缓存或 CDN 缓存</li></ul><h4 id="next-js" tabindex="-1">Next.js <a class="header-anchor" href="#next-js" aria-label="Permalink to &quot;Next.js&quot;">​</a></h4><ul><li><strong>SSR 页面</strong>：服务端缓存（Redis/内存）</li><li><strong>SSG 页面</strong>：构建时生成，可长期缓存</li><li><strong>静态资源</strong>：CDN 缓存（长期）</li><li><strong>API 路由</strong>：可配置缓存策略</li></ul><hr><h2 id="_5-总结" tabindex="-1">5. 总结 <a class="header-anchor" href="#_5-总结" aria-label="Permalink to &quot;5. 总结&quot;">​</a></h2><h3 id="next-js-项目的优势" tabindex="-1">Next.js 项目的优势 <a class="header-anchor" href="#next-js-项目的优势" aria-label="Permalink to &quot;Next.js 项目的优势&quot;">​</a></h3><ol><li><strong>更好的 SEO</strong>：服务端渲染，搜索引擎可直接抓取内容</li><li><strong>更快的首屏</strong>：服务端生成 HTML，用户立即看到内容</li><li><strong>自动优化</strong>：代码分割、预加载、图片优化等开箱即用</li><li><strong>灵活的渲染策略</strong>：SSR、SSG、ISR 可根据需求选择</li></ol><h3 id="部署复杂度" tabindex="-1">部署复杂度 <a class="header-anchor" href="#部署复杂度" aria-label="Permalink to &quot;部署复杂度&quot;">​</a></h3><ul><li><strong>需要</strong>：Node.js 运行环境、容器化部署、K8s 管理</li><li><strong>成本</strong>：服务器资源、运维复杂度增加</li><li><strong>收益</strong>：更好的用户体验、SEO、性能</li></ul><h3 id="适用场景" tabindex="-1">适用场景 <a class="header-anchor" href="#适用场景" aria-label="Permalink to &quot;适用场景&quot;">​</a></h3><p><strong>适合使用 Next.js</strong>：</p><ul><li>需要 SEO 的网站（内容站、电商等）</li><li>需要快速首屏加载的应用</li><li>需要服务端渲染的复杂应用</li></ul><p><strong>适合传统 CSR</strong>：</p><ul><li>纯后台管理系统（不需要 SEO）</li><li>简单的单页应用</li><li>对服务器资源有限制的场景</li></ul><hr><h2 id="_6-参考资料" tabindex="-1">6. 参考资料 <a class="header-anchor" href="#_6-参考资料" aria-label="Permalink to &quot;6. 参考资料&quot;">​</a></h2><ul><li><a href="https://nextjs.org/docs" target="_blank" rel="noreferrer">Next.js 官方文档</a></li><li><a href="https://nextjs.org/docs/deployment" target="_blank" rel="noreferrer">Next.js 部署文档</a></li><li><a href="https://docs.docker.com/build/building/multi-stage/" target="_blank" rel="noreferrer">Docker 多阶段构建</a></li><li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noreferrer">Kubernetes 部署</a></li></ul>`,37))])}const C=h(E,[["render",k]]);export{y as __pageData,C as default};
