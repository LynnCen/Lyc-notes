import{_ as s,c as n,o as e,a7 as i}from"./chunks/framework.BQb8NfN9.js";const b=JSON.parse('{"title":"后端架构与服务治理技术详解","description":"","frontmatter":{},"headers":[],"relativePath":"software-exam/架构师/知识点/02-后端架构技术.md","filePath":"software-exam/架构师/知识点/02-后端架构技术.md","lastUpdated":1770042246000}'),t={name:"software-exam/架构师/知识点/02-后端架构技术.md"};function l(r,a,h,p,d,o){return e(),n("div",null,a[0]||(a[0]=[i(`<h1 id="后端架构与服务治理技术详解" tabindex="-1">后端架构与服务治理技术详解 <a class="header-anchor" href="#后端架构与服务治理技术详解" aria-label="Permalink to &quot;后端架构与服务治理技术详解&quot;">​</a></h1><hr><h2 id="一、架构模式" tabindex="-1">一、架构模式 <a class="header-anchor" href="#一、架构模式" aria-label="Permalink to &quot;一、架构模式&quot;">​</a></h2><h3 id="_1-1-分层架构-layered-architecture" tabindex="-1">1.1 分层架构（Layered Architecture） <a class="header-anchor" href="#_1-1-分层架构-layered-architecture" aria-label="Permalink to &quot;1.1 分层架构（Layered Architecture）&quot;">​</a></h3><h4 id="定义" tabindex="-1">定义 <a class="header-anchor" href="#定义" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>将系统按职责划分为展示层、业务层、数据层等水平层次，层间依赖单向的架构模式。</p><h4 id="解决的问题" tabindex="-1">解决的问题 <a class="header-anchor" href="#解决的问题" aria-label="Permalink to &quot;解决的问题&quot;">​</a></h4><ul><li>代码职责不清</li><li>耦合严重</li><li>难以测试和维护</li></ul><h4 id="典型分层" tabindex="-1">典型分层 <a class="header-anchor" href="#典型分层" aria-label="Permalink to &quot;典型分层&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户体验层（SSR）</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>业务边界层（Gateway/BFF）</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>核心服务层（微服务）</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>基础设施层（K8s/DB）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_1-2-微服务架构-microservices-architecture" tabindex="-1">1.2 微服务架构（Microservices Architecture） <a class="header-anchor" href="#_1-2-微服务架构-microservices-architecture" aria-label="Permalink to &quot;1.2 微服务架构（Microservices Architecture）&quot;">​</a></h3><h4 id="定义-1" tabindex="-1">定义 <a class="header-anchor" href="#定义-1" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>将单体应用拆分为多个独立部署、独立扩展的小型服务，每个服务负责一个业务能力。</p><h4 id="解决的问题-1" tabindex="-1">解决的问题 <a class="header-anchor" href="#解决的问题-1" aria-label="Permalink to &quot;解决的问题&quot;">​</a></h4><ul><li>单体应用难以扩展</li><li>故障影响全局</li><li>技术栈固化</li></ul><h4 id="三种实现模式" tabindex="-1">三种实现模式 <a class="header-anchor" href="#三种实现模式" aria-label="Permalink to &quot;三种实现模式&quot;">​</a></h4><table tabindex="0"><thead><tr><th>模式</th><th>说明</th></tr></thead><tbody><tr><td>RESTful API模式</td><td>服务通过API提供，云服务属于这一类</td></tr><tr><td>RESTful应用模式</td><td>通过传统网络协议提供服务，企业内部常见</td></tr><tr><td>集中消息模式</td><td>采用消息代理实现消息队列、负载均衡</td></tr></tbody></table><h3 id="_1-3-事件驱动架构-event-driven-architecture-eda" tabindex="-1">1.3 事件驱动架构（Event-Driven Architecture, EDA） <a class="header-anchor" href="#_1-3-事件驱动架构-event-driven-architecture-eda" aria-label="Permalink to &quot;1.3 事件驱动架构（Event-Driven Architecture, EDA）&quot;">​</a></h3><h4 id="定义-2" tabindex="-1">定义 <a class="header-anchor" href="#定义-2" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>通过异步事件在服务间传递状态变化，实现松耦合通信的架构模式。</p><h4 id="解决的问题-2" tabindex="-1">解决的问题 <a class="header-anchor" href="#解决的问题-2" aria-label="Permalink to &quot;解决的问题&quot;">​</a></h4><ul><li>同步调用链路长导致超时</li><li>服务间强依赖</li><li>分布式事务难实现</li></ul><h4 id="核心组件" tabindex="-1">核心组件 <a class="header-anchor" href="#核心组件" aria-label="Permalink to &quot;核心组件&quot;">​</a></h4><table tabindex="0"><thead><tr><th>组件</th><th>职责</th></tr></thead><tbody><tr><td>事件队列</td><td>接收事件的入口</td></tr><tr><td>分发器</td><td>将事件分发到不同业务逻辑单元</td></tr><tr><td>事件通道</td><td>分发器与处理器之间的联系渠道</td></tr><tr><td>事件处理器</td><td>实现业务逻辑</td></tr></tbody></table><hr><h2 id="二、服务治理" tabindex="-1">二、服务治理 <a class="header-anchor" href="#二、服务治理" aria-label="Permalink to &quot;二、服务治理&quot;">​</a></h2><h3 id="_2-1-api-gateway-api网关" tabindex="-1">2.1 API Gateway（API网关） <a class="header-anchor" href="#_2-1-api-gateway-api网关" aria-label="Permalink to &quot;2.1 API Gateway（API网关）&quot;">​</a></h3><h4 id="定义-3" tabindex="-1">定义 <a class="header-anchor" href="#定义-3" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>系统的统一入口，负责路由、认证、限流、监控等横切关注点。</p><h4 id="解决的问题-3" tabindex="-1">解决的问题 <a class="header-anchor" href="#解决的问题-3" aria-label="Permalink to &quot;解决的问题&quot;">​</a></h4><ul><li>前端直连多个微服务导致复杂性高</li><li>安全风险大</li><li>流量无法统一管控</li></ul><h4 id="核心功能" tabindex="-1">核心功能 <a class="header-anchor" href="#核心功能" aria-label="Permalink to &quot;核心功能&quot;">​</a></h4><table tabindex="0"><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>路由转发</td><td>将请求路由到后端服务</td></tr><tr><td>认证鉴权</td><td>统一处理身份验证</td></tr><tr><td>限流熔断</td><td>保护后端服务</td></tr><tr><td>协议转换</td><td>HTTP/gRPC/WebSocket转换</td></tr><tr><td>日志审计</td><td>统一日志记录</td></tr></tbody></table><h4 id="常用产品" tabindex="-1">常用产品 <a class="header-anchor" href="#常用产品" aria-label="Permalink to &quot;常用产品&quot;">​</a></h4><ul><li>Kong</li><li>APISIX</li><li>Spring Cloud Gateway</li><li>Nginx</li></ul><h3 id="_2-2-bff-backend-for-frontend" tabindex="-1">2.2 BFF（Backend for Frontend） <a class="header-anchor" href="#_2-2-bff-backend-for-frontend" aria-label="Permalink to &quot;2.2 BFF（Backend for Frontend）&quot;">​</a></h3><h4 id="定义-4" tabindex="-1">定义 <a class="header-anchor" href="#定义-4" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>为不同前端（Web、Mobile、小程序）定制的轻量聚合层，按前端需求组装数据。</p><h4 id="解决的问题-4" tabindex="-1">解决的问题 <a class="header-anchor" href="#解决的问题-4" aria-label="Permalink to &quot;解决的问题&quot;">​</a></h4><ul><li>前端直接调用多个微服务导致请求多</li><li>数据冗余</li><li>网络开销大</li></ul><h4 id="架构示意" tabindex="-1">架构示意 <a class="header-anchor" href="#架构示意" aria-label="Permalink to &quot;架构示意&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Web端 → Web BFF → </span></span>
<span class="line"><span>                  → 后端微服务群</span></span>
<span class="line"><span>Mobile端 → Mobile BFF →</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="效果" tabindex="-1">效果 <a class="header-anchor" href="#效果" aria-label="Permalink to &quot;效果&quot;">​</a></h4><p>一次请求聚合模板、用户、权益等多个服务数据，减少80%的前端请求数。</p><h3 id="_2-3-grpc" tabindex="-1">2.3 gRPC <a class="header-anchor" href="#_2-3-grpc" aria-label="Permalink to &quot;2.3 gRPC&quot;">​</a></h3><h4 id="定义-5" tabindex="-1">定义 <a class="header-anchor" href="#定义-5" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>Google开源的高性能RPC框架，基于HTTP/2和Protocol Buffers，支持多语言。</p><h4 id="解决的问题-5" tabindex="-1">解决的问题 <a class="header-anchor" href="#解决的问题-5" aria-label="Permalink to &quot;解决的问题&quot;">​</a></h4><ul><li>REST/JSON通信性能低</li><li>序列化开销大</li><li>接口契约不明确</li></ul><h4 id="特点" tabindex="-1">特点 <a class="header-anchor" href="#特点" aria-label="Permalink to &quot;特点&quot;">​</a></h4><ul><li>比REST快5-10倍</li><li>通过.proto文件定义接口契约</li><li>类型安全和自动代码生成</li></ul><h4 id="示例" tabindex="-1">示例 <a class="header-anchor" href="#示例" aria-label="Permalink to &quot;示例&quot;">​</a></h4><div class="language-protobuf vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">protobuf</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">syntax</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;proto3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">service</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TemplateService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  rpc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GetTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetTemplateRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  rpc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ListTemplates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ListTemplatesRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ListTemplatesResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GetTemplateRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> template_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> category </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><hr><h2 id="三、数据一致性" tabindex="-1">三、数据一致性 <a class="header-anchor" href="#三、数据一致性" aria-label="Permalink to &quot;三、数据一致性&quot;">​</a></h2><h3 id="_3-1-outbox-pattern-事务性发件箱模式" tabindex="-1">3.1 Outbox Pattern（事务性发件箱模式） <a class="header-anchor" href="#_3-1-outbox-pattern-事务性发件箱模式" aria-label="Permalink to &quot;3.1 Outbox Pattern（事务性发件箱模式）&quot;">​</a></h3><h4 id="定义-6" tabindex="-1">定义 <a class="header-anchor" href="#定义-6" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>在业务事务中同时写入业务数据和事件到同一数据库，通过后续进程保证事件发布的模式。</p><h4 id="解决的问题-6" tabindex="-1">解决的问题 <a class="header-anchor" href="#解决的问题-6" aria-label="Permalink to &quot;解决的问题&quot;">​</a></h4><ul><li>分布式事务复杂</li><li>本地事务与消息发送无法保证原子性</li></ul><h4 id="实现流程" tabindex="-1">实现流程 <a class="header-anchor" href="#实现流程" aria-label="Permalink to &quot;实现流程&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. 业务操作 + 写入Outbox表（同一事务）</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>2. CDC工具监听Outbox表变化</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>3. 事件投递到消息队列</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>4. 下游服务幂等消费</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-2-cdc-change-data-capture" tabindex="-1">3.2 CDC（Change Data Capture） <a class="header-anchor" href="#_3-2-cdc-change-data-capture" aria-label="Permalink to &quot;3.2 CDC（Change Data Capture）&quot;">​</a></h3><h4 id="定义-7" tabindex="-1">定义 <a class="header-anchor" href="#定义-7" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>监听数据库变更日志（如MySQL binlog），实时捕获数据变化并发布到下游的技术。</p><h4 id="常用工具" tabindex="-1">常用工具 <a class="header-anchor" href="#常用工具" aria-label="Permalink to &quot;常用工具&quot;">​</a></h4><ul><li>Debezium</li><li>Maxwell</li><li>Canal</li></ul><h4 id="架构示例" tabindex="-1">架构示例 <a class="header-anchor" href="#架构示例" aria-label="Permalink to &quot;架构示例&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>MySQL (binlog) → Debezium → Kafka → Flink/Spark → 下游系统</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_3-3-幂等消费-idempotent-consumer" tabindex="-1">3.3 幂等消费（Idempotent Consumer） <a class="header-anchor" href="#_3-3-幂等消费-idempotent-consumer" aria-label="Permalink to &quot;3.3 幂等消费（Idempotent Consumer）&quot;">​</a></h3><h4 id="定义-8" tabindex="-1">定义 <a class="header-anchor" href="#定义-8" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>消费者处理消息时，保证重复消费同一条消息不会产生副作用的设计。</p><h4 id="解决的问题-7" tabindex="-1">解决的问题 <a class="header-anchor" href="#解决的问题-7" aria-label="Permalink to &quot;解决的问题&quot;">​</a></h4><p>消息队列至少一次语义导致重复消费引发数据重复或错误。</p><h4 id="实现方式" tabindex="-1">实现方式 <a class="header-anchor" href="#实现方式" aria-label="Permalink to &quot;实现方式&quot;">​</a></h4><ul><li>消息ID + 分布式锁</li><li>唯一索引去重</li><li>状态机控制</li></ul><hr><h2 id="四、流量治理" tabindex="-1">四、流量治理 <a class="header-anchor" href="#四、流量治理" aria-label="Permalink to &quot;四、流量治理&quot;">​</a></h2><h3 id="_4-1-限流-rate-limiting" tabindex="-1">4.1 限流（Rate Limiting） <a class="header-anchor" href="#_4-1-限流-rate-limiting" aria-label="Permalink to &quot;4.1 限流（Rate Limiting）&quot;">​</a></h3><h4 id="定义-9" tabindex="-1">定义 <a class="header-anchor" href="#定义-9" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>限制单位时间内请求数量，防止过载的流量控制手段。</p><h4 id="常用算法" tabindex="-1">常用算法 <a class="header-anchor" href="#常用算法" aria-label="Permalink to &quot;常用算法&quot;">​</a></h4><table tabindex="0"><thead><tr><th>算法</th><th>说明</th></tr></thead><tbody><tr><td>固定窗口</td><td>每个时间窗口独立计数</td></tr><tr><td>滑动窗口</td><td>平滑限流，避免边界问题</td></tr><tr><td>令牌桶</td><td>允许突发流量，令牌以固定速率生成</td></tr><tr><td>漏桶</td><td>请求以固定速率处理，平滑流量</td></tr></tbody></table><h4 id="示例配置" tabindex="-1">示例配置 <a class="header-anchor" href="#示例配置" aria-label="Permalink to &quot;示例配置&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Gateway层限流</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">rate_limit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  per_ip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">100/s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # 单IP每秒100次</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  per_user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10/min</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 单用户每分钟10次AI调用</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-2-熔断-circuit-breaker" tabindex="-1">4.2 熔断（Circuit Breaker） <a class="header-anchor" href="#_4-2-熔断-circuit-breaker" aria-label="Permalink to &quot;4.2 熔断（Circuit Breaker）&quot;">​</a></h3><h4 id="定义-10" tabindex="-1">定义 <a class="header-anchor" href="#定义-10" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>当下游服务故障率超过阈值时，自动切断请求，快速失败并返回降级响应的保护机制。</p><h4 id="状态机" tabindex="-1">状态机 <a class="header-anchor" href="#状态机" aria-label="Permalink to &quot;状态机&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>闭合（Closed） ←→ 开启（Open）</span></span>
<span class="line"><span>       ↓              ↓</span></span>
<span class="line"><span>      正常          快速失败</span></span>
<span class="line"><span>       ↓              ↓</span></span>
<span class="line"><span>      (故障率↑)    (冷却期后)</span></span>
<span class="line"><span>       ↓              ↓</span></span>
<span class="line"><span>    → 半开（Half-Open） ←</span></span>
<span class="line"><span>           ↓</span></span>
<span class="line"><span>       探测请求</span></span>
<span class="line"><span>           ↓</span></span>
<span class="line"><span>    成功率高 → 闭合</span></span>
<span class="line"><span>    成功率低 → 开启</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="常用工具-1" tabindex="-1">常用工具 <a class="header-anchor" href="#常用工具-1" aria-label="Permalink to &quot;常用工具&quot;">​</a></h4><ul><li>Hystrix（已停止维护）</li><li>Resilience4j</li><li>Sentinel</li></ul><h3 id="_4-3-重试与退避" tabindex="-1">4.3 重试与退避 <a class="header-anchor" href="#_4-3-重试与退避" aria-label="Permalink to &quot;4.3 重试与退避&quot;">​</a></h3><h4 id="指数退避" tabindex="-1">指数退避 <a class="header-anchor" href="#指数退避" aria-label="Permalink to &quot;指数退避&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>第1次重试：等待 100ms</span></span>
<span class="line"><span>第2次重试：等待 200ms</span></span>
<span class="line"><span>第3次重试：等待 400ms</span></span>
<span class="line"><span>第4次重试：等待 800ms（+ 随机抖动）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h4><ul><li>设置最大重试次数（如3次）</li><li>添加随机抖动避免重试风暴</li><li>配合幂等性设计</li></ul><hr><h2 id="五、领域驱动设计-ddd" tabindex="-1">五、领域驱动设计（DDD） <a class="header-anchor" href="#五、领域驱动设计-ddd" aria-label="Permalink to &quot;五、领域驱动设计（DDD）&quot;">​</a></h2><h3 id="_5-1-核心概念" tabindex="-1">5.1 核心概念 <a class="header-anchor" href="#_5-1-核心概念" aria-label="Permalink to &quot;5.1 核心概念&quot;">​</a></h3><h4 id="定义-11" tabindex="-1">定义 <a class="header-anchor" href="#定义-11" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>一种软件设计方法论，通过识别业务领域、建立统一语言、划分限界上下文来组织复杂系统。</p><h4 id="解决的问题-8" tabindex="-1">解决的问题 <a class="header-anchor" href="#解决的问题-8" aria-label="Permalink to &quot;解决的问题&quot;">​</a></h4><ul><li>业务逻辑分散</li><li>模型贫血</li><li>服务边界模糊</li></ul><h3 id="_5-2-战术模式" tabindex="-1">5.2 战术模式 <a class="header-anchor" href="#_5-2-战术模式" aria-label="Permalink to &quot;5.2 战术模式&quot;">​</a></h3><table tabindex="0"><thead><tr><th>模式</th><th>说明</th></tr></thead><tbody><tr><td>聚合根</td><td>一组相关对象的根实体，保证一致性边界</td></tr><tr><td>实体</td><td>具有唯一标识的对象</td></tr><tr><td>值对象</td><td>无唯一标识，通过属性值定义的对象</td></tr><tr><td>领域事件</td><td>领域中发生的有业务意义的事件</td></tr><tr><td>仓储</td><td>聚合的持久化接口</td></tr></tbody></table><h3 id="_5-3-限界上下文" tabindex="-1">5.3 限界上下文 <a class="header-anchor" href="#_5-3-限界上下文" aria-label="Permalink to &quot;5.3 限界上下文&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户域          模板域          编辑域</span></span>
<span class="line"><span>┌─────────┐   ┌─────────┐   ┌─────────┐</span></span>
<span class="line"><span>│ 用户    │   │ 模板    │   │ 项目    │</span></span>
<span class="line"><span>│ 账户    │   │ 素材    │   │ 页面    │</span></span>
<span class="line"><span>│ 权限    │   │ 分类    │   │ 图层    │</span></span>
<span class="line"><span>└─────────┘   └─────────┘   └─────────┘</span></span>
<span class="line"><span>     ↓             ↓             ↓</span></span>
<span class="line"><span>  认证服务      模板服务       编辑服务</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><hr><h2 id="六、契约管理" tabindex="-1">六、契约管理 <a class="header-anchor" href="#六、契约管理" aria-label="Permalink to &quot;六、契约管理&quot;">​</a></h2><h3 id="_6-1-契约测试-contract-testing" tabindex="-1">6.1 契约测试（Contract Testing） <a class="header-anchor" href="#_6-1-契约测试-contract-testing" aria-label="Permalink to &quot;6.1 契约测试（Contract Testing）&quot;">​</a></h3><h4 id="定义-12" tabindex="-1">定义 <a class="header-anchor" href="#定义-12" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>验证服务间接口约定（契约）是否被正确实现和遵守的测试方法。</p><h4 id="解决的问题-9" tabindex="-1">解决的问题 <a class="header-anchor" href="#解决的问题-9" aria-label="Permalink to &quot;解决的问题&quot;">​</a></h4><ul><li>微服务间接口变更导致运行时错误</li><li>集成测试成本高</li></ul><h4 id="工具" tabindex="-1">工具 <a class="header-anchor" href="#工具" aria-label="Permalink to &quot;工具&quot;">​</a></h4><ul><li>Pact</li><li>Spring Cloud Contract</li></ul><h3 id="_6-2-api版本管理" tabindex="-1">6.2 API版本管理 <a class="header-anchor" href="#_6-2-api版本管理" aria-label="Permalink to &quot;6.2 API版本管理&quot;">​</a></h3><h4 id="策略" tabindex="-1">策略 <a class="header-anchor" href="#策略" aria-label="Permalink to &quot;策略&quot;">​</a></h4><table tabindex="0"><thead><tr><th>策略</th><th>示例</th></tr></thead><tbody><tr><td>URL路径</td><td><code>/api/v1/templates</code>、<code>/api/v2/templates</code></td></tr><tr><td>Header</td><td><code>Accept-Version: v1</code></td></tr><tr><td>查询参数</td><td><code>?version=1</code></td></tr></tbody></table><h4 id="兼容性原则" tabindex="-1">兼容性原则 <a class="header-anchor" href="#兼容性原则" aria-label="Permalink to &quot;兼容性原则&quot;">​</a></h4><ul><li>向后兼容：新版本能处理旧格式请求</li><li>向前兼容：旧版本能忽略新字段</li></ul><hr><h2 id="七、安全认证" tabindex="-1">七、安全认证 <a class="header-anchor" href="#七、安全认证" aria-label="Permalink to &quot;七、安全认证&quot;">​</a></h2><h3 id="_7-1-oauth2" tabindex="-1">7.1 OAuth2 <a class="header-anchor" href="#_7-1-oauth2" aria-label="Permalink to &quot;7.1 OAuth2&quot;">​</a></h3><h4 id="定义-13" tabindex="-1">定义 <a class="header-anchor" href="#定义-13" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>开放授权标准，允许第三方应用在不获取用户密码的情况下访问用户资源。</p><h4 id="授权流程" tabindex="-1">授权流程 <a class="header-anchor" href="#授权流程" aria-label="Permalink to &quot;授权流程&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户 → 第三方应用 → 授权服务器 → 资源服务器</span></span>
<span class="line"><span>         ↓              ↓</span></span>
<span class="line"><span>      授权请求      发放Token</span></span>
<span class="line"><span>         ↓              ↓</span></span>
<span class="line"><span>      用户授权    携带Token访问资源</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_7-2-oidc-openid-connect" tabindex="-1">7.2 OIDC（OpenID Connect） <a class="header-anchor" href="#_7-2-oidc-openid-connect" aria-label="Permalink to &quot;7.2 OIDC（OpenID Connect）&quot;">​</a></h3><h4 id="定义-14" tabindex="-1">定义 <a class="header-anchor" href="#定义-14" aria-label="Permalink to &quot;定义&quot;">​</a></h4><p>基于OAuth2的身份认证协议，提供标准化的用户身份信息（ID Token）。</p><h3 id="_7-3-rbac-vs-abac" tabindex="-1">7.3 RBAC vs ABAC <a class="header-anchor" href="#_7-3-rbac-vs-abac" aria-label="Permalink to &quot;7.3 RBAC vs ABAC&quot;">​</a></h3><table tabindex="0"><thead><tr><th>特性</th><th>RBAC</th><th>ABAC</th></tr></thead><tbody><tr><td>定义</td><td>基于角色的访问控制</td><td>基于属性的访问控制</td></tr><tr><td>粒度</td><td>角色级别</td><td>细粒度（用户、资源、环境属性）</td></tr><tr><td>示例</td><td>管理员、编辑、查看者</td><td>只能访问自己创建的资源</td></tr><tr><td>复杂度</td><td>低</td><td>高</td></tr></tbody></table><h3 id="_7-4-jwt-json-web-token" tabindex="-1">7.4 JWT（JSON Web Token） <a class="header-anchor" href="#_7-4-jwt-json-web-token" aria-label="Permalink to &quot;7.4 JWT（JSON Web Token）&quot;">​</a></h3><h4 id="结构" tabindex="-1">结构 <a class="header-anchor" href="#结构" aria-label="Permalink to &quot;结构&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Header.Payload.Signature</span></span>
<span class="line"><span></span></span>
<span class="line"><span>示例：</span></span>
<span class="line"><span>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.</span></span>
<span class="line"><span>eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4ifQ.</span></span>
<span class="line"><span>SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="优势" tabindex="-1">优势 <a class="header-anchor" href="#优势" aria-label="Permalink to &quot;优势&quot;">​</a></h4><ul><li>无需服务端存储会话</li><li>支持分布式系统无状态扩展</li></ul>`,139)]))}const u=s(t,[["render",l]]);export{b as __pageData,u as default};
