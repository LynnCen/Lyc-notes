import{_ as a,c as n,o as i,a7 as p}from"./chunks/framework.BQb8NfN9.js";const E=JSON.parse('{"title":"å›¾ç‰‡æ ¼å¼è½¬æ¢æ·±åº¦è§£æ","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/è®¡ç®—æœºå›¾åƒ/å›¾ç‰‡æ ¼å¼è½¬æ¢.md","filePath":"work/gd/è®¡ç®—æœºå›¾åƒ/å›¾ç‰‡æ ¼å¼è½¬æ¢.md","lastUpdated":1770085732000}'),l={name:"work/gd/è®¡ç®—æœºå›¾åƒ/å›¾ç‰‡æ ¼å¼è½¬æ¢.md"};function e(h,s,r,t,k,c){return i(),n("div",null,s[0]||(s[0]=[p(`<h1 id="å›¾ç‰‡æ ¼å¼è½¬æ¢æ·±åº¦è§£æ" tabindex="-1">å›¾ç‰‡æ ¼å¼è½¬æ¢æ·±åº¦è§£æ <a class="header-anchor" href="#å›¾ç‰‡æ ¼å¼è½¬æ¢æ·±åº¦è§£æ" aria-label="Permalink to &quot;å›¾ç‰‡æ ¼å¼è½¬æ¢æ·±åº¦è§£æ&quot;">â€‹</a></h1><blockquote><p><strong>æ ¸å¿ƒæŠ€æœ¯ï¼š</strong> ImageMagick WASM + UTIF.js + heic2any</p><p><strong>åŠŸèƒ½ï¼š</strong> æ”¯æŒ10+ç§å›¾ç‰‡æ ¼å¼çš„äº’ç›¸è½¬æ¢</p></blockquote><hr><h2 id="ğŸ“š-ç›®å½•" tabindex="-1">ğŸ“š ç›®å½• <a class="header-anchor" href="#ğŸ“š-ç›®å½•" aria-label="Permalink to &quot;ğŸ“š ç›®å½•&quot;">â€‹</a></h2><ol><li><a href="#ä¸€åŠŸèƒ½æ¦‚è¿°ä¸éš¾ç‚¹åˆ†æ">åŠŸèƒ½æ¦‚è¿°ä¸éš¾ç‚¹åˆ†æ</a></li><li><a href="#äºŒinsmindå®ç°è¯¦è§£">InsMindå®ç°è¯¦è§£</a></li><li><a href="#ä¸‰ç‰¹æ®Šæ ¼å¼å¤„ç†">ç‰¹æ®Šæ ¼å¼å¤„ç†</a></li><li><a href="#å››imagemagick-wasmåŸç†">ImageMagick WASMåŸç†</a></li><li><a href="#äº”å›¾ç‰‡æ ¼å¼åŸºç¡€çŸ¥è¯†">å›¾ç‰‡æ ¼å¼åŸºç¡€çŸ¥è¯†</a></li><li><a href="#å…­canvas-apiçš„å±€é™æ€§">Canvas APIçš„å±€é™æ€§</a></li><li><a href="#ä¸ƒæ€»ç»“ä¸æœ€ä½³å®è·µ">æ€»ç»“ä¸æœ€ä½³å®è·µ</a></li></ol><hr><h2 id="ä¸€ã€åŠŸèƒ½æ¦‚è¿°ä¸éš¾ç‚¹åˆ†æ" tabindex="-1">ä¸€ã€åŠŸèƒ½æ¦‚è¿°ä¸éš¾ç‚¹åˆ†æ <a class="header-anchor" href="#ä¸€ã€åŠŸèƒ½æ¦‚è¿°ä¸éš¾ç‚¹åˆ†æ" aria-label="Permalink to &quot;ä¸€ã€åŠŸèƒ½æ¦‚è¿°ä¸éš¾ç‚¹åˆ†æ&quot;">â€‹</a></h2><h3 id="_1-1-åŠŸèƒ½è¯´æ˜" tabindex="-1">1.1 åŠŸèƒ½è¯´æ˜ <a class="header-anchor" href="#_1-1-åŠŸèƒ½è¯´æ˜" aria-label="Permalink to &quot;1.1 åŠŸèƒ½è¯´æ˜&quot;">â€‹</a></h3><p>æ ¼å¼è½¬æ¢å·¥å…·å…è®¸ç”¨æˆ·å°†å›¾ç‰‡ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼ï¼Œä¾‹å¦‚ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·ä¸Šä¼ ï¼šphoto.heicï¼ˆiPhoneæ‹æ‘„çš„ç…§ç‰‡ï¼‰</span></span>
<span class="line"><span>é€‰æ‹©ç›®æ ‡æ ¼å¼ï¼šPNG</span></span>
<span class="line"><span>ç‚¹å‡»è½¬æ¢</span></span>
<span class="line"><span>ä¸‹è½½ï¼šphoto.png</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1-2-æ”¯æŒçš„æ ¼å¼çŸ©é˜µ" tabindex="-1">1.2 æ”¯æŒçš„æ ¼å¼çŸ©é˜µ <a class="header-anchor" href="#_1-2-æ”¯æŒçš„æ ¼å¼çŸ©é˜µ" aria-label="Permalink to &quot;1.2 æ”¯æŒçš„æ ¼å¼çŸ©é˜µ&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>æ ¼å¼</th><th>MIMEç±»å‹</th><th>ç‰¹ç‚¹</th><th>éš¾åº¦</th></tr></thead><tbody><tr><td><strong>JPG/JPEG</strong></td><td>image/jpeg</td><td>æœ‰æŸå‹ç¼©ï¼Œä½“ç§¯å°</td><td>â­</td></tr><tr><td><strong>PNG</strong></td><td>image/png</td><td>æ— æŸå‹ç¼©ï¼Œæ”¯æŒé€æ˜</td><td>â­</td></tr><tr><td><strong>WebP</strong></td><td>image/webp</td><td>ç°ä»£æ ¼å¼ï¼Œä½“ç§¯æ›´å°</td><td>â­</td></tr><tr><td><strong>GIF</strong></td><td>image/gif</td><td>æ”¯æŒåŠ¨ç”»ï¼Œæœ€å¤š256è‰²</td><td>â­â­</td></tr><tr><td><strong>BMP</strong></td><td>image/bmp</td><td>æ— å‹ç¼©ï¼Œä½“ç§¯å¤§</td><td>â­</td></tr><tr><td><strong>TIFF</strong></td><td>image/tiff</td><td>ä¸“ä¸šæ ¼å¼ï¼Œæ”¯æŒå¤šé¡µ</td><td>â­â­â­â­</td></tr><tr><td><strong>SVG</strong></td><td>image/svg+xml</td><td>çŸ¢é‡å›¾ï¼Œæ— é™æ”¾å¤§</td><td>â­â­â­</td></tr><tr><td><strong>PDF</strong></td><td>application/pdf</td><td>æ–‡æ¡£æ ¼å¼</td><td>â­â­â­</td></tr><tr><td><strong>AI</strong></td><td>application/ai</td><td>Adobe Illustrator</td><td>â­â­â­</td></tr><tr><td><strong>HEIC</strong></td><td>image/heic</td><td>iOSä¸“ç”¨ï¼Œé«˜æ•ˆå‹ç¼©</td><td>â­â­â­â­â­</td></tr></tbody></table><h3 id="_1-3-æ ¸å¿ƒéš¾ç‚¹" tabindex="-1">1.3 æ ¸å¿ƒéš¾ç‚¹ <a class="header-anchor" href="#_1-3-æ ¸å¿ƒéš¾ç‚¹" aria-label="Permalink to &quot;1.3 æ ¸å¿ƒéš¾ç‚¹&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>éš¾ç‚¹1ï¼šæµè§ˆå™¨åŸç”Ÿä¸æ”¯æŒçš„æ ¼å¼</span></span>
<span class="line"><span>â”œâ”€ TIFFï¼šä¸“ä¸šæ‘„å½±/å°åˆ·æ ¼å¼ï¼ŒChromeæ— æ³•ç›´æ¥æ˜¾ç¤º</span></span>
<span class="line"><span>â”œâ”€ HEICï¼šiOS 11+é»˜è®¤ç…§ç‰‡æ ¼å¼ï¼ŒåŸºäºHEVCè§†é¢‘ç¼–ç </span></span>
<span class="line"><span>â”œâ”€ PDF/AIï¼šçŸ¢é‡æ ¼å¼ï¼Œéœ€è¦ä¸“é—¨çš„æ¸²æŸ“å¼•æ“</span></span>
<span class="line"><span>â””â”€ è§£å†³æ–¹æ¡ˆï¼šå¼•å…¥ç¬¬ä¸‰æ–¹åº“é¢„å¤„ç†</span></span>
<span class="line"><span></span></span>
<span class="line"><span>éš¾ç‚¹2ï¼šCanvas APIåªèƒ½è¾“å‡º3ç§æ ¼å¼</span></span>
<span class="line"><span>â”œâ”€ canvas.toBlob() åªæ”¯æŒï¼šJPGã€PNGã€WebP</span></span>
<span class="line"><span>â”œâ”€ ä¸æ”¯æŒï¼šGIFã€BMPã€SVGã€TIFFã€PDFã€AI</span></span>
<span class="line"><span>â””â”€ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ImageMagick WASM</span></span>
<span class="line"><span></span></span>
<span class="line"><span>éš¾ç‚¹3ï¼šæ ¼å¼ä¹‹é—´çš„å‚æ•°å·®å¼‚</span></span>
<span class="line"><span>â”œâ”€ JPGï¼šè´¨é‡(0-100)ï¼Œæœ‰æŸ</span></span>
<span class="line"><span>â”œâ”€ PNGï¼šå‹ç¼©çº§åˆ«(0-9)ï¼Œæ— æŸ</span></span>
<span class="line"><span>â”œâ”€ GIFï¼šæœ€å¤š256è‰²ï¼Œéœ€è¦é¢œè‰²é‡åŒ–</span></span>
<span class="line"><span>â”œâ”€ TIFFï¼šå¯èƒ½å¤šé¡µï¼Œéœ€è¦é€‰æ‹©</span></span>
<span class="line"><span>â””â”€ è§£å†³æ–¹æ¡ˆï¼šå‚æ•°æ˜ å°„å’Œæ ¼å¼é€‚é…</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><hr><h2 id="äºŒã€insmindå®ç°è¯¦è§£" tabindex="-1">äºŒã€InsMindå®ç°è¯¦è§£ <a class="header-anchor" href="#äºŒã€insmindå®ç°è¯¦è§£" aria-label="Permalink to &quot;äºŒã€InsMindå®ç°è¯¦è§£&quot;">â€‹</a></h2><h3 id="_2-1-æ ¸å¿ƒæœåŠ¡ç±»" tabindex="-1">2.1 æ ¸å¿ƒæœåŠ¡ç±» <a class="header-anchor" href="#_2-1-æ ¸å¿ƒæœåŠ¡ç±»" aria-label="Permalink to &quot;2.1 æ ¸å¿ƒæœåŠ¡ç±»&quot;">â€‹</a></h3><p><strong>æ–‡ä»¶ä½ç½®ï¼š</strong> <code>apps/insmind/routes/(vue3)/services/editor/editors/convert/services.ts</code></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ConvertService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseEditorService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IConvertServiceState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * ImageMagick WASMå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@link</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> https://github.com/dlemstra/magick-wasm</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    imageMagick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IBaseEditorServiceOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            state: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                targetFormat: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.jpg,        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é»˜è®¤ç›®æ ‡æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                targetFormatList: [],          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ”¯æŒçš„æ ¼å¼åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            config: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // è¿™äº›æ ¼å¼ä¸æ”¯æŒCanvasé¢„è§ˆï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                skipComposeMimes: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ai, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pdf, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.tiff, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.svg, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.bmp, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.gif],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆå§‹åŒ–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_2-2-åˆå§‹åŒ–æµç¨‹" tabindex="-1">2.2 åˆå§‹åŒ–æµç¨‹ <a class="header-anchor" href="#_2-2-åˆå§‹åŒ–æµç¨‹" aria-label="Permalink to &quot;2.2 åˆå§‹åŒ–æµç¨‹&quot;">â€‹</a></h3><p>åˆå§‹åŒ–åˆ†ä¸º<strong>ä¸‰ä¸ªé˜¶æ®µ</strong>ï¼šç‰¹æ®Šæ ¼å¼é¢„å¤„ç† â†’ åŠ è½½WASM â†’ é…ç½®æ ¼å¼åˆ—è¡¨</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(isSetPreset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.compressOriginImagePromise;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // =========================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // é˜¶æ®µ1ï¼šç‰¹æ®Šæ ¼å¼é¢„å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // =========================================</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¤„ç†TIFFæ ¼å¼ï¼ˆChromeä¸æ”¯æŒé¢„è§ˆï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.originMime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.tiff) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleTiffFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¤„ç†HEICæ ¼å¼ï¼ˆImageMagickä¸æ”¯æŒï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.originMime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.heic) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleHeicFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // =========================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // é˜¶æ®µ2ï¼šåŠ è½½ImageMagick WASM</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // =========================================</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">wasmUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">initializeImageMagick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ImageMagick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MagickFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@imagemagick/magick-wasm/magick.wasm?url&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@imagemagick/magick-wasm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆå§‹åŒ–WASMæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeImageMagick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wasmUrl, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.url));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.imageMagick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ImageMagick;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // =========================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // é˜¶æ®µ3ï¼šé…ç½®æ”¯æŒçš„æ ¼å¼åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // =========================================</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.targetFormatList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.jpg, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;JPG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fileSuffix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, magickFormat: MagickFormat.Jpg },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.jpeg, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;JPEG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fileSuffix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jpeg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, magickFormat: MagickFormat.Jpeg },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.png, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;PNG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fileSuffix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, magickFormat: MagickFormat.Png },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.webp, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;WEBP&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fileSuffix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;webp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, magickFormat: MagickFormat.WebP },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä»¥ä¸‹æ ¼å¼ä¸æ”¯æŒCanvasé¢„è§ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.gif, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GIF&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fileSuffix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;gif&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, magickFormat: MagickFormat.Gif },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.bmp, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;BMP&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fileSuffix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bmp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, magickFormat: MagickFormat.Bmp },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.svg, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;SVG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fileSuffix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;svg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, magickFormat: MagickFormat.Svg },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.tiff, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TIFF&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fileSuffix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tiff&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, magickFormat: MagickFormat.Tiff },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pdf, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;PDF&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fileSuffix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pdf&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, magickFormat: MagickFormat.Pdf },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ai, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;AI&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fileSuffix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ai&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, magickFormat: MagickFormat.Ai },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.init </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h3 id="_2-3-æ ¼å¼è½¬æ¢æ ¸å¿ƒé€»è¾‘" tabindex="-1">2.3 æ ¼å¼è½¬æ¢æ ¸å¿ƒé€»è¾‘ <a class="header-anchor" href="#_2-3-æ ¼å¼è½¬æ¢æ ¸å¿ƒé€»è¾‘" aria-label="Permalink to &quot;2.3 æ ¼å¼è½¬æ¢æ ¸å¿ƒé€»è¾‘&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.loading </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.tracker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">trackToolConflateStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // è·å–ç›®æ ‡æ ¼å¼é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> targetOption</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getTargetOption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.targetFormat);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // =========================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ­¥éª¤1ï¼šå°†æºå›¾ç‰‡ç»˜åˆ¶åˆ°Canvas</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // =========================================</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> urlToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.originImage,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // JPGéœ€è¦ç™½è‰²èƒŒæ™¯ï¼ˆå› ä¸ºæ²¡æœ‰é€æ˜é€šé“ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.targetFormat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;image/jpeg&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;#fff&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // =========================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ­¥éª¤2ï¼šè°ƒç”¨ImageMagick WASMè½¬æ¢</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // =========================================</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blobUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // ä»Canvasè¯»å–å›¾åƒæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.imageMagick.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFromCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvas, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // å†™å…¥ç›®æ ‡æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                image.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(targetOption?.magickFormat, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // åˆ›å»ºBlobå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([data], { type: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.targetFormat });</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blob));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // =========================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ­¥éª¤3ï¼šå¤„ç†ç»“æœå±•ç¤º</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // =========================================</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä¸æ”¯æŒCanvasé¢„è§ˆçš„æ ¼å¼ï¼Œç›´æ¥æ˜¾ç¤ºåŸå°ºå¯¸</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.skipComposeMimes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.targetMime)) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.resultImage </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blobUrl;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.showDownload </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // æ”¯æŒé¢„è§ˆçš„æ ¼å¼ï¼Œæ›´æ–°ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobUrl);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.tracker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">trackToolConflateCompleted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showErrorMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.loading </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h3 id="_2-4-å®Œæ•´æµç¨‹å›¾" tabindex="-1">2.4 å®Œæ•´æµç¨‹å›¾ <a class="header-anchor" href="#_2-4-å®Œæ•´æµç¨‹å›¾" aria-label="Permalink to &quot;2.4 å®Œæ•´æµç¨‹å›¾&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                    ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡                                  â”‚</span></span>
<span class="line"><span>â”‚                    (photo.heic)                                 â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                         â”‚</span></span>
<span class="line"><span>                         â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                 æ ¼å¼æ£€æµ‹                                         â”‚</span></span>
<span class="line"><span>â”‚  this.config.originMime = &#39;image/heic&#39;                          â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                         â”‚</span></span>
<span class="line"><span>         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>         â–¼               â–¼               â–¼</span></span>
<span class="line"><span>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>    â”‚  HEIC   â”‚    â”‚  TIFF    â”‚    â”‚  å…¶ä»–    â”‚</span></span>
<span class="line"><span>    â”‚  æ ¼å¼   â”‚    â”‚  æ ¼å¼    â”‚    â”‚  æ ¼å¼    â”‚</span></span>
<span class="line"><span>    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>         â”‚              â”‚               â”‚</span></span>
<span class="line"><span>         â–¼              â–¼               â”‚</span></span>
<span class="line"><span>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚</span></span>
<span class="line"><span>    â”‚  heic2anyåº“                 â”‚     â”‚</span></span>
<span class="line"><span>    â”‚  â†’ è½¬æ¢ä¸ºJPG               â”‚     â”‚</span></span>
<span class="line"><span>    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚</span></span>
<span class="line"><span>               â”‚              â”‚         â”‚</span></span>
<span class="line"><span>               â–¼              â–¼         â”‚</span></span>
<span class="line"><span>          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span></span>
<span class="line"><span>          â”‚  UTIF.jsåº“               â”‚ â”‚</span></span>
<span class="line"><span>          â”‚  â†’ è§£ç TIFFä¸ºRGBAåƒç´     â”‚ â”‚</span></span>
<span class="line"><span>          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span></span>
<span class="line"><span>                      â”‚                 â”‚</span></span>
<span class="line"><span>                      â–¼                 â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                 Canvasä¸­é—´æ ¼å¼                                   â”‚</span></span>
<span class="line"><span>â”‚  æ‰€æœ‰å›¾ç‰‡éƒ½è¢«è½¬æ¢ä¸ºCanvaså¯ä»¥å¤„ç†çš„æ ¼å¼                          â”‚</span></span>
<span class="line"><span>â”‚  ï¼ˆRGB/RGBAåƒç´ æ•°æ®ï¼‰                                            â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                         â”‚</span></span>
<span class="line"><span>                         â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                 åŠ è½½ImageMagick WASM                            â”‚</span></span>
<span class="line"><span>â”‚                                                                  â”‚</span></span>
<span class="line"><span>â”‚  const { ImageMagick, MagickFormat } =                          â”‚</span></span>
<span class="line"><span>â”‚      await import(&#39;@imagemagick/magick-wasm&#39;);                  â”‚</span></span>
<span class="line"><span>â”‚                                                                  â”‚</span></span>
<span class="line"><span>â”‚  await initializeImageMagick(wasmUrl);                          â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                         â”‚</span></span>
<span class="line"><span>                         â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                 ç”¨æˆ·é€‰æ‹©ç›®æ ‡æ ¼å¼                                 â”‚</span></span>
<span class="line"><span>â”‚                 (ä¾‹å¦‚: PNG)                                      â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                         â”‚</span></span>
<span class="line"><span>                         â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                 ImageMagick WASMè½¬æ¢                            â”‚</span></span>
<span class="line"><span>â”‚                                                                  â”‚</span></span>
<span class="line"><span>â”‚  ImageMagick.readFromCanvas(canvas, (image) =&gt; {                â”‚</span></span>
<span class="line"><span>â”‚      // ä»Canvasè¯»å–åƒç´ æ•°æ®                                    â”‚</span></span>
<span class="line"><span>â”‚      image.write(MagickFormat.Png, (data) =&gt; {                  â”‚</span></span>
<span class="line"><span>â”‚          // ç¼–ç ä¸ºPNGæ ¼å¼                                       â”‚</span></span>
<span class="line"><span>â”‚          // data: Uint8Array                                    â”‚</span></span>
<span class="line"><span>â”‚      });                                                         â”‚</span></span>
<span class="line"><span>â”‚  });                                                             â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                         â”‚</span></span>
<span class="line"><span>                         â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                 ç”ŸæˆBlobä¾›ä¸‹è½½                                   â”‚</span></span>
<span class="line"><span>â”‚                                                                  â”‚</span></span>
<span class="line"><span>â”‚  const blob = new Blob([data], { type: &#39;image/png&#39; });          â”‚</span></span>
<span class="line"><span>â”‚  const blobUrl = URL.createObjectURL(blob);                     â”‚</span></span>
<span class="line"><span>â”‚  // ä¸‹è½½ï¼šphoto.png                                             â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><hr><h2 id="ä¸‰ã€ç‰¹æ®Šæ ¼å¼å¤„ç†" tabindex="-1">ä¸‰ã€ç‰¹æ®Šæ ¼å¼å¤„ç† <a class="header-anchor" href="#ä¸‰ã€ç‰¹æ®Šæ ¼å¼å¤„ç†" aria-label="Permalink to &quot;ä¸‰ã€ç‰¹æ®Šæ ¼å¼å¤„ç†&quot;">â€‹</a></h2><h3 id="_3-1-tiffæ ¼å¼å¤„ç†" tabindex="-1">3.1 TIFFæ ¼å¼å¤„ç† <a class="header-anchor" href="#_3-1-tiffæ ¼å¼å¤„ç†" aria-label="Permalink to &quot;3.1 TIFFæ ¼å¼å¤„ç†&quot;">â€‹</a></h3><h4 id="_3-1-1-ä»€ä¹ˆæ˜¯tiff" tabindex="-1">3.1.1 ä»€ä¹ˆæ˜¯TIFFï¼Ÿ <a class="header-anchor" href="#_3-1-1-ä»€ä¹ˆæ˜¯tiff" aria-label="Permalink to &quot;3.1.1 ä»€ä¹ˆæ˜¯TIFFï¼Ÿ&quot;">â€‹</a></h4><p>**TIFFï¼ˆTagged Image File Formatï¼‰**æ˜¯ä¸€ç§ä¸“ä¸šå›¾åƒæ ¼å¼ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span>â”œâ”€ æ— æŸå‹ç¼©ï¼šä¿ç•™æ‰€æœ‰ç»†èŠ‚</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒå¤šé¡µï¼šä¸€ä¸ªæ–‡ä»¶å¯åŒ…å«å¤šå¼ å›¾ç‰‡ï¼ˆç±»ä¼¼PDFï¼‰</span></span>
<span class="line"><span>â”œâ”€ é«˜è‰²æ·±ï¼šæ”¯æŒ16bitã€32bit</span></span>
<span class="line"><span>â”œâ”€ ä¸“ä¸šç”¨é€”ï¼šæ‘„å½±ã€å°åˆ·ã€åŒ»å­¦å½±åƒ</span></span>
<span class="line"><span>â””â”€ æ–‡ä»¶è¾ƒå¤§ï¼šæ— å‹ç¼©ç‰ˆæœ¬å¯è¾¾å‡ ç™¾MB</span></span>
<span class="line"><span></span></span>
<span class="line"><span>é—®é¢˜ï¼š</span></span>
<span class="line"><span>â””â”€ æµè§ˆå™¨åŸç”Ÿä¸æ”¯æŒæ˜¾ç¤ºï¼</span></span>
<span class="line"><span>   Chromeã€Firefoxã€Safariéƒ½æ— æ³•ç›´æ¥æ˜¾ç¤ºTIFF</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_3-1-2-tiffæ–‡ä»¶ç»“æ„" tabindex="-1">3.1.2 TIFFæ–‡ä»¶ç»“æ„ <a class="header-anchor" href="#_3-1-2-tiffæ–‡ä»¶ç»“æ„" aria-label="Permalink to &quot;3.1.2 TIFFæ–‡ä»¶ç»“æ„&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚              TIFFæ–‡ä»¶å¤´                  â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ å­—èŠ‚åºæ ‡è¯†ï¼šIIï¼ˆIntelï¼‰æˆ– MMï¼ˆMotorolaï¼‰</span></span>
<span class="line"><span>â”‚  â”œâ”€ é­”æ•°ï¼š42ï¼ˆ0x2Aï¼‰                    â”‚</span></span>
<span class="line"><span>â”‚  â””â”€ ç¬¬ä¸€ä¸ªIFDçš„åç§»é‡                   â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                    â”‚</span></span>
<span class="line"><span>                    â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚    IFD 0ï¼ˆImage File Directoryï¼‰        â”‚</span></span>
<span class="line"><span>â”‚    ç¬¬ä¸€å¼ å›¾ç‰‡çš„å…ƒä¿¡æ¯                   â”‚</span></span>
<span class="line"><span>â”‚    â”œâ”€ å®½åº¦ï¼š4096                        â”‚</span></span>
<span class="line"><span>â”‚    â”œâ”€ é«˜åº¦ï¼š3072                        â”‚</span></span>
<span class="line"><span>â”‚    â”œâ”€ ä½æ·±ï¼š16bit                       â”‚</span></span>
<span class="line"><span>â”‚    â”œâ”€ å‹ç¼©æ–¹å¼ï¼šLZW                     â”‚</span></span>
<span class="line"><span>â”‚    â”œâ”€ åƒç´ æ•°æ®åç§»é‡ï¼š0x1000            â”‚</span></span>
<span class="line"><span>â”‚    â””â”€ ä¸‹ä¸€ä¸ªIFDåç§»é‡ â”€â”€â”€â”€â”€â”€â”€â”          â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                               â”‚</span></span>
<span class="line"><span>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                    â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚    IFD 1                                â”‚</span></span>
<span class="line"><span>â”‚    ç¬¬äºŒå¼ å›¾ç‰‡çš„å…ƒä¿¡æ¯                   â”‚</span></span>
<span class="line"><span>â”‚    â””â”€ ä¸‹ä¸€ä¸ªIFDåç§»é‡ â”€â”€â”€â”€â”€â”€â”€â”          â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                               â”‚</span></span>
<span class="line"><span>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>                    â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚    IFD 2                                â”‚</span></span>
<span class="line"><span>â”‚    ç¬¬ä¸‰å¼ å›¾ç‰‡...                        â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><strong>IFDï¼ˆImage File Directoryï¼‰ï¼š</strong></p><ul><li>æ¯ä¸ªIFDæè¿°ä¸€å¼ å›¾ç‰‡çš„ä¿¡æ¯</li><li>åŒ…å«ä¸€ç³»åˆ—æ ‡ç­¾ï¼ˆTagï¼‰ï¼šå®½åº¦ã€é«˜åº¦ã€å‹ç¼©æ–¹å¼ç­‰</li><li>æŒ‡å‘ä¸‹ä¸€ä¸ªIFDï¼Œå½¢æˆé“¾è¡¨ç»“æ„</li></ul><h4 id="_3-1-3-utif-jsè§£æåŸç†" tabindex="-1">3.1.3 UTIF.jsè§£æåŸç† <a class="header-anchor" href="#_3-1-3-utif-jsè§£æåŸç†" aria-label="Permalink to &quot;3.1.3 UTIF.jsè§£æåŸç†&quot;">â€‹</a></h4><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// UTIF.jsæ˜¯ä¸€ä¸ªçº¯JavaScriptçš„TIFFè§£æåº“</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> utif</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utif&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ­¥éª¤1ï¼šè¯»å–TIFFæ–‡ä»¶ä¸ºArrayBuffer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tiffBlob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getImageBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.originImage);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tiffArrayBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tiffBlob.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arrayBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ­¥éª¤2ï¼šè§£ææ‰€æœ‰IFDï¼ˆæ¯ä¸ªIFDä»£è¡¨ä¸€é¡µï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ifds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utif.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tiffArrayBuffer);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ifds = [IFD0, IFD1, IFD2, ...] æ•°ç»„</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ­¥éª¤3ï¼šè§£ç æŒ‡å®šé¡µçš„åƒç´ æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utif.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">decodeImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tiffArrayBuffer, ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è§£ç ç¬¬ä¸€é¡µ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ­¥éª¤4ï¼šè½¬æ¢ä¸ºRGBAæ ¼å¼ï¼ˆCanvaså¯ç”¨ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rgba</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utif.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toRGBA8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// rgba: Uint8Arrayï¼Œæ¯4å­—èŠ‚ä»£è¡¨ä¸€ä¸ªåƒç´  [R, G, B, A]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ­¥éª¤5ï¼šå†™å…¥Canvas</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> width</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].width;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].height;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">canvas.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> width;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">canvas.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> height;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imgData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createImageData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(width, height);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">imgData.data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Uint8ClampedArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rgba));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">putImageData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imgData, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h4 id="_3-1-4-insmindä¸­çš„tiffå¤„ç†" tabindex="-1">3.1.4 InsMindä¸­çš„TIFFå¤„ç† <a class="header-anchor" href="#_3-1-4-insmindä¸­çš„tiffå¤„ç†" aria-label="Permalink to &quot;3.1.4 InsMindä¸­çš„TIFFå¤„ç†&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// apps/insmind/.../convert/services.ts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleTiffFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆ›å»ºCanvas</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">canvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åŠ¨æ€å¯¼å…¥UTIFåº“ï¼ˆæŒ‰éœ€åŠ è½½ï¼Œå‡å°åˆå§‹åŒ…ä½“ç§¯ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> utif</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utif&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¹¶è¡Œæ“ä½œï¼šåˆå§‹åŒ–UTIF + è·å–TIFFæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        utif.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replaceIMG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆå§‹åŒ–</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        getImageBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.originImage),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è¯»å–ä¸ºArrayBuffer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tiffArrayBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blob.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arrayBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è§£æIFDåˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ifds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utif.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tiffArrayBuffer);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åªå¤„ç†ç¬¬ä¸€å¼ å›¾åƒï¼ˆå¤šé¡µTIFFåªå–ç¬¬ä¸€é¡µï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    utif.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">decodeImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tiffArrayBuffer, ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è½¬æ¢ä¸ºRGBAåƒç´ æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rgba</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utif.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toRGBA8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> width</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].width;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].height;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è®¾ç½®Canvaså°ºå¯¸</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    canvas.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> width;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    canvas.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> height;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆ›å»ºImageDataå¹¶å¡«å……åƒç´ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imgData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createImageData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(width, height);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    imgData.data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Uint8ClampedArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rgba));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">putImageData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imgData, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è½¬æ¢ä¸ºJPGæ ¼å¼çš„Blob URLï¼ˆç”¨äºåç»­å¤„ç†ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.originImage </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> canvasToBlobUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvas, { mime: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.jpg });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><hr><h3 id="_3-2-heicæ ¼å¼å¤„ç†" tabindex="-1">3.2 HEICæ ¼å¼å¤„ç† <a class="header-anchor" href="#_3-2-heicæ ¼å¼å¤„ç†" aria-label="Permalink to &quot;3.2 HEICæ ¼å¼å¤„ç†&quot;">â€‹</a></h3><h4 id="_3-2-1-ä»€ä¹ˆæ˜¯heic" tabindex="-1">3.2.1 ä»€ä¹ˆæ˜¯HEICï¼Ÿ <a class="header-anchor" href="#_3-2-1-ä»€ä¹ˆæ˜¯heic" aria-label="Permalink to &quot;3.2.1 ä»€ä¹ˆæ˜¯HEICï¼Ÿ&quot;">â€‹</a></h4><p>**HEICï¼ˆHigh Efficiency Image Containerï¼‰**æ˜¯iOS 11+çš„é»˜è®¤ç…§ç‰‡æ ¼å¼ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span>â”œâ”€ åŸºäºHEVCï¼ˆH.265ï¼‰è§†é¢‘ç¼–ç æŠ€æœ¯</span></span>
<span class="line"><span>â”œâ”€ å‹ç¼©ç‡æ¯”JPGé«˜50%ï¼Œè´¨é‡ç›¸åŒ</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒ16bitè‰²æ·±</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒé€æ˜é€šé“</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒå¤šå›¾ï¼ˆLive Photoï¼‰</span></span>
<span class="line"><span>â””â”€ iOSè®¾å¤‡åŸç”Ÿæ”¯æŒ</span></span>
<span class="line"><span></span></span>
<span class="line"><span>é—®é¢˜ï¼š</span></span>
<span class="line"><span>â”œâ”€ æµè§ˆå™¨ä¸æ”¯æŒæ˜¾ç¤ºï¼</span></span>
<span class="line"><span>â”œâ”€ ImageMagick WASMä¹Ÿä¸æ”¯æŒï¼ï¼ˆç‰ˆæƒåŸå› ï¼‰</span></span>
<span class="line"><span>â””â”€ éœ€è¦ç¬¬ä¸‰æ–¹åº“è½¬æ¢</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_3-2-2-ä¸ºä»€ä¹ˆimagemagickä¸æ”¯æŒheic" tabindex="-1">3.2.2 ä¸ºä»€ä¹ˆImageMagickä¸æ”¯æŒHEICï¼Ÿ <a class="header-anchor" href="#_3-2-2-ä¸ºä»€ä¹ˆimagemagickä¸æ”¯æŒheic" aria-label="Permalink to &quot;3.2.2 ä¸ºä»€ä¹ˆImageMagickä¸æ”¯æŒHEICï¼Ÿ&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HEICæ ¼å¼åŸºäºHEVCï¼ˆH.265ï¼‰ç¼–è§£ç å™¨</span></span>
<span class="line"><span>           â”‚</span></span>
<span class="line"><span>           â–¼</span></span>
<span class="line"><span>   HEVCå±äºMPEG-LAä¸“åˆ©æ± </span></span>
<span class="line"><span>           â”‚</span></span>
<span class="line"><span>           â–¼</span></span>
<span class="line"><span>   å•†ä¸šä½¿ç”¨éœ€è¦æ”¯ä»˜ä¸“åˆ©è´¹</span></span>
<span class="line"><span>           â”‚</span></span>
<span class="line"><span>           â–¼</span></span>
<span class="line"><span>   ImageMagick WASMä¸ºé¿å…ç‰ˆæƒé—®é¢˜</span></span>
<span class="line"><span>   æ²¡æœ‰åŒ…å«HEVCç¼–è§£ç å™¨</span></span>
<span class="line"><span>           â”‚</span></span>
<span class="line"><span>           â–¼</span></span>
<span class="line"><span>   éœ€è¦ä½¿ç”¨å…¶ä»–å¼€æºæ–¹æ¡ˆ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_3-2-3-heic2anyåº“åŸç†" tabindex="-1">3.2.3 heic2anyåº“åŸç† <a class="header-anchor" href="#_3-2-3-heic2anyåº“åŸç†" aria-label="Permalink to &quot;3.2.3 heic2anyåº“åŸç†&quot;">â€‹</a></h4><p><code>heic2any</code>æ˜¯ä¸€ä¸ªçº¯JavaScriptçš„HEICè§£ç åº“ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// heic2anyä½¿ç”¨libheifçš„WASMç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// libheifæ˜¯ä¸€ä¸ªå¼€æºçš„HEIF/HEICè§£ç å™¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> heic2any </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;heic2any&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾“å…¥ï¼šHEICæ ¼å¼çš„Blob</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾“å‡ºï¼šJPG/PNG/GIFæ ¼å¼çš„Blob</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> jpegBlob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> heic2any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    blob: heicBlob,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾“å…¥çš„HEICæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    toType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/jpeg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç›®æ ‡æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    quality: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// JPGè´¨é‡ï¼ˆ0-1ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>å†…éƒ¨å·¥ä½œæµç¨‹ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HEICæ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶ï¼‰</span></span>
<span class="line"><span>    â”‚</span></span>
<span class="line"><span>    â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  libheif WASM                       â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ è§£æHEICå®¹å™¨æ ¼å¼                â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ æå–HEVCè§†é¢‘å¸§                  â”‚</span></span>
<span class="line"><span>â”‚  â””â”€ HEVCè§£ç å™¨è¾“å‡ºRGBåƒç´            â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>    â”‚</span></span>
<span class="line"><span>    â–¼</span></span>
<span class="line"><span>RGBåƒç´ æ•°æ®</span></span>
<span class="line"><span>    â”‚</span></span>
<span class="line"><span>    â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  JavaScriptç¼–ç å™¨                   â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ åˆ›å»ºCanvas                      â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ å¡«å……åƒç´                         â”‚</span></span>
<span class="line"><span>â”‚  â””â”€ canvas.toBlob(&#39;image/jpeg&#39;)     â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>    â”‚</span></span>
<span class="line"><span>    â–¼</span></span>
<span class="line"><span>JPEG Blob</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_3-2-4-insmindä¸­çš„heicå¤„ç†" tabindex="-1">3.2.4 InsMindä¸­çš„HEICå¤„ç† <a class="header-anchor" href="#_3-2-4-insmindä¸­çš„heicå¤„ç†" aria-label="Permalink to &quot;3.2.4 InsMindä¸­çš„HEICå¤„ç†&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// apps/insmind/.../convert/services.ts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> heic2any </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;heic2any&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleHeicFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">canvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è·å–HEICæ–‡ä»¶çš„Blob</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> heicBlob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getImageBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.originImage);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä½¿ç”¨heic2anyè½¬æ¢ä¸ºJPEG</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> heic2any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            blob: heicBlob,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            toType: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.jpg,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è½¬æ¢ä¸ºJPEG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // åˆ›å»ºBlob URL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blobUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // åŠ è½½ä¸ºImageå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> image</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> loadImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobUrl);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">naturalWidth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">naturalHeight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // è®¾ç½®Canvaså°ºå¯¸</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        canvas.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> naturalWidth;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        canvas.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> naturalHeight;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å¡«å……ç™½è‰²èƒŒæ™¯ï¼ˆJPEGæ²¡æœ‰é€æ˜é€šé“ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ctx.fillStyle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;#fff&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillRect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, naturalWidth, naturalHeight);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ç»˜åˆ¶å›¾åƒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, naturalWidth, naturalHeight);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ›´æ–°æºå›¾ç‰‡ä¸ºè½¬æ¢åçš„JPEG</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.state.originImage </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> canvasToBlobUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvas, { mime: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.jpg });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // è½¬æ¢å¤±è´¥æ—¶çš„é”™è¯¯å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HEICè½¬æ¢å¤±è´¥:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h4 id="_3-2-5-å¤„ç†æµç¨‹æ€»ç»“" tabindex="-1">3.2.5 å¤„ç†æµç¨‹æ€»ç»“ <a class="header-anchor" href="#_3-2-5-å¤„ç†æµç¨‹æ€»ç»“" aria-label="Permalink to &quot;3.2.5 å¤„ç†æµç¨‹æ€»ç»“&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·ä¸Šä¼  photo.heic</span></span>
<span class="line"><span>        â”‚</span></span>
<span class="line"><span>        â–¼</span></span>
<span class="line"><span>    æ£€æµ‹æ ¼å¼ === &#39;image/heic&#39;</span></span>
<span class="line"><span>        â”‚</span></span>
<span class="line"><span>        â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  heic2anyè½¬æ¢                       â”‚</span></span>
<span class="line"><span>â”‚                                     â”‚</span></span>
<span class="line"><span>â”‚  HEIC â†’ libheif WASM â†’ RGBåƒç´       â”‚</span></span>
<span class="line"><span>â”‚       â†’ Canvas â†’ JPEG Blob          â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>        â”‚</span></span>
<span class="line"><span>        â–¼</span></span>
<span class="line"><span>    ç°åœ¨æ˜¯JPEGæ ¼å¼</span></span>
<span class="line"><span>        â”‚</span></span>
<span class="line"><span>        â–¼</span></span>
<span class="line"><span>    åç»­ç”¨ImageMagickè½¬æ¢</span></span>
<span class="line"><span>    ï¼ˆJPG â†’ PNG/WebP/GIF/...ï¼‰</span></span>
<span class="line"><span>        â”‚</span></span>
<span class="line"><span>        â–¼</span></span>
<span class="line"><span>    ç”¨æˆ·ä¸‹è½½ photo.png</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><hr><h2 id="å››ã€imagemagick-wasmåŸç†" tabindex="-1">å››ã€ImageMagick WASMåŸç† <a class="header-anchor" href="#å››ã€imagemagick-wasmåŸç†" aria-label="Permalink to &quot;å››ã€ImageMagick WASMåŸç†&quot;">â€‹</a></h2><h3 id="_4-1-ä»€ä¹ˆæ˜¯imagemagick" tabindex="-1">4.1 ä»€ä¹ˆæ˜¯ImageMagickï¼Ÿ <a class="header-anchor" href="#_4-1-ä»€ä¹ˆæ˜¯imagemagick" aria-label="Permalink to &quot;4.1 ä»€ä¹ˆæ˜¯ImageMagickï¼Ÿ&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ImageMagickæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å›¾åƒå¤„ç†åº“ï¼š</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å†å²ï¼š</span></span>
<span class="line"><span>â”œâ”€ 1987å¹´å¼€å§‹å¼€å‘</span></span>
<span class="line"><span>â”œâ”€ 30+å¹´æŒç»­ç»´æŠ¤</span></span>
<span class="line"><span>â””â”€ ä¸šç•Œæ ‡å‡†çš„å›¾åƒå¤„ç†å·¥å…·</span></span>
<span class="line"><span></span></span>
<span class="line"><span>åŠŸèƒ½ï¼š</span></span>
<span class="line"><span>â”œâ”€ æ ¼å¼è½¬æ¢ï¼š200+ç§æ ¼å¼äº’è½¬</span></span>
<span class="line"><span>â”œâ”€ å›¾åƒç¼–è¾‘ï¼šç¼©æ”¾ã€è£å‰ªã€æ—‹è½¬</span></span>
<span class="line"><span>â”œâ”€ ç‰¹æ•ˆå¤„ç†ï¼šæ»¤é•œã€æ¨¡ç³Šã€é”åŒ–</span></span>
<span class="line"><span>â””â”€ é¢œè‰²å¤„ç†ï¼šè‰²å½©ç©ºé—´è½¬æ¢ã€è‰²å½©æ ¡æ­£</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ä½¿ç”¨æ–¹å¼ï¼š</span></span>
<span class="line"><span>â”œâ”€ å‘½ä»¤è¡Œå·¥å…·ï¼šconvert input.jpg output.png</span></span>
<span class="line"><span>â”œâ”€ C/C++åº“ï¼šlibMagickCore, libMagickWand</span></span>
<span class="line"><span>â”œâ”€ è¯­è¨€ç»‘å®šï¼šPython(Wand), Ruby, PHP</span></span>
<span class="line"><span>â””â”€ WASMç‰ˆæœ¬ï¼š@imagemagick/magick-wasm</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_4-2-magick-wasmåº“" tabindex="-1">4.2 magick-wasmåº“ <a class="header-anchor" href="#_4-2-magick-wasmåº“" aria-label="Permalink to &quot;4.2 magick-wasmåº“&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>é¡¹ç›®ï¼šhttps://github.com/dlemstra/magick-wasm</span></span>
<span class="line"><span></span></span>
<span class="line"><span>åŸç†ï¼š</span></span>
<span class="line"><span>â”œâ”€ å°†ImageMagick C++ä»£ç ç¼–è¯‘ä¸ºWASM</span></span>
<span class="line"><span>â”œâ”€ ä½¿ç”¨Emscriptenå·¥å…·é“¾</span></span>
<span class="line"><span>â”œâ”€ ä¿ç•™æ ¸å¿ƒæ ¼å¼æ”¯æŒ</span></span>
<span class="line"><span>â””â”€ æ–‡ä»¶å¤§å°çº¦2-3MB</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ”¯æŒçš„åŠŸèƒ½ï¼š</span></span>
<span class="line"><span>â”œâ”€ æ ¼å¼è¯»å†™ï¼šJPG, PNG, GIF, WebP, TIFF, BMP...</span></span>
<span class="line"><span>â”œâ”€ å›¾åƒå˜æ¢ï¼šResize, Rotate, Crop</span></span>
<span class="line"><span>â”œâ”€ è‰²å½©å¤„ç†ï¼šColorSpace, Normalize</span></span>
<span class="line"><span>â””â”€ ç‰¹æ•ˆï¼šBlur, Sharpen, Edge</span></span>
<span class="line"><span></span></span>
<span class="line"><span>é™åˆ¶ï¼š</span></span>
<span class="line"><span>â”œâ”€ ä¸æ”¯æŒHEICï¼ˆç‰ˆæƒé—®é¢˜ï¼‰</span></span>
<span class="line"><span>â”œâ”€ ä¸æ”¯æŒRAWæ ¼å¼ï¼ˆä½“ç§¯å¤ªå¤§ï¼‰</span></span>
<span class="line"><span>â””â”€ éƒ¨åˆ†é«˜çº§ç‰¹æ•ˆä¸å¯ç”¨</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_4-3-ä½¿ç”¨æ–¹å¼è¯¦è§£" tabindex="-1">4.3 ä½¿ç”¨æ–¹å¼è¯¦è§£ <a class="header-anchor" href="#_4-3-ä½¿ç”¨æ–¹å¼è¯¦è§£" aria-label="Permalink to &quot;4.3 ä½¿ç”¨æ–¹å¼è¯¦è§£&quot;">â€‹</a></h3><h4 id="_4-3-1-åˆå§‹åŒ–" tabindex="-1">4.3.1 åˆå§‹åŒ– <a class="header-anchor" href="#_4-3-1-åˆå§‹åŒ–" aria-label="Permalink to &quot;4.3.1 åˆå§‹åŒ–&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ­¥éª¤1ï¼šå¯¼å…¥WASM URLå’Œåº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">wasmUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">initializeImageMagick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ImageMagick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MagickFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // WASMäºŒè¿›åˆ¶æ–‡ä»¶çš„URL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@imagemagick/magick-wasm/magick.wasm?url&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // JavaScriptåŒ…è£…å±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@imagemagick/magick-wasm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ­¥éª¤2ï¼šåˆå§‹åŒ–WASMæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeImageMagick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wasmUrl, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.url));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ­¤æ—¶WASMå·²ä¸‹è½½ã€ç¼–è¯‘ã€å‡†å¤‡å°±ç»ª</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ­¥éª¤3ï¼šä½¿ç”¨ImageMagickå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.imageMagick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ImageMagick;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_4-3-2-ä»canvasè¯»å–å›¾åƒ" tabindex="-1">4.3.2 ä»Canvasè¯»å–å›¾åƒ <a class="header-anchor" href="#_4-3-2-ä»canvasè¯»å–å›¾åƒ" aria-label="Permalink to &quot;4.3.2 ä»Canvasè¯»å–å›¾åƒ&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ImageMagick.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFromCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvas, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // image: MagickImageå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åŒ…å«äº†Canvasä¸­çš„å›¾åƒæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¯ä»¥è·å–å›¾åƒä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;å®½åº¦:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, image.width);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;é«˜åº¦:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, image.height);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;æ ¼å¼:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, image.format);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¯ä»¥è¿›è¡Œå›¾åƒå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç¼©æ”¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rotate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ—‹è½¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image.quality </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 85</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®¾ç½®è´¨é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å†™å…¥ç›®æ ‡æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MagickFormat.Png, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // data: Uint8Array</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="_4-3-3-å†™å…¥ç›®æ ‡æ ¼å¼" tabindex="-1">4.3.3 å†™å…¥ç›®æ ‡æ ¼å¼ <a class="header-anchor" href="#_4-3-3-å†™å…¥ç›®æ ‡æ ¼å¼" aria-label="Permalink to &quot;4.3.3 å†™å…¥ç›®æ ‡æ ¼å¼&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MagickFormat.Png, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // dataæ˜¯Uint8Arrayï¼ŒåŒ…å«PNGæ ¼å¼çš„äºŒè¿›åˆ¶æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆ›å»ºBlobå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([data], { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆ›å»ºå¯ä¸‹è½½çš„URL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blobUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blob);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¯ä»¥ç”¨äºä¸‹è½½æˆ–æ˜¾ç¤º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    downloadLink.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blobUrl;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    downloadLink.download </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;converted.png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_4-4-æ”¯æŒçš„æ ¼å¼æšä¸¾" tabindex="-1">4.4 æ”¯æŒçš„æ ¼å¼æšä¸¾ <a class="header-anchor" href="#_4-4-æ”¯æŒçš„æ ¼å¼æšä¸¾" aria-label="Permalink to &quot;4.4 æ”¯æŒçš„æ ¼å¼æšä¸¾&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// MagickFormatæšä¸¾å€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MagickFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Jpg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;JPG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Jpeg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;JPEG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Png</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PNG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    WebP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;WEBP&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Gif</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;GIF&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Bmp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;BMP&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Tiff</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;TIFF&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Svg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;SVG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Pdf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PDF&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Ai</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;AI&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... æ›´å¤šæ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_4-5-å†…éƒ¨å·¥ä½œæµç¨‹" tabindex="-1">4.5 å†…éƒ¨å·¥ä½œæµç¨‹ <a class="header-anchor" href="#_4-5-å†…éƒ¨å·¥ä½œæµç¨‹" aria-label="Permalink to &quot;4.5 å†…éƒ¨å·¥ä½œæµç¨‹&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>readFromCanvas(canvas)</span></span>
<span class="line"><span>        â”‚</span></span>
<span class="line"><span>        â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  æ­¥éª¤1ï¼šè¯»å–Canvasåƒç´               â”‚</span></span>
<span class="line"><span>â”‚                                     â”‚</span></span>
<span class="line"><span>â”‚  ctx.getImageData(0, 0, w, h)       â”‚</span></span>
<span class="line"><span>â”‚  â†’ ImageData { data: Uint8ClampedArray }  â”‚</span></span>
<span class="line"><span>â”‚  â†’ RGBAæ ¼å¼ï¼š[R,G,B,A, R,G,B,A, ...]â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>        â”‚</span></span>
<span class="line"><span>        â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  æ­¥éª¤2ï¼šå¤åˆ¶åˆ°WASMå†…å­˜              â”‚</span></span>
<span class="line"><span>â”‚                                     â”‚</span></span>
<span class="line"><span>â”‚  const ptr = Module._malloc(size);  â”‚</span></span>
<span class="line"><span>â”‚  HEAPU8.set(pixelData, ptr);        â”‚</span></span>
<span class="line"><span>â”‚  â†’ åƒç´ æ•°æ®ç°åœ¨åœ¨WASMå†…å­˜ä¸­         â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>        â”‚</span></span>
<span class="line"><span>        â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  æ­¥éª¤3ï¼šWASMå†…éƒ¨å¤„ç†                â”‚</span></span>
<span class="line"><span>â”‚                                     â”‚</span></span>
<span class="line"><span>â”‚  C++ä»£ç ï¼š                          â”‚</span></span>
<span class="line"><span>â”‚  MagickImage* img = new MagickImage();   â”‚</span></span>
<span class="line"><span>â”‚  img-&gt;read(ptr, size);              â”‚</span></span>
<span class="line"><span>â”‚  img-&gt;write(format, &amp;output);       â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>        â”‚</span></span>
<span class="line"><span>        â–¼</span></span>
<span class="line"><span>write(format, callback)</span></span>
<span class="line"><span>        â”‚</span></span>
<span class="line"><span>        â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  æ­¥éª¤4ï¼šç¼–ç ä¸ºç›®æ ‡æ ¼å¼              â”‚</span></span>
<span class="line"><span>â”‚                                     â”‚</span></span>
<span class="line"><span>â”‚  PNGç¼–ç å™¨ï¼š                        â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ æ»¤æ³¢ï¼ˆFilterï¼‰                  â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ DEFLATEå‹ç¼©                     â”‚</span></span>
<span class="line"><span>â”‚  â””â”€ æ·»åŠ PNGæ–‡ä»¶å¤´                   â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>        â”‚</span></span>
<span class="line"><span>        â–¼</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  æ­¥éª¤5ï¼šè¿”å›ç»“æœåˆ°JavaScript        â”‚</span></span>
<span class="line"><span>â”‚                                     â”‚</span></span>
<span class="line"><span>â”‚  const resultView = typed_memory_view(size, ptr);  â”‚</span></span>
<span class="line"><span>â”‚  callback(new Uint8Array(resultView));             â”‚</span></span>
<span class="line"><span>â”‚  Module._free(ptr);  // é‡Šæ”¾WASMå†…å­˜â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><hr><h2 id="äº”ã€å›¾ç‰‡æ ¼å¼åŸºç¡€çŸ¥è¯†" tabindex="-1">äº”ã€å›¾ç‰‡æ ¼å¼åŸºç¡€çŸ¥è¯† <a class="header-anchor" href="#äº”ã€å›¾ç‰‡æ ¼å¼åŸºç¡€çŸ¥è¯†" aria-label="Permalink to &quot;äº”ã€å›¾ç‰‡æ ¼å¼åŸºç¡€çŸ¥è¯†&quot;">â€‹</a></h2><h3 id="_5-1-æ ¼å¼åˆ†ç±»" tabindex="-1">5.1 æ ¼å¼åˆ†ç±» <a class="header-anchor" href="#_5-1-æ ¼å¼åˆ†ç±»" aria-label="Permalink to &quot;5.1 æ ¼å¼åˆ†ç±»&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å›¾ç‰‡æ ¼å¼åˆ†ç±»</span></span>
<span class="line"><span>â”œâ”€ ä½å›¾æ ¼å¼ï¼ˆRasterï¼‰</span></span>
<span class="line"><span>â”‚  â”œâ”€ æœ‰æŸå‹ç¼©ï¼šJPG, WebP(lossy)</span></span>
<span class="line"><span>â”‚  â”œâ”€ æ— æŸå‹ç¼©ï¼šPNG, GIF, WebP(lossless), BMP(æ— å‹ç¼©)</span></span>
<span class="line"><span>â”‚  â””â”€ ä¸“ä¸šæ ¼å¼ï¼šTIFF, RAW</span></span>
<span class="line"><span>â”‚</span></span>
<span class="line"><span>â”œâ”€ çŸ¢é‡æ ¼å¼ï¼ˆVectorï¼‰</span></span>
<span class="line"><span>â”‚  â”œâ”€ SVGï¼šåŸºäºXMLçš„çŸ¢é‡å›¾</span></span>
<span class="line"><span>â”‚  â”œâ”€ AIï¼šAdobe Illustratoræ ¼å¼</span></span>
<span class="line"><span>â”‚  â””â”€ PDFï¼šå¯åŒ…å«çŸ¢é‡å’Œä½å›¾</span></span>
<span class="line"><span>â”‚</span></span>
<span class="line"><span>â””â”€ å®¹å™¨æ ¼å¼ï¼ˆContainerï¼‰</span></span>
<span class="line"><span>   â”œâ”€ HEIF/HEICï¼šå¯åŒ…å«å¤šå¼ å›¾ç‰‡</span></span>
<span class="line"><span>   â””â”€ TIFFï¼šå¯åŒ…å«å¤šé¡µ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_5-2-å„æ ¼å¼è¯¦è§£" tabindex="-1">5.2 å„æ ¼å¼è¯¦è§£ <a class="header-anchor" href="#_5-2-å„æ ¼å¼è¯¦è§£" aria-label="Permalink to &quot;5.2 å„æ ¼å¼è¯¦è§£&quot;">â€‹</a></h3><h4 id="jpg-jpeg" tabindex="-1">JPG/JPEG <a class="header-anchor" href="#jpg-jpeg" aria-label="Permalink to &quot;JPG/JPEG&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å…¨ç§°ï¼šJoint Photographic Experts Group</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span>â”œâ”€ æœ‰æŸå‹ç¼©</span></span>
<span class="line"><span>â”œâ”€ ä¸æ”¯æŒé€æ˜</span></span>
<span class="line"><span>â”œâ”€ 16.7Mé¢œè‰²</span></span>
<span class="line"><span>â”œâ”€ é€‚åˆç…§ç‰‡</span></span>
<span class="line"><span>â””â”€ æ–‡ä»¶è¾ƒå°</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å‹ç¼©åŸç†ï¼š</span></span>
<span class="line"><span>1. RGB â†’ YCbCrè‰²å½©ç©ºé—´è½¬æ¢</span></span>
<span class="line"><span>2. è‰²åº¦å­é‡‡æ ·ï¼ˆ4:2:0ï¼‰</span></span>
<span class="line"><span>3. 8x8åƒç´ å—åˆ†å‰²</span></span>
<span class="line"><span>4. DCTå˜æ¢</span></span>
<span class="line"><span>5. é‡åŒ–ï¼ˆæœ‰æŸæ­¥éª¤ï¼‰</span></span>
<span class="line"><span>6. Huffmanç¼–ç </span></span>
<span class="line"><span></span></span>
<span class="line"><span>è´¨é‡å‚æ•°ï¼š</span></span>
<span class="line"><span>â”œâ”€ 0-100</span></span>
<span class="line"><span>â”œâ”€ 85é€šå¸¸æ˜¯æœ€ä½³å¹³è¡¡ç‚¹</span></span>
<span class="line"><span>â””â”€ &lt;60æ—¶å‡ºç°æ˜æ˜¾å¤±çœŸ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="png" tabindex="-1">PNG <a class="header-anchor" href="#png" aria-label="Permalink to &quot;PNG&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å…¨ç§°ï¼šPortable Network Graphics</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span>â”œâ”€ æ— æŸå‹ç¼©</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒé€æ˜ï¼ˆAlphaé€šé“ï¼‰</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒç´¢å¼•è‰²ï¼ˆ256è‰²ï¼‰</span></span>
<span class="line"><span>â”œâ”€ é€‚åˆå›¾æ ‡ã€æˆªå›¾</span></span>
<span class="line"><span>â””â”€ æ–‡ä»¶è¾ƒå¤§ï¼ˆå¯¹ç…§ç‰‡ï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å‹ç¼©åŸç†ï¼š</span></span>
<span class="line"><span>1. æ»¤æ³¢ï¼ˆNone, Sub, Up, Average, Paethï¼‰</span></span>
<span class="line"><span>2. DEFLATEå‹ç¼©ï¼ˆLZ77 + Huffmanï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç±»å‹ï¼š</span></span>
<span class="line"><span>â”œâ”€ PNG-8ï¼šæœ€å¤š256è‰²</span></span>
<span class="line"><span>â”œâ”€ PNG-24ï¼š24ä½çœŸå½©è‰²</span></span>
<span class="line"><span>â””â”€ PNG-32ï¼š24ä½é¢œè‰² + 8ä½é€æ˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="webp" tabindex="-1">WebP <a class="header-anchor" href="#webp" aria-label="Permalink to &quot;WebP&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å¼€å‘è€…ï¼šGoogle</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒæœ‰æŸå’Œæ— æŸ</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒé€æ˜</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒåŠ¨ç”»</span></span>
<span class="line"><span>â”œâ”€ æ¯”JPGå°25-35%</span></span>
<span class="line"><span>â”œâ”€ æ¯”PNGå°26%</span></span>
<span class="line"><span>â””â”€ ç°ä»£æµè§ˆå™¨æ”¯æŒ</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å‹ç¼©åŸç†ï¼ˆæœ‰æŸï¼‰ï¼š</span></span>
<span class="line"><span>â”œâ”€ åŸºäºVP8è§†é¢‘ç¼–ç </span></span>
<span class="line"><span>â”œâ”€ å—é¢„æµ‹</span></span>
<span class="line"><span>â”œâ”€ å˜æ¢ç¼–ç </span></span>
<span class="line"><span>â””â”€ è‡ªé€‚åº”é‡åŒ–</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å…¼å®¹æ€§ï¼š</span></span>
<span class="line"><span>â”œâ”€ Chrome 23+</span></span>
<span class="line"><span>â”œâ”€ Firefox 65+</span></span>
<span class="line"><span>â”œâ”€ Safari 14+</span></span>
<span class="line"><span>â””â”€ Edge 18+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="gif" tabindex="-1">GIF <a class="header-anchor" href="#gif" aria-label="Permalink to &quot;GIF&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å…¨ç§°ï¼šGraphics Interchange Format</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span>â”œâ”€ æœ€å¤š256è‰²</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒç®€å•é€æ˜ï¼ˆ1bitï¼‰</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒåŠ¨ç”»</span></span>
<span class="line"><span>â”œâ”€ æ— æŸå‹ç¼©ï¼ˆLZWï¼‰</span></span>
<span class="line"><span>â””â”€ é€‚åˆç®€å•å›¾å½¢ã€åŠ¨å›¾</span></span>
<span class="line"><span></span></span>
<span class="line"><span>é™åˆ¶ï¼š</span></span>
<span class="line"><span>â”œâ”€ é¢œè‰²æ•°é™åˆ¶ï¼ˆ256è‰²ï¼‰</span></span>
<span class="line"><span>â”œâ”€ é€æ˜åº¦åªæœ‰0æˆ–1</span></span>
<span class="line"><span>â””â”€ ç°ä»£æ›¿ä»£å“ï¼šWebPåŠ¨å›¾ã€APNG</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="tiff" tabindex="-1">TIFF <a class="header-anchor" href="#tiff" aria-label="Permalink to &quot;TIFF&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å…¨ç§°ï¼šTagged Image File Format</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒå¤šç§å‹ç¼©ï¼ˆæ— å‹ç¼©ã€LZWã€ZIPï¼‰</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒå¤šé¡µ</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒé«˜è‰²æ·±ï¼ˆ16/32bitï¼‰</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒCMYK</span></span>
<span class="line"><span>â”œâ”€ ä¸“ä¸šæ‘„å½±/å°åˆ·ä½¿ç”¨</span></span>
<span class="line"><span>â””â”€ æ–‡ä»¶é€šå¸¸å¾ˆå¤§</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç»“æ„ï¼š</span></span>
<span class="line"><span>â”œâ”€ æ–‡ä»¶å¤´ï¼ˆ8å­—èŠ‚ï¼‰</span></span>
<span class="line"><span>â”œâ”€ IFDï¼ˆImage File Directoryï¼‰é“¾è¡¨</span></span>
<span class="line"><span>â””â”€ åƒç´ æ•°æ®æ¡å¸¦</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="heic" tabindex="-1">HEIC <a class="header-anchor" href="#heic" aria-label="Permalink to &quot;HEIC&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å…¨ç§°ï¼šHigh Efficiency Image Container</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span>â”œâ”€ åŸºäºHEVCç¼–ç </span></span>
<span class="line"><span>â”œâ”€ æ¯”JPGå‹ç¼©ç‡é«˜50%</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒ16bitè‰²æ·±</span></span>
<span class="line"><span>â”œâ”€ æ”¯æŒé€æ˜</span></span>
<span class="line"><span>â”œâ”€ iOS 11+é»˜è®¤æ ¼å¼</span></span>
<span class="line"><span>â””â”€ æ”¯æŒLive Photo</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å…¼å®¹æ€§é—®é¢˜ï¼š</span></span>
<span class="line"><span>â”œâ”€ æµè§ˆå™¨ä¸æ”¯æŒ</span></span>
<span class="line"><span>â”œâ”€ Windowséœ€è¦æ‰©å±•</span></span>
<span class="line"><span>â””â”€ Androidéœ€è¦ä¸“é—¨è§£ç å™¨</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_5-3-æ ¼å¼é€‰æ‹©æŒ‡å—" tabindex="-1">5.3 æ ¼å¼é€‰æ‹©æŒ‡å— <a class="header-anchor" href="#_5-3-æ ¼å¼é€‰æ‹©æŒ‡å—" aria-label="Permalink to &quot;5.3 æ ¼å¼é€‰æ‹©æŒ‡å—&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                    å¦‚ä½•é€‰æ‹©å›¾ç‰‡æ ¼å¼ï¼Ÿ                        â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚  ç…§ç‰‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚</span></span>
<span class="line"><span>â”‚  â”‚                                                           â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ éœ€è¦æœ€å°ä½“ç§¯ï¼Ÿ â†’ JPG (quality 85)                       â”‚</span></span>
<span class="line"><span>â”‚  â”‚                                                           â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ éœ€è¦æ›´å°ä½“ç§¯ï¼Ÿ â†’ WebP (æœ‰æŸ)                            â”‚</span></span>
<span class="line"><span>â”‚  â”‚                                                           â”‚</span></span>
<span class="line"><span>â”‚  â””â”€ éœ€è¦æ— æŸï¼Ÿ â†’ PNGï¼ˆä½“ç§¯å¤§ï¼‰æˆ– WebPï¼ˆæ— æŸï¼‰               â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚  å›¾æ ‡/Logo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚</span></span>
<span class="line"><span>â”‚  â”‚                                                           â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ éœ€è¦é€æ˜ï¼Ÿ â†’ PNG-32 æˆ– WebP                             â”‚</span></span>
<span class="line"><span>â”‚  â”‚                                                           â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ é¢œè‰²ç®€å•ï¼Ÿ â†’ PNG-8ï¼ˆ256è‰²ï¼‰                             â”‚</span></span>
<span class="line"><span>â”‚  â”‚                                                           â”‚</span></span>
<span class="line"><span>â”‚  â””â”€ å¯ç¼©æ”¾ï¼Ÿ â†’ SVG                                          â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚  åŠ¨å›¾ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚</span></span>
<span class="line"><span>â”‚  â”‚                                                           â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ å…¼å®¹æ€§ä¼˜å…ˆï¼Ÿ â†’ GIF                                      â”‚</span></span>
<span class="line"><span>â”‚  â”‚                                                           â”‚</span></span>
<span class="line"><span>â”‚  â””â”€ è´¨é‡ä¼˜å…ˆï¼Ÿ â†’ WebPåŠ¨å›¾ æˆ– APNG                           â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚  ä¸“ä¸šå°åˆ· â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚</span></span>
<span class="line"><span>â”‚  â”‚                                                           â”‚</span></span>
<span class="line"><span>â”‚  â””â”€ TIFFï¼ˆCMYK, æ— æŸï¼‰                                      â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><hr><h2 id="å…­ã€canvas-apiçš„å±€é™æ€§" tabindex="-1">å…­ã€Canvas APIçš„å±€é™æ€§ <a class="header-anchor" href="#å…­ã€canvas-apiçš„å±€é™æ€§" aria-label="Permalink to &quot;å…­ã€Canvas APIçš„å±€é™æ€§&quot;">â€‹</a></h2><h3 id="_6-1-canvasèƒ½åšä»€ä¹ˆ" tabindex="-1">6.1 Canvasèƒ½åšä»€ä¹ˆï¼Ÿ <a class="header-anchor" href="#_6-1-canvasèƒ½åšä»€ä¹ˆ" aria-label="Permalink to &quot;6.1 Canvasèƒ½åšä»€ä¹ˆï¼Ÿ&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Canvaså¯ä»¥è¯»å–çš„æ ¼å¼ï¼ˆé€šè¿‡Imageå¯¹è±¡ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æµè§ˆå™¨åŸç”Ÿæ”¯æŒçš„æ‰€æœ‰æ ¼å¼éƒ½å¯ä»¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> img</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;photo.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… JPG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;icon.png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… PNG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;anim.gif&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… GIFï¼ˆåªæ˜¾ç¤ºç¬¬ä¸€å¸§ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;photo.webp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… WebPï¼ˆç°ä»£æµè§ˆå™¨ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;photo.tiff&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âŒ TIFFï¼ˆæµè§ˆå™¨ä¸æ”¯æŒï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;photo.heic&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âŒ HEICï¼ˆæµè§ˆå™¨ä¸æ”¯æŒï¼‰</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Canvaså¯ä»¥è¾“å‡ºçš„æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(callback, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(callback, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/jpeg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(callback, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/webp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ…ï¼ˆéƒ¨åˆ†æµè§ˆå™¨ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(callback, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/gif&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âŒ ä¸æ”¯æŒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(callback, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/tiff&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âŒ ä¸æ”¯æŒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(callback, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/svg+xml&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âŒ ä¸æ”¯æŒ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_6-2-ä¸ºä»€ä¹ˆcanvasä¸èƒ½è¾“å‡ºæ‰€æœ‰æ ¼å¼" tabindex="-1">6.2 ä¸ºä»€ä¹ˆCanvasä¸èƒ½è¾“å‡ºæ‰€æœ‰æ ¼å¼ï¼Ÿ <a class="header-anchor" href="#_6-2-ä¸ºä»€ä¹ˆcanvasä¸èƒ½è¾“å‡ºæ‰€æœ‰æ ¼å¼" aria-label="Permalink to &quot;6.2 ä¸ºä»€ä¹ˆCanvasä¸èƒ½è¾“å‡ºæ‰€æœ‰æ ¼å¼ï¼Ÿ&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Canvasè®¾è®¡ç›®çš„ï¼š</span></span>
<span class="line"><span>â”œâ”€ å®æ—¶å›¾å½¢æ¸²æŸ“</span></span>
<span class="line"><span>â”œâ”€ æ¸¸æˆã€åŠ¨ç”»</span></span>
<span class="line"><span>â”œâ”€ æ•°æ®å¯è§†åŒ–</span></span>
<span class="line"><span>â””â”€ ä¸æ˜¯å›¾åƒæ ¼å¼è½¬æ¢å·¥å…·</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æµè§ˆå™¨åªå®ç°äº†æœ€å¸¸ç”¨çš„è¾“å‡ºæ ¼å¼ï¼š</span></span>
<span class="line"><span>â”œâ”€ JPEGï¼šç…§ç‰‡</span></span>
<span class="line"><span>â”œâ”€ PNGï¼šæˆªå›¾ã€é€æ˜å›¾</span></span>
<span class="line"><span>â””â”€ WebPï¼šç°ä»£æ›¿ä»£å“</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å…¶ä»–æ ¼å¼éœ€è¦ï¼š</span></span>
<span class="line"><span>â”œâ”€ å®Œæ•´çš„ç¼–ç å™¨å®ç°</span></span>
<span class="line"><span>â”œâ”€ å¢åŠ æµè§ˆå™¨ä½“ç§¯</span></span>
<span class="line"><span>â”œâ”€ å¤šæ•°ç”¨æˆ·ä¸éœ€è¦</span></span>
<span class="line"><span>â””â”€ æ‰€ä»¥æ²¡æœ‰å†…ç½®</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_6-3-éœ€è¦imagemagickçš„åœºæ™¯" tabindex="-1">6.3 éœ€è¦ImageMagickçš„åœºæ™¯ <a class="header-anchor" href="#_6-3-éœ€è¦imagemagickçš„åœºæ™¯" aria-label="Permalink to &quot;6.3 éœ€è¦ImageMagickçš„åœºæ™¯&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚              éœ€è¦ä½¿ç”¨ImageMagick WASMçš„åœºæ™¯                  â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚  åœºæ™¯1ï¼šè¾“å‡ºCanvasä¸æ”¯æŒçš„æ ¼å¼                               â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ PNG â†’ GIF                                               â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ PNG â†’ BMP                                               â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ PNG â†’ TIFF                                              â”‚</span></span>
<span class="line"><span>â”‚  â””â”€ PNG â†’ PDF                                               â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚  åœºæ™¯2ï¼šéœ€è¦ä¸“ä¸šçš„å‹ç¼©å‚æ•°                                   â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ TIFFçš„LZWå‹ç¼©                                           â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ GIFçš„é¢œè‰²é‡åŒ–                                           â”‚</span></span>
<span class="line"><span>â”‚  â””â”€ PDFçš„çŸ¢é‡åŒ–                                             â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚  åœºæ™¯3ï¼šè‰²å½©ç©ºé—´è½¬æ¢                                         â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ RGB â†’ CMYKï¼ˆå°åˆ·ï¼‰                                      â”‚</span></span>
<span class="line"><span>â”‚  â”œâ”€ sRGB â†’ Adobe RGB                                        â”‚</span></span>
<span class="line"><span>â”‚  â””â”€ 8bit â†’ 16bit                                            â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><hr><h2 id="ä¸ƒã€æ€»ç»“ä¸æœ€ä½³å®è·µ" tabindex="-1">ä¸ƒã€æ€»ç»“ä¸æœ€ä½³å®è·µ <a class="header-anchor" href="#ä¸ƒã€æ€»ç»“ä¸æœ€ä½³å®è·µ" aria-label="Permalink to &quot;ä¸ƒã€æ€»ç»“ä¸æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="_7-1-æ ¸å¿ƒè¦ç‚¹å›é¡¾" tabindex="-1">7.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾ <a class="header-anchor" href="#_7-1-æ ¸å¿ƒè¦ç‚¹å›é¡¾" aria-label="Permalink to &quot;7.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                    æ ¼å¼è½¬æ¢æ ¸å¿ƒè¦ç‚¹                          â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚  1. ä¸‰å±‚å¤„ç†æ¶æ„                                             â”‚</span></span>
<span class="line"><span>â”‚     â”œâ”€ é¢„å¤„ç†å±‚ï¼šHEIC(heic2any), TIFF(UTIF.js)              â”‚</span></span>
<span class="line"><span>â”‚     â”œâ”€ æ ¸å¿ƒå±‚ï¼šImageMagick WASM                             â”‚</span></span>
<span class="line"><span>â”‚     â””â”€ è¾“å‡ºå±‚ï¼šBlob URL                                     â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚  2. ç‰¹æ®Šæ ¼å¼å¿…é¡»é¢„å¤„ç†                                       â”‚</span></span>
<span class="line"><span>â”‚     â”œâ”€ HEIC â†’ å…ˆè½¬JPG â†’ å†ç”¨ImageMagick                     â”‚</span></span>
<span class="line"><span>â”‚     â”œâ”€ TIFF â†’ ç”¨UTIF.jsè§£æ â†’ Canvas â†’ ImageMagick          â”‚</span></span>
<span class="line"><span>â”‚     â””â”€ å…¶ä»–æ ¼å¼å¯ä»¥ç›´æ¥å¤„ç†                                  â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚  3. Canvas APIçš„å±€é™æ€§                                       â”‚</span></span>
<span class="line"><span>â”‚     â”œâ”€ åªèƒ½è¾“å‡ºï¼šJPG, PNG, WebP                             â”‚</span></span>
<span class="line"><span>â”‚     â””â”€ å…¶ä»–æ ¼å¼å¿…é¡»ç”¨ImageMagick                            â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚  4. æ€§èƒ½è€ƒè™‘                                                 â”‚</span></span>
<span class="line"><span>â”‚     â”œâ”€ WASMåˆå§‹åŒ–ä¸€æ¬¡ï¼Œåç»­å¤ç”¨                             â”‚</span></span>
<span class="line"><span>â”‚     â”œâ”€ å¤§æ–‡ä»¶æ³¨æ„å†…å­˜é™åˆ¶                                   â”‚</span></span>
<span class="line"><span>â”‚     â””â”€ ä½¿ç”¨Web Workeré¿å…é˜»å¡UI                             â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_7-2-æŠ€æœ¯éš¾åº¦åˆ†æ" tabindex="-1">7.2 æŠ€æœ¯éš¾åº¦åˆ†æ <a class="header-anchor" href="#_7-2-æŠ€æœ¯éš¾åº¦åˆ†æ" aria-label="Permalink to &quot;7.2 æŠ€æœ¯éš¾åº¦åˆ†æ&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>éš¾ç‚¹</th><th>æè¿°</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>HEICè§£ç </strong></td><td>æµè§ˆå™¨å’ŒImageMagickéƒ½ä¸æ”¯æŒ</td><td>heic2anyåº“</td></tr><tr><td><strong>TIFFè§£æ</strong></td><td>æµè§ˆå™¨ä¸æ”¯æŒï¼Œå¤šé¡µå¤„ç†å¤æ‚</td><td>UTIF.jsåº“</td></tr><tr><td><strong>Canvasé™åˆ¶</strong></td><td>åªèƒ½è¾“å‡º3ç§æ ¼å¼</td><td>ImageMagick WASM</td></tr><tr><td><strong>WASMå†…å­˜</strong></td><td>å¤§æ–‡ä»¶å¯èƒ½å†…å­˜ä¸è¶³</td><td>åˆ†å—å¤„ç†</td></tr><tr><td><strong>æ ¼å¼å‚æ•°</strong></td><td>ä¸åŒæ ¼å¼å‚æ•°å·®å¼‚å¤§</td><td>å‚æ•°æ˜ å°„</td></tr></tbody></table><h3 id="_7-3-å®Œæ•´ä»£ç æ¶æ„" tabindex="-1">7.3 å®Œæ•´ä»£ç æ¶æ„ <a class="header-anchor" href="#_7-3-å®Œæ•´ä»£ç æ¶æ„" aria-label="Permalink to &quot;7.3 å®Œæ•´ä»£ç æ¶æ„&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ImageFormatConverter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> imageMagick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆå§‹åŒ–ï¼ˆåªéœ€ä¸€æ¬¡ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">wasmUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">initializeImageMagick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ImageMagick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@imagemagick/magick-wasm/magick.wasm?url&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@imagemagick/magick-wasm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeImageMagick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wasmUrl, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.url));</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.imageMagick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ImageMagick;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ ¼å¼è½¬æ¢ï¼ˆæ¯æ¬¡è°ƒç”¨ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> convert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sourceUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sourceMime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">targetMime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ­¥éª¤1ï¼šé¢„å¤„ç†ç‰¹æ®Šæ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> processedUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sourceUrl;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (sourceMime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;image/heic&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            processedUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleHeic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceUrl);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (sourceMime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;image/tiff&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            processedUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleTiff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sourceUrl);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ­¥éª¤2ï¼šç»˜åˆ¶åˆ°Canvas</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> urlToCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(processedUrl);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ­¥éª¤3ï¼šä½¿ç”¨ImageMagickè½¬æ¢</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.imageMagick.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFromCanvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvas, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                image.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMagickFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(targetMime), (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([data], { type: targetMime }));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // HEICé¢„å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleHeic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> jpegBlob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> heic2any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ blob, toType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/jpeg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jpegBlob);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // TIFFé¢„å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleTiff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> utif</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utif&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> arrayBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blob.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arrayBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ifds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utif.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(arrayBuffer);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        utif.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">decodeImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(arrayBuffer, ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rgba</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utif.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toRGBA8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;canvas&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        canvas.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].width;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        canvas.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ifds[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].height;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imgData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createImageData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvas.width, canvas.height);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        imgData.data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Uint8ClampedArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rgba));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">putImageData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imgData, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // MIMEç±»å‹è½¬MagickFormat</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getMagickFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">mime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;image/jpeg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;JPEG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;image/png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;PNG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;image/webp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;WEBP&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;image/gif&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GIF&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;image/bmp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;BMP&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;image/tiff&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TIFF&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> map[mime] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PNG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><h3 id="_7-4-å­¦ä¹ ä»·å€¼" tabindex="-1">7.4 å­¦ä¹ ä»·å€¼ <a class="header-anchor" href="#_7-4-å­¦ä¹ ä»·å€¼" aria-label="Permalink to &quot;7.4 å­¦ä¹ ä»·å€¼&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>é€šè¿‡å­¦ä¹ æ ¼å¼è½¬æ¢ï¼Œä½ æŒæ¡äº†ï¼š</span></span>
<span class="line"><span></span></span>
<span class="line"><span>1. WASMåº“é›†æˆ</span></span>
<span class="line"><span>   â”œâ”€ ç¬¬ä¸‰æ–¹WASMåº“çš„åŠ è½½å’Œåˆå§‹åŒ–</span></span>
<span class="line"><span>   â”œâ”€ @imagemagick/magick-wasmçš„ä½¿ç”¨</span></span>
<span class="line"><span>   â””â”€ å¼‚æ­¥æ¨¡å—å¯¼å…¥</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. ç‰¹æ®Šæ ¼å¼å¤„ç†</span></span>
<span class="line"><span>   â”œâ”€ HEICçš„ç‰ˆæƒé—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</span></span>
<span class="line"><span>   â”œâ”€ TIFFçš„å¤šé¡µç»“æ„å’Œè§£æ</span></span>
<span class="line"><span>   â””â”€ æ ¼å¼å…¼å®¹æ€§çš„å¤„ç†æ€è·¯</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3. Canvasè¿›é˜¶</span></span>
<span class="line"><span>   â”œâ”€ Canvasçš„èƒ½åŠ›è¾¹ç•Œ</span></span>
<span class="line"><span>   â”œâ”€ ImageDataä¸åƒç´ æ“ä½œ</span></span>
<span class="line"><span>   â””â”€ Blobå’ŒURLå¯¹è±¡ç®¡ç†</span></span>
<span class="line"><span></span></span>
<span class="line"><span>4. å›¾ç‰‡æ ¼å¼çŸ¥è¯†</span></span>
<span class="line"><span>   â”œâ”€ æœ‰æŸvsæ— æŸå‹ç¼©åŸç†</span></span>
<span class="line"><span>   â”œâ”€ å„æ ¼å¼çš„é€‚ç”¨åœºæ™¯</span></span>
<span class="line"><span>   â””â”€ è‰²å½©ç©ºé—´å’Œé€æ˜é€šé“</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><hr><h2 id="å…«ã€å¸¸è§é—®é¢˜è§£ç­”" tabindex="-1">å…«ã€å¸¸è§é—®é¢˜è§£ç­” <a class="header-anchor" href="#å…«ã€å¸¸è§é—®é¢˜è§£ç­”" aria-label="Permalink to &quot;å…«ã€å¸¸è§é—®é¢˜è§£ç­”&quot;">â€‹</a></h2><h3 id="q1-ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨canvasçš„toblobè¾“å‡ºæ‰€æœ‰æ ¼å¼" tabindex="-1">Q1ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨Canvasçš„toBlobè¾“å‡ºæ‰€æœ‰æ ¼å¼ï¼Ÿ <a class="header-anchor" href="#q1-ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨canvasçš„toblobè¾“å‡ºæ‰€æœ‰æ ¼å¼" aria-label="Permalink to &quot;Q1ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨Canvasçš„toBlobè¾“å‡ºæ‰€æœ‰æ ¼å¼ï¼Ÿ&quot;">â€‹</a></h3><p><strong>ç­”ï¼š</strong> Canvasåªå®ç°äº†æœ€å¸¸ç”¨çš„3ç§æ ¼å¼ï¼ˆJPGã€PNGã€WebPï¼‰ã€‚å…¶ä»–æ ¼å¼å¦‚GIFã€TIFFã€BMPç­‰éœ€è¦å®Œæ•´çš„ç¼–ç å™¨å®ç°ï¼Œæµè§ˆå™¨å‚å•†è€ƒè™‘åˆ°ï¼š</p><ul><li>å¢åŠ æµè§ˆå™¨ä½“ç§¯</li><li>å¤§å¤šæ•°ç”¨æˆ·ä¸éœ€è¦è¿™äº›æ ¼å¼</li><li>å¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹åº“å®ç°</li></ul><p>æ‰€ä»¥æ²¡æœ‰å†…ç½®è¿™äº›æ ¼å¼çš„ç¼–ç å™¨ã€‚</p><h3 id="q2-heicä¸ºä»€ä¹ˆè¿™ä¹ˆéš¾å¤„ç†" tabindex="-1">Q2ï¼šHEICä¸ºä»€ä¹ˆè¿™ä¹ˆéš¾å¤„ç†ï¼Ÿ <a class="header-anchor" href="#q2-heicä¸ºä»€ä¹ˆè¿™ä¹ˆéš¾å¤„ç†" aria-label="Permalink to &quot;Q2ï¼šHEICä¸ºä»€ä¹ˆè¿™ä¹ˆéš¾å¤„ç†ï¼Ÿ&quot;">â€‹</a></h3><p><strong>ç­”ï¼š</strong> HEICçš„å›°éš¾åœ¨äºï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HEICæ ¼å¼</span></span>
<span class="line"><span>    â”‚</span></span>
<span class="line"><span>    â”œâ”€ åŸºäºHEVCï¼ˆH.265ï¼‰è§†é¢‘ç¼–ç </span></span>
<span class="line"><span>    â”‚     â”‚</span></span>
<span class="line"><span>    â”‚     â””â”€ HEVCå±äºMPEG-LAä¸“åˆ©æ± </span></span>
<span class="line"><span>    â”‚           â”‚</span></span>
<span class="line"><span>    â”‚           â””â”€ å•†ä¸šä½¿ç”¨éœ€æ”¯ä»˜ä¸“åˆ©è´¹</span></span>
<span class="line"><span>    â”‚</span></span>
<span class="line"><span>    â”œâ”€ æµè§ˆå™¨ä¸æ„¿æ„æ”¯ä»˜ä¸“åˆ©è´¹ â†’ ä¸å†…ç½®è§£ç å™¨</span></span>
<span class="line"><span>    â”‚</span></span>
<span class="line"><span>    â””â”€ ImageMagickä¸ºé¿å…ç‰ˆæƒé—®é¢˜ â†’ ä¹Ÿä¸æ”¯æŒ</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>è§£å†³æ–¹æ¡ˆï¼š</span></span>
<span class="line"><span>    â””â”€ heic2anyåº“ä½¿ç”¨libheifï¼ˆå¼€æºHEIFè§£ç å™¨ï¼‰</span></span>
<span class="line"><span>       é€šè¿‡WASMå®ç°çº¯å‰ç«¯è§£ç </span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="q3-å¤§æ–‡ä»¶è½¬æ¢ä¼šä¸ä¼šå¡é¡¿" tabindex="-1">Q3ï¼šå¤§æ–‡ä»¶è½¬æ¢ä¼šä¸ä¼šå¡é¡¿ï¼Ÿ <a class="header-anchor" href="#q3-å¤§æ–‡ä»¶è½¬æ¢ä¼šä¸ä¼šå¡é¡¿" aria-label="Permalink to &quot;Q3ï¼šå¤§æ–‡ä»¶è½¬æ¢ä¼šä¸ä¼šå¡é¡¿ï¼Ÿ&quot;">â€‹</a></h3><p><strong>ç­”ï¼š</strong> å¯èƒ½ä¼šã€‚è§£å†³æ–¹æ¡ˆï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. Web Worker</span></span>
<span class="line"><span>   â”œâ”€ å°†WASMè°ƒç”¨æ”¾åœ¨Workerçº¿ç¨‹</span></span>
<span class="line"><span>   â””â”€ ä¸é˜»å¡ä¸»çº¿ç¨‹UI</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. è¿›åº¦åé¦ˆ</span></span>
<span class="line"><span>   â”œâ”€ æ˜¾ç¤ºåŠ è½½åŠ¨ç”»</span></span>
<span class="line"><span>   â””â”€ å‘ŠçŸ¥ç”¨æˆ·æ­£åœ¨å¤„ç†</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3. åˆ†å—å¤„ç†ï¼ˆé«˜çº§ï¼‰</span></span>
<span class="line"><span>   â”œâ”€ å°†å¤§å›¾åˆ†å‰²ä¸ºå°å—</span></span>
<span class="line"><span>   â”œâ”€ åˆ†åˆ«å¤„ç†</span></span>
<span class="line"><span>   â””â”€ æœ€ååˆå¹¶</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="q4-ä¸ºä»€ä¹ˆtifféœ€è¦å•ç‹¬ç”¨utif-js" tabindex="-1">Q4ï¼šä¸ºä»€ä¹ˆTIFFéœ€è¦å•ç‹¬ç”¨UTIF.jsï¼Ÿ <a class="header-anchor" href="#q4-ä¸ºä»€ä¹ˆtifféœ€è¦å•ç‹¬ç”¨utif-js" aria-label="Permalink to &quot;Q4ï¼šä¸ºä»€ä¹ˆTIFFéœ€è¦å•ç‹¬ç”¨UTIF.jsï¼Ÿ&quot;">â€‹</a></h3><p><strong>ç­”ï¼š</strong> TIFFæ ¼å¼çš„ç‰¹æ®Šæ€§ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. æµè§ˆå™¨ä¸æ”¯æŒ</span></span>
<span class="line"><span>   â””â”€ æ— æ³•ç”¨Imageå¯¹è±¡åŠ è½½TIFF</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. TIFFç»“æ„å¤æ‚</span></span>
<span class="line"><span>   â”œâ”€ æ”¯æŒå¤šé¡µï¼ˆç±»ä¼¼PDFï¼‰</span></span>
<span class="line"><span>   â”œâ”€ æ”¯æŒå¤šç§å‹ç¼©æ–¹å¼</span></span>
<span class="line"><span>   â”œâ”€ æ”¯æŒä¸åŒè‰²å½©ç©ºé—´</span></span>
<span class="line"><span>   â””â”€ éœ€è¦ä¸“é—¨çš„è§£æå™¨</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3. ImageMagickå¯ä»¥è¯»å–TIFF</span></span>
<span class="line"><span>   ä½†æˆ‘ä»¬éœ€è¦å…ˆåœ¨Canvasä¸­é¢„è§ˆ</span></span>
<span class="line"><span>   â””â”€ æ‰€ä»¥ç”¨UTIF.jsè§£æä¸ºåƒç´ æ•°æ®</span></span>
<span class="line"><span>      å†ç»˜åˆ¶åˆ°Canvas</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="q5-æ ¼å¼è½¬æ¢çš„æ€§èƒ½å¦‚ä½•" tabindex="-1">Q5ï¼šæ ¼å¼è½¬æ¢çš„æ€§èƒ½å¦‚ä½•ï¼Ÿ <a class="header-anchor" href="#q5-æ ¼å¼è½¬æ¢çš„æ€§èƒ½å¦‚ä½•" aria-label="Permalink to &quot;Q5ï¼šæ ¼å¼è½¬æ¢çš„æ€§èƒ½å¦‚ä½•ï¼Ÿ&quot;">â€‹</a></h3><p><strong>ç­”ï¼š</strong> å®æµ‹æ•°æ®ï¼ˆ1920x1080å›¾ç‰‡ï¼‰ï¼š</p><table tabindex="0"><thead><tr><th>è½¬æ¢ç±»å‹</th><th>çº¯JavaScript</th><th>ImageMagick WASM</th><th>æå‡</th></tr></thead><tbody><tr><td>JPG â†’ PNG</td><td>~800ms</td><td>~50ms</td><td><strong>16å€</strong></td></tr><tr><td>PNG â†’ GIF</td><td>~2000ms</td><td>~120ms</td><td><strong>17å€</strong></td></tr><tr><td>HEIC â†’ JPG</td><td>~1500ms</td><td>~200ms</td><td><strong>7å€</strong></td></tr><tr><td>TIFF â†’ PNG</td><td>~3000ms</td><td>~180ms</td><td><strong>17å€</strong></td></tr></tbody></table><hr><h2 id="ä¹ã€æ‰©å±•é˜…è¯»" tabindex="-1">ä¹ã€æ‰©å±•é˜…è¯» <a class="header-anchor" href="#ä¹ã€æ‰©å±•é˜…è¯»" aria-label="Permalink to &quot;ä¹ã€æ‰©å±•é˜…è¯»&quot;">â€‹</a></h2><h3 id="_9-1-ç›¸å…³æŠ€æœ¯æ–‡æ¡£" tabindex="-1">9.1 ç›¸å…³æŠ€æœ¯æ–‡æ¡£ <a class="header-anchor" href="#_9-1-ç›¸å…³æŠ€æœ¯æ–‡æ¡£" aria-label="Permalink to &quot;9.1 ç›¸å…³æŠ€æœ¯æ–‡æ¡£&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>InsMindé¡¹ç›®ç›¸å…³ï¼š</span></span>
<span class="line"><span>â”œâ”€ ä»C++åˆ°WASMåˆ°JavaScriptçš„å®Œæ•´æµç¨‹è¯¦è§£.md</span></span>
<span class="line"><span>â”œâ”€ å›¾ç‰‡å‹ç¼©æŠ€æœ¯æ·±åº¦è§£æï¼ˆMozJPEG/ImageQuantï¼‰</span></span>
<span class="line"><span>â””â”€ SAMä¸»ä½“é€‰æ‹©æ·±åº¦è§£æ</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å¤–éƒ¨èµ„æºï¼š</span></span>
<span class="line"><span>â”œâ”€ ImageMagickå®˜æ–¹æ–‡æ¡£ï¼šhttps://imagemagick.org/</span></span>
<span class="line"><span>â”œâ”€ magick-wasmé¡¹ç›®ï¼šhttps://github.com/dlemstra/magick-wasm</span></span>
<span class="line"><span>â”œâ”€ UTIF.jsé¡¹ç›®ï¼šhttps://github.com/nicklockwood/UTIF.js</span></span>
<span class="line"><span>â””â”€ heic2anyé¡¹ç›®ï¼šhttps://github.com/nicklockwood/heic2any</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_9-2-å›¾ç‰‡æ ¼å¼è§„èŒƒ" tabindex="-1">9.2 å›¾ç‰‡æ ¼å¼è§„èŒƒ <a class="header-anchor" href="#_9-2-å›¾ç‰‡æ ¼å¼è§„èŒƒ" aria-label="Permalink to &quot;9.2 å›¾ç‰‡æ ¼å¼è§„èŒƒ&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>JPEGè§„èŒƒï¼š</span></span>
<span class="line"><span>â”œâ”€ ITU-T T.81ï¼ˆåŸºç¡€JPEGï¼‰</span></span>
<span class="line"><span>â””â”€ ITU-T T.871ï¼ˆJPEG XLï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PNGè§„èŒƒï¼š</span></span>
<span class="line"><span>â”œâ”€ ISO/IEC 15948</span></span>
<span class="line"><span>â””â”€ W3C PNG Specification</span></span>
<span class="line"><span></span></span>
<span class="line"><span>WebPè§„èŒƒï¼š</span></span>
<span class="line"><span>â””â”€ Google WebPæ–‡æ¡£</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TIFFè§„èŒƒï¼š</span></span>
<span class="line"><span>â””â”€ TIFF 6.0 Specificationï¼ˆAdobeï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>HEIF/HEICè§„èŒƒï¼š</span></span>
<span class="line"><span>â””â”€ ISO/IEC 23008-12</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><hr><h2 id="åã€æ€»ç»“" tabindex="-1">åã€æ€»ç»“ <a class="header-anchor" href="#åã€æ€»ç»“" aria-label="Permalink to &quot;åã€æ€»ç»“&quot;">â€‹</a></h2><h3 id="_10-1-ä¸€å¥è¯æ€»ç»“" tabindex="-1">10.1 ä¸€å¥è¯æ€»ç»“ <a class="header-anchor" href="#_10-1-ä¸€å¥è¯æ€»ç»“" aria-label="Permalink to &quot;10.1 ä¸€å¥è¯æ€»ç»“&quot;">â€‹</a></h3><blockquote><p><strong>æ ¼å¼è½¬æ¢çš„æœ¬è´¨ï¼š</strong> è§£ç æºæ ¼å¼çš„åƒç´ æ•°æ® â†’ ç¼–ç ä¸ºç›®æ ‡æ ¼å¼çš„å­—èŠ‚æµ</p></blockquote><h3 id="_10-2-æ ¸å¿ƒæŠ€æœ¯æ ˆ" tabindex="-1">10.2 æ ¸å¿ƒæŠ€æœ¯æ ˆ <a class="header-anchor" href="#_10-2-æ ¸å¿ƒæŠ€æœ¯æ ˆ" aria-label="Permalink to &quot;10.2 æ ¸å¿ƒæŠ€æœ¯æ ˆ&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                    å›¾ç‰‡æ ¼å¼è½¬æ¢æŠ€æœ¯æ ˆ                        â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚</span></span>
<span class="line"><span>â”‚   â”‚   heic2any  â”‚    â”‚   UTIF.js   â”‚    â”‚  Canvas API â”‚    â”‚</span></span>
<span class="line"><span>â”‚   â”‚   (HEIC)    â”‚    â”‚   (TIFF)    â”‚    â”‚  (JPG/PNG)  â”‚    â”‚</span></span>
<span class="line"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚</span></span>
<span class="line"><span>â”‚          â”‚                  â”‚                  â”‚            â”‚</span></span>
<span class="line"><span>â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚</span></span>
<span class="line"><span>â”‚                             â”‚                               â”‚</span></span>
<span class="line"><span>â”‚                             â–¼                               â”‚</span></span>
<span class="line"><span>â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚</span></span>
<span class="line"><span>â”‚          â”‚      ImageMagick WASM               â”‚            â”‚</span></span>
<span class="line"><span>â”‚          â”‚      (10+ç§æ ¼å¼è¾“å‡º)                â”‚            â”‚</span></span>
<span class="line"><span>â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚</span></span>
<span class="line"><span>â”‚                             â”‚                               â”‚</span></span>
<span class="line"><span>â”‚                             â–¼                               â”‚</span></span>
<span class="line"><span>â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚</span></span>
<span class="line"><span>â”‚          â”‚           Blob + URL                â”‚            â”‚</span></span>
<span class="line"><span>â”‚          â”‚         (ä¸‹è½½/é¢„è§ˆ)                 â”‚            â”‚</span></span>
<span class="line"><span>â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚</span></span>
<span class="line"><span>â”‚                                                              â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_10-3-å…³é”®è®°å¿†ç‚¹" tabindex="-1">10.3 å…³é”®è®°å¿†ç‚¹ <a class="header-anchor" href="#_10-3-å…³é”®è®°å¿†ç‚¹" aria-label="Permalink to &quot;10.3 å…³é”®è®°å¿†ç‚¹&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. ä¸‰ä¸ªåº“çš„åˆ†å·¥ï¼š</span></span>
<span class="line"><span>   â”œâ”€ heic2anyï¼šå¤„ç†iOSçš„HEICæ ¼å¼</span></span>
<span class="line"><span>   â”œâ”€ UTIF.jsï¼šå¤„ç†ä¸“ä¸šçš„TIFFæ ¼å¼</span></span>
<span class="line"><span>   â””â”€ ImageMagick WASMï¼šé€šç”¨æ ¼å¼è½¬æ¢å¼•æ“</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. å¤„ç†æµç¨‹ï¼š</span></span>
<span class="line"><span>   ç‰¹æ®Šæ ¼å¼é¢„å¤„ç† â†’ Canvasä¸­è½¬ â†’ ImageMagickç¼–ç  â†’ Blobè¾“å‡º</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3. Canvasçš„å±€é™ï¼š</span></span>
<span class="line"><span>   â””â”€ åªèƒ½è¾“å‡ºJPGã€PNGã€WebPï¼Œå…¶ä»–æ ¼å¼å¿…é¡»ç”¨ImageMagick</span></span>
<span class="line"><span></span></span>
<span class="line"><span>4. æ€§èƒ½ä¼˜åŠ¿ï¼š</span></span>
<span class="line"><span>   â””â”€ WASMæ¯”çº¯JSå¿«10-20å€</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><hr><p><strong>æ–‡æ¡£ç‰ˆæœ¬ï¼š</strong> v1.0<br><strong>æœ€åæ›´æ–°ï¼š</strong> 2026-01-27<br><strong>ä½œè€…ï¼š</strong> InsMindæŠ€æœ¯å›¢é˜Ÿ</p>`,144)]))}const d=a(l,[["render",e]]);export{E as __pageData,d as default};
