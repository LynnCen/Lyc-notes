import{_ as r,C as E,c as d,o as a,a7 as t,b as p,j as e,w as i,a as n,G as h,a9 as k}from"./chunks/framework.BQb8NfN9.js";const C=JSON.parse('{"title":"æ¶ˆæ¯ç³»ç»Ÿæ·±å…¥åŸç†","description":"","frontmatter":{},"headers":[],"relativePath":"work/gd/Agent/02-æ¶ˆæ¯ç³»ç»Ÿ.md","filePath":"work/gd/Agent/02-æ¶ˆæ¯ç³»ç»Ÿ.md","lastUpdated":1770085732000}'),g={name:"work/gd/Agent/02-æ¶ˆæ¯ç³»ç»Ÿ.md"};function c(o,s,y,F,u,b){const l=E("Mermaid");return a(),d("div",null,[s[2]||(s[2]=t(`<h1 id="æ¶ˆæ¯ç³»ç»Ÿæ·±å…¥åŸç†" tabindex="-1">æ¶ˆæ¯ç³»ç»Ÿæ·±å…¥åŸç† <a class="header-anchor" href="#æ¶ˆæ¯ç³»ç»Ÿæ·±å…¥åŸç†" aria-label="Permalink to &quot;æ¶ˆæ¯ç³»ç»Ÿæ·±å…¥åŸç†&quot;">â€‹</a></h1><blockquote><p><strong>ç†è§£ AI Agent çš„é€šä¿¡è¯­è¨€</strong></p></blockquote><hr><h2 id="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯æ ¼å¼-æ·±å…¥åˆ†æ" tabindex="-1">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯æ ¼å¼ï¼Ÿï¼ˆæ·±å…¥åˆ†æï¼‰ <a class="header-anchor" href="#ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯æ ¼å¼-æ·±å…¥åˆ†æ" aria-label="Permalink to &quot;ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯æ ¼å¼ï¼Ÿï¼ˆæ·±å…¥åˆ†æï¼‰&quot;">â€‹</a></h2><h3 id="_1-1-llm-åŸç”Ÿæ ¼å¼çš„æ·±å±‚é—®é¢˜" tabindex="-1">1.1 LLM åŸç”Ÿæ ¼å¼çš„æ·±å±‚é—®é¢˜ <a class="header-anchor" href="#_1-1-llm-åŸç”Ÿæ ¼å¼çš„æ·±å±‚é—®é¢˜" aria-label="Permalink to &quot;1.1 LLM åŸç”Ÿæ ¼å¼çš„æ·±å±‚é—®é¢˜&quot;">â€‹</a></h3><h4 id="chatgpt-çš„é“¾è¡¨ç»“æ„å‰–æ" tabindex="-1">ChatGPT çš„é“¾è¡¨ç»“æ„å‰–æ <a class="header-anchor" href="#chatgpt-çš„é“¾è¡¨ç»“æ„å‰–æ" aria-label="Permalink to &quot;ChatGPT çš„é“¾è¡¨ç»“æ„å‰–æ&quot;">â€‹</a></h4><p>ä» <code>image2025-7-1_1-8-34.png</code> å¯ä»¥çœ‹åˆ° ChatGPT çš„æ¶ˆæ¯ç»“æ„ï¼š</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mapping&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;7e5528af-c94d-47a9-9d97-a940f601d491&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;7e5528af-c94d-47a99d97-a940f601d491&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;7e5528af-c94d-47a9-9d97-a940f601d491&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;author&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;system&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;content_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;parts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;finished_successfully&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;end_turn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;is_visually_hidden_from_conversation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;parent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;aaa14f48-f585-462a-a22a-cb6be5550bf6&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;children&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;aaa22956-f5e7-4e1e-ab3b-19719f2cecc1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><strong>æ·±å±‚é—®é¢˜åˆ†æ</strong>ï¼š</p><ol><li><p><strong>æ ‘å½¢ç»“æ„çš„å¤æ‚æ€§</strong></p><ul><li>ä½¿ç”¨ <code>parent</code> å’Œ <code>children</code> æ„æˆæ ‘</li><li>éœ€è¦é€’å½’éå†æ‰èƒ½è·å–å¯¹è¯å†å²</li><li>éš¾ä»¥åšèŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚&quot;è·å–æœ€è¿‘10æ¡æ¶ˆæ¯&quot;ï¼‰</li></ul></li><li><p><strong>å…ƒæ•°æ®å†—ä½™</strong></p><ul><li><code>id</code> å­—æ®µé‡å¤å‡ºç°</li><li><code>metadata</code> åµŒå¥—è¿‡æ·±</li><li><code>is_visually_hidden_from_conversation</code> è¿™ç±»å­—æ®µä¸šåŠ¡è€¦åˆ</li></ul></li><li><p><strong>å­˜å‚¨æ•ˆç‡ä½</strong></p><ul><li>JSON åµŒå¥—å±‚æ¬¡æ·±</li><li>å…³ç³»å‹æ•°æ®åº“å­˜å‚¨å›°éš¾</li><li>æŸ¥è¯¢æ€§èƒ½å·®</li></ul></li></ol><h4 id="doubao-çš„åˆ—è¡¨ç»“æ„å‰–æ" tabindex="-1">Doubao çš„åˆ—è¡¨ç»“æ„å‰–æ <a class="header-anchor" href="#doubao-çš„åˆ—è¡¨ç»“æ„å‰–æ" aria-label="Permalink to &quot;Doubao çš„åˆ—è¡¨ç»“æ„å‰–æ&quot;">â€‹</a></h4><p>ä» <code>image2025-7-1_1-9-19.png</code> å¯ä»¥çœ‹åˆ°è±†åŒ…çš„æ¶ˆæ¯ç»“æ„ï¼š</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;message_list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;conversation_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;9807447576487938&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;section_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;9807447576488194&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;10646269206109442&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;local_message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">26</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">text</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§è¯­è¨€ä¸­&quot;</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">ä½ å¥½</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;çš„è¡¨è¾¾...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;ext&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;bot_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;7338286299411103781&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;inner_app_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;582478&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;inner_platform&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">          ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>æ·±å±‚é—®é¢˜åˆ†æ</strong>ï¼š</p><ol><li><p><strong>å­—æ®µå‘½åä¸ä¸€è‡´</strong></p><ul><li><code>conversation_id</code> vs OpenAI çš„ <code>thread_id</code></li><li><code>content</code> æ˜¯å­—ç¬¦ä¸²ï¼Œéœ€è¦äºŒæ¬¡è§£æ</li><li><code>ext</code> å­—æ®µé‡Œå¡äº†å¤§é‡å†…éƒ¨å­—æ®µ</li></ul></li><li><p><strong>ä¸šåŠ¡è€¦åˆä¸¥é‡</strong></p><ul><li><code>inner_app_id</code>, <code>inner_platform</code> ç­‰å†…éƒ¨å­—æ®µæš´éœ²</li><li><code>bot_id</code> æ˜¯è±†åŒ…ç‰¹æœ‰æ¦‚å¿µ</li><li>éš¾ä»¥é€‚é…å…¶ä»– LLM</li></ul></li><li><p><strong>æ‰©å±•æ€§å·®</strong></p><ul><li>Content æ˜¯çº¯å­—ç¬¦ä¸²ï¼Œéš¾ä»¥è¡¨è¾¾å¤æ‚ç±»å‹</li><li>æ²¡æœ‰é¢„ç•™çš„æ‰©å±•å­—æ®µ</li><li>ç¼ºå°‘ç‰ˆæœ¬ç®¡ç†</li></ul></li></ol><h3 id="_1-2-ç»Ÿä¸€æ ¼å¼çš„è®¾è®¡å“²å­¦" tabindex="-1">1.2 ç»Ÿä¸€æ ¼å¼çš„è®¾è®¡å“²å­¦ <a class="header-anchor" href="#_1-2-ç»Ÿä¸€æ ¼å¼çš„è®¾è®¡å“²å­¦" aria-label="Permalink to &quot;1.2 ç»Ÿä¸€æ ¼å¼çš„è®¾è®¡å“²å­¦&quot;">â€‹</a></h3><blockquote><p>ğŸ’¡ <strong>æ ¸å¿ƒæ´å¯Ÿ</strong><br> &quot;æ„ˆå‘è§‰å¾—å‰æœŸä¸åº”è¯¥æŠŠ LLM çš„æ¶ˆæ¯æ ¼å¼å½“ä½œä¸šåŠ¡æ ¼å¼æ¥ä½¿ç”¨ã€‚é¢å‘ä¸šåŠ¡é¢†åŸŸçš„æ¶ˆæ¯æ ¼å¼ï¼ŒåŠ¿å¿…è¦è€ƒè™‘çŠ¶æ€å’Œäº¤äº’çš„é—®é¢˜ï¼Œå¦åˆ™æ— æ³•é€šè¿‡ä¸€ä¸ªæºæ¥å›æº¯æ‰€æœ‰çš„çŠ¶æ€ã€‚&quot;</p></blockquote><p><strong>è®¾è®¡å“²å­¦</strong>ï¼š</p><ol><li><p><strong>åˆ†ç¦»å…³æ³¨ç‚¹</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>LLM æ¶ˆæ¯æ ¼å¼ â† é€‚é…å±‚ â†’ ä¸šåŠ¡æ¶ˆæ¯æ ¼å¼</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>LLM æ ¼å¼ï¼šä¸“æ³¨äº LLM çš„è¾“å…¥è¾“å‡º</li><li>ä¸šåŠ¡æ ¼å¼ï¼šä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†</li><li>é€‚é…å±‚ï¼šè´Ÿè´£æ ¼å¼è½¬æ¢</li></ul></li><li><p><strong>é¢†åŸŸé©±åŠ¨è®¾è®¡</strong></p><ul><li>æ¶ˆæ¯æ ¼å¼åº”è¯¥åæ˜ ä¸šåŠ¡é¢†åŸŸæ¨¡å‹</li><li>è€Œä¸æ˜¯åæ˜  LLM çš„æŠ€æœ¯å®ç°</li></ul></li><li><p><strong>é¢å‘æœªæ¥çš„å¯æ‰©å±•æ€§</strong></p><ul><li>æ”¯æŒæ–°çš„æ¶ˆæ¯ç±»å‹</li><li>æ”¯æŒæ–°çš„ä¸šåŠ¡å­—æ®µ</li><li>æ”¯æŒç‰ˆæœ¬æ¼”è¿›</li></ul></li></ol><hr><h2 id="äºŒã€æ¶ˆæ¯æ ¼å¼è¯¦ç»†è®¾è®¡" tabindex="-1">äºŒã€æ¶ˆæ¯æ ¼å¼è¯¦ç»†è®¾è®¡ <a class="header-anchor" href="#äºŒã€æ¶ˆæ¯æ ¼å¼è¯¦ç»†è®¾è®¡" aria-label="Permalink to &quot;äºŒã€æ¶ˆæ¯æ ¼å¼è¯¦ç»†è®¾è®¡&quot;">â€‹</a></h2><h3 id="_2-1-ä¸€çº§å­—æ®µè®¾è®¡" tabindex="-1">2.1 ä¸€çº§å­—æ®µè®¾è®¡ <a class="header-anchor" href="#_2-1-ä¸€çº§å­—æ®µè®¾è®¡" aria-label="Permalink to &quot;2.1 ä¸€çº§å­—æ®µè®¾è®¡&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>å¿…éœ€</th><th>è¯´æ˜</th><th>è®¾è®¡ç†ç”±</th></tr></thead><tbody><tr><td><code>thread_id</code></td><td>varchar(100)</td><td>âœ…</td><td>ä¼šè¯ ID</td><td>å…³è”ä¼šè¯</td></tr><tr><td><code>message_id</code></td><td>varchar(100)</td><td>âœ…</td><td>æ¶ˆæ¯ ID</td><td>å…¨å±€å”¯ä¸€æ ‡è¯†</td></tr><tr><td><code>local_thread_id</code></td><td>varchar(100)</td><td>-</td><td>å‰ç«¯æœ¬åœ°ä¼šè¯ ID</td><td>æ”¯æŒç¦»çº¿å’Œä¹è§‚æ›´æ–°</td></tr><tr><td><code>local_message_id</code></td><td>varchar(100)</td><td>-</td><td>å‰ç«¯æœ¬åœ°æ¶ˆæ¯ ID</td><td>å‰ç«¯å…³è”ç”¨</td></tr><tr><td><code>role</code></td><td>string</td><td>âœ…</td><td>æ¶ˆæ¯è§’è‰²</td><td>åŒºåˆ†æ¶ˆæ¯ç±»å‹</td></tr><tr><td><code>content</code></td><td>JSON</td><td>âœ…</td><td>æ¶ˆæ¯å†…å®¹</td><td>ç»“æ„åŒ–å†…å®¹</td></tr><tr><td><code>input_skill_id</code></td><td>int</td><td>-</td><td>ç”¨æˆ·é€‰æ‹©çš„æŠ€èƒ½</td><td>ä¸šåŠ¡æ‰©å±•</td></tr><tr><td><code>attachments</code></td><td>JSON Array</td><td>-</td><td>é™„ä»¶åˆ—è¡¨</td><td>æ”¯æŒå¤šæ¨¡æ€</td></tr><tr><td><code>extra</code></td><td>JSON</td><td>-</td><td>é¢å¤–ä¿¡æ¯</td><td>é¢„ç•™æ‰©å±•å­—æ®µ</td></tr></tbody></table><h4 id="å­—æ®µè®¾è®¡æ·±åº¦åˆ†æ" tabindex="-1">å­—æ®µè®¾è®¡æ·±åº¦åˆ†æ <a class="header-anchor" href="#å­—æ®µè®¾è®¡æ·±åº¦åˆ†æ" aria-label="Permalink to &quot;å­—æ®µè®¾è®¡æ·±åº¦åˆ†æ&quot;">â€‹</a></h4><p><strong>1. ä¸ºä»€ä¹ˆæœ‰ä¸¤å¥— IDï¼Ÿ</strong></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;local_thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;local_001&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å‰ç«¯ç”Ÿæˆ</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;thread_abc123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åç«¯ç”Ÿæˆ</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;local_message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;local_msg_001&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;msg_123&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>åŸå› </strong>ï¼š</p><ul><li><strong>ç¦»çº¿æ”¯æŒ</strong>ï¼šå‰ç«¯å¯ä»¥åœ¨ç¦»çº¿æ—¶åˆ›å»ºæœ¬åœ°ä¼šè¯</li><li><strong>ä¹è§‚æ›´æ–°</strong>ï¼šå‰ç«¯ä¸éœ€è¦ç­‰å¾…åç«¯å“åº”</li><li><strong>å…³è”æ˜ å°„</strong>ï¼šå‰ç«¯å¯ä»¥é€šè¿‡æœ¬åœ° ID æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡ç«¯ ID</li><li><strong>é”™è¯¯æ¢å¤</strong>ï¼šå¦‚æœåˆ›å»ºå¤±è´¥ï¼Œå‰ç«¯å¯ä»¥é€šè¿‡æœ¬åœ° ID é‡è¯•</li></ul><p><strong>æµç¨‹</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>å‰ç«¯åˆ›å»ºæ¶ˆæ¯</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>ç”Ÿæˆ local_message_id = &quot;local_msg_001&quot;</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>ä¹è§‚æ˜¾ç¤ºï¼ˆä½¿ç”¨æœ¬åœ° IDï¼‰</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>å‘é€åˆ°åç«¯</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>åç«¯ç”Ÿæˆ message_id = &quot;msg_abc123&quot;</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>å‰ç«¯è®°å½•æ˜ å°„ï¼šlocal_msg_001 â†’ msg_abc123</span></span>
<span class="line"><span>  â†“</span></span>
<span class="line"><span>æ›´æ–°æ˜¾ç¤ºï¼ˆä½¿ç”¨æœåŠ¡ç«¯ IDï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>2. ä¸ºä»€ä¹ˆ Content æ˜¯ JSON è€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Ÿ</strong></p><p>âŒ <strong>å­—ç¬¦ä¸²æ–¹æ¡ˆ</strong>ï¼š</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;å¸®æˆ‘ç”Ÿæˆä¸€å¼ å›¾&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>é—®é¢˜ï¼š</p><ul><li>æ— æ³•åŒºåˆ†ç±»å‹ï¼ˆçº¯æ–‡æœ¬ vs å·¥å…·è°ƒç”¨ï¼‰</li><li>æ— æ³•æºå¸¦ç»“æ„åŒ–ä¿¡æ¯</li><li>å‰ç«¯éœ€è¦è§£æå­—ç¬¦ä¸²</li></ul><p>âœ… <strong>JSON æ–¹æ¡ˆ</strong>ï¼š</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;å¸®æˆ‘ç”Ÿæˆä¸€å¼ å›¾&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¼˜åŠ¿ï¼š</p><ul><li>ç±»å‹æ˜ç¡®</li><li>ç»“æ„æ¸…æ™°</li><li>æ˜“äºæ‰©å±•</li></ul><p><strong>3. ä¸ºä»€ä¹ˆéœ€è¦ extra å­—æ®µï¼Ÿ</strong></p><p><strong>è®¾è®¡åŸåˆ™</strong>ï¼š<strong>å¼€æ”¾å°é—­åŸåˆ™</strong></p><ul><li>å¯¹æ‰©å±•å¼€æ”¾</li><li>å¯¹ä¿®æ”¹å°é—­</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;extra&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;deduct_points&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ‰£é™¤ç¨¿è±†</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;execution_time_ms&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ‰§è¡Œè€—æ—¶</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;model_version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;v1.2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¨¡å‹ç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;debug_info&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è°ƒè¯•ä¿¡æ¯ï¼ˆä»…éç”Ÿäº§ç¯å¢ƒï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä¸éœ€è¦ä¿®æ”¹è¡¨ç»“æ„ï¼Œå°±å¯ä»¥æ·»åŠ æ–°å­—æ®µã€‚</p><h3 id="_2-2-role-ç±»å‹æ·±åº¦è§£æ" tabindex="-1">2.2 Role ç±»å‹æ·±åº¦è§£æ <a class="header-anchor" href="#_2-2-role-ç±»å‹æ·±åº¦è§£æ" aria-label="Permalink to &quot;2.2 Role ç±»å‹æ·±åº¦è§£æ&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>Role</th><th>ç”Ÿæˆè€…</th><th>ä½œç”¨</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><code>system</code></td><td>ç³»ç»Ÿ</td><td>è®¾å®š LLM è¡Œä¸º</td><td>é€šå¸¸æ˜¯ç¬¬ä¸€æ¡æ¶ˆæ¯</td></tr><tr><td><code>user</code></td><td>ç”¨æˆ·</td><td>ç”¨æˆ·è¾“å…¥</td><td>å¯ä»¥æºå¸¦é™„ä»¶å’ŒæŠ€èƒ½ ID</td></tr><tr><td><code>assistant</code></td><td>LLM</td><td>AI å›å¤æˆ–å·¥å…·è°ƒç”¨</td><td>å¯ä»¥åŒ…å« reasoning</td></tr><tr><td><code>function</code></td><td>å·¥å…·</td><td>å·¥å…·æ‰§è¡Œç»“æœ</td><td>æ€»æ˜¯è·Ÿåœ¨ function_call å</td></tr><tr><td><code>status</code></td><td>ç³»ç»Ÿ</td><td>çŠ¶æ€æ¶ˆæ¯</td><td>ç”¨äºæ§åˆ¶æµç¨‹</td></tr><tr><td><code>heartbeat</code></td><td>ç³»ç»Ÿ</td><td>å¿ƒè·³åŒ…</td><td>ä»…ä¿æŒè¿æ¥æ´»è·ƒ</td></tr></tbody></table><h4 id="heartbeat-çš„è®¾è®¡ç†ç”±" tabindex="-1">Heartbeat çš„è®¾è®¡ç†ç”± <a class="header-anchor" href="#heartbeat-çš„è®¾è®¡ç†ç”±" aria-label="Permalink to &quot;Heartbeat çš„è®¾è®¡ç†ç”±&quot;">â€‹</a></h4><p><strong>é—®é¢˜</strong>ï¼šSSE é•¿è¿æ¥å¯èƒ½è¢«ç½‘å…³æˆ–ä»£ç†æ–­å¼€</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå®šæœŸå‘é€å¿ƒè·³</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åç«¯æ¯ 30 ç§’å‘é€ä¸€æ¬¡å¿ƒè·³</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  send_sse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;heartbeat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content: { code: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1005</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;heartbeat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å‰ç«¯æ£€æµ‹å¿ƒè·³</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastHeartbeat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Date.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Date.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastHeartbeat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 60ç§’æ²¡æ”¶åˆ°å¿ƒè·³ï¼Œè®¤ä¸ºè¿æ¥æ–­å¼€</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    reconnect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_2-3-content-ç±»å‹æ·±åº¦è§£æ" tabindex="-1">2.3 Content ç±»å‹æ·±åº¦è§£æ <a class="header-anchor" href="#_2-3-content-ç±»å‹æ·±åº¦è§£æ" aria-label="Permalink to &quot;2.3 Content ç±»å‹æ·±åº¦è§£æ&quot;">â€‹</a></h3><h4 id="type-æšä¸¾" tabindex="-1">Type æšä¸¾ <a class="header-anchor" href="#type-æšä¸¾" aria-label="Permalink to &quot;Type æšä¸¾&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>Type</th><th>è¯´æ˜</th><th>ä½¿ç”¨åœºæ™¯</th><th>Content.text ç±»å‹</th></tr></thead><tbody><tr><td><code>plain</code></td><td>çº¯æ–‡æœ¬</td><td>ç”¨æˆ·è¾“å…¥ã€LLM å›å¤</td><td>string</td></tr><tr><td><code>function_call</code></td><td>å·¥å…·è°ƒç”¨æŒ‡ä»¤</td><td>LLM å†³å®šè°ƒç”¨å·¥å…·</td><td>FunctionCall</td></tr><tr><td><code>function_response</code></td><td>å·¥å…·æ‰§è¡Œç»“æœ</td><td>å·¥å…·è¿”å›ç»“æœ</td><td>FunctionResponse</td></tr><tr><td><code>reasoning</code></td><td>æ€è€ƒå†…å®¹</td><td>Reasoning æ¨¡å‹çš„æ€è€ƒè¿‡ç¨‹</td><td>string</td></tr></tbody></table><h4 id="functioncall-ç»“æ„" tabindex="-1">FunctionCall ç»“æ„ <a class="header-anchor" href="#functioncall-ç»“æ„" aria-label="Permalink to &quot;FunctionCall ç»“æ„&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FunctionCall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tool_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  parameters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;function_call&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;tool_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;parameters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;user_prompt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ä¸€å¼ ç‰™è†äº§å“å›¾&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;width&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;512&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;height&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;512&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;style&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ç®€çº¦&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆå‚æ•°æ˜¯ Record&lt;string, any&gt;ï¼Ÿ</strong></p><ul><li><strong>çµæ´»æ€§</strong>ï¼šä¸åŒå·¥å…·çš„å‚æ•°ä¸åŒ</li><li><strong>å¯æ‰©å±•</strong>ï¼šå·¥å…·å¯ä»¥éšæ—¶æ·»åŠ æ–°å‚æ•°</li><li><strong>JSON å…¼å®¹</strong>ï¼šå¯ä»¥ç›´æ¥åºåˆ—åŒ–</li></ul><p><strong>å‚æ•°éªŒè¯</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> validate_function_call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tool_name, parameters):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tool </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_tool(tool_name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ£€æŸ¥å¿…éœ€å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> param_name, param_def </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tool.required_params.items():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> param_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parameters:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ValueError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Missing required parameter: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">param_name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ£€æŸ¥å‚æ•°ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> param_name, param_value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parameters.items():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        param_def </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tool.params[param_name]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isinstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(param_value, param_def[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TypeError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Parameter </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">param_name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> must be </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">param_def[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="functionresponse-ç»“æ„" tabindex="-1">FunctionResponse ç»“æ„ <a class="header-anchor" href="#functionresponse-ç»“æ„" aria-label="Permalink to &quot;FunctionResponse ç»“æ„&quot;">â€‹</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FunctionResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tool_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;success&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;failed&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [key: string]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å·¥å…·ç‰¹å®šçš„è¿”å›å­—æ®µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å›¾åƒç”Ÿæˆå·¥å…·è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;function_response&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;tool_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;result&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;image_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://cdn.gaoding.com/xxx.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;task_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;task_123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;width&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;height&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æœç´¢å·¥å…·è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;function_response&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;tool_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search_templates&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;result&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;results&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;thumbnail&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;thumbnail&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;total&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;page&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆå…è®¸åŠ¨æ€å­—æ®µï¼Ÿ</strong></p><ul><li>ä¸åŒå·¥å…·è¿”å›çš„å­—æ®µä¸åŒ</li><li>é¿å…å®šä¹‰å¤§é‡çš„æ¥å£ç±»å‹</li><li>ä¿æŒçµæ´»æ€§</li></ul><hr><h2 id="ä¸‰ã€çŠ¶æ€æ¶ˆæ¯çš„æ·±å±‚è®¾è®¡" tabindex="-1">ä¸‰ã€çŠ¶æ€æ¶ˆæ¯çš„æ·±å±‚è®¾è®¡ <a class="header-anchor" href="#ä¸‰ã€çŠ¶æ€æ¶ˆæ¯çš„æ·±å±‚è®¾è®¡" aria-label="Permalink to &quot;ä¸‰ã€çŠ¶æ€æ¶ˆæ¯çš„æ·±å±‚è®¾è®¡&quot;">â€‹</a></h2><h3 id="_3-1-çŠ¶æ€æ¶ˆæ¯çš„æœ¬è´¨" tabindex="-1">3.1 çŠ¶æ€æ¶ˆæ¯çš„æœ¬è´¨ <a class="header-anchor" href="#_3-1-çŠ¶æ€æ¶ˆæ¯çš„æœ¬è´¨" aria-label="Permalink to &quot;3.1 çŠ¶æ€æ¶ˆæ¯çš„æœ¬è´¨&quot;">â€‹</a></h3><p><strong>çŠ¶æ€æ¶ˆæ¯æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ§åˆ¶æµæ¶ˆæ¯ï¼Œå®ƒä¸æºå¸¦ä¸šåŠ¡æ•°æ®ï¼Œè€Œæ˜¯æºå¸¦æ§åˆ¶æŒ‡ä»¤ã€‚</strong></p><p><strong>ç±»æ¯”</strong>ï¼š</p><ul><li>æ™®é€šæ¶ˆæ¯ = HTTP çš„ 200 å“åº”ï¼ˆæ­£å¸¸æ•°æ®ï¼‰</li><li>çŠ¶æ€æ¶ˆæ¯ = HTTP çš„ 4xx/5xx çŠ¶æ€ç ï¼ˆé”™è¯¯æ§åˆ¶ï¼‰</li></ul><p><strong>åŒºåˆ«</strong>ï¼š</p><table tabindex="0"><thead><tr><th>ç»´åº¦</th><th>æ™®é€šæ¶ˆæ¯</th><th>çŠ¶æ€æ¶ˆæ¯</th></tr></thead><tbody><tr><td><strong>æ¥æº</strong></td><td>ç”¨æˆ·æˆ– LLM</td><td>ç³»ç»Ÿ</td></tr><tr><td><strong>å†…å®¹</strong></td><td>ä¸šåŠ¡æ•°æ®</td><td>æ§åˆ¶æŒ‡ä»¤</td></tr><tr><td><strong>ä½œç”¨</strong></td><td>æ¨è¿›å¯¹è¯</td><td>æ§åˆ¶æµç¨‹</td></tr><tr><td><strong>æŒä¹…åŒ–</strong></td><td>éœ€è¦</td><td>å¯é€‰</td></tr></tbody></table><h3 id="_3-2-çŠ¶æ€ç è®¾è®¡å“²å­¦" tabindex="-1">3.2 çŠ¶æ€ç è®¾è®¡å“²å­¦ <a class="header-anchor" href="#_3-2-çŠ¶æ€ç è®¾è®¡å“²å­¦" aria-label="Permalink to &quot;3.2 çŠ¶æ€ç è®¾è®¡å“²å­¦&quot;">â€‹</a></h3><h4 id="åˆ†æ®µè®¾è®¡" tabindex="-1">åˆ†æ®µè®¾è®¡ <a class="header-anchor" href="#åˆ†æ®µè®¾è®¡" aria-label="Permalink to &quot;åˆ†æ®µè®¾è®¡&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>-1xxxï¼šåç«¯ â†’ å‰ç«¯çš„çŠ¶æ€æ¶ˆæ¯</span></span>
<span class="line"><span>-2xxxï¼šå‰ç«¯ â†’ åç«¯çš„çŠ¶æ€æ¶ˆæ¯</span></span>
<span class="line"><span>-3xxxï¼šé¢„ç•™ï¼ˆå¦‚ç³»ç»Ÿé—´é€šä¿¡ï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆåˆ†æ®µï¼Ÿ</strong></p><ol><li><strong>èŒè´£æ˜ç¡®</strong>ï¼šä¸€çœ‹å°±çŸ¥é“æ˜¯è°å‘çš„</li><li><strong>é˜²æ­¢å†²çª</strong>ï¼šä¸ä¼šæœ‰ç›¸åŒçš„çŠ¶æ€ç </li><li><strong>æ˜“äºæ‰©å±•</strong>ï¼šæ¯æ®µå†…å¯ä»¥ç‹¬ç«‹æ·»åŠ æ–°çŠ¶æ€ç </li></ol><h4 id="åç«¯çŠ¶æ€ç è¯¦è§£" tabindex="-1">åç«¯çŠ¶æ€ç è¯¦è§£ <a class="header-anchor" href="#åç«¯çŠ¶æ€ç è¯¦è§£" aria-label="Permalink to &quot;åç«¯çŠ¶æ€ç è¯¦è§£&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>Code</th><th>Message</th><th>è§¦å‘æ¡ä»¶</th><th>å‰ç«¯å¤„ç†</th><th>Extra å­—æ®µ</th></tr></thead><tbody><tr><td><code>-1001</code></td><td>åœæ­¢ç”Ÿæˆ</td><td>ç”¨æˆ·ç‚¹å‡»åœæ­¢æŒ‰é’®</td><td>åœæ­¢æ˜¾ç¤ºæµå¼è¾“å‡º</td><td><code>message_id</code>: è¢«åœæ­¢çš„æ¶ˆæ¯ ID</td></tr><tr><td><code>-1002</code></td><td>ç¨¿è±†ä¸è¶³</td><td>å·¥å…·è°ƒç”¨æ—¶ç¨¿è±†ä½™é¢ä¸è¶³</td><td>æ˜¾ç¤ºå……å€¼å¼¹çª—</td><td><code>last_tool_message_id</code>: æœ€åä¸€æ¬¡å·¥å…·è°ƒç”¨çš„æ¶ˆæ¯ ID</td></tr><tr><td><code>-1003</code></td><td>LLM/å·¥å…·è°ƒç”¨è¶…é™</td><td>å•è½®å¯¹è¯è°ƒç”¨æ¬¡æ•°è¶…è¿‡é˜ˆå€¼</td><td>æç¤ºç”¨æˆ·ï¼Œç»“æŸå¯¹è¯</td><td>-</td></tr><tr><td><code>-1004</code></td><td>Token è¿‡æœŸ</td><td>ç”¨æˆ· Token å¤±æ•ˆ</td><td>é™é»˜åˆ·æ–°æˆ–å¼•å¯¼ç™»å½•</td><td>-</td></tr><tr><td><code>-1005</code></td><td>å¿ƒè·³</td><td>å®šæ—¶å‘é€</td><td>æ›´æ–°æœ€åå¿ƒè·³æ—¶é—´</td><td>-</td></tr><tr><td><code>-1006</code></td><td>ä¸­æ–­å¹¶æ’¤å›</td><td>Guardrails æ£€æµ‹åˆ°é£é™©</td><td>æ’¤å›å·²è¾“å‡ºçš„æ¶ˆæ¯ï¼Œæ˜¾ç¤ºè­¦å‘Š</td><td><code>revoked_message_id</code>: è¢«æ’¤å›çš„æ¶ˆæ¯ ID</td></tr><tr><td><code>-1007</code></td><td>å®‰å…¨é¢„è­¦</td><td>Guardrails æ£€æµ‹åˆ°è½»å¾®é£é™©</td><td>æ˜¾ç¤ºè­¦å‘Šæç¤ºï¼Œä½†ä¸ä¸­æ–­</td><td><code>warning</code>: è­¦å‘Šä¿¡æ¯</td></tr></tbody></table><h4 id="å‰ç«¯çŠ¶æ€ç è¯¦è§£" tabindex="-1">å‰ç«¯çŠ¶æ€ç è¯¦è§£ <a class="header-anchor" href="#å‰ç«¯çŠ¶æ€ç è¯¦è§£" aria-label="Permalink to &quot;å‰ç«¯çŠ¶æ€ç è¯¦è§£&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>Code</th><th>Message</th><th>è§¦å‘æ¡ä»¶</th><th>åç«¯å¤„ç†</th><th>Extra å­—æ®µ</th></tr></thead><tbody><tr><td><code>-2001</code></td><td>æ¢å¤æ‰§è¡Œ</td><td>ç”¨æˆ·å……å€¼åç‚¹å‡»&quot;ç»§ç»­&quot;</td><td>æ£€æµ‹åˆ°æ­¤æ¶ˆæ¯ï¼Œä»ä¸­æ–­ç‚¹æ¢å¤</td><td><code>message_id</code>: ä¸­æ–­æ—¶çš„çŠ¶æ€æ¶ˆæ¯ ID</td></tr></tbody></table><h3 id="_3-3-çŠ¶æ€æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸ" tabindex="-1">3.3 çŠ¶æ€æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸ <a class="header-anchor" href="#_3-3-çŠ¶æ€æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸ" aria-label="Permalink to &quot;3.3 çŠ¶æ€æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸ&quot;">â€‹</a></h3><h4 id="_1002-ç¨¿è±†ä¸è¶³-çš„å®Œæ•´æµç¨‹" tabindex="-1">-1002ï¼ˆç¨¿è±†ä¸è¶³ï¼‰çš„å®Œæ•´æµç¨‹ <a class="header-anchor" href="#_1002-ç¨¿è±†ä¸è¶³-çš„å®Œæ•´æµç¨‹" aria-label="Permalink to &quot;-1002ï¼ˆç¨¿è±†ä¸è¶³ï¼‰çš„å®Œæ•´æµç¨‹&quot;">â€‹</a></h4>`,83)),(a(),p(k,null,{default:i(()=>[h(l,{id:"mermaid-1102",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20Frontend%0A%20%20%20%20participant%20Agent%0A%20%20%20%20participant%20Tool%0A%20%20%20%20participant%20Payment%0A%0A%20%20%20%20User-%3E%3EFrontend%3A%20%E7%94%9F%E6%88%90%E5%9B%BE%E7%89%87%0A%20%20%20%20Frontend-%3E%3EAgent%3A%20POST%20%2Fchat%20(input_skill_id%3D2)%0A%20%20%20%20Agent-%3E%3EAgent%3A%20%E6%A3%80%E6%9F%A5%20LLM%20%E8%B0%83%E7%94%A8%E6%AC%A1%E6%95%B0%0A%20%20%20%20Agent-%3E%3ETool%3A%20%E8%B0%83%E7%94%A8%E5%9B%BE%E5%83%8F%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7%0A%20%20%20%20Tool-%3E%3ETool%3A%20%E6%A3%80%E6%9F%A5%E7%A8%BF%E8%B1%86%E4%BD%99%E9%A2%9D%0A%20%20%20%20Tool--%3E%3EAgent%3A%20%E7%A8%BF%E8%B1%86%E4%B8%8D%E8%B6%B3%0A%20%20%20%20%0A%20%20%20%20Note%20over%20Agent%3A%20%E7%94%9F%E6%88%90%E7%8A%B6%E6%80%81%E6%B6%88%E6%81%AF%20-1002%0A%20%20%20%20%0A%20%20%20%20Agent-%3E%3EFrontend%3A%20SSE%3A%20status%20message%20(-1002)%0A%20%20%20%20Frontend-%3E%3EUser%3A%20%E6%98%BE%E7%A4%BA%E5%85%85%E5%80%BC%E5%BC%B9%E7%AA%97%0A%20%20%20%20%0A%20%20%20%20User-%3E%3EPayment%3A%20%E5%AE%8C%E6%88%90%E5%85%85%E5%80%BC%0A%20%20%20%20Payment--%3E%3EFrontend%3A%20%E5%85%85%E5%80%BC%E6%88%90%E5%8A%9F%E5%9B%9E%E8%B0%83%0A%20%20%20%20%0A%20%20%20%20Frontend-%3E%3EAgent%3A%20POST%20%2Fchat%20(resume%3Dtrue%2C%20status%20message%20-2001)%0A%20%20%20%20%0A%20%20%20%20Note%20over%20Agent%3A%20%E6%A3%80%E6%B5%8B%E5%88%B0%E6%81%A2%E5%A4%8D%E6%B6%88%E6%81%AF%0A%20%20%20%20%0A%20%20%20%20Agent-%3E%3EAgent%3A%20%E4%BB%8E%20messages%20%E4%B8%AD%E6%89%BE%E5%88%B0%E4%B8%AD%E6%96%AD%E7%82%B9%0A%20%20%20%20Agent-%3E%3ETool%3A%20%E9%87%8D%E8%AF%95%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%0A%20%20%20%20Tool-%3E%3ETool%3A%20%E6%A3%80%E6%9F%A5%E7%A8%BF%E8%B1%86%E4%BD%99%E9%A2%9D%EF%BC%88%E5%85%85%E5%80%BC%E5%90%8E%E4%BD%99%E9%A2%9D%E5%85%85%E8%B6%B3%EF%BC%89%0A%20%20%20%20Tool--%3E%3EAgent%3A%20%E8%B0%83%E7%94%A8%E6%88%90%E5%8A%9F%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%9B%BE%E7%89%87%0A%20%20%20%20Agent-%3E%3EFrontend%3A%20SSE%3A%20function%20response%0A%20%20%20%20Frontend-%3E%3EUser%3A%20%E6%98%BE%E7%A4%BA%E7%94%9F%E6%88%90%E7%BB%93%E6%9E%9C%0A"})]),fallback:i(()=>s[0]||(s[0]=[n(" Loading... ")])),_:1})),s[3]||(s[3]=e("h4",{id:"_1006-ä¸­æ–­å¹¶æ’¤å›-çš„å®Œæ•´æµç¨‹",tabindex:"-1"},[n("-1006ï¼ˆä¸­æ–­å¹¶æ’¤å›ï¼‰çš„å®Œæ•´æµç¨‹ "),e("a",{class:"header-anchor",href:"#_1006-ä¸­æ–­å¹¶æ’¤å›-çš„å®Œæ•´æµç¨‹","aria-label":'Permalink to "-1006ï¼ˆä¸­æ–­å¹¶æ’¤å›ï¼‰çš„å®Œæ•´æµç¨‹"'},"â€‹")],-1)),(a(),p(k,null,{default:i(()=>[h(l,{id:"mermaid-1106",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20Frontend%0A%20%20%20%20participant%20Agent%0A%20%20%20%20participant%20LLM%0A%20%20%20%20participant%20Guardrails%0A%0A%20%20%20%20User-%3E%3EFrontend%3A%20%E7%94%9F%E6%88%90%E6%95%8F%E6%84%9F%E5%86%85%E5%AE%B9%0A%20%20%20%20Frontend-%3E%3EAgent%3A%20POST%20%2Fchat%0A%20%20%20%20Agent-%3E%3ELLM%3A%20%E8%B0%83%E7%94%A8%20LLM%0A%20%20%20%20%0A%20%20%20%20Note%20over%20LLM%3A%20%E5%BC%80%E5%A7%8B%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA%0A%20%20%20%20%0A%20%20%20%20LLM--%3E%3EAgent%3A%20chunk%201%3A%20%22%E8%BF%99%E6%98%AF...%22%0A%20%20%20%20Agent-%3E%3EFrontend%3A%20SSE%3A%20chunk%201%0A%20%20%20%20Frontend-%3E%3EUser%3A%20%E6%98%BE%E7%A4%BA%20%22%E8%BF%99%E6%98%AF...%22%0A%20%20%20%20%0A%20%20%20%20LLM--%3E%3EAgent%3A%20chunk%202%3A%20%22%E4%B8%80%E4%B8%AA%E5%85%B3%E4%BA%8E...%22%0A%20%20%20%20Agent-%3E%3EGuardrails%3A%20%E6%A3%80%E6%B5%8B%E5%86%85%E5%AE%B9%0A%20%20%20%20Guardrails--%3E%3EAgent%3A%20%E6%A3%80%E6%B5%8B%E5%88%B0%E9%AB%98%E9%A3%8E%E9%99%A9%E8%AF%8D%E6%B1%87%0A%20%20%20%20%0A%20%20%20%20Note%20over%20Agent%3A%20%E7%94%9F%E6%88%90%E7%8A%B6%E6%80%81%E6%B6%88%E6%81%AF%20-1006%0A%20%20%20%20%0A%20%20%20%20Agent-%3E%3EFrontend%3A%20SSE%3A%20status%20message%20(-1006)%0A%20%20%20%20Frontend-%3E%3EFrontend%3A%20%E6%92%A4%E5%9B%9E%E5%B7%B2%E6%98%BE%E7%A4%BA%E7%9A%84%E5%86%85%E5%AE%B9%0A%20%20%20%20Frontend-%3E%3EUser%3A%20%E6%98%BE%E7%A4%BA%E8%AD%A6%E5%91%8A%EF%BC%9A%22%E5%86%85%E5%AE%B9%E5%8C%85%E5%90%AB%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%22%0A%20%20%20%20%0A%20%20%20%20Note%20over%20Agent%3A%20%E7%BB%88%E6%AD%A2%20LLM%20%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA%0A"})]),fallback:i(()=>s[1]||(s[1]=[n(" Loading... ")])),_:1})),s[4]||(s[4]=t(`<h3 id="_3-4-çŠ¶æ€æ¶ˆæ¯çš„å­˜å‚¨ç­–ç•¥" tabindex="-1">3.4 çŠ¶æ€æ¶ˆæ¯çš„å­˜å‚¨ç­–ç•¥ <a class="header-anchor" href="#_3-4-çŠ¶æ€æ¶ˆæ¯çš„å­˜å‚¨ç­–ç•¥" aria-label="Permalink to &quot;3.4 çŠ¶æ€æ¶ˆæ¯çš„å­˜å‚¨ç­–ç•¥&quot;">â€‹</a></h3><p><strong>é—®é¢˜</strong>ï¼šçŠ¶æ€æ¶ˆæ¯éœ€è¦æŒä¹…åŒ–å—ï¼Ÿ</p><p><strong>ç­”æ¡ˆ</strong>ï¼šåˆ†æƒ…å†µ</p><table tabindex="0"><thead><tr><th>çŠ¶æ€ç </th><th>æ˜¯å¦æŒä¹…åŒ–</th><th>ç†ç”±</th></tr></thead><tbody><tr><td><code>-1001</code> (åœæ­¢)</td><td>âœ… æ˜¯</td><td>éœ€è¦è®°å½•ç”¨æˆ·ä¸»åŠ¨åœæ­¢çš„å†å²</td></tr><tr><td><code>-1002</code> (ç¨¿è±†ä¸è¶³)</td><td>âœ… æ˜¯</td><td>éœ€è¦æ¢å¤ï¼Œå¿…é¡»æŒä¹…åŒ–</td></tr><tr><td><code>-1003</code> (è¶…é™)</td><td>âœ… æ˜¯</td><td>éœ€è¦è®°å½•è¶…é™åŸå› </td></tr><tr><td><code>-1004</code> (Tokenè¿‡æœŸ)</td><td>âŒ å¦</td><td>ä¸´æ—¶çŠ¶æ€ï¼Œä¸éœ€è¦æŒä¹…åŒ–</td></tr><tr><td><code>-1005</code> (å¿ƒè·³)</td><td>âŒ å¦</td><td>ä»…ä¿æŒè¿æ¥ï¼Œä¸éœ€è¦æŒä¹…åŒ–</td></tr><tr><td><code>-1006</code> (æ’¤å›)</td><td>âœ… æ˜¯</td><td>éœ€è¦å®¡è®¡è¿½è¸ª</td></tr><tr><td><code>-1007</code> (é¢„è­¦)</td><td>âœ… æ˜¯</td><td>éœ€è¦åˆ†æé¢„è­¦è®°å½•</td></tr><tr><td><code>-2001</code> (æ¢å¤)</td><td>âœ… æ˜¯</td><td>éœ€è¦è®°å½•æ¢å¤æ“ä½œ</td></tr></tbody></table><p><strong>å®ç°</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PERSISTENT_STATUS_CODES</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1002</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1003</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1006</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1007</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2001</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> should_persist_status_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PERSISTENT_STATUS_CODES</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> send_status_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(thread_id, code, message, extra</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    status_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: thread_id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: code,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: message,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;extra&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: extra </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">or</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å‘é€ç»™å‰ç«¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    send_sse(status_msg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ ¹æ®çŠ¶æ€ç å†³å®šæ˜¯å¦æŒä¹…åŒ–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> should_persist_status_message(code):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        message_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> generate_message_id()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        status_msg[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message_id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        save_message(status_msg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status_msg</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><hr><h2 id="å››ã€qwen-agent-çš„æ¶ˆæ¯è½¬æ¢æœºåˆ¶" tabindex="-1">å››ã€Qwen-Agent çš„æ¶ˆæ¯è½¬æ¢æœºåˆ¶ <a class="header-anchor" href="#å››ã€qwen-agent-çš„æ¶ˆæ¯è½¬æ¢æœºåˆ¶" aria-label="Permalink to &quot;å››ã€Qwen-Agent çš„æ¶ˆæ¯è½¬æ¢æœºåˆ¶&quot;">â€‹</a></h2><h3 id="_4-1-convert-fncall-to-text-å‡½æ•°è§£æ" tabindex="-1">4.1 convert_fncall_to_text å‡½æ•°è§£æ <a class="header-anchor" href="#_4-1-convert-fncall-to-text-å‡½æ•°è§£æ" aria-label="Permalink to &quot;4.1 convert_fncall_to_text å‡½æ•°è§£æ&quot;">â€‹</a></h3><p>ä»ç°æœ‰æ–‡æ¡£å¯ä»¥çœ‹åˆ°ï¼ŒQwen-Agent éœ€è¦è½¬æ¢æ¶ˆæ¯æ ¼å¼ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> convert_fncall_to_text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(messages: List[Dict]) -&gt; List[Dict]:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    å°† function æ¶ˆæ¯è½¬æ¢ä¸º assistant æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    åŸå› ï¼š</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    1. ä¾¿äºå‰ç«¯å±•ç¤º</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    2. LLM æ›´å®¹æ˜“ç†è§£</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    3. ä¿æŒå¯¹è¯çš„è¿ç»­æ€§</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    new_messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        role, content, reasoning_content, name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            msg[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ROLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], msg[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            msg.get(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">REASONING_CONTENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            msg.get(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å»é™¤å¤šä½™çš„ç©ºç™½å’Œä»£ç å—æ ‡è®°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).lstrip(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).rstrip().replace(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;\`\`\`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # system æˆ– user æ¶ˆæ¯ç›´æ¥è¿½åŠ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> role </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SYSTEM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            new_messages.append({</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                ROLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: role, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                CONTENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: content, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # assistant æ¶ˆæ¯ï¼šæ·»åŠ  thinking å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        elif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> role </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ASSISTANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reasoning_content:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                thought </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reasoning_content</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> THINK</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.format(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">thought</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">thought) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # åˆå¹¶è¿ç»­çš„ assistant æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(new_messages) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                new_messages[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ROLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ASSISTANT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                new_messages[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                new_messages[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                new_messages.append({</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    ROLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: role, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    CONTENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: content, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # function æ¶ˆæ¯ï¼šåˆå¹¶åˆ°æœ€åä¸€æ¡ assistant æ¶ˆæ¯ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        elif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> role </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> FUNCTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> new_messages[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ROLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ASSISTANT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            new_messages[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TOOL_OUTPUT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.format(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                tool_output</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TypeError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Unknown role: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">role</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> new_messages</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h3 id="_4-2-ä¸ºä»€ä¹ˆéœ€è¦è½¬æ¢" tabindex="-1">4.2 ä¸ºä»€ä¹ˆéœ€è¦è½¬æ¢ï¼Ÿ <a class="header-anchor" href="#_4-2-ä¸ºä»€ä¹ˆéœ€è¦è½¬æ¢" aria-label="Permalink to &quot;4.2 ä¸ºä»€ä¹ˆéœ€è¦è½¬æ¢ï¼Ÿ&quot;">â€‹</a></h3><p><strong>åœºæ™¯ 1ï¼šå±•ç¤ºå·¥å…·è°ƒç”¨ç»“æœ</strong></p><p><strong>è½¬æ¢å‰</strong>ï¼š</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;tool_call&gt;{...}&lt;/tool_call&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;function&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{&#39;result&#39;: &#39;success&#39;, &#39;image_url&#39;: &#39;...&#39;}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å‰ç«¯éœ€è¦ï¼š</p><ol><li>è§£æ assistant æ¶ˆæ¯æ‰¾åˆ°å·¥å…·è°ƒç”¨</li><li>å…³è” function æ¶ˆæ¯</li><li>åˆ†åˆ«æ¸²æŸ“</li></ol><p><strong>è½¬æ¢å</strong>ï¼š</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;âœ±âœ±âœ± Start calling tool </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">generate_image</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{...}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">âœ±âœ±âœ±</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">âœ±âœ±âœ± Finished tool calling.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{&#39;result&#39;: &#39;success&#39;, &#39;image_url&#39;: &#39;...&#39;}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">âœ±âœ±âœ±&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å‰ç«¯åªéœ€è¦ï¼š</p><ol><li>æ¸²æŸ“ assistant æ¶ˆæ¯</li><li>è§£æç‰¹æ®Šæ ‡è®° <code>âœ±âœ±âœ±</code></li><li>åˆ†åŒºåŸŸæ˜¾ç¤º</li></ol><p><strong>åœºæ™¯ 2ï¼šLLM ç†è§£ä¸Šä¸‹æ–‡</strong></p><p>LLM åœ¨ç†è§£å†å²å¯¹è¯æ—¶ï¼Œæ›´å®¹æ˜“ç†è§£ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Assistant: æˆ‘æ­£åœ¨è°ƒç”¨å·¥å…· generate_image ç”Ÿæˆå›¾ç‰‡...</span></span>
<span class="line"><span>[å·¥å…·æ‰§è¡Œç»“æœï¼šæˆåŠŸï¼Œå›¾ç‰‡URL: xxx]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è€Œä¸æ˜¯ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Message 1: &lt;tool_call&gt;{...}&lt;/tool_call&gt;</span></span>
<span class="line"><span>Message 2: (role=function) {...}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_4-3-å·¥å…·è°ƒç”¨æ¨¡æ¿" tabindex="-1">4.3 å·¥å…·è°ƒç”¨æ¨¡æ¿ <a class="header-anchor" href="#_4-3-å·¥å…·è°ƒç”¨æ¨¡æ¿" aria-label="Permalink to &quot;4.3 å·¥å…·è°ƒç”¨æ¨¡æ¿&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å·¥å…·è°ƒç”¨å¼€å§‹æ ‡è®°</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TOOL_CALL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">âœ±âœ±âœ± Start calling tool &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{tool_name}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{tool_input}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">âœ±âœ±âœ±</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å·¥å…·æ‰§è¡Œç»“æœæ ‡è®°</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TOOL_OUTPUT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">âœ±âœ±âœ± Finished tool calling.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{tool_output}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">âœ±âœ±âœ±</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Thinking å†…å®¹æ ‡è®°</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">THINK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;think&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{thought}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/think&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ç‰¹æ®Šæ ‡è®°ï¼Ÿ</strong></p><ol><li><strong>æ˜“äºè§£æ</strong>ï¼š<code>âœ±âœ±âœ±</code> ä¸ä¼šå‡ºç°åœ¨æ­£å¸¸æ–‡æœ¬ä¸­</li><li><strong>æ˜“äºè¯†åˆ«</strong>ï¼šè§†è§‰ä¸Šæ˜æ˜¾</li><li><strong>æ˜“äºç§»é™¤</strong>ï¼šå‰ç«¯å¯ä»¥é€‰æ‹©éšè—è¿™äº›æ ‡è®°</li></ol><hr><h2 id="äº”ã€æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†" tabindex="-1">äº”ã€æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸç®¡ç† <a class="header-anchor" href="#äº”ã€æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†" aria-label="Permalink to &quot;äº”ã€æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†&quot;">â€‹</a></h2><h3 id="_5-1-æ¶ˆæ¯çš„åˆ›å»º" tabindex="-1">5.1 æ¶ˆæ¯çš„åˆ›å»º <a class="header-anchor" href="#_5-1-æ¶ˆæ¯çš„åˆ›å»º" aria-label="Permalink to &quot;5.1 æ¶ˆæ¯çš„åˆ›å»º&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> create_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    thread_id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    role: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    input_skill_id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    attachments: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    extra: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;åˆ›å»ºæ¶ˆæ¯&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 1. ç”Ÿæˆæ¶ˆæ¯ ID</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> generate_message_id()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 2. éªŒè¯æ¶ˆæ¯æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    validate_message(role, content)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 3. æ„é€ æ¶ˆæ¯å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: thread_id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;message_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: message_id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: role,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: content,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;input_skill_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: input_skill_id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;attachments&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: attachments </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">or</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;extra&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: extra </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">or</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;created_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: datetime.utcnow().isoformat()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 4. æŒä¹…åŒ–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    save_message(message)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 5. è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="_5-2-æ¶ˆæ¯çš„æŸ¥è¯¢" tabindex="-1">5.2 æ¶ˆæ¯çš„æŸ¥è¯¢ <a class="header-anchor" href="#_5-2-æ¶ˆæ¯çš„æŸ¥è¯¢" aria-label="Permalink to &quot;5.2 æ¶ˆæ¯çš„æŸ¥è¯¢&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è·å–ä¼šè¯çš„æ‰€æœ‰æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_messages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(thread_id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; List[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.query(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;SELECT * FROM messages WHERE thread_id = ? ORDER BY created_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread_id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è·å–ä¼šè¯çš„æœ€è¿‘Næ¡æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_recent_messages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(thread_id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, limit: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; List[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.query(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;SELECT * FROM messages WHERE thread_id = ? &quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;ORDER BY created_at DESC LIMIT ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread_id, limit</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è·å–ç‰¹å®šè§’è‰²çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_messages_by_role</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(thread_id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, role: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; List[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.query(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;SELECT * FROM messages WHERE thread_id = ? AND role = ? &quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;ORDER BY created_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        thread_id, role</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_5-3-æ¶ˆæ¯çš„ç»Ÿè®¡" tabindex="-1">5.3 æ¶ˆæ¯çš„ç»Ÿè®¡ <a class="header-anchor" href="#_5-3-æ¶ˆæ¯çš„ç»Ÿè®¡" aria-label="Permalink to &quot;5.3 æ¶ˆæ¯çš„ç»Ÿè®¡&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»Ÿè®¡ LLM è°ƒç”¨æ¬¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> count_llm_calls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(messages: List[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;role&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;assistant&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           msg[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;plain&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;function_call&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»Ÿè®¡å·¥å…·è°ƒç”¨æ¬¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> count_tool_calls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(messages: List[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;role&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;function&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ£€æŸ¥æ˜¯å¦éœ€è¦æ¢å¤</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> needs_resume</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(messages: List[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> False</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    last_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æœ€åä¸€æ¡æ¶ˆæ¯æ˜¯æ¢å¤çŠ¶æ€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (last_msg[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;role&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;status&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        last_msg[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> False</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><hr><h2 id="å…­ã€æœ€ä½³å®è·µ" tabindex="-1">å…­ã€æœ€ä½³å®è·µ <a class="header-anchor" href="#å…­ã€æœ€ä½³å®è·µ" aria-label="Permalink to &quot;å…­ã€æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="_6-1-æ¶ˆæ¯è®¾è®¡åŸåˆ™" tabindex="-1">6.1 æ¶ˆæ¯è®¾è®¡åŸåˆ™ <a class="header-anchor" href="#_6-1-æ¶ˆæ¯è®¾è®¡åŸåˆ™" aria-label="Permalink to &quot;6.1 æ¶ˆæ¯è®¾è®¡åŸåˆ™&quot;">â€‹</a></h3><p><strong>DOï¼š</strong></p><ul><li>âœ… ä½¿ç”¨ç±»å‹å®‰å…¨çš„ Content ç»“æ„</li><li>âœ… è®°å½•å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</li><li>âœ… ä¿æŒæ¶ˆæ¯ä¸å¯å˜</li><li>âœ… ä½¿ç”¨çŠ¶æ€æ¶ˆæ¯ä¼ é€’æ§åˆ¶æŒ‡ä»¤</li><li>âœ… è®°å½•æœ¬åœ° ID ä¾¿äºå‰ç«¯å…³è”</li></ul><p><strong>DON&#39;Tï¼š</strong></p><ul><li>âŒ ç›´æ¥ä½¿ç”¨ LLM çš„æ¶ˆæ¯æ ¼å¼</li><li>âŒ åœ¨æ¶ˆæ¯ä¸­å­˜å‚¨å¤§æ–‡ä»¶</li><li>âŒ ä¿®æ”¹å·²åˆ›å»ºçš„æ¶ˆæ¯</li><li>âŒ åœ¨ content ä¸­åµŒå¥—è¿‡æ·±</li></ul><h3 id="_6-2-å‰ç«¯å¤„ç†å»ºè®®" tabindex="-1">6.2 å‰ç«¯å¤„ç†å»ºè®® <a class="header-anchor" href="#_6-2-å‰ç«¯å¤„ç†å»ºè®®" aria-label="Permalink to &quot;6.2 å‰ç«¯å¤„ç†å»ºè®®&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¶ˆæ¯å¤„ç†å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessageHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (message.role) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleUserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;assistant&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleAssistantMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;function&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleFunctionMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;status&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleStatusMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;heartbeat&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleHeartbeat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  handleStatusMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StatusMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">extra</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message.content</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (code) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1002</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç¨¿è±†ä¸è¶³</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showRechargeDialog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(extra.last_tool_message_id)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        break</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1004</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Token è¿‡æœŸ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">refreshToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">retryLastRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        break</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1006</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸­æ–­å¹¶æ’¤å›</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">revokeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(extra.revoked_message_id)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showWarning</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        break</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1007</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å®‰å…¨é¢„è­¦</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showWarningBanner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        break</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><hr><h2 id="ä¸ƒã€æ€»ç»“" tabindex="-1">ä¸ƒã€æ€»ç»“ <a class="header-anchor" href="#ä¸ƒã€æ€»ç»“" aria-label="Permalink to &quot;ä¸ƒã€æ€»ç»“&quot;">â€‹</a></h2><h3 id="_7-1-æ ¸å¿ƒè®¾è®¡" tabindex="-1">7.1 æ ¸å¿ƒè®¾è®¡ <a class="header-anchor" href="#_7-1-æ ¸å¿ƒè®¾è®¡" aria-label="Permalink to &quot;7.1 æ ¸å¿ƒè®¾è®¡&quot;">â€‹</a></h3><ol><li><strong>ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼</strong>ï¼šä¸ä¾èµ–ç‰¹å®š LLM</li><li><strong>çŠ¶æ€æ¶ˆæ¯</strong>ï¼šå®ç°ä¸­æ–­ä¸æ¢å¤</li><li><strong>ç±»å‹å®‰å…¨</strong>ï¼šContent ç»“æ„åŒ–è®¾è®¡</li><li><strong>å¯æ‰©å±•</strong>ï¼šExtra å­—æ®µé¢„ç•™æ‰©å±•</li></ol><h3 id="_7-2-å…³é”®ç‰¹æ€§" tabindex="-1">7.2 å…³é”®ç‰¹æ€§ <a class="header-anchor" href="#_7-2-å…³é”®ç‰¹æ€§" aria-label="Permalink to &quot;7.2 å…³é”®ç‰¹æ€§&quot;">â€‹</a></h3><ul><li>âœ… æ”¯æŒå¤šç§æ¶ˆæ¯ç±»å‹</li><li>âœ… å®Œæ•´çš„çŠ¶æ€ç ä½“ç³»</li><li>âœ… ä¸­æ–­ä¸æ¢å¤æœºåˆ¶</li><li>âœ… æœ¬åœ° ID å…³è”</li><li>âœ… æŠ€èƒ½é€‰æ‹©</li><li>âœ… é™„ä»¶æ”¯æŒ</li></ul><hr><p><em>æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0</em><br><em>æœ€åæ›´æ–°ï¼š2026-01-26</em></p><p><strong>ä¸Šä¸€ç¯‡</strong>ï¼š<a href="./01-åŸºç¡€æ¦‚å¿µ">â† åŸºç¡€æ¦‚å¿µ</a> | <strong>ä¸‹ä¸€ç¯‡</strong>ï¼š<a href="./03-å·¥å…·è°ƒç”¨">å·¥å…·è°ƒç”¨ â†’</a></p>`,56))])}const B=r(g,[["render",c]]);export{C as __pageData,B as default};
