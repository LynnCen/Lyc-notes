import{_ as e,C as h,c as t,o as n,a8 as i,b as k,j as s,w as l,a as r,G as E,a9 as d}from"./chunks/framework.n3V8RT1I.js";const C=JSON.parse('{"title":"AI对话系统深度解析（二）：消息流转与处理机制","description":"","frontmatter":{},"headers":[],"relativePath":"project/gaoding/AI+智能设计编辑器架构文档/AI对话系统深度解析-2-消息流转.md","filePath":"project/gaoding/AI+智能设计编辑器架构文档/AI对话系统深度解析-2-消息流转.md","lastUpdated":1768921608000}'),c={name:"project/gaoding/AI+智能设计编辑器架构文档/AI对话系统深度解析-2-消息流转.md"};function g(y,a,b,u,F,m){const p=h("Mermaid");return n(),t("div",null,[a[1]||(a[1]=i("",7)),(n(),k(d,null,{default:l(()=>[E(p,{id:"mermaid-41",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20U%20as%20%E7%94%A8%E6%88%B7%0A%20%20%20%20participant%20CS%20as%20ChatSender%0A%20%20%20%20participant%20UM%20as%20useMessage%0A%20%20%20%20participant%20MH%20as%20MessageHandler%0A%20%20%20%20participant%20SSE%20as%20SSEManager%0A%20%20%20%20participant%20API%20as%20Dify%20API%0A%20%20%20%20participant%20BL%20as%20Bubble.List%0A%0A%20%20%20%20U-%3E%3ECS%3A%20%E8%BE%93%E5%85%A5%22%E7%94%9F%E6%88%90logo%22%0A%20%20%20%20CS-%3E%3EUM%3A%20emit('submit'%2C%20userMessage)%0A%20%20%20%20UM-%3E%3EMH%3A%20initialize()%0A%20%20%20%20UM-%3E%3ESSE%3A%20connect(messages)%0A%20%20%20%20SSE-%3E%3EAPI%3A%20POST%20%2Fchat%20(SSE)%0A%20%20%20%20%0A%20%20%20%20loop%20SSE%E6%B5%81%0A%20%20%20%20%20%20%20%20API--%3E%3ESSE%3A%20push%20chunk%0A%20%20%20%20%20%20%20%20SSE-%3E%3EMH%3A%20handleSSEMessage(data)%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20alt%20assistant%20%2B%20text%0A%20%20%20%20%20%20%20%20%20%20%20%20MH-%3E%3EMH%3A%20updateMessage()%0A%20%20%20%20%20%20%20%20else%20assistant%20%2B%20function_call%0A%20%20%20%20%20%20%20%20%20%20%20%20MH-%3E%3EMH%3A%20trackConsecutiveFunctionCall()%0A%20%20%20%20%20%20%20%20%20%20%20%20MH-%3E%3EU%3A%20emit('addImage')%20%E2%86%92%20%E5%88%9B%E5%BB%BA%E5%8D%A0%E4%BD%8D%0A%20%20%20%20%20%20%20%20else%20function%20%2B%20function_response%0A%20%20%20%20%20%20%20%20%20%20%20%20MH-%3E%3EMH%3A%20checkConsecutiveFunctionResponse()%0A%20%20%20%20%20%20%20%20%20%20%20%20MH-%3E%3EMH%3A%20createTools()%0A%20%20%20%20%20%20%20%20%20%20%20%20MH-%3E%3EU%3A%20emit('replaceImage')%20%E2%86%92%20%E6%9B%BF%E6%8D%A2%E5%8D%A0%E4%BD%8D%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20MH-%3E%3EMH%3A%20filterMessages()%0A%20%20%20%20%20%20%20%20MH-%3E%3EUM%3A%20observer.onUpdate(filtered)%0A%20%20%20%20%20%20%20%20UM-%3E%3EBL%3A%20setMessages()%0A%20%20%20%20%20%20%20%20BL-%3E%3EU%3A%20%E6%B8%B2%E6%9F%93UI%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20API--%3E%3ESSE%3A%20done%0A%20%20%20%20SSE-%3E%3EMH%3A%20handleSSEMessage(%5B%5D%2C%20true)%0A%20%20%20%20MH-%3E%3EUM%3A%20observer.onSuccess(messages)%0A"})]),fallback:l(()=>a[0]||(a[0]=[r(" Loading... ")])),_:1})),a[2]||(a[2]=i("",65)),a[3]||(a[3]=s("table",{tabindex:"0"},[s("thead",null,[s("tr",null,[s("th",null,"时间"),s("th",null,"事件"),s("th",null,"MessageHandler状态")])]),s("tbody",null,[s("tr",null,[s("td",null,"T+0ms"),s("td",null,"用户点击发送"),s("td",null,"messages: [userMsg]")]),s("tr",null,[s("td",null,"T+200ms"),s("td",null,"SSE连接建立"),s("td",null,"-")]),s("tr",null,[s("td",null,"T+500ms"),s("td",null,"收到assistant+text"),s("td",null,"messages: [userMsg, aiText]")]),s("tr",null,[s("td",null,"T+1000ms"),s("td",null,"收到call_1"),s("td",{"expected:1,":"","received:0":""},"tracking:")]),s("tr",null,[s("td",null,"T+1020ms"),s("td",null,"收到call_2"),s("td",{"expected:2,":"","received:0":""},"tracking:")]),s("tr",null,[s("td",null,"T+1040ms"),s("td",null,"收到call_3"),s("td",{"expected:3,":"","received:0":""},"tracking:")]),s("tr",null,[s("td",null,"T+1060ms"),s("td",null,"收到call_4"),s("td",{"expected:4,":"","received:0":""},"tracking:")]),s("tr",null,[s("td",null,"T+3000ms"),s("td",null,"收到resp_1"),s("td",{"expected:4,":"","received:1":""},"tracking:")]),s("tr",null,[s("td",null,"T+5000ms"),s("td",null,"收到resp_2"),s("td",{"expected:4,":"","received:2":""},"tracking:")]),s("tr",null,[s("td",null,"T+7000ms"),s("td",null,"收到resp_3"),s("td",{"expected:4,":"","received:3":""},"tracking:")]),s("tr",null,[s("td",null,"T+9000ms"),s("td",null,"收到resp_4"),s("td",{"expected:4,":"","received:4,":"","completed:":"",true:""},"tracking:")])])],-1)),a[4]||(a[4]=i("",33))])}const A=e(c,[["render",g]]);export{C as __pageData,A as default};
