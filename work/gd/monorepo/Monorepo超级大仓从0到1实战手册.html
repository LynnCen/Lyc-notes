<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Monorepo 超级大仓从0到1实战手册 | 林岑LynnCenʘᴗʘ </title>
    <meta name="description" content="林岑的成长之路，包含前端常用知识、源码阅读笔记、各种奇淫技巧、日常提效工具等">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/Lyc-notes/assets/style.BrpGh1Np.css" as="style">
    <link rel="preload stylesheet" href="/Lyc-notes/vp-icons.css" as="style">
    
    <script type="module" src="/Lyc-notes/assets/app.C3R6uMsT.js"></script>
    <link rel="preload" href="/Lyc-notes/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/framework.BQb8NfN9.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/theme.b30oNGhQ.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/katex.CfZphoad.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/dagre-QXRM2OYR.D0ti8XCW.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/c4Diagram-7JAJQR3Y.DobSuc1n.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/flowDiagram-27HWSH3H.Bz00dcCW.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/erDiagram-MVNNDQJ5.Bo7eVCEq.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/gitGraphDiagram-ISGV4O2Y.eCBkJBhJ.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/ganttDiagram-ZCE2YOAT.hoQjBQEZ.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/infoDiagram-SDLB2J7W.B5d3c0PM.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/pieDiagram-OC6WZ2SS.BWjD9lww.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/quadrantDiagram-OT6RYTWY.C4in2xHy.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/xychartDiagram-NJOKMNIP.DYWQOB0l.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/requirementDiagram-BKGUWIPO.CSIjyKpr.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/sequenceDiagram-C4VUPXDP.SqgCLWA3.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/classDiagram-L266QK7U.pq4rc1sZ.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/classDiagram-v2-JRWBCVM4.pq4rc1sZ.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/stateDiagram-BVO7J4UH.DQmz1Rwc.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/stateDiagram-v2-WR7QG3WR.BTsqsRlc.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/journeyDiagram-D7A75E63.BpsYXsN3.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/timeline-definition-WOTUTIAU.BojOBRCN.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/mindmap-definition-7EJRZJGK.rTN7577D.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/kanban-definition-4GR4SRK3.BwYpjr7q.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/sankeyDiagram-3MH5UGAL.Ay8KWN6J.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/diagram-DHSB7DV3.ebOGdAU8.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/blockDiagram-5JUZGEFE.CWkztzD0.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/architectureDiagram-PQUH6ZAG.CdpXDlVj.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/Lyc-notes/assets/work_gd_monorepo_Monorepo超级大仓从0到1实战手册.md.9TEM0SoJ.lean.js">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/favicon.ico">
    <link rel="mask-icon" href="/favicon.ico" color="#3eaf7c">
    <meta name="msapplication-TileImage" content="/favicon.ico">
    <meta name="msapplication-TileColor" content="#000000">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-31cf94a2><!--[--><!--]--><!--[--><span tabindex="-1" data-v-36ec46eb></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-36ec46eb>Skip to content</a><!--]--><!----><header class="VPNav" data-v-31cf94a2 data-v-3b3dad99><div class="VPNavBar" data-v-3b3dad99 data-v-6355aac1><div class="wrapper" data-v-6355aac1><div class="container" data-v-6355aac1><div class="title" data-v-6355aac1><div class="VPNavBarTitle" data-v-6355aac1 data-v-1dbe09c3><a class="title" href="/Lyc-notes/" data-v-1dbe09c3><!--[--><!--]--><!--[--><img class="VPImage logo" src="/Lyc-notes/LynnCenLogo.png" alt data-v-26416d94><!--]--><span data-v-1dbe09c3>林岑LynnCenʘᴗʘ </span><!--[--><!--[--><!--[--><!--[--><img class="visitor" src="https://visitor-badge.laobi.icu/badge?page_id=LynnCen.Lyc-notes" onerror="this.style.display=&#39;none&#39;" data-v-41535482><!--]--><!--]--><!--]--><!--]--></a></div></div><div class="content" data-v-6355aac1><div class="content-body" data-v-6355aac1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6355aac1><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6355aac1 data-v-12f7eeca><span id="main-nav-aria-label" class="visually-hidden" data-v-12f7eeca> Main Navigation </span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-12f7eeca data-v-3ccf5a95><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3ccf5a95><span class="text" data-v-3ccf5a95><!----><span data-v-3ccf5a95>Frontend</span><span class="vpi-chevron-down text-icon" data-v-3ccf5a95></span></span></button><div class="menu" data-v-3ccf5a95><div class="VPMenu" data-v-3ccf5a95 data-v-e354aaf3><div class="items" data-v-e354aaf3><!--[--><!--[--><div class="VPMenuLink" data-v-e354aaf3 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/frontend/" data-v-20fb6a61><!--[--><span data-v-20fb6a61>概览</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>框架</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/frontend/react/customHook/hooks" data-v-20fb6a61><!--[--><span data-v-20fb6a61>React</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/frontend/vue/schudle" data-v-20fb6a61><!--[--><span data-v-20fb6a61>Vue</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>语言</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/frontend/typescript/%E8%AE%B0%E5%BD%95" data-v-20fb6a61><!--[--><span data-v-20fb6a61>TypeScript</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/frontend/javascript/Advance/executionContext" data-v-20fb6a61><!--[--><span data-v-20fb6a61>JavaScript</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>浏览器 &amp; 工程化</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/frontend/browser/Chrome%E6%9E%B6%E6%9E%84" data-v-20fb6a61><!--[--><span data-v-20fb6a61>浏览器原理</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/frontend/webpack/basic" data-v-20fb6a61><!--[--><span data-v-20fb6a61>Webpack</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/frontend/git/basic" data-v-20fb6a61><!--[--><span data-v-20fb6a61>Git</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-12f7eeca data-v-3ccf5a95><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3ccf5a95><span class="text" data-v-3ccf5a95><!----><span data-v-3ccf5a95>Graphics</span><span class="vpi-chevron-down text-icon" data-v-3ccf5a95></span></span></button><div class="menu" data-v-3ccf5a95><div class="VPMenu" data-v-3ccf5a95 data-v-e354aaf3><div class="items" data-v-e354aaf3><!--[--><!--[--><div class="VPMenuLink" data-v-e354aaf3 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/cv/" data-v-20fb6a61><!--[--><span data-v-20fb6a61>概览</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>理论基础</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/cv/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%8E%9F%E7%90%86/00-%E6%95%99%E5%AD%A6%E5%A4%A7%E7%BA%B2%E4%B8%8E%E7%9B%AE%E5%BD%95" data-v-20fb6a61><!--[--><span data-v-20fb6a61>图形学原理</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>渲染技术</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/cv/Canvas2D%E5%9F%BA%E7%A1%80/00-%E6%95%99%E5%AD%A6%E5%A4%A7%E7%BA%B2%E4%B8%8E%E7%9B%AE%E5%BD%95" data-v-20fb6a61><!--[--><span data-v-20fb6a61>Canvas2D</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/cv/WebGL%E5%9F%BA%E7%A1%80/00-%E6%95%99%E5%AD%A6%E5%A4%A7%E7%BA%B2%E4%B8%8E%E7%9B%AE%E5%BD%95" data-v-20fb6a61><!--[--><span data-v-20fb6a61>WebGL</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/cv/PixiJS%E5%AE%9E%E6%88%98/00-%E6%95%99%E5%AD%A6%E5%A4%A7%E7%BA%B2%E4%B8%8E%E7%9B%AE%E5%BD%95" data-v-20fb6a61><!--[--><span data-v-20fb6a61>PixiJS</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>应用实战</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/cv/%E6%97%A0%E9%99%90%E7%94%BB%E5%B8%83/00-%E6%95%99%E5%AD%A6%E5%A4%A7%E7%BA%B2%E4%B8%8E%E7%9B%AE%E5%BD%95" data-v-20fb6a61><!--[--><span data-v-20fb6a61>无限画布</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-12f7eeca data-v-3ccf5a95><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3ccf5a95><span class="text" data-v-3ccf5a95><!----><span data-v-3ccf5a95>AI</span><span class="vpi-chevron-down text-icon" data-v-3ccf5a95></span></span></button><div class="menu" data-v-3ccf5a95><div class="VPMenu" data-v-3ccf5a95 data-v-e354aaf3><div class="items" data-v-e354aaf3><!--[--><!--[--><div class="VPMenuLink" data-v-e354aaf3 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/ai/" data-v-20fb6a61><!--[--><span data-v-20fb6a61>概览</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>AI 工程</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/ai/mcp/browserTools" data-v-20fb6a61><!--[--><span data-v-20fb6a61>MCP 协议</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/ai/Dify/" data-v-20fb6a61><!--[--><span data-v-20fb6a61>Dify 平台</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/ai/posts/LLM" data-v-20fb6a61><!--[--><span data-v-20fb6a61>LLM 基础</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>机器学习</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/ai/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92" data-v-20fb6a61><!--[--><span data-v-20fb6a61>机器学习</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/ai/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80" data-v-20fb6a61><!--[--><span data-v-20fb6a61>深度学习</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/ai/sam/" data-v-20fb6a61><!--[--><span data-v-20fb6a61>SAM</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-12f7eeca data-v-3ccf5a95><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3ccf5a95><span class="text" data-v-3ccf5a95><!----><span data-v-3ccf5a95>CS Basics</span><span class="vpi-chevron-down text-icon" data-v-3ccf5a95></span></span></button><div class="menu" data-v-3ccf5a95><div class="VPMenu" data-v-3ccf5a95 data-v-e354aaf3><div class="items" data-v-e354aaf3><!--[--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>计算机基础</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/fundamentals/data-structures/chapter1" data-v-20fb6a61><!--[--><span data-v-20fb6a61>数据结构</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/fundamentals/operating-systems/chapter1" data-v-20fb6a61><!--[--><span data-v-20fb6a61>操作系统</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/fundamentals/computer-networks/chapter1" data-v-20fb6a61><!--[--><span data-v-20fb6a61>计算机网络</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/fundamentals/computer-organization/chapter1" data-v-20fb6a61><!--[--><span data-v-20fb6a61>计算机组成</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>设计模式</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/design-patterns/" data-v-20fb6a61><!--[--><span data-v-20fb6a61>设计模式概览</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/fundamentals/exam-408/2009" data-v-20fb6a61><!--[--><span data-v-20fb6a61>408 真题</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>算法</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/algorithms/leetcode" data-v-20fb6a61><!--[--><span data-v-20fb6a61>LeetCode</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/algorithms/LRU" data-v-20fb6a61><!--[--><span data-v-20fb6a61>LRU 算法</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Lyc-notes/blog/" tabindex="0" data-v-12f7eeca data-v-60390558><!--[--><span data-v-60390558>Blog</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-12f7eeca data-v-3ccf5a95><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3ccf5a95><span class="text" data-v-3ccf5a95><!----><span data-v-3ccf5a95>More</span><span class="vpi-chevron-down text-icon" data-v-3ccf5a95></span></span></button><div class="menu" data-v-3ccf5a95><div class="VPMenu" data-v-3ccf5a95 data-v-e354aaf3><div class="items" data-v-e354aaf3><!--[--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>开源项目</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/open-source/" data-v-20fb6a61><!--[--><span data-v-20fb6a61>项目列表</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link vp-external-link-icon" href="https://github.com/LynnCen/gitlab-mcp" target="_blank" rel="noreferrer" data-v-20fb6a61><!--[--><span data-v-20fb6a61>GitLab MCP</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link vp-external-link-icon" href="https://lynncen.github.io/LynKit/" target="_blank" rel="noreferrer" data-v-20fb6a61><!--[--><span data-v-20fb6a61>LynKit</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>软考</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/software-exam/%E6%9E%B6%E6%9E%84%E5%B8%88/README" data-v-20fb6a61><!--[--><span data-v-20fb6a61>系统架构师</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/software-exam/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%B8%88/README" data-v-20fb6a61><!--[--><span data-v-20fb6a61>软件设计师</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e354aaf3 data-v-05dadae9><p class="title" data-v-05dadae9>其他</p><!--[--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/interview/js" data-v-20fb6a61><!--[--><span data-v-20fb6a61>面试题库</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/work/gd/%E4%B8%9A%E5%8A%A1%E4%BB%8B%E7%BB%8D" data-v-20fb6a61><!--[--><span data-v-20fb6a61>工作文档</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-05dadae9 data-v-20fb6a61><a class="VPLink link" href="/Lyc-notes/about/about" data-v-20fb6a61><!--[--><span data-v-20fb6a61>关于我</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6355aac1 data-v-bf566743><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bf566743 data-v-d7e239c8 data-v-0f82579d><span class="check" data-v-0f82579d><span class="icon" data-v-0f82579d><!--[--><span class="vpi-sun sun" data-v-d7e239c8></span><span class="vpi-moon moon" data-v-d7e239c8></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6355aac1 data-v-d7f6a161 data-v-d9e68e33><!--[--><a class="VPSocialLink no-icon" href="https://github.com/LynnCen" aria-label="github" target="_blank" rel="noopener" data-v-d9e68e33 data-v-feb64ff2><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6355aac1 data-v-a003e139 data-v-3ccf5a95><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-3ccf5a95><span class="vpi-more-horizontal icon" data-v-3ccf5a95></span></button><div class="menu" data-v-3ccf5a95><div class="VPMenu" data-v-3ccf5a95 data-v-e354aaf3><!----><!--[--><!--[--><!----><div class="group" data-v-a003e139><div class="item appearance" data-v-a003e139><p class="label" data-v-a003e139>外观</p><div class="appearance-action" data-v-a003e139><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-a003e139 data-v-d7e239c8 data-v-0f82579d><span class="check" data-v-0f82579d><span class="icon" data-v-0f82579d><!--[--><span class="vpi-sun sun" data-v-d7e239c8></span><span class="vpi-moon moon" data-v-d7e239c8></span><!--]--></span></span></button></div></div></div><div class="group" data-v-a003e139><div class="item social-links" data-v-a003e139><div class="VPSocialLinks social-links-list" data-v-a003e139 data-v-d9e68e33><!--[--><a class="VPSocialLink no-icon" href="https://github.com/LynnCen" aria-label="github" target="_blank" rel="noopener" data-v-d9e68e33 data-v-feb64ff2><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6355aac1 data-v-a3c5ca32><span class="container" data-v-a3c5ca32><span class="top" data-v-a3c5ca32></span><span class="middle" data-v-a3c5ca32></span><span class="bottom" data-v-a3c5ca32></span></span></button></div></div></div></div><div class="divider" data-v-6355aac1><div class="divider-line" data-v-6355aac1></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-31cf94a2 data-v-eb11061a><div class="container" data-v-eb11061a><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-eb11061a data-v-b72df35b><button data-v-b72df35b>返回顶部</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-31cf94a2 data-v-4f3472e4><div class="VPDoc has-aside" data-v-4f3472e4 data-v-19e5f4bd><!--[--><!--]--><div class="container" data-v-19e5f4bd><div class="aside" data-v-19e5f4bd><div class="aside-curtain" data-v-19e5f4bd></div><div class="aside-container" data-v-19e5f4bd><div class="aside-content" data-v-19e5f4bd><div class="VPDocAside" data-v-19e5f4bd data-v-d5b85769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-d5b85769 data-v-c8348399><div class="content" data-v-c8348399><div class="outline-marker" data-v-c8348399></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8348399>本页目录</div><ul class="VPDocOutlineItem root" data-v-c8348399 data-v-48e03ebb><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-d5b85769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-19e5f4bd><div class="content-container" data-v-19e5f4bd><!--[--><!--]--><main class="main" data-v-19e5f4bd><div style="position:relative;" class="vp-doc _Lyc-notes_work_gd_monorepo_Monorepo%E8%B6%85%E7%BA%A7%E5%A4%A7%E4%BB%93%E4%BB%8E0%E5%88%B01%E5%AE%9E%E6%88%98%E6%89%8B%E5%86%8C" data-v-19e5f4bd><div><h1 id="monorepo-超级大仓从0到1实战手册" tabindex="-1">Monorepo 超级大仓从0到1实战手册 <a class="header-anchor" href="#monorepo-超级大仓从0到1实战手册" aria-label="Permalink to &quot;Monorepo 超级大仓从0到1实战手册&quot;">​</a></h1><blockquote><p><strong>定位</strong>：通用的 Monorepo 搭建实战指南<br><strong>核心目标</strong>：深入理解每一步的工作原理与本质<br><strong>技术栈</strong>：pnpm + Turborepo + TypeScript<br><strong>目标读者</strong>：需要搭建或迁移到 Monorepo 的团队</p></blockquote><hr><h2 id="目录" tabindex="-1">目录 <a class="header-anchor" href="#目录" aria-label="Permalink to &quot;目录&quot;">​</a></h2><ul><li><a href="#第一章monorepo-的本质与适用场景">第一章：Monorepo 的本质与适用场景</a></li><li><a href="#第二章技术选型的底层逻辑">第二章：技术选型的底层逻辑</a></li><li><a href="#第三章架构设计原则">第三章：架构设计原则</a></li><li><a href="#第四章搭建基础骨架">第四章：搭建基础骨架</a></li><li><a href="#第五章配置-pnpm-workspace">第五章：配置 pnpm Workspace</a></li><li><a href="#第六章配置-turborepo">第六章：配置 Turborepo</a></li><li><a href="#第七章typescript-配置体系">第七章：TypeScript 配置体系</a></li><li><a href="#第八章构建第一个共享包">第八章：构建第一个共享包</a></li><li><a href="#第九章依赖管理系统">第九章：依赖管理系统</a></li><li><a href="#第十章构建性能优化">第十章：构建性能优化</a></li><li><a href="#第十一章架构治理机制">第十一章：架构治理机制</a></li><li><a href="#第十二章cicd-集成">第十二章：CI/CD 集成</a></li></ul><hr><h2 id="第一章-monorepo-的本质与适用场景" tabindex="-1">第一章：Monorepo 的本质与适用场景 <a class="header-anchor" href="#第一章-monorepo-的本质与适用场景" aria-label="Permalink to &quot;第一章：Monorepo 的本质与适用场景&quot;">​</a></h2><h3 id="_1-1-什么是-monorepo" tabindex="-1">1.1 什么是 Monorepo <a class="header-anchor" href="#_1-1-什么是-monorepo" aria-label="Permalink to &quot;1.1 什么是 Monorepo&quot;">​</a></h3><p><strong>Monorepo</strong> (Monolithic Repository) 的本质是<strong>用单一代码仓库管理多个相关项目</strong>的软件工程实践。</p><h4 id="核心特征" tabindex="-1">核心特征 <a class="header-anchor" href="#核心特征" aria-label="Permalink to &quot;核心特征&quot;">​</a></h4><ol><li><strong>统一的版本控制</strong>：所有代码在同一个 Git 仓库中</li><li><strong>共享的工具链</strong>：统一的构建、测试、部署流程</li><li><strong>原子化的变更</strong>：跨项目修改可以在一个 commit 中完成</li><li><strong>可见的依赖关系</strong>：项目间依赖明确可追踪</li></ol><h4 id="与-polyrepo-的本质区别" tabindex="-1">与 Polyrepo 的本质区别 <a class="header-anchor" href="#与-polyrepo-的本质区别" aria-label="Permalink to &quot;与 Polyrepo 的本质区别&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Polyrepo（多仓库）的问题本质：</span></span>
<span class="line"><span>┌─────────────┐      ┌─────────────┐      ┌─────────────┐</span></span>
<span class="line"><span>│  项目 A     │      │  项目 B     │      │  共享库 C   │</span></span>
<span class="line"><span>│  v1.2.0     │─────▶│  v2.1.0     │─────▶│  v0.5.0     │</span></span>
<span class="line"><span>└─────────────┘      └─────────────┘      └─────────────┘</span></span>
<span class="line"><span>     │                    │                    │</span></span>
<span class="line"><span>     └────────────────────┴────────────────────┘</span></span>
<span class="line"><span>              问题：版本不同步、依赖混乱</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Monorepo 的解决方案：</span></span>
<span class="line"><span>┌────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│               单一代码仓库                          │</span></span>
<span class="line"><span>│  ┌──────────┐  ┌──────────┐  ┌──────────┐         │</span></span>
<span class="line"><span>│  │ 项目 A   │  │ 项目 B   │  │ 共享库 C │         │</span></span>
<span class="line"><span>│  │ 统一版本 │──│ 统一版本 │──│ 统一版本 │         │</span></span>
<span class="line"><span>│  └──────────┘  └──────────┘  └──────────┘         │</span></span>
<span class="line"><span>└────────────────────────────────────────────────────┘</span></span>
<span class="line"><span>         本质：依赖关系内聚、版本统一</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_1-2-是否需要-monorepo-评估维度" tabindex="-1">1.2 是否需要 Monorepo：评估维度 <a class="header-anchor" href="#_1-2-是否需要-monorepo-评估维度" aria-label="Permalink to &quot;1.2 是否需要 Monorepo：评估维度&quot;">​</a></h3><p>不需要复杂的评分系统，关注以下<strong>核心矛盾点</strong>：</p><h4 id="维度一-代码共享需求" tabindex="-1">维度一：代码共享需求 <a class="header-anchor" href="#维度一-代码共享需求" aria-label="Permalink to &quot;维度一：代码共享需求&quot;">​</a></h4><p><strong>判断依据</strong>：</p><ul><li>是否有 5 个以上的通用组件/工具库需要跨项目共享？</li><li>跨项目修改是否频繁（月均 10 次以上）？</li><li>是否存在大量重复代码？</li></ul><p><strong>本质</strong>：Monorepo 解决的是<strong>代码复用的成本问题</strong>。如果你的项目间代码重用很少，Monorepo 的价值有限。</p><h4 id="维度二-团队协作效率" tabindex="-1">维度二：团队协作效率 <a class="header-anchor" href="#维度二-团队协作效率" aria-label="Permalink to &quot;维度二：团队协作效率&quot;">​</a></h4><p><strong>判断依据</strong>：</p><ul><li>是否有多个团队共同维护前端基础设施？</li><li>是否需要保证多个项目技术栈版本一致？</li><li>是否希望建立统一的代码规范和质量标准？</li></ul><p><strong>本质</strong>：Monorepo 是一种<strong>组织级的协作模式</strong>，适合需要统一技术栈的中大型团队。</p><h4 id="维度三-技术债务" tabindex="-1">维度三：技术债务 <a class="header-anchor" href="#维度三-技术债务" aria-label="Permalink to &quot;维度三：技术债务&quot;">​</a></h4><p><strong>判断依据</strong>：</p><ul><li>是否存在严重的依赖版本碎片化问题？</li><li>构建和部署流程是否过于复杂？</li><li>是否难以追踪跨项目的影响范围？</li></ul><p><strong>本质</strong>：Monorepo 通过<strong>集中化管理降低复杂度</strong>，但前提是你愿意投入初期搭建成本。</p><h4 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h4><p>如果以上三个维度中有<strong>两个及以上</strong>的答案是肯定的，那么 Monorepo 适合你的团队。</p><hr><h2 id="第二章-技术选型的底层逻辑" tabindex="-1">第二章：技术选型的底层逻辑 <a class="header-anchor" href="#第二章-技术选型的底层逻辑" aria-label="Permalink to &quot;第二章：技术选型的底层逻辑&quot;">​</a></h2><h3 id="_2-1-包管理器的选择-为什么是-pnpm" tabindex="-1">2.1 包管理器的选择：为什么是 pnpm <a class="header-anchor" href="#_2-1-包管理器的选择-为什么是-pnpm" aria-label="Permalink to &quot;2.1 包管理器的选择：为什么是 pnpm&quot;">​</a></h3><h4 id="npm-yarn-的局限性" tabindex="-1">npm/yarn 的局限性 <a class="header-anchor" href="#npm-yarn-的局限性" aria-label="Permalink to &quot;npm/yarn 的局限性&quot;">​</a></h4><p>传统包管理器采用<strong>扁平化 node_modules</strong> 结构：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>node_modules/</span></span>
<span class="line"><span>├── package-a/</span></span>
<span class="line"><span>├── package-b/</span></span>
<span class="line"><span>└── package-c/  (被 a 和 b 共同依赖，提升到顶层)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>问题本质</strong>：</p><ol><li><strong>幽灵依赖（Phantom Dependencies）</strong>：项目可以访问未声明的依赖</li><li><strong>磁盘空间浪费</strong>：同一个包的不同版本会被复制多次</li><li><strong>安装速度慢</strong>：需要解析复杂的依赖树并复制文件</li></ol><h4 id="pnpm-的创新-内容寻址存储" tabindex="-1">pnpm 的创新：内容寻址存储 <a class="header-anchor" href="#pnpm-的创新-内容寻址存储" aria-label="Permalink to &quot;pnpm 的创新：内容寻址存储&quot;">​</a></h4><p>pnpm 采用<strong>硬链接 + 符号链接</strong>的方式：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>全局存储（Content-Addressable Store）</span></span>
<span class="line"><span>~/.pnpm-store/</span></span>
<span class="line"><span>└── v3/</span></span>
<span class="line"><span>    └── files/</span></span>
<span class="line"><span>        └── 00/</span></span>
<span class="line"><span>            └── &lt;hash&gt;  ← 包的实际内容</span></span>
<span class="line"><span></span></span>
<span class="line"><span>项目 node_modules</span></span>
<span class="line"><span>node_modules/</span></span>
<span class="line"><span>├── .pnpm/</span></span>
<span class="line"><span>│   └── package-a@1.0.0/</span></span>
<span class="line"><span>│       └── node_modules/</span></span>
<span class="line"><span>│           └── package-a/  ← 硬链接到全局存储</span></span>
<span class="line"><span>└── package-a  ← 符号链接到 .pnpm/package-a@1.0.0/node_modules/package-a</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>工作原理</strong>：</p><ol><li><strong>硬链接（Hard Link）</strong>：多个文件路径指向同一个 inode，节省空间</li><li><strong>符号链接（Symbolic Link）</strong>：保证 Node.js 的模块解析算法正确工作</li><li><strong>依赖隔离</strong>：只有声明的依赖才能被访问，杜绝幽灵依赖</li></ol><p><strong>性能优势</strong>：</p><ul><li>磁盘空间：节省 60%+（多项目共享同一份依赖）</li><li>安装速度：快 2-3 倍（只需创建链接，无需复制）</li><li>严格性：强制显式声明依赖</li></ul><h4 id="workspace-支持" tabindex="-1">Workspace 支持 <a class="header-anchor" href="#workspace-支持" aria-label="Permalink to &quot;Workspace 支持&quot;">​</a></h4><p>pnpm workspace 的核心是<strong>包之间的链接机制</strong>：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># pnpm-workspace.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">packages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;apps/*&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;packages/*&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当你声明 <code>&quot;@shared/ui&quot;: &quot;workspace:*&quot;</code> 时，pnpm 会：</p><ol><li>扫描 workspace 中所有包的 <code>package.json</code></li><li>找到匹配的包（如 <code>packages/ui</code>）</li><li>创建符号链接：<code>node_modules/@shared/ui</code> → <code>../../packages/ui</code></li></ol><p><strong>本质</strong>：workspace 是一种<strong>本地依赖解析机制</strong>，让包之间的引用像引用 npm 包一样自然。</p><h3 id="_2-2-构建工具的选择-为什么是-turborepo" tabindex="-1">2.2 构建工具的选择：为什么是 Turborepo <a class="header-anchor" href="#_2-2-构建工具的选择-为什么是-turborepo" aria-label="Permalink to &quot;2.2 构建工具的选择：为什么是 Turborepo&quot;">​</a></h3><h4 id="monorepo-构建的挑战" tabindex="-1">Monorepo 构建的挑战 <a class="header-anchor" href="#monorepo-构建的挑战" aria-label="Permalink to &quot;Monorepo 构建的挑战&quot;">​</a></h4><p>假设有以下依赖关系：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>app-web → shared-ui → shared-utils</span></span>
<span class="line"><span>app-mobile → shared-ui → shared-utils</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>问题</strong>：</p><ol><li>构建顺序：必须先构建 utils，再构建 ui，最后构建 app</li><li>增量构建：修改 utils 后，需要重新构建 ui 和 app</li><li>并行构建：app-web 和 app-mobile 可以并行，但必须等 ui 完成</li><li>缓存复用：相同输入应该跳过构建</li></ol><h4 id="turborepo-的解决方案" tabindex="-1">Turborepo 的解决方案 <a class="header-anchor" href="#turborepo-的解决方案" aria-label="Permalink to &quot;Turborepo 的解决方案&quot;">​</a></h4><p><strong>核心机制 1：任务图（Task Graph）</strong></p><p>Turborepo 会根据依赖关系构建一个 DAG（有向无环图）：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────┐</span></span>
<span class="line"><span>│ utils:build │</span></span>
<span class="line"><span>└──────┬──────┘</span></span>
<span class="line"><span>       │</span></span>
<span class="line"><span>       ▼</span></span>
<span class="line"><span>┌─────────────┐</span></span>
<span class="line"><span>│  ui:build   │</span></span>
<span class="line"><span>└──────┬──────┘</span></span>
<span class="line"><span>       │</span></span>
<span class="line"><span>       ├─────────────┬─────────────┐</span></span>
<span class="line"><span>       ▼             ▼             ▼</span></span>
<span class="line"><span>┌──────────┐  ┌──────────┐  ┌──────────┐</span></span>
<span class="line"><span>│web:build │  │mobile:   │  │admin:    │</span></span>
<span class="line"><span>│          │  │build     │  │build     │</span></span>
<span class="line"><span>└──────────┘  └──────────┘  └──────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>调度算法</strong>：</p><ol><li>拓扑排序确定执行顺序</li><li>识别可并行的任务（无依赖关系）</li><li>最大化 CPU 利用率</li></ol><p><strong>核心机制 2：缓存系统</strong></p><p>Turborepo 的缓存键计算公式：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Cache Key = Hash(</span></span>
<span class="line"><span>  任务配置（task definition）</span></span>
<span class="line"><span>  + 输入文件（inputs）</span></span>
<span class="line"><span>  + 环境变量（env）</span></span>
<span class="line"><span>  + 上游依赖的输出（upstream outputs）</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>工作流程</strong>：</p><ol><li><strong>构建前</strong>：计算当前任务的缓存键</li><li><strong>查找缓存</strong>：在本地/远程缓存中查找匹配的输出</li><li><strong>缓存命中</strong>：直接恢复输出文件，跳过构建</li><li><strong>缓存未命中</strong>：执行构建，保存输出到缓存</li></ol><p><strong>核心机制 3：增量构建</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 初次构建</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">•</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> utils:build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (3.2s)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">•</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ui:build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (5.1s)     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">•</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> web:build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (8.3s)    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改 utils 后</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">•</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> utils:build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (3.1s)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行（输入变化）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">•</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ui:build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (5.0s)     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行（上游变化）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">•</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> web:build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CACHED)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 跳过（依赖 ui 的输出未变）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>原理</strong>：Turborepo 会检测<strong>传递性依赖</strong>，只重建受影响的部分。</p><h3 id="_2-3-版本管理-为什么是-changesets" tabindex="-1">2.3 版本管理：为什么是 Changesets <a class="header-anchor" href="#_2-3-版本管理-为什么是-changesets" aria-label="Permalink to &quot;2.3 版本管理：为什么是 Changesets&quot;">​</a></h3><h4 id="monorepo-版本管理的挑战" tabindex="-1">Monorepo 版本管理的挑战 <a class="header-anchor" href="#monorepo-版本管理的挑战" aria-label="Permalink to &quot;Monorepo 版本管理的挑战&quot;">​</a></h4><p><strong>问题场景</strong>：</p><ul><li>修改了共享库 <code>@shared/ui</code></li><li>哪些应用受影响？</li><li>应该发布什么版本？major/minor/patch？</li><li>如何生成 changelog？</li></ul><h4 id="changesets-的解决方案" tabindex="-1">Changesets 的解决方案 <a class="header-anchor" href="#changesets-的解决方案" aria-label="Permalink to &quot;Changesets 的解决方案&quot;">​</a></h4><p><strong>核心理念</strong>：<strong>开发者在修改时声明变更意图</strong></p><p><strong>工作流程</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 开发者修改代码后创建 changeset</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changeset</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Which packages would you like to include</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ✔</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @shared/ui</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> What kind of change is this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ○</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> major</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (破坏性变更)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ●</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> minor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (新增功能)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ○</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> patch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (bug </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">修复</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Please enter a summary:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Added</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Button</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> variants:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ghost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 生成 .changeset/xxx.md</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;@shared/ui&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> minor</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Added</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Button</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> variants:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ghost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>版本更新机制</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changeset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Changesets 会：</p><ol><li>读取所有 <code>.changeset/*.md</code> 文件</li><li>根据语义化版本规则更新 <code>package.json</code></li><li>更新依赖此包的其他包的依赖版本</li><li>生成 <code>CHANGELOG.md</code></li><li>删除已消费的 changeset 文件</li></ol><p><strong>本质</strong>：Changesets 是一种<strong>分布式的版本管理协议</strong>，让版本升级可追溯、可预测。</p><hr><h2 id="第三章-架构设计原则" tabindex="-1">第三章：架构设计原则 <a class="header-anchor" href="#第三章-架构设计原则" aria-label="Permalink to &quot;第三章：架构设计原则&quot;">​</a></h2><h3 id="_3-1-分层架构的本质" tabindex="-1">3.1 分层架构的本质 <a class="header-anchor" href="#_3-1-分层架构的本质" aria-label="Permalink to &quot;3.1 分层架构的本质&quot;">​</a></h3><p>Monorepo 不是把所有代码放在一个仓库就完事了，<strong>架构清晰度</strong>比单仓库更重要。</p><h4 id="核心原则-单向依赖" tabindex="-1">核心原则：单向依赖 <a class="header-anchor" href="#核心原则-单向依赖" aria-label="Permalink to &quot;核心原则：单向依赖&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌───────────────────────────────────┐</span></span>
<span class="line"><span>│        应用层 (apps/)              │  ← 业务应用</span></span>
<span class="line"><span>└───────────────┬───────────────────┘</span></span>
<span class="line"><span>                ↓ 依赖</span></span>
<span class="line"><span>┌───────────────────────────────────┐</span></span>
<span class="line"><span>│        领域层 (domains/)           │  ← 垂直业务逻辑</span></span>
<span class="line"><span>└───────────────┬───────────────────┘</span></span>
<span class="line"><span>                ↓ 依赖</span></span>
<span class="line"><span>┌───────────────────────────────────┐</span></span>
<span class="line"><span>│        共享层 (shared/)            │  ← 横向通用能力</span></span>
<span class="line"><span>└───────────────┬───────────────────┘</span></span>
<span class="line"><span>                ↓ 依赖</span></span>
<span class="line"><span>┌───────────────────────────────────┐</span></span>
<span class="line"><span>│        平台层 (platform/)          │  ← 跨切面技术设施</span></span>
<span class="line"><span>└───────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>设计意图</strong>：</p><ul><li><strong>上层可以依赖下层</strong>：应用可以引用领域、共享、平台</li><li><strong>下层不能依赖上层</strong>：平台不能引用应用</li><li><strong>同层避免互相依赖</strong>：两个领域之间不应直接依赖</li></ul><h4 id="为什么要分层" tabindex="-1">为什么要分层？ <a class="header-anchor" href="#为什么要分层" aria-label="Permalink to &quot;为什么要分层？&quot;">​</a></h4><p><strong>本质原因</strong>：<strong>降低认知负担</strong></p><ul><li>当你修改平台层代码时，你知道<strong>所有上层</strong>都可能受影响</li><li>当你修改应用层代码时，你知道<strong>只有这个应用</strong>受影响</li><li>依赖关系单向流动，易于理解和维护</li></ul><h4 id="每一层的职责" tabindex="-1">每一层的职责 <a class="header-anchor" href="#每一层的职责" aria-label="Permalink to &quot;每一层的职责&quot;">​</a></h4><p><strong>应用层（apps/）</strong>：</p><ul><li><strong>职责</strong>：路由、配置、组装、部署</li><li><strong>不应该包含</strong>：业务逻辑、通用组件</li><li><strong>类比</strong>：orchestrator（编排器）</li></ul><p><strong>领域层（domains/）</strong>：</p><ul><li><strong>职责</strong>：特定业务领域的完整逻辑</li><li><strong>特点</strong>：垂直切分，高内聚低耦合</li><li><strong>类比</strong>：DDD 中的 Bounded Context</li></ul><p><strong>共享层（shared/）</strong>：</p><ul><li><strong>职责</strong>：跨领域的通用代码</li><li><strong>特点</strong>：无业务语义，纯技术组件</li><li><strong>类比</strong>：utility library</li></ul><p><strong>平台层（platform/）</strong>：</p><ul><li><strong>职责</strong>：跨切面的技术能力（认证、监控、配置）</li><li><strong>特点</strong>：提供基础设施，对业务透明</li><li><strong>类比</strong>：infrastructure</li></ul><h3 id="_3-2-命名规范的意义" tabindex="-1">3.2 命名规范的意义 <a class="header-anchor" href="#_3-2-命名规范的意义" aria-label="Permalink to &quot;3.2 命名规范的意义&quot;">​</a></h3><h4 id="package-命名的信息密度" tabindex="-1">Package 命名的信息密度 <a class="header-anchor" href="#package-命名的信息密度" aria-label="Permalink to &quot;Package 命名的信息密度&quot;">​</a></h4><p>一个好的包名应该传达：</p><ol><li><strong>作用域（scope）</strong>：属于哪一层</li><li><strong>领域（domain）</strong>：属于哪个业务域</li><li><strong>功能（feature）</strong>：提供什么能力</li></ol><p><strong>推荐规范</strong>：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@{layer}/{domain}-{feature}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>示例：</span></span>
<span class="line"><span>@app/web                    ← 应用层</span></span>
<span class="line"><span>@domain/editor-core         ← 领域层：编辑器核心</span></span>
<span class="line"><span>@domain/editor-tools        ← 领域层：编辑器工具</span></span>
<span class="line"><span>@shared/ui                  ← 共享层：UI 组件</span></span>
<span class="line"><span>@platform/auth              ← 平台层：认证</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>为什么要这样命名？</strong></p><ol><li><strong>快速定位</strong>：看名字就知道在哪一层</li><li><strong>依赖检查</strong>：<code>@app/*</code> 不应该被 <code>@shared/*</code> 依赖</li><li><strong>工具友好</strong>：可以基于命名规则自动生成依赖图</li></ol><h3 id="_3-3-目录结构设计" tabindex="-1">3.3 目录结构设计 <a class="header-anchor" href="#_3-3-目录结构设计" aria-label="Permalink to &quot;3.3 目录结构设计&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>monorepo/</span></span>
<span class="line"><span>├── apps/                         # 应用层</span></span>
<span class="line"><span>│   ├── web/                      # Web 应用</span></span>
<span class="line"><span>│   ├── mobile/                   # 移动应用</span></span>
<span class="line"><span>│   └── admin/                    # 后台管理</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── domains/                      # 领域层</span></span>
<span class="line"><span>│   ├── user/                     # 用户域</span></span>
<span class="line"><span>│   │   ├── api/                  # 对外接口</span></span>
<span class="line"><span>│   │   ├── features/             # 功能模块</span></span>
<span class="line"><span>│   │   ├── services/             # 领域服务</span></span>
<span class="line"><span>│   │   └── ui/                   # 领域 UI</span></span>
<span class="line"><span>│   │</span></span>
<span class="line"><span>│   └── product/                  # 产品域</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── shared/                       # 共享层</span></span>
<span class="line"><span>│   ├── ui/                       # UI 组件库</span></span>
<span class="line"><span>│   ├── utils/                    # 工具函数</span></span>
<span class="line"><span>│   └── hooks/                    # 通用 Hooks</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── platform/                     # 平台层</span></span>
<span class="line"><span>│   ├── config/                   # 配置预设</span></span>
<span class="line"><span>│   │   ├── eslint-config/</span></span>
<span class="line"><span>│   │   ├── tsconfig/</span></span>
<span class="line"><span>│   │   └── vite-config/</span></span>
<span class="line"><span>│   │</span></span>
<span class="line"><span>│   ├── monitoring/               # 监控</span></span>
<span class="line"><span>│   ├── auth/                     # 认证</span></span>
<span class="line"><span>│   └── storage/                  # 存储</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── tooling/                      # 工具链</span></span>
<span class="line"><span>│   ├── catalog-manager/          # Catalog 管理</span></span>
<span class="line"><span>│   └── generator/                # 代码生成器</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── pnpm-workspace.yaml           # Workspace 配置</span></span>
<span class="line"><span>├── turbo.json                    # Turbo 配置</span></span>
<span class="line"><span>├── package.json                  # 根配置</span></span>
<span class="line"><span>└── tsconfig.base.json            # TS 基础配置</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p><strong>设计意图</strong>：</p><ol><li><strong>按职责而非技术栈划分</strong>：不是 <code>react/</code>, <code>vue/</code> 而是 <code>domains/</code>, <code>shared/</code></li><li><strong>支持嵌套包</strong>：领域内可以有子包（如 <code>domains/editor/packages/*</code>）</li><li><strong>工具链独立</strong>：<code>tooling/</code> 存放构建工具，与业务代码分离</li></ol><hr><h2 id="第四章-搭建基础骨架" tabindex="-1">第四章：搭建基础骨架 <a class="header-anchor" href="#第四章-搭建基础骨架" aria-label="Permalink to &quot;第四章：搭建基础骨架&quot;">​</a></h2><h3 id="_4-1-初始化项目的本质" tabindex="-1">4.1 初始化项目的本质 <a class="header-anchor" href="#_4-1-初始化项目的本质" aria-label="Permalink to &quot;4.1 初始化项目的本质&quot;">​</a></h3><h4 id="创建项目目录" tabindex="-1">创建项目目录 <a class="header-anchor" href="#创建项目目录" aria-label="Permalink to &quot;创建项目目录&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-monorepo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-monorepo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>为什么先初始化 Git？</strong></p><ul><li>Turborepo 的缓存键依赖 Git 历史</li><li>很多工具（如 Husky）需要 Git 环境</li></ul><h4 id="配置包管理器版本" tabindex="-1">配置包管理器版本 <a class="header-anchor" href="#配置包管理器版本" aria-label="Permalink to &quot;配置包管理器版本&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;packageManager=pnpm@10.24.0&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">corepack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">corepack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prepare</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm@10.24.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --activate</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>核心概念：Corepack</strong></p><p>Corepack 是 Node.js 的内置工具，用于管理包管理器版本。</p><p><strong>工作原理</strong>：</p><ol><li>读取 <code>package.json</code> 中的 <code>packageManager</code> 字段</li><li>自动下载并激活指定版本的 pnpm</li><li>确保团队成员使用相同版本</li></ol><p><strong>为什么要锁定版本？</strong></p><ul><li>pnpm 的行为在不同版本间可能有差异</li><li>避免 &quot;在我机器上能跑&quot; 的问题</li><li>CI/CD 环境可以自动使用正确版本</li></ul><h3 id="_4-2-根-package-json-的设计" tabindex="-1">4.2 根 package.json 的设计 <a class="header-anchor" href="#_4-2-根-package-json-的设计" aria-label="Permalink to &quot;4.2 根 package.json 的设计&quot;">​</a></h3><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my-monorepo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;private&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;turbo run dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;turbo run build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;turbo run test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;lint&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;turbo run lint&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;devDependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;turbo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^2.5.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@changesets/cli&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^2.29.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;typescript&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^5.8.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;packageManager&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pnpm@10.24.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;engines&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&gt;=20.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;pnpm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&gt;=10.0.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>关键字段解析</strong>：</p><p><strong>1. <code>&quot;private&quot;: true</code></strong></p><ul><li><strong>作用</strong>：防止根目录被发布到 npm</li><li><strong>原因</strong>：根目录只是容器，不应该是可安装的包</li></ul><p><strong>2. <code>scripts</code></strong></p><ul><li><strong>设计原则</strong>：根目录只有编排命令，不包含具体逻辑</li><li><strong>工作机制</strong>：<code>turbo run build</code> 会在所有包中查找 <code>build</code> 脚本并执行</li></ul><p><strong>3. <code>engines</code></strong></p><ul><li><strong>作用</strong>：限制 Node.js 和 pnpm 版本</li><li><strong>执行时机</strong>：pnpm install 时会检查版本，不匹配则报错</li></ul><h3 id="_4-3-npmrc-配置的意义" tabindex="-1">4.3 .npmrc 配置的意义 <a class="header-anchor" href="#_4-3-npmrc-配置的意义" aria-label="Permalink to &quot;4.3 .npmrc 配置的意义&quot;">​</a></h3><p>创建 <code>.npmrc</code>：</p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># pnpm 存储目录（可选）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">store-dir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=~/.pnpm-store</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 对等依赖处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">auto-install-peers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">dedupe-peer-dependents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Hoisting 策略</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">public-hoist-pattern[]=*eslint*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">public-hoist-pattern[]=*prettier*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">public-hoist-pattern[]=*typescript*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># CI 环境</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">frozen-lockfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=false</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>关键配置解析</strong>：</p><p><strong>1. Peer Dependencies 处理</strong></p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">auto-install-peers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">dedupe-peer-dependents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>问题场景</strong>：</p><ul><li>包 A 声明了 <code>peerDependencies: { &quot;react&quot;: &quot;^18.0.0&quot; }</code></li><li>你的项目安装了 <code>react@17.0.0</code></li><li>默认情况下 pnpm 会警告但不会自动处理</li></ul><p><strong>配置效果</strong>：</p><ul><li><code>auto-install-peers=true</code>：自动安装缺失的 peer dependencies</li><li><code>dedupe-peer-dependents=true</code>：去重 peer dependencies</li></ul><p><strong>2. Hoisting 策略</strong></p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">public-hoist-pattern[]=*eslint*</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>为什么需要 Hoisting？</strong></p><p>pnpm 默认使用<strong>非扁平化结构</strong>，但某些工具（如 ESLint）期望在根目录的 <code>node_modules</code> 中找到插件。</p><p><strong>Hoisting 原理</strong>：</p><ul><li>将匹配的包提升到 <code>node_modules/</code> 根目录</li><li>通过符号链接指向 <code>.pnpm/</code> 中的实际位置</li></ul><p><strong>3. frozen-lockfile</strong></p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">frozen-lockfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=false</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><strong>开发环境</strong>：<code>false</code>，允许自动更新 lockfile</li><li><strong>CI 环境</strong>：<code>true</code>，禁止修改 lockfile（通过环境变量覆盖）</li></ul><hr><h2 id="第五章-配置-pnpm-workspace" tabindex="-1">第五章：配置 pnpm Workspace <a class="header-anchor" href="#第五章-配置-pnpm-workspace" aria-label="Permalink to &quot;第五章：配置 pnpm Workspace&quot;">​</a></h2><h3 id="_5-1-pnpm-workspace-yaml-的工作原理" tabindex="-1">5.1 pnpm-workspace.yaml 的工作原理 <a class="header-anchor" href="#_5-1-pnpm-workspace-yaml-的工作原理" aria-label="Permalink to &quot;5.1 pnpm-workspace.yaml 的工作原理&quot;">​</a></h3><p>创建 <code>pnpm-workspace.yaml</code>：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">packages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;apps/*&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;domains/*&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;domains/*/packages/*&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;shared/*&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;platform/*&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tooling/*&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 排除</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;!**/__tests__/**&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;!**/.temp/**&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>核心机制：包发现</strong></p><p>当你运行 <code>pnpm install</code> 时，pnpm 会：</p><ol><li><strong>扫描文件系统</strong>：根据 glob 模式匹配目录</li><li><strong>读取 package.json</strong>：提取包名和版本</li><li><strong>构建 workspace 映射表</strong>：<div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@app/web → apps/web</span></span>
<span class="line"><span>@shared/ui → shared/ui</span></span>
<span class="line"><span>@domain/editor-core → domains/editor/packages/core</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><strong>解析依赖</strong>：当遇到 <code>workspace:*</code> 协议时，从映射表中查找</li></ol><p><strong>支持嵌套包的原因</strong>：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">packages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;domains/*&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;domains/*/packages/*&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这允许领域内部有子包：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>domains/</span></span>
<span class="line"><span>└── editor/</span></span>
<span class="line"><span>    ├── package.json           # @domain/editor</span></span>
<span class="line"><span>    └── packages/</span></span>
<span class="line"><span>        ├── core/              # @domain/editor-core</span></span>
<span class="line"><span>        ├── tools/             # @domain/editor-tools</span></span>
<span class="line"><span>        └── plugins/           # @domain/editor-plugins</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>设计意图</strong>：</p><ul><li><strong>垂直切分</strong>：大型领域可以拆分成多个子包</li><li><strong>独立版本</strong>：子包可以独立发布</li><li><strong>依赖管理</strong>：子包之间可以使用 workspace 协议</li></ul><h3 id="_5-2-workspace-协议的本质" tabindex="-1">5.2 workspace 协议的本质 <a class="header-anchor" href="#_5-2-workspace-协议的本质" aria-label="Permalink to &quot;5.2 workspace 协议的本质&quot;">​</a></h3><h4 id="版本声明方式" tabindex="-1">版本声明方式 <a class="header-anchor" href="#版本声明方式" aria-label="Permalink to &quot;版本声明方式&quot;">​</a></h4><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@shared/ui&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workspace:*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@shared/utils&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workspace:^&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@shared/hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workspace:~&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@platform/auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workspace:1.2.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>版本符号含义</strong>：</p><table tabindex="0"><thead><tr><th>符号</th><th>含义</th><th>发布时转换</th></tr></thead><tbody><tr><td><code>*</code></td><td>任意版本</td><td>当前精确版本</td></tr><tr><td><code>^</code></td><td>兼容版本</td><td><code>^x.y.z</code></td></tr><tr><td><code>~</code></td><td>patch 版本</td><td><code>~x.y.z</code></td></tr><tr><td><code>x.y.z</code></td><td>精确版本</td><td><code>x.y.z</code></td></tr></tbody></table><p><strong>关键机制：发布时转换</strong></p><p>开发时：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@shared/ui&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workspace:^&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>发布到 npm 后：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@shared/ui&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^1.2.3&quot;</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">  ←</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> 自动转换为真实版本</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>为什么要这样设计？</strong></p><ol><li><strong>开发期</strong>：使用本地链接，修改立即生效</li><li><strong>发布期</strong>：转换为语义化版本，确保用户能从 npm 安装</li></ol><hr><h2 id="第六章-配置-turborepo" tabindex="-1">第六章：配置 Turborepo <a class="header-anchor" href="#第六章-配置-turborepo" aria-label="Permalink to &quot;第六章：配置 Turborepo&quot;">​</a></h2><h3 id="_6-1-turbo-json-的核心概念" tabindex="-1">6.1 turbo.json 的核心概念 <a class="header-anchor" href="#_6-1-turbo-json-的核心概念" aria-label="Permalink to &quot;6.1 turbo.json 的核心概念&quot;">​</a></h3><p>创建 <code>turbo.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;$schema&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://turbo.build/schema.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;globalEnv&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;NODE_ENV&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;globalPassThroughEnv&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CI&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DEBUG&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;tasks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;dependsOn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;outputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dist/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;inputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;src/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;package.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tsconfig.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vite.config.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;persistent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;dependsOn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;outputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;coverage/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;inputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;src/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tests/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;**/*.test.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_6-2-任务依赖-dependson" tabindex="-1">6.2 任务依赖（dependsOn） <a class="header-anchor" href="#_6-2-任务依赖-dependson" aria-label="Permalink to &quot;6.2 任务依赖（dependsOn）&quot;">​</a></h3><h4 id="build-的含义" tabindex="-1">^build 的含义 <a class="header-anchor" href="#build-的含义" aria-label="Permalink to &quot;^build 的含义&quot;">​</a></h4><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;dependsOn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>符号解析</strong>：</p><ul><li><code>^build</code>：上游依赖的 <code>build</code> 任务（topological dependency）</li><li><code>build</code>：当前包的 <code>build</code> 任务（internal dependency）</li></ul><p><strong>工作原理</strong>：</p><p>假设依赖关系：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@app/web (依赖) → @shared/ui (依赖) → @shared/utils</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>执行 <code>turbo run build</code> 时：</p><ol><li><p><strong>构建依赖图</strong>：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@shared/utils:build</span></span>
<span class="line"><span>      ↓</span></span>
<span class="line"><span>@shared/ui:build</span></span>
<span class="line"><span>      ↓</span></span>
<span class="line"><span>@app/web:build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>拓扑排序</strong>：确定执行顺序</p></li><li><p><strong>并行执行</strong>：无依赖关系的任务并行</p></li></ol><h4 id="内部依赖" tabindex="-1">内部依赖 <a class="header-anchor" href="#内部依赖" aria-label="Permalink to &quot;内部依赖&quot;">​</a></h4><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;deploy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;dependsOn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>含义</strong>：<code>deploy</code> 任务必须等待<strong>同一个包</strong>的 <code>build</code> 和 <code>test</code> 完成。</p><h3 id="_6-3-缓存配置-outputs-inputs" tabindex="-1">6.3 缓存配置（outputs &amp; inputs） <a class="header-anchor" href="#_6-3-缓存配置-outputs-inputs" aria-label="Permalink to &quot;6.3 缓存配置（outputs &amp; inputs）&quot;">​</a></h3><h4 id="outputs-声明输出产物" tabindex="-1">outputs：声明输出产物 <a class="header-anchor" href="#outputs-声明输出产物" aria-label="Permalink to &quot;outputs：声明输出产物&quot;">​</a></h4><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;outputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dist/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.next/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;build/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>工作原理</strong>：</p><ol><li><strong>构建前</strong>：计算缓存键</li><li><strong>构建后</strong>：将 <code>outputs</code> 中的文件/目录打包成 tar.gz</li><li><strong>缓存命中时</strong>：解压到对应位置</li></ol><p><strong>为什么要声明 outputs？</strong></p><ul><li>Turborepo 只缓存声明的文件</li><li>未声明的文件不会被恢复</li></ul><h4 id="inputs-声明输入依赖" tabindex="-1">inputs：声明输入依赖 <a class="header-anchor" href="#inputs-声明输入依赖" aria-label="Permalink to &quot;inputs：声明输入依赖&quot;">​</a></h4><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;inputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;src/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;package.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tsconfig.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;!src/**/*.test.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>缓存键计算原理</strong>：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Cache Key = Hash(</span></span>
<span class="line"><span>  inputs 中所有文件的内容</span></span>
<span class="line"><span>  + 任务配置（task definition）</span></span>
<span class="line"><span>  + 环境变量（env）</span></span>
<span class="line"><span>  + 上游 outputs 的哈希</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>精确定义 inputs 的重要性</strong>：</p><p>❌ <strong>不好的配置</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;inputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 包含所有文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>结果：修改 README.md 也会导致缓存失效</p><p>✅ <strong>好的配置</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;inputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;src/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;package.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tsconfig.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;!**/*.test.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;!**/*.md&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>结果：只有影响构建的文件变化才失效缓存</p><h3 id="_6-4-环境变量策略" tabindex="-1">6.4 环境变量策略 <a class="header-anchor" href="#_6-4-环境变量策略" aria-label="Permalink to &quot;6.4 环境变量策略&quot;">​</a></h3><h4 id="globalenv-vs-globalpassthroughenv" tabindex="-1">globalEnv vs globalPassThroughEnv <a class="header-anchor" href="#globalenv-vs-globalpassthroughenv" aria-label="Permalink to &quot;globalEnv vs globalPassThroughEnv&quot;">​</a></h4><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;globalEnv&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;NODE_ENV&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;globalPassThroughEnv&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CI&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DEBUG&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>区别</strong>：</p><table tabindex="0"><thead><tr><th>配置</th><th>影响缓存</th><th>传递给任务</th><th>用途</th></tr></thead><tbody><tr><td><code>globalEnv</code></td><td>✅ 是</td><td>✅ 是</td><td>影响构建结果的变量</td></tr><tr><td><code>globalPassThroughEnv</code></td><td>❌ 否</td><td>✅ 是</td><td>不影响构建的变量</td></tr></tbody></table><p><strong>为什么要区分？</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 场景 1：改变 DEBUG 模式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DEBUG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>如果 <code>DEBUG</code> 在 <code>globalEnv</code> 中 → 缓存失效 ❌</li><li>如果 <code>DEBUG</code> 在 <code>globalPassThroughEnv</code> 中 → 缓存命中 ✅</li></ul><p><strong>设计原则</strong>：</p><ul><li><code>globalEnv</code>：只包含真正影响构建产物的变量（如 <code>NODE_ENV</code>）</li><li><code>globalPassThroughEnv</code>：包含调试、日志级别等变量</li></ul><hr><h2 id="第七章-typescript-配置体系" tabindex="-1">第七章：TypeScript 配置体系 <a class="header-anchor" href="#第七章-typescript-配置体系" aria-label="Permalink to &quot;第七章：TypeScript 配置体系&quot;">​</a></h2><h3 id="_7-1-tsconfig-的继承机制" tabindex="-1">7.1 tsconfig 的继承机制 <a class="header-anchor" href="#_7-1-tsconfig-的继承机制" aria-label="Permalink to &quot;7.1 tsconfig 的继承机制&quot;">​</a></h3><p>TypeScript 支持配置文件继承：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>tsconfig.base.json           # 基础配置</span></span>
<span class="line"><span>       ↑</span></span>
<span class="line"><span>       ├── packages/ui/tsconfig.json</span></span>
<span class="line"><span>       ├── packages/utils/tsconfig.json</span></span>
<span class="line"><span>       └── apps/web/tsconfig.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>创建基础配置</strong> (<code>tsconfig.base.json</code>):</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;$schema&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://json.schemastore.org/tsconfig&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;target&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ES2020&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ESNext&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;moduleResolution&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bundler&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;strict&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;esModuleInterop&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;skipLibCheck&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>包级配置继承</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;extends&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;../../tsconfig.base.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;outDir&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;rootDir&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./src&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;include&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;src&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>继承的本质</strong>：</p><ul><li>子配置会<strong>合并</strong>父配置的字段</li><li>同名字段会<strong>覆盖</strong>父配置</li></ul><h3 id="_7-2-typescript-project-references" tabindex="-1">7.2 TypeScript Project References <a class="header-anchor" href="#_7-2-typescript-project-references" aria-label="Permalink to &quot;7.2 TypeScript Project References&quot;">​</a></h3><h4 id="什么是-project-references" tabindex="-1">什么是 Project References <a class="header-anchor" href="#什么是-project-references" aria-label="Permalink to &quot;什么是 Project References&quot;">​</a></h4><p><strong>问题场景</strong>：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@app/web 依赖 @shared/ui</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>传统方式：</p><ol><li>先编译 <code>@shared/ui</code> → 生成 <code>dist/</code></li><li>再编译 <code>@app/web</code>，引用 <code>@shared/ui/dist</code></li></ol><p><strong>问题</strong>：</p><ul><li>类型信息来自 <code>.d.ts</code> 文件，不是源码</li><li>无法跳转到源码</li><li>无法实现增量编译</li></ul><h4 id="project-references-的解决方案" tabindex="-1">Project References 的解决方案 <a class="header-anchor" href="#project-references-的解决方案" aria-label="Permalink to &quot;Project References 的解决方案&quot;">​</a></h4><p><strong>启用机制</strong>：</p><p><code>shared/ui/tsconfig.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;composite&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 启用项目引用</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;declaration&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 生成 .d.ts</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;declarationMap&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 生成 .d.ts.map（支持跳转到源码）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>apps/web/tsconfig.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;references&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;../../shared/ui&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>工作原理</strong>：</p><ol><li><p><strong>TypeScript 构建模式</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tsc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/web</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>依赖解析</strong>：</p><ul><li>TypeScript 读取 <code>references</code> 字段</li><li>检查被引用项目是否已构建</li><li>如果未构建或过期，先构建依赖</li></ul></li><li><p><strong>增量编译</strong>：</p><ul><li>TypeScript 生成 <code>.tsbuildinfo</code> 文件记录编译状态</li><li>下次构建时只编译变化的部分</li></ul></li></ol><p><strong>优势</strong>：</p><ul><li>支持 Go to Definition 跳转到源码</li><li>增量编译，构建速度更快</li><li>强制依赖顺序，避免循环引用</li></ul><h3 id="_7-3-共享-tsconfig-预设" tabindex="-1">7.3 共享 tsconfig 预设 <a class="header-anchor" href="#_7-3-共享-tsconfig-预设" aria-label="Permalink to &quot;7.3 共享 tsconfig 预设&quot;">​</a></h3><p>创建 <code>platform/config/tsconfig/package.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@internal/tsconfig&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;private&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;files&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;base.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;react.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vue.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>预设配置</strong> (<code>platform/config/tsconfig/react.json</code>):</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;extends&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./base.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;jsx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;react-jsx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;lib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DOM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DOM.Iterable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ES2020&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>使用预设</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;extends&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@internal/tsconfig/react.json&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>设计意图</strong>：</p><ul><li>统一配置：所有 React 项目使用相同配置</li><li>易于维护：修改一处，全局生效</li><li>类型安全：配置本身也有类型检查（通过 <code>$schema</code>）</li></ul><hr><h2 id="第八章-构建第一个共享包" tabindex="-1">第八章：构建第一个共享包 <a class="header-anchor" href="#第八章-构建第一个共享包" aria-label="Permalink to &quot;第八章：构建第一个共享包&quot;">​</a></h2><h3 id="_8-1-包的基本结构" tabindex="-1">8.1 包的基本结构 <a class="header-anchor" href="#_8-1-包的基本结构" aria-label="Permalink to &quot;8.1 包的基本结构&quot;">​</a></h3><p>创建 <code>shared/ui/</code> 目录：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>shared/ui/</span></span>
<span class="line"><span>├── src/</span></span>
<span class="line"><span>│   ├── components/</span></span>
<span class="line"><span>│   │   └── Button.tsx</span></span>
<span class="line"><span>│   └── index.ts</span></span>
<span class="line"><span>├── package.json</span></span>
<span class="line"><span>├── tsconfig.json</span></span>
<span class="line"><span>└── tsup.config.ts</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_8-2-package-json-的关键字段" tabindex="-1">8.2 package.json 的关键字段 <a class="header-anchor" href="#_8-2-package-json-的关键字段" aria-label="Permalink to &quot;8.2 package.json 的关键字段&quot;">​</a></h3><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@shared/ui&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;private&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.cjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.d.ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;exports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;import&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;require&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.cjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.d.ts&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;./button&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;import&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/button.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/button.d.ts&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;files&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dist&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tsup&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tsup --watch&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><strong>关键字段解析</strong>：</p><h4 id="_1-type-module" tabindex="-1">1. type: &quot;module&quot; <a class="header-anchor" href="#_1-type-module" aria-label="Permalink to &quot;1. type: &quot;module&quot;&quot;">​</a></h4><ul><li><strong>含义</strong>：此包是 ES Module</li><li><strong>效果</strong>：<code>.js</code> 文件被视为 ESM，<code>.cjs</code> 被视为 CommonJS</li></ul><h4 id="_2-exports-字段" tabindex="-1">2. exports 字段 <a class="header-anchor" href="#_2-exports-字段" aria-label="Permalink to &quot;2. exports 字段&quot;">​</a></h4><p><strong>新的模块导出标准</strong>（Node.js 12.7+）：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;exports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;import&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ESM 入口</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;require&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.cjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// CJS 入口</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.d.ts&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 类型入口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;./button&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;import&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/button.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>工作原理</strong>：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用户代码</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Button } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@shared/ui&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用 &quot;.&quot; 入口</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Button } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@shared/ui/button&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用 &quot;./button&quot; 入口</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Node.js 的解析逻辑：</p><ol><li>检测用户环境（ESM 还是 CJS）</li><li>查找对应的 <code>import</code> 或 <code>require</code> 字段</li><li>加载对应的文件</li></ol><p><strong>为什么要支持多个导出？</strong></p><ul><li>按需加载：用户可以只导入 <code>button</code>，不加载整个库</li><li>Tree-shaking：构建工具可以更好地优化</li></ul><h4 id="_3-files-字段" tabindex="-1">3. files 字段 <a class="header-anchor" href="#_3-files-字段" aria-label="Permalink to &quot;3. files 字段&quot;">​</a></h4><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;files&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dist&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>作用</strong>：</p><ul><li>指定发布到 npm 时包含的文件</li><li>默认会排除 <code>src/</code>, <code>tests/</code> 等开发文件</li></ul><h3 id="_8-3-构建配置-tsup" tabindex="-1">8.3 构建配置：tsup <a class="header-anchor" href="#_8-3-构建配置-tsup" aria-label="Permalink to &quot;8.3 构建配置：tsup&quot;">​</a></h3><p>创建 <code>tsup.config.ts</code>：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;tsup&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  entry: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    index: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;src/index.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    button: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;src/components/Button.tsx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  format: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;esm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  dts: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  clean: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  external: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;react&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;react-dom&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  treeshake: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>配置解析</strong>：</p><h4 id="entry-多入口配置" tabindex="-1">entry：多入口配置 <a class="header-anchor" href="#entry-多入口配置" aria-label="Permalink to &quot;entry：多入口配置&quot;">​</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  entry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;src/index.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;src/components/Button.tsx&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>输出</strong>：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>dist/</span></span>
<span class="line"><span>├── index.js</span></span>
<span class="line"><span>├── index.cjs</span></span>
<span class="line"><span>├── index.d.ts</span></span>
<span class="line"><span>├── button.js</span></span>
<span class="line"><span>├── button.cjs</span></span>
<span class="line"><span>└── button.d.ts</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="format-输出格式" tabindex="-1">format：输出格式 <a class="header-anchor" href="#format-输出格式" aria-label="Permalink to &quot;format：输出格式&quot;">​</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;esm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>为什么要同时输出 CJS 和 ESM？</strong></p><ul><li><strong>ESM</strong>：现代构建工具（Vite、Rollup）首选</li><li><strong>CJS</strong>：Node.js 和老工具（Webpack 4）兼容</li></ul><h4 id="dts-生成类型文件" tabindex="-1">dts：生成类型文件 <a class="header-anchor" href="#dts-生成类型文件" aria-label="Permalink to &quot;dts：生成类型文件&quot;">​</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  dts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>工作原理</strong>：</p><ul><li>tsup 内部调用 TypeScript 编译器</li><li>生成 <code>.d.ts</code> 文件</li><li>保留源码的类型信息</li></ul><h4 id="external-外部依赖" tabindex="-1">external：外部依赖 <a class="header-anchor" href="#external-外部依赖" aria-label="Permalink to &quot;external：外部依赖&quot;">​</a></h4><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  external</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;react&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;react-dom&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>含义</strong>：</p><ul><li>不将 <code>react</code> 打包到产物中</li><li>期望用户自己安装 <code>react</code></li></ul><p><strong>对应 package.json</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;peerDependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;react&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^18.0.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_8-4-示例组件" tabindex="-1">8.4 示例组件 <a class="header-anchor" href="#_8-4-示例组件" aria-label="Permalink to &quot;8.4 示例组件&quot;">​</a></h3><p><code>src/components/Button.tsx</code>：</p><div class="language-tsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> React </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;react&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ButtonProps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  variant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;primary&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;secondary&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;danger&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  children</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> React</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ReactNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Button</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> React</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ButtonProps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">variant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;primary&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">children</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">onClick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> className</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`btn btn-${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">variant</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{onClick}&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {children}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>src/index.ts</code>：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Button } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./components/Button&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ButtonProps } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./components/Button&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_8-5-在应用中使用" tabindex="-1">8.5 在应用中使用 <a class="header-anchor" href="#_8-5-在应用中使用" aria-label="Permalink to &quot;8.5 在应用中使用&quot;">​</a></h3><p><strong>1. 添加依赖</strong>：</p><p><code>apps/web/package.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@shared/ui&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workspace:*&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>2. 安装依赖</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>pnpm 会创建符号链接：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>apps/web/node_modules/@shared/ui → ../../../shared/ui</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>3. 使用组件</strong>：</p><div class="language-tsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Button } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@shared/ui&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> variant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;primary&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Clicked!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)}&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Click Me</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_8-6-构建流程" tabindex="-1">8.6 构建流程 <a class="header-anchor" href="#_8-6-构建流程" aria-label="Permalink to &quot;8.6 构建流程&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从根目录执行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>Turborepo 的执行流程</strong>：</p><ol><li><strong>扫描 workspace</strong>：找到所有包</li><li><strong>构建依赖图</strong>：<div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@shared/ui:build</span></span>
<span class="line"><span>      ↓</span></span>
<span class="line"><span>@app/web:build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><strong>执行任务</strong>： <ul><li>先执行 <code>@shared/ui:build</code>（因为 <code>dependsOn: [&quot;^build&quot;]</code>）</li><li>再执行 <code>@app/web:build</code></li></ul></li><li><strong>缓存结果</strong>：保存 <code>dist/</code> 到缓存</li></ol><hr><h2 id="第九章-依赖管理系统" tabindex="-1">第九章：依赖管理系统 <a class="header-anchor" href="#第九章-依赖管理系统" aria-label="Permalink to &quot;第九章：依赖管理系统&quot;">​</a></h2><h3 id="_9-1-catalog-的本质" tabindex="-1">9.1 Catalog 的本质 <a class="header-anchor" href="#_9-1-catalog-的本质" aria-label="Permalink to &quot;9.1 Catalog 的本质&quot;">​</a></h3><h4 id="问题场景" tabindex="-1">问题场景 <a class="header-anchor" href="#问题场景" aria-label="Permalink to &quot;问题场景&quot;">​</a></h4><p>随着包数量增加，依赖版本开始碎片化：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看 vue 的版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vue</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@app/web:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vue</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3.4.14</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@app/mobile:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vue</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3.4.15</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@shared/ui:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vue</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3.4.14</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@shared/hooks:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vue</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3.4.13</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>问题</strong>：</p><ul><li>版本不一致可能导致类型冲突</li><li>手动同步版本耗时且容易出错</li><li>无法快速升级所有包的依赖</li></ul><h4 id="catalog-的解决方案" tabindex="-1">Catalog 的解决方案 <a class="header-anchor" href="#catalog-的解决方案" aria-label="Permalink to &quot;Catalog 的解决方案&quot;">​</a></h4><p><strong>核心理念</strong>：<strong>集中化的版本声明</strong></p><p>编辑 <code>pnpm-workspace.yaml</code>：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">packages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;apps/*&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;shared/*&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">catalog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  vue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^3.4.14</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  react</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^19.0.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  typescript</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^5.8.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  vite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^5.4.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  lodash-es</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^4.17.21</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>工作原理</strong>：</p><ol><li><strong>集中声明</strong>：在 workspace 配置中定义版本</li><li><strong>引用语法</strong>：包使用 <code>catalog:</code> 协议</li><li><strong>版本分发</strong>：pnpm 自动使用 catalog 中的版本</li></ol><h3 id="_9-2-迁移到-catalog" tabindex="-1">9.2 迁移到 Catalog <a class="header-anchor" href="#_9-2-迁移到-catalog" aria-label="Permalink to &quot;9.2 迁移到 Catalog&quot;">​</a></h3><h4 id="修改子包配置" tabindex="-1">修改子包配置 <a class="header-anchor" href="#修改子包配置" aria-label="Permalink to &quot;修改子包配置&quot;">​</a></h4><p><strong>修改前</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;vue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^3.4.14&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;axios&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^1.6.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>修改后</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;vue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;catalog:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;axios&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;catalog:&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="批量迁移脚本" tabindex="-1">批量迁移脚本 <a class="header-anchor" href="#批量迁移脚本" aria-label="Permalink to &quot;批量迁移脚本&quot;">​</a></h4><p>创建 <code>tooling/catalog-manager/</code> 工具：</p><p><strong>核心算法</strong>：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 收集所有依赖及其版本</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DependencyInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  versions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 版本 → 使用次数</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  packages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用此依赖的包</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> collectDependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> allDeps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DependencyInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. 扫描所有 package.json</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> packagePaths</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> glob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;**/package.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ignore: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;**/node_modules/**&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. 收集依赖信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pkgPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> packagePaths) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pkg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pkgPath, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">entries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pkg.dependencies </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {})) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 跳过 workspace: 和 catalog: 协议</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (version.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;workspace:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> version.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;catalog:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allDeps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        allDeps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          versions: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          packages: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> depInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> allDeps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> count</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> depInfo.versions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(version) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      depInfo.versions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(version, count </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      depInfo.packages.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pkg.name);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 3. 生成 catalog</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> catalog</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">depInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> allDeps) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> versions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Array.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(depInfo.versions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">entries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (versions.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 单一版本</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      catalog[name] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> versions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 版本冲突：选择最高版本</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sorted</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> versions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        semver.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extractVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(b[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extractVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      catalog[name] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sorted[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`⚠️  ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} 存在版本冲突:`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      versions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(([</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`   ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}: ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">count</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} 个包`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> catalog;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p><strong>执行流程</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 收集现有依赖</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> catalog:collect</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">⚠️</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  vue</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 存在版本冲突:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   ^3.4.15:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 个包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   ^3.4.14:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 个包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   ^3.4.13:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 个包</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">✓</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 已收集</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 45</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 个依赖到</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> catalog</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 分发到各个包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> catalog:distribute</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">✓</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 更新</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/web/package.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">✓</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 更新</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/mobile/package.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">✓</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 更新</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shared/ui/package.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_9-3-多版本支持-catalogs" tabindex="-1">9.3 多版本支持：catalogs <a class="header-anchor" href="#_9-3-多版本支持-catalogs" aria-label="Permalink to &quot;9.3 多版本支持：catalogs&quot;">​</a></h3><h4 id="场景-vue-2-和-vue-3-共存" tabindex="-1">场景：Vue 2 和 Vue 3 共存 <a class="header-anchor" href="#场景-vue-2-和-vue-3-共存" aria-label="Permalink to &quot;场景：Vue 2 和 Vue 3 共存&quot;">​</a></h4><p>某些情况下，需要在同一个 Monorepo 中支持不同版本的依赖：</p><ul><li>老项目使用 Vue 2，新项目使用 Vue 3</li><li>需要渐进式迁移，不能一次性升级</li></ul><p><strong>解决方案：catalogs（多 catalog）</strong></p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># pnpm-workspace.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">catalog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 默认版本（主流技术栈）</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  vue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^3.4.14</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;@vitejs/plugin-vue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^5.0.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  vue-router</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^4.3.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 多版本 catalog</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">catalogs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Vue 2 技术栈</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  vue2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    vue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^2.7.14</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;@vitejs/plugin-vue2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^2.3.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    vue-router</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^3.6.5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    vuex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^3.6.2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # React 17 技术栈（兼容老项目）</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  react17</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    react</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^17.0.2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    react-dom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^17.0.2</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;@types/react&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^17.0.0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="如何使用不同的-catalog" tabindex="-1">如何使用不同的 catalog <a class="header-anchor" href="#如何使用不同的-catalog" aria-label="Permalink to &quot;如何使用不同的 catalog&quot;">​</a></h4><p><strong>默认 catalog</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;vue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;catalog:&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>使用特定 catalog</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;vue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;catalog:vue2&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>工作原理</strong>：</p><ol><li>pnpm 解析 <code>catalog:vue2</code> 时：</li><li>在 <code>catalogs.vue2</code> 中查找 <code>vue</code> 字段</li><li>找到版本 <code>^2.7.14</code></li><li>安装对应版本</li></ol><h4 id="版本隔离的本质" tabindex="-1">版本隔离的本质 <a class="header-anchor" href="#版本隔离的本质" aria-label="Permalink to &quot;版本隔离的本质&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>项目 A (Vue 3)             项目 B (Vue 2)</span></span>
<span class="line"><span>    ↓                           ↓</span></span>
<span class="line"><span>  catalog:                  catalog:vue2</span></span>
<span class="line"><span>    ↓                           ↓</span></span>
<span class="line"><span>  ^3.4.14                     ^2.7.14</span></span>
<span class="line"><span>    ↓                           ↓</span></span>
<span class="line"><span>node_modules/.pnpm/</span></span>
<span class="line"><span>├── vue@3.4.14/</span></span>
<span class="line"><span>└── vue@2.7.14/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>关键点</strong>：</p><ul><li>不同版本的包会被安装到不同的路径</li><li>符号链接确保每个项目使用正确的版本</li><li>类型系统也会正确识别版本</li></ul><h3 id="_9-4-overrides-强制版本覆盖" tabindex="-1">9.4 Overrides：强制版本覆盖 <a class="header-anchor" href="#_9-4-overrides-强制版本覆盖" aria-label="Permalink to &quot;9.4 Overrides：强制版本覆盖&quot;">​</a></h3><h4 id="问题场景-1" tabindex="-1">问题场景 <a class="header-anchor" href="#问题场景-1" aria-label="Permalink to &quot;问题场景&quot;">​</a></h4><p>第三方包的子依赖版本有安全漏洞：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>你的项目</span></span>
<span class="line"><span>  └── some-lib@1.0.0</span></span>
<span class="line"><span>        └── axios@0.21.0  ← 有安全漏洞</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>你无法直接控制 <code>some-lib</code> 的依赖版本。</p><h4 id="pnpm-overrides" tabindex="-1">pnpm Overrides <a class="header-anchor" href="#pnpm-overrides" aria-label="Permalink to &quot;pnpm Overrides&quot;">​</a></h4><p>编辑根 <code>package.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;pnpm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;overrides&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 1. 强制所有 axios 使用 1.7.0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;axios&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.7.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 2. 强制特定范围的版本升级</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;axios@&lt;1.6.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.7.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 3. 使用 catalog 中的版本</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;lodash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$lodash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 4. 针对特定包的子依赖</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;some-lib&gt;axios&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.7.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>工作原理</strong>：</p><ol><li>pnpm 构建依赖树时</li><li>检查 <code>overrides</code> 配置</li><li>匹配的依赖会被替换为指定版本</li><li>即使 <code>some-lib</code> 声明了 <code>axios@0.21.0</code>，实际安装的是 <code>1.7.0</code></li></ol><p><strong>应用场景</strong>：</p><ul><li>安全漏洞修复</li><li>统一依赖版本</li><li>修复兼容性问题</li></ul><hr><h2 id="第十章-构建性能优化" tabindex="-1">第十章：构建性能优化 <a class="header-anchor" href="#第十章-构建性能优化" aria-label="Permalink to &quot;第十章：构建性能优化&quot;">​</a></h2><h3 id="_10-1-缓存命中率优化" tabindex="-1">10.1 缓存命中率优化 <a class="header-anchor" href="#_10-1-缓存命中率优化" aria-label="Permalink to &quot;10.1 缓存命中率优化&quot;">​</a></h3><h4 id="问题诊断" tabindex="-1">问题诊断 <a class="header-anchor" href="#问题诊断" aria-label="Permalink to &quot;问题诊断&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看缓存统计</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --summarize</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Summary:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Tasks:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 12</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Cache</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Hit:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ←</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 命中率只有</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 25%</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Cache</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Miss:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 9</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>低命中率的常见原因</strong>：</p><ol><li>inputs 定义不精确</li><li>环境变量污染</li><li>lockfile 未纳入 inputs</li><li>时间戳、随机数导致输出不一致</li></ol><h4 id="优化策略-1-精确定义-inputs" tabindex="-1">优化策略 1：精确定义 inputs <a class="header-anchor" href="#优化策略-1-精确定义-inputs" aria-label="Permalink to &quot;优化策略 1：精确定义 inputs&quot;">​</a></h4><p><strong>不好的配置</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;inputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 包含所有文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>问题</strong>：</p><ul><li>修改 README.md → 缓存失效</li><li>修改测试文件 → 缓存失效</li><li>修改配置注释 → 缓存失效</li></ul><p><strong>优化后的配置</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;inputs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ✓ 包含：影响构建结果的文件</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;src/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;public/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;package.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;tsconfig.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;vite.config.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;pnpm-lock.yaml&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ✗ 排除：不影响构建的文件</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;!src/**/*.test.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;!src/**/*.spec.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;!src/**/__tests__/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;!src/**/__mocks__/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;!**/*.md&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;!.vscode/**&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>原理</strong>：</p><ul><li>Turborepo 计算 inputs 文件的哈希值</li><li>只有相关文件变化才会导致缓存失效</li><li>文档、测试文件的修改不会影响生产构建</li></ul><h4 id="优化策略-2-环境变量策略" tabindex="-1">优化策略 2：环境变量策略 <a class="header-anchor" href="#优化策略-2-环境变量策略" aria-label="Permalink to &quot;优化策略 2：环境变量策略&quot;">​</a></h4><p><strong>问题场景</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开发者 A</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Cache Miss</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开发者 B</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEBUG=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Cache Miss（应该命中！）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>原因分析</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;env&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;NODE_ENV&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DEBUG&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;USER&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;HOME&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>DEBUG</code> 变化导致缓存键不同</li><li>但 <code>DEBUG</code> 不影响构建产物</li></ul><p><strong>优化配置</strong>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;globalEnv&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;NODE_ENV&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 只包含真正影响构建的变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;globalPassThroughEnv&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CI&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CI_*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DEBUG&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;VERBOSE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;tasks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;env&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;VITE_API_URL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 会被注入到构建产物</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;VITE_APP_VERSION&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 会影响版本号</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;passThroughEnv&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;DEBUG&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 传递给进程，但不影响缓存</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>区别</strong>：</p><table tabindex="0"><thead><tr><th>配置</th><th>影响缓存</th><th>传递给进程</th><th>用途</th></tr></thead><tbody><tr><td><code>env</code></td><td>✅ 是</td><td>✅ 是</td><td>影响构建产物的变量</td></tr><tr><td><code>passThroughEnv</code></td><td>❌ 否</td><td>✅ 是</td><td>调试、日志变量</td></tr></tbody></table><h3 id="_10-2-远程缓存" tabindex="-1">10.2 远程缓存 <a class="header-anchor" href="#_10-2-远程缓存" aria-label="Permalink to &quot;10.2 远程缓存&quot;">​</a></h3><h4 id="为什么需要远程缓存" tabindex="-1">为什么需要远程缓存 <a class="header-anchor" href="#为什么需要远程缓存" aria-label="Permalink to &quot;为什么需要远程缓存&quot;">​</a></h4><p><strong>场景</strong>：</p><ul><li>开发者 A 构建了某个包</li><li>开发者 B 拉取代码后，需要重新构建相同的内容</li><li>CI 环境每次都从零开始构建</li></ul><p><strong>本质问题</strong>：<strong>缓存无法跨机器共享</strong></p><h4 id="远程缓存的工作原理" tabindex="-1">远程缓存的工作原理 <a class="header-anchor" href="#远程缓存的工作原理" aria-label="Permalink to &quot;远程缓存的工作原理&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>开发者 A                        远程缓存服务器                    开发者 B</span></span>
<span class="line"><span>   |                                  |                            |</span></span>
<span class="line"><span>   | 1. 构建项目                       |                            |</span></span>
<span class="line"><span>   |---------------------------------&gt;|                            |</span></span>
<span class="line"><span>   | 2. 上传缓存（cache key + tar）    |                            |</span></span>
<span class="line"><span>   |                                  |                            |</span></span>
<span class="line"><span>   |                                  | 3. 存储缓存                |</span></span>
<span class="line"><span>   |                                  |                            |</span></span>
<span class="line"><span>   |                                  |&lt;---------------------------|</span></span>
<span class="line"><span>   |                                  | 4. 查询缓存（cache key）   |</span></span>
<span class="line"><span>   |                                  |                            |</span></span>
<span class="line"><span>   |                                  |---------------------------&gt;|</span></span>
<span class="line"><span>   |                                  | 5. 返回缓存                |</span></span>
<span class="line"><span>   |                                  |                            |</span></span>
<span class="line"><span>   |                                  | 6. 直接恢复，跳过构建      |</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>缓存键计算</strong>（保证一致性）：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Cache Key = Hash(</span></span>
<span class="line"><span>  任务配置（来自 turbo.json）</span></span>
<span class="line"><span>  + 输入文件内容（来自 Git）</span></span>
<span class="line"><span>  + 环境变量</span></span>
<span class="line"><span>  + 上游依赖的输出哈希</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>关键</strong>：只要代码和配置相同，所有机器计算出的缓存键都相同。</p><h4 id="配置远程缓存" tabindex="-1">配置远程缓存 <a class="header-anchor" href="#配置远程缓存" aria-label="Permalink to &quot;配置远程缓存&quot;">​</a></h4><p><strong>方案 1：使用 Vercel（最简单）</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 登录 Vercel</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> login</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 链接项目</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>方案 2：自建缓存服务器（基于 S3/OSS）</strong></p><p>创建简单的缓存服务：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// tooling/cache-server/src/server.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createServer } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;http&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { S3Client, PutObjectCommand, GetObjectCommand } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@aws-sdk/client-s3&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> s3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> S3Client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ region: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;us-east-1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> BUCKET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;my-turbo-cache&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(req.url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`http://${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">req</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">headers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // GET /v1/artifacts/:hash - 下载缓存</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (req.method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;GET&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/v1/artifacts/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cacheKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s3.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GetObjectCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          Bucket: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BUCKET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          Key: cacheKey,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application/octet-stream&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      response.Body?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // PUT /v1/artifacts/:hash - 上传缓存</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (req.method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;PUT&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/v1/artifacts/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cacheKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> chunks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    req.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunks.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunk));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    req.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Buffer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">concat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunks);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s3.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PutObjectCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          Bucket: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BUCKET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          Key: cacheKey,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          Body: body,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p><strong>配置 Turborepo</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 环境变量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TURBO_API</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://localhost:3000&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TURBO_TOKEN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;your-secret-token&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TURBO_TEAM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;your-team-id&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>turbo.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;remoteCache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;signature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>使用效果</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开发者 A</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">•</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @shared/ui:build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (5.2s)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行构建，上传缓存</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开发者 B（10分钟后）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">•</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @shared/ui:build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CACHED)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从远程缓存恢复</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_10-3-并行度优化" tabindex="-1">10.3 并行度优化 <a class="header-anchor" href="#_10-3-并行度优化" aria-label="Permalink to &quot;10.3 并行度优化&quot;">​</a></h3><p>Turborepo 默认并行执行无依赖的任务，但可以调整并发数：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用所有 CPU 核心</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --concurrency</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 100%</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 限制并发数（避免 OOM）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --concurrency</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 串行执行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --concurrency</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>何时限制并发</strong>：</p><ul><li>CI 环境资源有限</li><li>构建任务内存占用大</li><li>避免磁盘 I/O 竞争</li></ul><hr><h2 id="第十一章-架构治理机制" tabindex="-1">第十一章：架构治理机制 <a class="header-anchor" href="#第十一章-架构治理机制" aria-label="Permalink to &quot;第十一章：架构治理机制&quot;">​</a></h2><h3 id="_11-1-turborepo-boundaries" tabindex="-1">11.1 Turborepo Boundaries <a class="header-anchor" href="#_11-1-turborepo-boundaries" aria-label="Permalink to &quot;11.1 Turborepo Boundaries&quot;">​</a></h3><h4 id="为什么需要边界约束" tabindex="-1">为什么需要边界约束 <a class="header-anchor" href="#为什么需要边界约束" aria-label="Permalink to &quot;为什么需要边界约束&quot;">​</a></h4><p><strong>问题场景</strong>：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@shared/ui 依赖 @domain/editor  ← 错误！共享层不应该依赖领域层</span></span>
<span class="line"><span>@domain/user 依赖 @domain/order ← 错误！领域之间不应该直接依赖</span></span>
<span class="line"><span>@platform/auth 依赖 @app/web    ← 错误！平台层不应该依赖应用层</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>本质问题</strong>：<strong>依赖方向混乱导致架构腐化</strong></p><h4 id="boundaries-的解决方案" tabindex="-1">Boundaries 的解决方案 <a class="header-anchor" href="#boundaries-的解决方案" aria-label="Permalink to &quot;Boundaries 的解决方案&quot;">​</a></h4><p><strong>核心理念</strong>：<strong>用标签（tags）标记包的层级，用规则（rules）约束依赖方向</strong></p><p><strong>步骤 1：为包添加标签</strong></p><p><code>apps/web/turbo.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app:web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>domains/user/turbo.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;domain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;domain:user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>shared/ui/turbo.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;shared&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ui&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>platform/auth/turbo.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;platform&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>步骤 2：定义边界规则</strong></p><p>根 <code>turbo.json</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;boundaries&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 应用层规则</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;deny&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 应用之间不能互相依赖</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 领域层规则</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;domain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;deny&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;domain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 不能依赖应用、不能互相依赖</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 共享层规则</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;shared&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;allow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;shared&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;platform&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 只能依赖共享层和平台层</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;deny&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;domain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 平台层规则</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;platform&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          &quot;deny&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;domain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;shared&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 最底层,不依赖任何业务代码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><strong>步骤 3：检查违规</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> turbo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> boundaries</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">❌</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Boundary</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> violations</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> detected:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @shared/ui</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> depends</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @domain/editor</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @shared/ui</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> has</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;shared&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @domain/editor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> has</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;domain&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Rule:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;shared&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cannot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> depend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;domain&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Location:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shared/ui/package.json:15</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>工作原理</strong>：</p><ol><li>Turborepo 扫描所有包的 <code>package.json</code></li><li>提取依赖关系</li><li>根据标签和规则检查</li><li>报告违规情况</li></ol><h4 id="在-ci-中强制执行" tabindex="-1">在 CI 中强制执行 <a class="header-anchor" href="#在-ci-中强制执行" aria-label="Permalink to &quot;在 CI 中强制执行&quot;">​</a></h4><p><code>.gitlab-ci.yml</code>：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">lint-architecture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo boundaries</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">if [ $? -ne 0 ]; then</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      echo &quot;Architecture boundary violations detected!&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      exit 1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      fi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>效果</strong>：</p><ul><li>PR 中的违规依赖会被自动拒绝</li><li>强制团队遵守架构规则</li></ul><h3 id="_11-2-代码生成器" tabindex="-1">11.2 代码生成器 <a class="header-anchor" href="#_11-2-代码生成器" aria-label="Permalink to &quot;11.2 代码生成器&quot;">​</a></h3><h4 id="为什么需要生成器" tabindex="-1">为什么需要生成器 <a class="header-anchor" href="#为什么需要生成器" aria-label="Permalink to &quot;为什么需要生成器&quot;">​</a></h4><p><strong>问题</strong>：</p><ul><li>手动创建包，步骤繁琐</li><li>容易遗漏配置文件</li><li>命名规范不统一</li></ul><p><strong>解决方案</strong>：<strong>自动化包创建流程</strong></p><h4 id="实现包生成器" tabindex="-1">实现包生成器 <a class="header-anchor" href="#实现包生成器" aria-label="Permalink to &quot;实现包生成器&quot;">​</a></h4><p><strong>创建模板</strong>（<code>tooling/generator/templates/package/</code>）：</p><p><code>package.json.hbs</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{scope}}/{{name}}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;private&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.cjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.d.ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;exports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;import&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;require&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.cjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist/index.d.ts&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tsup&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tsup --watch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;lint&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;eslint src&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;devDependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@internal/tsconfig&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workspace:*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;@internal/eslint-config&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workspace:*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;tsup&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;catalog:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;typescript&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;catalog:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;vitest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;catalog:&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><code>tsconfig.json.hbs</code>：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;extends&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@internal/tsconfig/base.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;composite&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;outDir&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./dist&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;rootDir&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./src&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;include&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;src&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>生成器脚本</strong>（<code>tooling/generator/src/create-package.ts</code>）：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { mkdir, writeFile } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;fs/promises&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { readFile } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;fs/promises&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Handlebars </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;handlebars&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { join } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;path&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prompts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;prompts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createPackage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. 交互式输入</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> answers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> prompts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;select&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;layer&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;选择层级&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      choices: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;App（应用层）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;apps&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Domain（领域层）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;domains&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Shared（共享层）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;shared&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Platform（平台层）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;platform&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;text&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;包名（如: ui-components）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;select&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;buildTool&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;构建工具&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      choices: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tsup（推荐）&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tsup&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;vite&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;vite&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;rollup&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;rollup&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. 生成 scope</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scopeMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    apps: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@app&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    domains: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@domain&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    shared: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@shared&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    platform: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@platform&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scope</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scopeMap[answers.layer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> keyof</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scopeMap];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 3. 创建目录</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> packagePath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(answers.layer, answers.name);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mkdir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(packagePath, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;src&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), { recursive: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 4. 生成 package.json</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pkgTemplate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;tooling/generator/templates/package/package.json.hbs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> compiledPkg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Handlebars.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pkgTemplate);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> packageJson</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compiledPkg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    scope,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: answers.name,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    buildTool: answers.buildTool,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(packagePath, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;package.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), packageJson);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 5. 生成 tsconfig.json</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tsconfigTemplate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;tooling/generator/templates/package/tsconfig.json.hbs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(packagePath, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tsconfig.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), tsconfigTemplate);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 6. 生成入口文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(packagePath, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;src/index.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`// ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scope</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">export {}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 7. 生成 turbo.json（添加标签）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> layerTag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> answers.layer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// apps → app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(packagePath, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;turbo.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tags: [layerTag, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">layerTag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`✓ Created ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scope</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} at ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">packagePath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Next steps:`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`  1. cd ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">packagePath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`  2. pnpm install`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`  3. pnpm dev`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createPackage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br></div></div><p><strong>使用</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加到根 package.json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  &quot;scripts&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;create:package&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;tsx tooling/generator/src/create-package.ts&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建新包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create:package</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 选择层级 › Shared（共享层）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 包名 › hooks</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 构建工具 › tsup（推荐）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">✓</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Created</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @shared/hooks</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shared/hooks</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Next</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> steps:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  1.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shared/hooks</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  2.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  3.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><hr><h2 id="第十二章-ci-cd-集成" tabindex="-1">第十二章：CI/CD 集成 <a class="header-anchor" href="#第十二章-ci-cd-集成" aria-label="Permalink to &quot;第十二章：CI/CD 集成&quot;">​</a></h2><h3 id="_12-1-ci-环境的特殊性" tabindex="-1">12.1 CI 环境的特殊性 <a class="header-anchor" href="#_12-1-ci-环境的特殊性" aria-label="Permalink to &quot;12.1 CI 环境的特殊性&quot;">​</a></h3><h4 id="与本地开发的区别" tabindex="-1">与本地开发的区别 <a class="header-anchor" href="#与本地开发的区别" aria-label="Permalink to &quot;与本地开发的区别&quot;">​</a></h4><table tabindex="0"><thead><tr><th>维度</th><th>本地开发</th><th>CI 环境</th></tr></thead><tbody><tr><td>缓存</td><td>持久化本地磁盘</td><td>跨 Job 需要缓存机制</td></tr><tr><td>依赖安装</td><td>增量安装</td><td>每次全新安装</td></tr><tr><td>构建</td><td>可能跳过测试</td><td>必须全流程</td></tr><tr><td>并发</td><td>CPU 核心数</td><td>需要限制资源使用</td></tr></tbody></table><h4 id="ci-优化目标" tabindex="-1">CI 优化目标 <a class="header-anchor" href="#ci-优化目标" aria-label="Permalink to &quot;CI 优化目标&quot;">​</a></h4><ol><li><strong>加快安装速度</strong>：缓存 pnpm store</li><li><strong>加快构建速度</strong>：缓存 Turbo 输出</li><li><strong>节省资源</strong>：只构建受影响的包</li><li><strong>提前失败</strong>：先执行快速检查（lint）</li></ol><h3 id="_12-2-github-actions-配置" tabindex="-1">12.2 GitHub Actions 配置 <a class="header-anchor" href="#_12-2-github-actions-配置" aria-label="Permalink to &quot;12.2 GitHub Actions 配置&quot;">​</a></h3><p><strong>完整配置</strong>（<code>.github/workflows/ci.yml</code>）：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CI</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">develop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  pull_request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">develop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  PNPM_VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;10.24.0&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  NODE_VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;20&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Job 1: 安装依赖</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          fetch-depth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Turbo 需要完整 Git 历史</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup Node.js</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.NODE_VERSION }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.PNPM_VERSION }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 缓存 pnpm store</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Get pnpm store directory</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm-cache</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">echo &quot;STORE_PATH=$(pnpm store path)&quot; &gt;&gt; $GITHUB_OUTPUT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup pnpm cache</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/cache@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ steps.pnpm-cache.outputs.STORE_PATH }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ runner.os }}-pnpm-store-${{ hashFiles(&#39;**/pnpm-lock.yaml&#39;) }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          restore-keys</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            ${{ runner.os }}-pnpm-store-</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Install dependencies</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm install --frozen-lockfile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 缓存 node_modules（供后续 Job 使用）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Cache node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/cache/save@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ runner.os }}-node_modules-${{ hashFiles(&#39;**/pnpm-lock.yaml&#39;) }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Job 2: Lint（快速失败）</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  lint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">setup</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.NODE_VERSION }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.PNPM_VERSION }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Restore node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/cache/restore@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ runner.os }}-node_modules-${{ hashFiles(&#39;**/pnpm-lock.yaml&#39;) }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Lint</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo run lint</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Job 3: Type Check</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  type-check</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">setup</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.NODE_VERSION }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.PNPM_VERSION }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Restore node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/cache/restore@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ runner.os }}-node_modules-${{ hashFiles(&#39;**/pnpm-lock.yaml&#39;) }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Type check</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo run type-check</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Job 4: Test（并行执行）</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">setup</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          fetch-depth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.NODE_VERSION }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.PNPM_VERSION }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Restore node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/cache/restore@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ runner.os }}-node_modules-${{ hashFiles(&#39;**/pnpm-lock.yaml&#39;) }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 缓存 Turbo 输出</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup Turbo cache</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/cache@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.turbo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ runner.os }}-turbo-${{ github.sha }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          restore-keys</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            ${{ runner.os }}-turbo-</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Run tests</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo run test --output-logs=new-only</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Upload coverage</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">codecov/codecov-action@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          files</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./coverage/coverage-final.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Job 5: Build（必须等待所有检查通过）</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">lint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">type-check</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          fetch-depth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.NODE_VERSION }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.PNPM_VERSION }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Restore node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/cache/restore@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ runner.os }}-node_modules-${{ hashFiles(&#39;**/pnpm-lock.yaml&#39;) }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup Turbo cache</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/cache@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.turbo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ runner.os }}-turbo-${{ github.sha }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          restore-keys</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            ${{ runner.os }}-turbo-</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo run build --output-logs=new-only</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Upload artifacts</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/upload-artifact@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">dist</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            apps/*/dist</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            packages/*/dist</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          retention-days</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Job 6: Architecture Check</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  architecture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">setup</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.NODE_VERSION }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ env.PNPM_VERSION }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Restore node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/cache/restore@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ runner.os }}-node_modules-${{ hashFiles(&#39;**/pnpm-lock.yaml&#39;) }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Check boundaries</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo boundaries</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br></div></div><p><strong>关键优化点</strong>：</p><ol><li><strong>并行执行</strong>：<code>lint</code>, <code>type-check</code>, <code>test</code>, <code>architecture</code> 并行</li><li><strong>Turbo 缓存</strong>：跨 Job 共享构建缓存</li><li><strong>pnpm 缓存</strong>：缓存全局 store</li><li><strong>提前失败</strong>：先执行快速检查</li></ol><h3 id="_12-3-gitlab-ci-配置" tabindex="-1">12.3 GitLab CI 配置 <a class="header-anchor" href="#_12-3-gitlab-ci-配置" aria-label="Permalink to &quot;12.3 GitLab CI 配置&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">variables</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  PNPM_VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;10.24.0&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  NODE_VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;20&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  PNPM_CACHE_FOLDER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.pnpm-store</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">stages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">install</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">check</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">deploy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    files</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm-lock.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.pnpm-store</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node_modules</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.turbo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装依赖</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">install</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node:${NODE_VERSION}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  before_script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack enable</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack prepare pnpm@${PNPM_VERSION} --activate</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm config set store-dir .pnpm-store</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm install --frozen-lockfile</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  artifacts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node_modules</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.pnpm-store</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    expire_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1 day</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 代码检查</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">lint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">check</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node:${NODE_VERSION}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  before_script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack enable</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack prepare pnpm@${PNPM_VERSION} --activate</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo run lint</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">type-check</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">check</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node:${NODE_VERSION}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  before_script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack enable</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack prepare pnpm@${PNPM_VERSION} --activate</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo run type-check</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">architecture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">check</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node:${NODE_VERSION}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  before_script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack enable</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack prepare pnpm@${PNPM_VERSION} --activate</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo boundaries</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node:${NODE_VERSION}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  before_script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack enable</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack prepare pnpm@${PNPM_VERSION} --activate</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo run test --output-logs=new-only</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  coverage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/All files[^|]*\|[^|]*\s+([\d\.]+)/&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  artifacts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    reports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      coverage_report</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        coverage_format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cobertura</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">coverage/cobertura-coverage.xml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 构建</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node:${NODE_VERSION}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">lint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">type-check</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">architecture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  before_script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack enable</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">corepack prepare pnpm@${PNPM_VERSION} --activate</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm turbo run build --output-logs=new-only</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  artifacts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/*/dist</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">packages/*/dist</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    expire_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1 week</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 部署到测试环境</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">deploy-staging</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">deploy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  only</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">develop</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">echo &quot;Deploy to staging&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 部署逻辑</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 部署到生产环境</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">deploy-production</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">deploy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  only</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  when</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">manual</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 需要手动触发</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">echo &quot;Deploy to production&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 部署逻辑</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br></div></div><h3 id="_12-4-changesets-自动化" tabindex="-1">12.4 Changesets 自动化 <a class="header-anchor" href="#_12-4-changesets-自动化" aria-label="Permalink to &quot;12.4 Changesets 自动化&quot;">​</a></h3><h4 id="在-ci-中自动发布" tabindex="-1">在 CI 中自动发布 <a class="header-anchor" href="#在-ci-中自动发布" aria-label="Permalink to &quot;在 CI 中自动发布&quot;">​</a></h4><p><code>.github/workflows/release.yml</code>：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Release</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  release</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          fetch-depth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;20&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          registry-url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://registry.npmjs.org&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;10.24.0&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm install --frozen-lockfile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Create Release Pull Request or Publish</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">changesets/action@v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          publish</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm release</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm changeset version</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          commit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;chore: release packages&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;chore: release packages&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          GITHUB_TOKEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          NPM_TOKEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${{ secrets.NPM_TOKEN }}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p><strong>工作流程</strong>：</p><ol><li>开发者合并 PR 到 <code>main</code></li><li>CI 检测到 <code>.changeset/</code> 中有未消费的 changesets</li><li>自动创建一个 &quot;Release PR&quot;</li><li>Release PR 包含： <ul><li>更新后的版本号</li><li>生成的 CHANGELOG.md</li></ul></li><li>团队 Review 后合并</li><li>CI 自动发布到 npm</li></ol><hr><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><h3 id="核心要点回顾" tabindex="-1">核心要点回顾 <a class="header-anchor" href="#核心要点回顾" aria-label="Permalink to &quot;核心要点回顾&quot;">​</a></h3><h4 id="_1-monorepo-的本质" tabindex="-1">1. Monorepo 的本质 <a class="header-anchor" href="#_1-monorepo-的本质" aria-label="Permalink to &quot;1. Monorepo 的本质&quot;">​</a></h4><p>不是简单地把代码放在一个仓库，而是：</p><ul><li><strong>统一的依赖管理</strong>：避免版本碎片化</li><li><strong>清晰的架构边界</strong>：分层设计+依赖约束</li><li><strong>高效的构建系统</strong>：增量构建+缓存复用</li><li><strong>自动化的治理</strong>：工具强制规范</li></ul><h4 id="_2-技术选型的逻辑" tabindex="-1">2. 技术选型的逻辑 <a class="header-anchor" href="#_2-技术选型的逻辑" aria-label="Permalink to &quot;2. 技术选型的逻辑&quot;">​</a></h4><ul><li><strong>pnpm</strong>：内容寻址存储 → 节省空间+严格依赖</li><li><strong>Turborepo</strong>：任务图调度 → 增量构建+并行执行</li><li><strong>Catalog</strong>：集中版本管理 → 统一升级+冲突检测</li><li><strong>Boundaries</strong>：标签+规则 → 架构约束+自动检查</li></ul><h4 id="_3-从-0-到-1-的路径" tabindex="-1">3. 从 0 到 1 的路径 <a class="header-anchor" href="#_3-从-0-到-1-的路径" aria-label="Permalink to &quot;3. 从 0 到 1 的路径&quot;">​</a></h4><ol><li><strong>评估需求</strong> → 确认 Monorepo 适合团队</li><li><strong>选择技术栈</strong> → pnpm + Turbo + TypeScript</li><li><strong>设计架构</strong> → 分层+命名规范+目录结构</li><li><strong>搭建骨架</strong> → Workspace + Turbo + 工具链</li><li><strong>迁移首包</strong> → 共享包 + 应用</li><li><strong>依赖管理</strong> → Catalog + Overrides</li><li><strong>性能优化</strong> → inputs 精确化 + 远程缓存</li><li><strong>架构治理</strong> → Boundaries + 生成器</li><li><strong>CI/CD</strong> → 缓存策略 + 并行执行</li></ol><h3 id="实施建议" tabindex="-1">实施建议 <a class="header-anchor" href="#实施建议" aria-label="Permalink to &quot;实施建议&quot;">​</a></h3><h4 id="渐进式迁移" tabindex="-1">渐进式迁移 <a class="header-anchor" href="#渐进式迁移" aria-label="Permalink to &quot;渐进式迁移&quot;">​</a></h4><p>不要一次性迁移所有项目：</p><ol><li><strong>Phase 1</strong>：搭建基础设施，迁移工具库</li><li><strong>Phase 2</strong>：迁移一个小型应用，验证流程</li><li><strong>Phase 3</strong>：逐步迁移其他应用</li><li><strong>Phase 4</strong>：优化性能，完善治理</li></ol><h4 id="常见陷阱" tabindex="-1">常见陷阱 <a class="header-anchor" href="#常见陷阱" aria-label="Permalink to &quot;常见陷阱&quot;">​</a></h4><p>❌ <strong>过度设计</strong>：不要一开始就搞复杂的目录结构<br> ✅ 从简单开始，根据需求演进</p><p>❌ <strong>忽略 inputs</strong>：导致缓存命中率低<br> ✅ 精确定义 inputs，排除无关文件</p><p>❌ <strong>缺乏约束</strong>：依赖关系混乱<br> ✅ 使用 Boundaries 强制架构规则</p><p>❌ <strong>没有文档</strong>：团队不知道如何使用<br> ✅ 编写清晰的贡献指南和最佳实践</p><h3 id="下一步" tabindex="-1">下一步 <a class="header-anchor" href="#下一步" aria-label="Permalink to &quot;下一步&quot;">​</a></h3><ul><li><strong>TypeScript Project References</strong>：提升类型检查性能</li><li><strong>E2E 测试集成</strong>：Playwright/Cypress</li><li><strong>性能监控</strong>：追踪构建时间趋势</li><li><strong>RFC 流程</strong>：重大变更的讨论机制</li><li><strong>Micro Frontends</strong>：应用层的模块化</li></ul><hr><p><strong>本手册基于真实项目经验总结，持续更新。</strong></p></div></div></main><footer class="VPDocFooter" data-v-19e5f4bd data-v-60c89bea><!--[--><!--[--><!--[--><!--[--><div class="doc-comments"><!----></div><!--]--><!--]--><!--]--><!--]--><div class="edit-info" data-v-60c89bea><!----><div class="last-updated" data-v-60c89bea><p class="VPLastUpdated" data-v-60c89bea data-v-dd735ae2>上次更新: <time datetime="2026-02-03T02:28:52.000Z" data-v-dd735ae2></time></p></div></div><!----></footer><!--[--><!--[--><!--[--><div style="display:none;" class="m-doc-footer" data-v-3bfcfc2f><div class="m-doc-footer-message" data-v-3bfcfc2f><img class="visitor" src="https://visitor-badge.laobi.icu/badge?page_id=LynnCen.Lyc-notes./work/gd/monorepo/Monorepo%E8%B6%85%E7%BA%A7%E5%A4%A7%E4%BB%93%E4%BB%8E0%E5%88%B01%E5%AE%9E%E6%88%98%E6%89%8B%E5%86%8C" title="当前页面累计访问数" onerror="this.style.display=&#39;none&#39;" data-v-3bfcfc2f><p data-v-3bfcfc2f>如有转载或 CV 的请标注本站原文地址</p></div><p class="m-doc-footer-copyright" data-v-3bfcfc2f>Copyright © 2024-present LynnCen</p></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter" data-v-31cf94a2 data-v-276efff3><div class="container" data-v-276efff3><p class="message" data-v-276efff3>如有转载或 CV 的请标注本站原文地址</p><p class="copyright" data-v-276efff3>Copyright © 2024-present LynnCen</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about_about.md\":\"hYy3oXwG\",\"about_resume.md\":\"BnhkDdWg\",\"about_resume_fudan.md\":\"DGmfUoed\",\"ai_dify_index.md\":\"CyLb-AoN\",\"ai_index.md\":\"D3J-wTOw\",\"ai_mcp_browsertools.md\":\"CSyw3h4L\",\"ai_mcp_cursor-mcp.md\":\"C9ORWRf1\",\"ai_mcp_figma.md\":\"CFzNfoCN\",\"ai_posts_ai.md\":\"Dr-5slUC\",\"ai_posts_llm.md\":\"BHVMNvnV\",\"ai_sam_index.md\":\"ctdjkjtQ\",\"ai_sam_sam主体选择深度解析.md\":\"CYCdQAPZ\",\"ai_机器学习_01人工智能三大概念.md\":\"mowRZr0p\",\"ai_机器学习_02应用领域及发展史.md\":\"DdarlgqS\",\"ai_机器学习_03常用术语.md\":\"DPr2dXCp\",\"ai_机器学习_04.机器学习算法分类.md\":\"Cjmc7U_W\",\"ai_机器学习_05建模流程.md\":\"1rQlVdse\",\"ai_机器学习_06线性回归-模型保存.md\":\"C2g45kv2\",\"ai_机器学习_07knn.md\":\"9_idyspB\",\"ai_机器学习_08kmeans.md\":\"BlXqBAfm\",\"ai_机器学习_09特征处理.md\":\"oUZAKNrT\",\"ai_机器学习_10过拟合欠拟合.md\":\"Dg2o3G9B\",\"ai_机器学习_其他机器学习方法.md\":\"B3-Vf88c\",\"ai_机器学习_逻辑回归.md\":\"Cjn5Mhr7\",\"ai_深度学习_卷积神经网络基础.md\":\"CKopRYYA\",\"algorithms_dp.md\":\"B5XxDGaJ\",\"algorithms_index.md\":\"Cn3mNlh4\",\"algorithms_leetcode.md\":\"B_w816oF\",\"algorithms_lru.md\":\"pvEqJTze\",\"algorithms_退避算法.md\":\"9c29uBnR\",\"blog_ai_ai.md\":\"DD8ezd15\",\"blog_ai_gitlab-mcp.md\":\"BnS1Hgqq\",\"blog_ai_llm.md\":\"BOie_33B\",\"blog_index.md\":\"BGlSj4HW\",\"blog_web-front-end_compareviteandwebpack.md\":\"BBPHh6NF\",\"blog_web-front-end_dataprefetch.md\":\"x55goHqT\",\"blog_web-front-end_im多端一致性.md\":\"cN4CjXWU\",\"blog_web-front-end_rendermode.md\":\"5GABI0z7\",\"blog_web-front-end_rpxtovw.md\":\"igSVIHe-\",\"blog_web-front-end_seo.md\":\"HRv5HL5Y\",\"blog_web-front-end_skelon.md\":\"DG27dXMg\",\"blog_web-front-end_vuetopdf.md\":\"zHyVpuOu\",\"cv_canvas2d基础_00-教学大纲与目录.md\":\"BBi7OErr\",\"cv_canvas2d基础_01-canvas元素与绑制环境.md\":\"B0A8oUD1\",\"cv_canvas2d基础_02-基础图形绑制.md\":\"CPn0FAlM\",\"cv_canvas2d基础_03-路径与贝塞尔曲线.md\":\"D6tJWobi\",\"cv_canvas2d基础_04-样式与颜色系统.md\":\"BET5BsaX\",\"cv_canvas2d基础_05-变换与坐标系统.md\":\"ZTH6RpWq\",\"cv_canvas2d基础_06-图像与像素操作.md\":\"C0WCOdNk\",\"cv_canvas2d基础_07-合成与混合模式.md\":\"p8TM1aTo\",\"cv_canvas2d基础_08-文本渲染.md\":\"D9F0fQME\",\"cv_canvas2d基础_09-动画与帧循环.md\":\"BPN_u8W8\",\"cv_canvas2d基础_10-离屏渲染与性能优化.md\":\"Cr6DGnEc\",\"cv_canvas2d基础_11-实战案例与最佳实践.md\":\"B96k87Xz\",\"cv_index.md\":\"4U08Kk_W\",\"cv_pixijs实战_00-教学大纲与目录.md\":\"BVwiwSG0\",\"cv_pixijs实战_01-pixijs概述与快速入门.md\":\"D_BZNzch\",\"cv_pixijs实战_02-application与渲染器.md\":\"soG9BIii\",\"cv_pixijs实战_03-显示对象体系.md\":\"BvKJIl6r\",\"cv_pixijs实战_04-container容器与场景图.md\":\"Zvv4ApDU\",\"cv_pixijs实战_05-sprite精灵与纹理.md\":\"C9ETsP3v\",\"cv_pixijs实战_06-graphics图形绘制.md\":\"CJFMCmxn\",\"cv_pixijs实战_07-text文本渲染.md\":\"BuXDDlLq\",\"cv_pixijs实战_08-transform变换系统.md\":\"9rQD1jiS\",\"cv_pixijs实战_09-交互与事件系统.md\":\"CU-WhwdT\",\"cv_pixijs实战_10-纹理管理与资源加载.md\":\"DKMlVSg1\",\"cv_pixijs实战_11-滤镜与特效.md\":\"BjxwcoIO\",\"cv_pixijs实战_12-遮罩与混合模式.md\":\"BcsujstC\",\"cv_pixijs实战_13-ticker与动画.md\":\"fg9ltEKL\",\"cv_pixijs实战_14-性能优化实践.md\":\"DrBQ8SzA\",\"cv_pixijs实战_15-高级特性与扩展.md\":\"CUVH3SgQ\",\"cv_webgl基础_00-教学大纲与目录.md\":\"C6moeFhg\",\"cv_webgl基础_01-webgl概述与环境搭建.md\":\"BrtbR2sk\",\"cv_webgl基础_02-渲染管线详解.md\":\"CbogbLb3\",\"cv_webgl基础_03-着色器与glsl.md\":\"DRVT7bof\",\"cv_webgl基础_04-缓冲区与顶点数据.md\":\"xs6fs0Dj\",\"cv_webgl基础_05-纹理与采样.md\":\"Cgx0hWCe\",\"cv_webgl基础_06-矩阵变换与相机.md\":\"DmVAi3fN\",\"cv_webgl基础_07-光照与材质.md\":\"CGijcoc4\",\"cv_webgl基础_08-帧缓冲与离屏渲染.md\":\"Dd2fHVdu\",\"cv_webgl基础_09-混合与深度测试.md\":\"CyT9a84n\",\"cv_webgl基础_10-webgl2新特性.md\":\"DMMUbDkN\",\"cv_webgl基础_11-性能优化与调试.md\":\"CGDtlHMH\",\"cv_webgl基础_12-实战案例集.md\":\"D7zRcsCT\",\"cv_无限画布_00-教学大纲与目录.md\":\"CfF091Ka\",\"cv_无限画布_01-代码路径与模块映射.md\":\"2wITatga\",\"cv_无限画布_02-基础概念与技术选型.md\":\"CJui946T\",\"cv_无限画布_03-坐标系统与矩阵变换.md\":\"Dk4OvjFq\",\"cv_无限画布_04-viewport视口管理.md\":\"B1HEutr5\",\"cv_无限画布_05-vmengine视图模型引擎.md\":\"DJuoqiDN\",\"cv_无限画布_06-元素生命周期与渲染.md\":\"a_retb9m\",\"cv_无限画布_07-事件系统与碰撞检测.md\":\"DkLPsJTu\",\"cv_无限画布_08-手势与交互处理.md\":\"FLB0VNbC\",\"cv_无限画布_09-插件系统架构.md\":\"D9ZSNGhd\",\"cv_无限画布_10-性能优化策略.md\":\"DE_965BN\",\"cv_无限画布_11-导出与截图.md\":\"BNQW2gfH\",\"cv_无限画布_12-总结与最佳实践.md\":\"BYbhUsof\",\"cv_计算机图形学原理_00-教学大纲与目录.md\":\"CRMm3LsB\",\"cv_计算机图形学原理_01-图形学概述.md\":\"CyOngRuF\",\"cv_计算机图形学原理_02-向量与线性代数基础.md\":\"NHJBq4mC\",\"cv_计算机图形学原理_03-矩阵与变换.md\":\"07yFPHXd\",\"cv_计算机图形学原理_04-齐次坐标与投影.md\":\"DVnyVNVn\",\"cv_计算机图形学原理_05-2d图形绘制算法.md\":\"CL1rv81E\",\"cv_计算机图形学原理_06-曲线与曲面.md\":\"DP3Auvei\",\"cv_计算机图形学原理_07-几何建模基础.md\":\"6s1ytU9C\",\"cv_计算机图形学原理_08-可见性与遮挡.md\":\"Bb-kW08A\",\"cv_计算机图形学原理_09-光照与着色模型.md\":\"DBoXKvLr\",\"cv_计算机图形学原理_10-纹理映射.md\":\"3Whvaw-z\",\"cv_计算机图形学原理_11-碰撞检测算法.md\":\"BwLL4gmv\",\"cv_计算机图形学原理_12-空间索引与加速结构.md\":\"D_DDJ5td\",\"cv_计算机图形学原理_13-图像处理基础.md\":\"DlbxyhpP\",\"cv_计算机图形学原理_14-颜色科学.md\":\"B2cqBUJ9\",\"cv_计算机图形学原理_15-前沿技术与发展方向.md\":\"2d797N1I\",\"design-patterns_behavioral_chain-of-responsibility.md\":\"Cqv1bHZU\",\"design-patterns_behavioral_command.md\":\"MaEwWbMz\",\"design-patterns_behavioral_interpreter.md\":\"CdiKNEt-\",\"design-patterns_behavioral_iterator.md\":\"eLwL95-p\",\"design-patterns_behavioral_mediator.md\":\"DAoVaIBC\",\"design-patterns_behavioral_memento.md\":\"SYXxqbzB\",\"design-patterns_behavioral_observer.md\":\"CU6ovJ_H\",\"design-patterns_behavioral_state.md\":\"RkQsXrBc\",\"design-patterns_behavioral_strategy.md\":\"BawvLeMq\",\"design-patterns_behavioral_template-method.md\":\"BL4EkOY9\",\"design-patterns_behavioral_visitor.md\":\"BAVZ0xBF\",\"design-patterns_creational_abstract-factory.md\":\"BhLOByjt\",\"design-patterns_creational_builder.md\":\"DQt3u2gq\",\"design-patterns_creational_factory-method.md\":\"Dwu6iJmE\",\"design-patterns_creational_prototype.md\":\"BNTqACAo\",\"design-patterns_creational_singleton.md\":\"vSPxqzu8\",\"design-patterns_index.md\":\"DnZAag3L\",\"design-patterns_microservices_api-gateway.md\":\"D2e446RU\",\"design-patterns_microservices_circuit-breaker.md\":\"BiEIZy0c\",\"design-patterns_microservices_cqrs.md\":\"DNSXTOLN\",\"design-patterns_microservices_event-sourcing.md\":\"D7pPHGVI\",\"design-patterns_microservices_service-discovery.md\":\"Bh9JJuV1\",\"design-patterns_modern_dependency-injection.md\":\"DRJb3ZTn\",\"design-patterns_modern_mvc.md\":\"D8Lzp5kI\",\"design-patterns_modern_mvp.md\":\"DpQN5XKl\",\"design-patterns_modern_mvvm.md\":\"DgWjpdQH\",\"design-patterns_modern_pub-sub.md\":\"CNDLxt4i\",\"design-patterns_structural_adapter.md\":\"DlTvkoNA\",\"design-patterns_structural_bridge.md\":\"BbN5JEhE\",\"design-patterns_structural_composite.md\":\"kZt46ovA\",\"design-patterns_structural_decorator.md\":\"CPJPP-NU\",\"design-patterns_structural_facade.md\":\"CKKYk0dZ\",\"design-patterns_structural_flyweight.md\":\"k7Qr1pXV\",\"design-patterns_structural_proxy.md\":\"BzRIJGsx\",\"design-patterns_模版方法.md\":\"BMMT8Ywz\",\"devops_shell_index.md\":\"BLhCksXD\",\"fdu_index.md\":\"CTvUR_XI\",\"fdu_四级_index.md\":\"XkbMXlg8\",\"fdu_计算机图像_lisa.md\":\"CkV_phVX\",\"frontend_architecture_modern-frontend-architecture.md\":\"zd80FZh9\",\"frontend_browser_ introduce.md\":\"Du_CIN19\",\"frontend_browser_async_await.md\":\"CPAVs55c\",\"frontend_browser_chrome开发者工具.md\":\"D74zAroT\",\"frontend_browser_chrome架构.md\":\"CsFHncKg\",\"frontend_browser_csrf攻击.md\":\"CKBFgivQ\",\"frontend_browser_dom树.md\":\"UqZe0BZ8\",\"frontend_browser_http.md\":\"gX17dz4c\",\"frontend_browser_http1.md\":\"XLf7xhUL\",\"frontend_browser_http2.md\":\"BrNGK3m3\",\"frontend_browser_http3.md\":\"xqNGRDMW\",\"frontend_browser_https.md\":\"C0Lm0Zbo\",\"frontend_browser_performance.md\":\"8hTmyFPO\",\"frontend_browser_performance中的main指标.md\":\"Las3VpZN\",\"frontend_browser_promise.md\":\"Ci05xbWh\",\"frontend_browser_renderfirst.md\":\"DxwdPiFn\",\"frontend_browser_rendersec.md\":\"DUNQLBmg\",\"frontend_browser_settimeout如何实现.md\":\"Cbk08eQW\",\"frontend_browser_tcp协议.md\":\"CxQpqQ_2\",\"frontend_browser_this.md\":\"55VKaac7\",\"frontend_browser_xmlhttprequest.md\":\"DPl4D7e3\",\"frontend_browser_任务调度.md\":\"DbPjKjyS\",\"frontend_browser_作用域链和闭包.md\":\"BGy9bR5u\",\"frontend_browser_分层和合成.md\":\"CzGmdKtQ\",\"frontend_browser_加载阶段性能.md\":\"DKKGisbA\",\"frontend_browser_变量提升.md\":\"B99JU5UE\",\"frontend_browser_同源策略.md\":\"Db72U1K5\",\"frontend_browser_块级作用域.md\":\"C5z7V_7b\",\"frontend_browser_垃圾回收.md\":\"CINwzdhW\",\"frontend_browser_安全沙箱.md\":\"2fMG67Ob\",\"frontend_browser_宏任务和微任务.md\":\"DI3oXcRM\",\"frontend_browser_导航流程.md\":\"CBre6dE_\",\"frontend_browser_栈和堆.md\":\"Bz3I1_YW\",\"frontend_browser_浏览上下文组.md\":\"Ms0WMn9r\",\"frontend_browser_消息队列和事件循环.md\":\"DJexHKz7\",\"frontend_browser_渐进式网页应用pwa.md\":\"BanrN0PG\",\"frontend_browser_渲染流水线.md\":\"Cie3BCb4\",\"frontend_browser_编译器和解释器.md\":\"CkXXBZmX\",\"frontend_browser_虚拟dom.md\":\"BbNc_tDM\",\"frontend_browser_调用栈.md\":\"xsulnuUM\",\"frontend_browser_跨站脚本攻击xss.md\":\"CPaURAs9\",\"frontend_browser_页面性能.md\":\"DU-rAfQh\",\"frontend_git_basic.md\":\"cqoLzUCz\",\"frontend_git_index.md\":\"CQ00vKUa\",\"frontend_index.md\":\"vGYnzcjk\",\"frontend_javascript_advance_browser.md\":\"Bu-KHT7A\",\"frontend_javascript_advance_execution.md\":\"0-lg6h5U\",\"frontend_javascript_advance_executioncontext.md\":\"D-C6oMkX\",\"frontend_javascript_advance_executionstack.md\":\"hhIa1kFX\",\"frontend_javascript_basic_你不知道的js.md\":\"D8JniV6j\",\"frontend_next_deploy.md\":\"VfHij5sE\",\"frontend_next_index.md\":\"DAjxLq5D\",\"frontend_node_packages.md\":\"BGH2nbn8\",\"frontend_react_customhook_hooks.md\":\"DB_CcHVT\",\"frontend_react_customhook_usesetstate.md\":\"WQQkXpF-\",\"frontend_react_index.md\":\"DZCp9lC8\",\"frontend_typescript_advance.md\":\"VyOBlnJC\",\"frontend_typescript_class.md\":\"CTsZq6v0\",\"frontend_typescript_index.md\":\"DDd53JLp\",\"frontend_utils_throttle.md\":\"BhMsr6Gl\",\"frontend_utils_utils.md\":\"DSHgnO8R\",\"frontend_vue_advanced_animation.md\":\"BDykWCCZ\",\"frontend_vue_advanced_directive.md\":\"BhXj1XxJ\",\"frontend_vue_advanced_generic.md\":\"DVwKUtci\",\"frontend_vue_advanced_hooks.md\":\"Cp2tzRqT\",\"frontend_vue_advanced_index.md\":\"25ZEfvqY\",\"frontend_vue_advanced_performance.md\":\"CDPUGsUB\",\"frontend_vue_basic.md\":\"DqrZj41l\",\"frontend_vue_basic_component-communication.md\":\"IOYBLBBq\",\"frontend_vue_basic_composition-api.md\":\"futAdJkv\",\"frontend_vue_basic_index.md\":\"B7S7RpuA\",\"frontend_vue_basic_reactivity.md\":\"ek0AfHg1\",\"frontend_vue_basic_template.md\":\"_SKNuKwo\",\"frontend_vue_ecosystem_build.md\":\"9-ngI9RQ\",\"frontend_vue_ecosystem_devtools.md\":\"BU_R6PBj\",\"frontend_vue_ecosystem_index.md\":\"1DjZTbto\",\"frontend_vue_ecosystem_pinia.md\":\"BMDQoPBb\",\"frontend_vue_ecosystem_router.md\":\"DGHp1H1s\",\"frontend_vue_ecosystem_test.md\":\"9XIFNfEt\",\"frontend_vue_ecosystem_ui.md\":\"BIdbE9gH\",\"frontend_vue_index.md\":\"Cj6dYkUp\",\"frontend_vue_principle_compiler.md\":\"Czp9_kwx\",\"frontend_vue_principle_index.md\":\"Cwg9bGvy\",\"frontend_vue_principle_reactivity.md\":\"CqPcoHvZ\",\"frontend_vue_schudle.md\":\"D0sYyi5u\",\"frontend_webpack_basic.md\":\"BnviUxNB\",\"frontend_webpack_index.md\":\"gwGE4TDn\",\"frontend_webpack_optimization.md\":\"BdeDfEPj\",\"frontend_webpack_performance.md\":\"C2ZL0qoK\",\"frontend_webpack_practice.md\":\"DzczZC6H\",\"frontend_webpack_principle.md\":\"DVHbzli3\",\"fundamentals_computer-networks_chapter1.md\":\"0xRmBf6a\",\"fundamentals_computer-networks_chapter2.md\":\"zMdhwrkJ\",\"fundamentals_computer-networks_chapter3.md\":\"DjZuohcT\",\"fundamentals_computer-networks_http.md\":\"rqbKg4px\",\"fundamentals_computer-networks_https.md\":\"DTJ8Z1ae\",\"fundamentals_computer-networks_websocket.md\":\"CFN8_nOr\",\"fundamentals_computer-networks_强化.md\":\"SCjWC0uC\",\"fundamentals_computer-organization_chapter1.md\":\"Bwulhh6i\",\"fundamentals_computer-organization_chapter2.md\":\"rMubs-K1\",\"fundamentals_computer-organization_chapter3.md\":\"BoFjvNnG\",\"fundamentals_computer-organization_chapter4.md\":\"Bx7obc8K\",\"fundamentals_computer-organization_chapter5.md\":\"C23IC199\",\"fundamentals_computer-organization_chapter6.md\":\"LrJg24vr\",\"fundamentals_computer-organization_chapter7.md\":\"rfyDJ6yE\",\"fundamentals_computer-organization_强化.md\":\"ysEuUHnw\",\"fundamentals_data-structures_chapter1.md\":\"MN_wtTjm\",\"fundamentals_data-structures_chapter1_ex.md\":\"D8shil24\",\"fundamentals_data-structures_chapter2.md\":\"l0ptp12N\",\"fundamentals_data-structures_chapter2_ex.md\":\"CU1xunPq\",\"fundamentals_data-structures_chapter3.md\":\"CGxeko5N\",\"fundamentals_data-structures_chapter4.md\":\"uQjLXa9A\",\"fundamentals_data-structures_chapter5.md\":\"icUEJCDD\",\"fundamentals_data-structures_chapter6.md\":\"32BbP8sX\",\"fundamentals_data-structures_chapter7.md\":\"CBbblPf3\",\"fundamentals_data-structures_chapter8.md\":\"C28Ss_k_\",\"fundamentals_data-structures_强化.md\":\"BfsCXj3Z\",\"fundamentals_exam-408_2009.md\":\"Cypx-6Mk\",\"fundamentals_exam-408_2010.md\":\"D4LqZTeV\",\"fundamentals_exam-408_2011.md\":\"D73HeaPt\",\"fundamentals_exam-408_2012.md\":\"B0xyWjh3\",\"fundamentals_exam-408_2013.md\":\"Bp09Rkgh\",\"fundamentals_exam-408_2014.md\":\"C1tbmkSf\",\"fundamentals_exam-408_2015.md\":\"OE8Ber0-\",\"fundamentals_exam-408_2016.md\":\"BE5f1e6f\",\"fundamentals_exam-408_2017.md\":\"lJOBvFBU\",\"fundamentals_exam-408_2018.md\":\"C59piAdW\",\"fundamentals_exam-408_2019.md\":\"CynVVk26\",\"fundamentals_index.md\":\"Bu-eLnXn\",\"fundamentals_operating-systems_chapter1.md\":\"CYwW2A5S\",\"fundamentals_operating-systems_chapter2.md\":\"BtQO-Wxj\",\"fundamentals_operating-systems_chapter3.md\":\"Dgg0vNgC\",\"fundamentals_operating-systems_chapter4.md\":\"BNEozzow\",\"fundamentals_operating-systems_chapter5.md\":\"CVz8l5ev\",\"fundamentals_operating-systems_强化.md\":\"Cqw4Htmz\",\"index.md\":\"qowVqw4G\",\"interview_2025.md\":\"CPG_MIN6\",\"interview_browser.md\":\"D7zU3TpV\",\"interview_coding.md\":\"ClC2e65l\",\"interview_css.md\":\"CDqDS8DQ\",\"interview_html.md\":\"BIzr0jdF\",\"interview_js.md\":\"CLR6KEmm\",\"interview_network.md\":\"K9gK9Ljk\",\"interview_project.md\":\"BJXEkddS\",\"interview_react.md\":\"DrFnvnwr\",\"interview_typescript.md\":\"nXXHarYl\",\"interview_webpack.md\":\"roJzi_wP\",\"open-source_index.md\":\"DT1TXU8u\",\"resources_index.md\":\"D3w3ZCi0\",\"software-exam_架构师_01绪论.md\":\"9zB3mwK6\",\"software-exam_架构师_02计算机系统基础知识.md\":\"CJfAaAO9\",\"software-exam_架构师_readme.md\":\"BqoTXbos\",\"software-exam_架构师_案例.md\":\"DGH7RaUA\",\"software-exam_架构师_知识点_01-前端架构技术.md\":\"EIjD5kz6\",\"software-exam_架构师_知识点_02-后端架构技术.md\":\"DtxWieOv\",\"software-exam_架构师_知识点_03-ai工程化技术.md\":\"CggfwN0K\",\"software-exam_架构师_知识点_04-devops与可观测性.md\":\"CHN9mBCk\",\"software-exam_架构师_考试预测_01-历年真题汇总.md\":\"CWCT-psh\",\"software-exam_架构师_考试预测_02-2025年11月备考指南.md\":\"r4gvvRUE\",\"software-exam_架构师_论文_01-论文写作指南.md\":\"HUWJkICq\",\"software-exam_架构师_论文_02-论文通用模版.md\":\"Bu3o_30D\",\"software-exam_架构师_论文_03-论文最终稿.md\":\"CapM0BK7\",\"software-exam_架构师_论文_主题版本_论文-soa架构.md\":\"MYvmGYHH\",\"software-exam_架构师_论文_主题版本_论文-微服务架构.md\":\"DA231NG4\",\"software-exam_软件设计师_readme.md\":\"CHh6Rvll\",\"software-exam_软件设计师_真题_历年真题要点.md\":\"ChZ7RV37\",\"software-exam_软件设计师_知识点_01-软件过程模型.md\":\"Dq3PzBPA\",\"software-exam_软件设计师_知识点_02-软件需求工程.md\":\"CMUBTNgK\",\"software-exam_软件设计师_知识点_03-软件设计基础.md\":\"CQJIfg-3\",\"software-exam_软件设计师_知识点_04-面向对象与uml.md\":\"CbQpDGes\",\"software-exam_软件设计师_知识点_05-设计模式.md\":\"Bb6ED7ig\",\"software-exam_软件设计师_知识点_06-软件测试.md\":\"DcMteHyG\",\"software-exam_软件设计师_知识点_07-软件维护与质量.md\":\"C5fZP5Su\",\"software-exam_软件设计师_知识点_08-软件项目管理.md\":\"DS27I_8c\",\"software-exam_软件设计师_知识点_09-计算机网络基础.md\":\"BAwKlOzA\",\"software-exam_软件设计师_考试指南_01-考试结构与重点.md\":\"C7maQCHu\",\"software-exam_软件设计师_考试指南_02-备考计划.md\":\"DbHbj8A6\",\"work_ali_cross_border.md\":\"DQ9pcAdr\",\"work_ali_generate_icon.md\":\"CNC87PY2\",\"work_ali_lerna_monorepo.md\":\"D7psmlTm\",\"work_ali_linyang.md\":\"-r0OwGGZ\",\"work_ali_local_return.md\":\"Bj-o92KA\",\"work_ali_react-intl.md\":\"Bur0zKvn\",\"work_ali_taojp.md\":\"CxX5YrUK\",\"work_gd_agent_00-快速入门.md\":\"CY_kuw5j\",\"work_gd_agent_01-基础概念.md\":\"DQbuywTv\",\"work_gd_agent_01-架构设计_网络架构.md\":\"DZEzKvmq\",\"work_gd_agent_02-消息系统.md\":\"DychR5bI\",\"work_gd_agent_02-消息系统_completion接口与工具调用.md\":\"D48L8RwE\",\"work_gd_agent_02-消息系统_消息结构设计.md\":\"RohqgTtd\",\"work_gd_agent_03-langgraph集成_langgraph接入方案.md\":\"SzIXMOPW\",\"work_gd_agent_03-工具调用.md\":\"BuOVaNlb\",\"work_gd_agent_04-业务功能_会话标题生成.md\":\"BtGOe8nh\",\"work_gd_agent_04-工作流编排.md\":\"D8KPijxW\",\"work_gd_agent_05-可观测性_链路追踪与监控.md\":\"BtneV_3x\",\"work_gd_agent_05-网络架构.md\":\"C7otf3_a\",\"work_gd_agent_06-中断与恢复.md\":\"D9YHsfnp\",\"work_gd_agent_07-业务功能.md\":\"CCYZtBQ7\",\"work_gd_agent_08-可观测性.md\":\"K6e6E-MG\",\"work_gd_agent_09-最佳实践.md\":\"Bv_2K-iL\",\"work_gd_agent_readme.md\":\"puPEmsNf\",\"work_gd_agent_稿定ai-agent架构深度解析.md\":\"Dl172agi\",\"work_gd_ai_智能设计编辑器架构文档_01-产品全景.md\":\"DngrN78A\",\"work_gd_ai_智能设计编辑器架构文档_02-整体架构设计.md\":\"CewYcGRf\",\"work_gd_ai_智能设计编辑器架构文档_03-编辑器基座.md\":\"DIsi9_JX\",\"work_gd_ai_智能设计编辑器架构文档_04-扩展插件系统.md\":\"DrvgpFBr\",\"work_gd_ai_智能设计编辑器架构文档_05-无限画布渲染引擎.md\":\"CB-zfOjw\",\"work_gd_ai_智能设计编辑器架构文档_06-ai对话系统核心技术.md\":\"BOzMJczu\",\"work_gd_ai_智能设计编辑器架构文档_07-agent工作流程.md\":\"BfX0IZy_\",\"work_gd_ai_智能设计编辑器架构文档_08-ai工具实现指南.md\":\"ChOWY__A\",\"work_gd_ai_智能设计编辑器架构文档_08-性能优化与错误处理.md\":\"C8aPmnn0\",\"work_gd_ai_智能设计编辑器架构文档_09-核心代码实现.md\":\"CojgFQ4T\",\"work_gd_ai_智能设计编辑器架构文档_10-总结与展望.md\":\"tSpr4TwG\",\"work_gd_ai_智能设计编辑器架构文档_11-附录-技术栈与术语.md\":\"1i2Vlert\",\"work_gd_ai_智能设计编辑器架构文档_ai_智能设计编辑器架构文档-完整版-备份.md\":\"DOnuD_zt\",\"work_gd_ai_智能设计编辑器架构文档_readme.md\":\"DXNUDka_\",\"work_gd_ai对话_ai-chat-react详细分析.md\":\"y6rET-Q6\",\"work_gd_ai对话_ai对话系统深度解析-1-概述与架构.md\":\"whqf4JqI\",\"work_gd_ai对话_ai对话系统深度解析-2-消息流转.md\":\"CV2v3HpF\",\"work_gd_ai对话_ai对话系统深度解析-3-三种模式.md\":\"-H90Zi20\",\"work_gd_ai对话_ai对话系统深度解析-4-会话管理.md\":\"CUCFeEID\",\"work_gd_ai对话_ant-design-x在ai-chat-react中的使用.md\":\"CGFftrHf\",\"work_gd_ai工具_ai扩图.md\":\"CJJgyNwz\",\"work_gd_ai工具_ai抠图_architecture_design.md\":\"DJ0ExJSz\",\"work_gd_ai工具_ai抠图_core_image_processing_guide.md\":\"CVLvzS4A\",\"work_gd_ai工具_ai抠图_frontend_matting_blog.md\":\"DBwtADEx\",\"work_gd_ai工具_ai视频.md\":\"NM0KoAMS\",\"work_gd_ai工具_insmind ai工具完整指南.md\":\"BB6Uhuwe\",\"work_gd_ai工具_图片压缩_从c__到wasm到javascript的完整流程详解.md\":\"5dD-Kk0F\",\"work_gd_ai工具_图片压缩_图片压缩.md\":\"BTdxAhEv\",\"work_gd_gd绩效考核.md\":\"DQtcUqYR\",\"work_gd_import-map_01-基础概念-importmap与esm-cdn介绍.md\":\"BRfRo1Hd\",\"work_gd_import-map_02-工具演进-rfc15-wpm2.md\":\"DqtW24sS\",\"work_gd_import-map_03-工具演进-rfc20-wpm3.md\":\"BJEDwA0M\",\"work_gd_import-map_04-实践指南-浏览器兼容性处理.md\":\"0Y45D5mZ\",\"work_gd_import-map_readme.md\":\"D5vKAdo9\",\"work_gd_insmind工具_insmind ai工具完整指南.md\":\"BDpv6O0z\",\"work_gd_monorepo_01-核心概念_主干开发与最佳实践.md\":\"CX1i-ejB\",\"work_gd_monorepo_02-工作流设计_ci-cd工作流设计.md\":\"4ifppkj4\",\"work_gd_monorepo_03-实践指南_docker镜像构建指南.md\":\"Culh7Pmd\",\"work_gd_monorepo_monorepo超级大仓从0到1实战手册.md\":\"9TEM0SoJ\",\"work_gd_monorepo_monorepo超级大仓架构深度解析.md\":\"CBXtEoE9\",\"work_gd_monorepo_readme.md\":\"CH2j_9Ql\",\"work_gd_monorepo_rfc_ 大型 monorepo 中基于 changesets 的混合制品交付策略改进.md\":\"rg3-CDI4\",\"work_gd_npm_package-exports最佳实践.md\":\"DRi9fVXU\",\"work_gd_npm_package.json规范.md\":\"D8K2WQfk\",\"work_gd_npm_版本管理与发布.md\":\"B9JNlu-n\",\"work_gd_performance.md\":\"CCQFSgMF\",\"work_gd_sam_sam 前端图像分割深度解析.md\":\"CjohX4ae\",\"work_gd_sam_sam 深度解析：前端图像分割实践指南.md\":\"RSqEKiMZ\",\"work_gd_sam_sam主体选择深度解析.md\":\"CrXXR5vr\",\"work_gd_sam_主体选择功能完整流程与职责划分.md\":\"CHuMx-OX\",\"work_gd_seo_insmind-seo最佳实践.md\":\"Dkn-5WqT\",\"work_gd_seo_insmind-seo深度解析.md\":\"CsHULt2k\",\"work_gd_seo_insmind落地页实现深度解析.md\":\"txNu2QJ7\",\"work_gd_seo_seo基础认知与原理深度解析.md\":\"IIHBWWiq\",\"work_gd_skills_index.md\":\"6lvpIj6z\",\"work_gd_ssr_01-基础入门-前后端同构快速入门.md\":\"1V2lnEs-\",\"work_gd_ssr_02-核心机制-ssr场景下接口数据请求及水合机制.md\":\"DL5DhALU\",\"work_gd_ssr_03-核心机制-rfc-ssr场景下接口数据请求及水合机制更新.md\":\"DfrVTa32\",\"work_gd_ssr_04-实践指南-ssr接入文档.md\":\"CrZ-I1LC\",\"work_gd_ssr_05-鉴权-rfc16-ssr鉴权流程标准化提议.md\":\"y0YlJlec\",\"work_gd_ssr_09-ab实验-rfc12.1-ssr场景下的ab实验与缓存策略改进.md\":\"BqBySrIJ\",\"work_gd_ssr_10-ab实验-rfc12.2-ssr场景下的ab实验数据获取优化.md\":\"3nOEw1oY\",\"work_gd_ssr_11-ab实验-rfc12.3-提高ab缓存命中率.md\":\"DripFK7M\",\"work_gd_ssr_12-ab实验-rfc12.4-ab支持花瓣服务端.md\":\"D7lu8Zpi\",\"work_gd_ssr_readme.md\":\"C25NETJP\",\"work_gd_ssr_文档整理进度.md\":\"DZHtAxnr\",\"work_gd_业务介绍.md\":\"BBXt_fta\",\"work_gd_前端基础架构_cdn资源加载失败信息采集优化.md\":\"DLBrPm0q\",\"work_gd_前端基础架构_http缓存策略加速站点速度.md\":\"Mm76kvy3\",\"work_gd_前端基础架构_readme.md\":\"DSCtImTX\",\"work_gd_前端基础架构_widget系统设计.md\":\"DD7jxrXm\",\"work_gd_前端基础架构_前端可生长架构设计.md\":\"VH3QMmZw\",\"work_gd_前端基础架构_无阻塞的sls-sdk优化.md\":\"CCEfOxsk\",\"work_gd_前端基础架构_类early-hints页面离线能力.md\":\"gAmA_vOe\",\"work_gd_搜索推荐_01-搜索能力介绍.md\":\"CvWk0e1y\",\"work_gd_搜索推荐_02-推荐能力介绍.md\":\"B-W5FmR3\",\"work_gd_搜索推荐_03-稿定推荐能力介绍.md\":\"BvWwBnvV\",\"work_gd_搜索推荐_04-稿定搜索能力介绍.md\":\"BVhVFyst\",\"work_gd_搜索推荐_readme.md\":\"_STDpNjX\",\"work_gd_无限画布_05-无限画布渲染引擎.md\":\"MUCZfQbF\",\"work_gd_无限画布_editor-rendering-flow-analysis.md\":\"Bi93ee81\",\"work_gd_无限画布_infinite-renderer-architecture-analysis.md\":\"CDiJLaCr\",\"work_gd_稿定cicd_稿定前端ci-cd深度解析.md\":\"CaqnNkRa\",\"work_gd_端一体化_01-战略规划_端一体化战略规划.md\":\"ujTfp8jX\",\"work_gd_端一体化_02-design-tokens_01-概念与价值.md\":\"BIHmXLBi\",\"work_gd_端一体化_02-design-tokens_02-方案介绍.md\":\"LxUqWbl7\",\"work_gd_端一体化_02-design-tokens_03-定义规范.md\":\"DUfTk4Hx\",\"work_gd_端一体化_02-design-tokens_04-接入指南.md\":\"DKi6Z7xt\",\"work_gd_端一体化_readme.md\":\"DotPuuGC\",\"work_gd_编辑器架构_01-业务现状与基座化需求.md\":\"CCrfOYuX\",\"work_gd_编辑器架构_02-第一代基座方案实现.md\":\"CKa82BSW\",\"work_gd_编辑器架构_03-kernel-x架构详解.md\":\"C4_o1kwB\",\"work_gd_编辑器架构_04-架构演进总结.md\":\"B7uu04bO\",\"work_gd_计算机图像_ai replace智能选区深度解析.md\":\"CJA3OPvI\",\"work_gd_计算机图像_ai改图功能-主体选择-套索-画笔实现详解.md\":\"DCZUnoFR\",\"work_gd_计算机图像_从c__到wasm到javascript的完整流程详解.md\":\"CWL-SmsH\",\"work_gd_计算机图像_图片压缩.md\":\"Z8zwuI9U\",\"work_gd_计算机图像_图片格式转换.md\":\"BJHshzc7\",\"work_gd_计算机图像_套索工具实现原理详解.md\":\"BPtvgCrX\",\"work_gd_计算机图像_抠图与智能选区技术深度解析.md\":\"Dq1QNM7A\",\"work_gd_计算机图像_画笔工具实现原理详解.md\":\"D5U05d-z\",\"work_platform_ai-service.md\":\"Bk5sQv9K\",\"work_platform_video-architecture.md\":\"DRIUlPZT\",\"work_tmm_architecture.md\":\"hjj2ZaAk\",\"work_tmm_index.md\":\"CGYg72vr\",\"work_tmm_local_search.md\":\"B4MeDCBs\",\"work_tmm_mention.md\":\"CSCO0HfH\",\"work_tmm_partfileupload.md\":\"CCZCH_FJ\",\"work_tmm_performance_optimization.md\":\"CBe17jNF\",\"work_tmm_rbac.md\":\"Dmkoerf1\",\"work_tmm_resources_manner.md\":\"CIxkSF3-\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"林岑LynnCenʘᴗʘ \",\"description\":\"林岑的成长之路，包含前端常用知识、源码阅读笔记、各种奇淫技巧、日常提效工具等\",\"base\":\"/Lyc-notes/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"i18nRouting\":false,\"logo\":\"/LynnCenLogo.png\",\"nav\":[{\"text\":\"Frontend\",\"activeMatch\":\"/frontend/\",\"items\":[{\"text\":\"概览\",\"link\":\"/frontend/\"},{\"text\":\"框架\",\"items\":[{\"text\":\"React\",\"link\":\"/frontend/react/customHook/hooks\"},{\"text\":\"Vue\",\"link\":\"/frontend/vue/schudle\"}]},{\"text\":\"语言\",\"items\":[{\"text\":\"TypeScript\",\"link\":\"/frontend/typescript/记录\"},{\"text\":\"JavaScript\",\"link\":\"/frontend/javascript/Advance/executionContext\"}]},{\"text\":\"浏览器 & 工程化\",\"items\":[{\"text\":\"浏览器原理\",\"link\":\"/frontend/browser/Chrome架构\"},{\"text\":\"Webpack\",\"link\":\"/frontend/webpack/basic\"},{\"text\":\"Git\",\"link\":\"/frontend/git/basic\"}]}]},{\"text\":\"Graphics\",\"activeMatch\":\"/cv/\",\"items\":[{\"text\":\"概览\",\"link\":\"/cv/\"},{\"text\":\"理论基础\",\"items\":[{\"text\":\"图形学原理\",\"link\":\"/cv/计算机图形学原理/00-教学大纲与目录\"}]},{\"text\":\"渲染技术\",\"items\":[{\"text\":\"Canvas2D\",\"link\":\"/cv/Canvas2D基础/00-教学大纲与目录\"},{\"text\":\"WebGL\",\"link\":\"/cv/WebGL基础/00-教学大纲与目录\"},{\"text\":\"PixiJS\",\"link\":\"/cv/PixiJS实战/00-教学大纲与目录\"}]},{\"text\":\"应用实战\",\"items\":[{\"text\":\"无限画布\",\"link\":\"/cv/无限画布/00-教学大纲与目录\"}]}]},{\"text\":\"AI\",\"activeMatch\":\"/ai/\",\"items\":[{\"text\":\"概览\",\"link\":\"/ai/\"},{\"text\":\"AI 工程\",\"items\":[{\"text\":\"MCP 协议\",\"link\":\"/ai/mcp/browserTools\"},{\"text\":\"Dify 平台\",\"link\":\"/ai/Dify/\"},{\"text\":\"LLM 基础\",\"link\":\"/ai/posts/LLM\"}]},{\"text\":\"机器学习\",\"items\":[{\"text\":\"机器学习\",\"link\":\"/ai/机器学习/逻辑回归\"},{\"text\":\"深度学习\",\"link\":\"/ai/深度学习/卷积神经网络基础\"},{\"text\":\"SAM\",\"link\":\"/ai/sam/\"}]}]},{\"text\":\"CS Basics\",\"activeMatch\":\"/fundamentals/|/design-patterns/\",\"items\":[{\"text\":\"计算机基础\",\"items\":[{\"text\":\"数据结构\",\"link\":\"/fundamentals/data-structures/chapter1\"},{\"text\":\"操作系统\",\"link\":\"/fundamentals/operating-systems/chapter1\"},{\"text\":\"计算机网络\",\"link\":\"/fundamentals/computer-networks/chapter1\"},{\"text\":\"计算机组成\",\"link\":\"/fundamentals/computer-organization/chapter1\"}]},{\"text\":\"设计模式\",\"items\":[{\"text\":\"设计模式概览\",\"link\":\"/design-patterns/\"},{\"text\":\"408 真题\",\"link\":\"/fundamentals/exam-408/2009\"}]},{\"text\":\"算法\",\"items\":[{\"text\":\"LeetCode\",\"link\":\"/algorithms/leetcode\"},{\"text\":\"LRU 算法\",\"link\":\"/algorithms/LRU\"}]}]},{\"text\":\"Blog\",\"activeMatch\":\"/blog/\",\"link\":\"/blog/\"},{\"text\":\"More\",\"items\":[{\"text\":\"开源项目\",\"items\":[{\"text\":\"项目列表\",\"link\":\"/open-source/\"},{\"text\":\"GitLab MCP\",\"link\":\"https://github.com/LynnCen/gitlab-mcp\"},{\"text\":\"LynKit\",\"link\":\"https://lynncen.github.io/LynKit/\"}]},{\"text\":\"软考\",\"items\":[{\"text\":\"系统架构师\",\"link\":\"/software-exam/架构师/README\"},{\"text\":\"软件设计师\",\"link\":\"/software-exam/软件设计师/README\"}]},{\"text\":\"其他\",\"items\":[{\"text\":\"面试题库\",\"link\":\"/interview/js\"},{\"text\":\"工作文档\",\"link\":\"/work/gd/业务介绍\"},{\"text\":\"关于我\",\"link\":\"/about/about\"}]}]}],\"sidebar\":{\"/frontend/javascript/\":[{\"text\":\"JS引擎\",\"link\":\"frontend/javascript/Advance/execution\"},{\"text\":\"调用堆栈\",\"items\":[{\"text\":\"执行上下文和执行栈\",\"link\":\"frontend/javascript/Advance/executionContext\"},{\"text\":\"执行上下文栈和变量对象\",\"link\":\"frontend/javascript/Advance/executionStack\"}]}],\"/frontend/vue/\":[{\"text\":\"Vue学习规划\",\"link\":\"/frontend/vue/schudle\"},{\"text\":\"Vue基础\",\"items\":[{\"text\":\"响应式系统\",\"link\":\"/frontend/vue/basic/reactivity\"},{\"text\":\"模板语法与指令\",\"link\":\"/frontend/vue/basic/template\"},{\"text\":\"组件通信\",\"link\":\"/frontend/vue/basic/component-communication\"},{\"text\":\"Composition API\",\"link\":\"/frontend/vue/basic/composition-api\"}]},{\"text\":\"Vue进阶\",\"items\":[{\"text\":\"hooks\",\"link\":\"/frontend/vue/advanced/hooks\"},{\"text\":\"自定义指令\",\"link\":\"/frontend/vue/advanced/directive\"},{\"text\":\"动画\",\"link\":\"/frontend/vue/advanced/animation\"},{\"text\":\"性能优化\",\"link\":\"/frontend/vue/advanced/performance\"},{\"text\":\"项目架构设计\",\"link\":\"/frontend/vue/advanced/architecture\"}]},{\"text\":\"Vue 生态篇\",\"items\":[{\"text\":\"Vue Router\",\"link\":\"/frontend/vue/ecosystem/router\"},{\"text\":\"Pinia状态管理\",\"link\":\"/frontend/vue/ecosystem/pinia\"},{\"text\":\"构建工具\",\"link\":\"/frontend/vue/ecosystem/build\"},{\"text\":\"Vue Devtools\",\"link\":\"/frontend/vue/ecosystem/devtools\"},{\"text\":\"UI库\",\"link\":\"/frontend/vue/ecosystem/ui\"},{\"text\":\"测试\",\"link\":\"/frontend/vue/ecosystem/test\"}]},{\"text\":\"Vue原理\",\"items\":[{\"text\":\"深入响应式系统\",\"link\":\"/frontend/vue/principle/reactivity\"},{\"text\":\"编译器原理\",\"link\":\"/frontend/vue/principle/compiler\"}]}],\"/frontend/typescript/\":[{\"text\":\"TypeScript\",\"link\":\"/frontend/typescript/记录\"},{\"text\":\"TypeScript进阶\",\"link\":\"/frontend/typescript/advance\"},{\"text\":\"Class\",\"link\":\"/frontend/typescript/class\"}],\"/frontend/react/\":[{\"text\":\"React实践\",\"items\":[{\"text\":\"思考\",\"link\":\"/frontend/react/record/thinking\"},{\"text\":\"自定义Hooks\",\"link\":\"/frontend/react/customHook/hooks\"},{\"text\":\"React with TS\",\"link\":\"/frontend/react/utils/type\"}]}],\"/interview/\":[{\"text\":\"HTML\",\"link\":\"/interview/html\"},{\"text\":\"CSS\",\"link\":\"/interview/css\"},{\"text\":\"Javascript\",\"link\":\"/interview/js\"},{\"text\":\"React\",\"link\":\"/interview/react\"},{\"text\":\"Typescript\",\"link\":\"/interview/typescript\"},{\"text\":\"WebPack\",\"link\":\"/interview/webpack\"},{\"text\":\"浏览器\",\"link\":\"/interview/browser\"},{\"text\":\"网络\",\"link\":\"/interview/network\"},{\"text\":\"项目总结\",\"link\":\"/blog/work-experience/index\"},{\"text\":\"笔试题\",\"link\":\"/interview/coding\"}],\"/fundamentals/operating-systems/\":[{\"text\":\"操作系统基础\",\"items\":[{\"text\":\"第一章 操作系统引论\",\"link\":\"/fundamentals/operating-systems/chapter1\"},{\"text\":\"第二章 进程与线程\",\"link\":\"/fundamentals/operating-systems/chapter2\"},{\"text\":\"第三章 内存管理\",\"link\":\"/fundamentals/operating-systems/chapter3\"},{\"text\":\"第四章 文件管理\",\"link\":\"/fundamentals/operating-systems/chapter4\"},{\"text\":\"第五章 磁盘和固态硬盘\",\"link\":\"/fundamentals/operating-systems/chapter5\"},{\"text\":\"强化\",\"link\":\"/fundamentals/operating-systems/强化\"}]}],\"/fundamentals/exam-408/\":[{\"text\":\"2009真题\",\"link\":\"/fundamentals/exam-408/2009\"},{\"text\":\"2010真题\",\"link\":\"/fundamentals/exam-408/2010\"},{\"text\":\"2011真题\",\"link\":\"/fundamentals/exam-408/2011\"},{\"text\":\"2012真题\",\"link\":\"/fundamentals/exam-408/2012\"},{\"text\":\"2013真题\",\"link\":\"/fundamentals/exam-408/2013\"},{\"text\":\"2014真题\",\"link\":\"/fundamentals/exam-408/2014\"},{\"text\":\"2015真题\",\"link\":\"/fundamentals/exam-408/2015\"},{\"text\":\"2016真题\",\"link\":\"/fundamentals/exam-408/2016\"},{\"text\":\"2017真题\",\"link\":\"/fundamentals/exam-408/2017\"},{\"text\":\"2018真题\",\"link\":\"/fundamentals/exam-408/2018\"},{\"text\":\"2019真题\",\"link\":\"/fundamentals/exam-408/2019\"}],\"/fundamentals/computer-networks/\":[{\"text\":\"计算机网络基础\",\"items\":[{\"text\":\"第一章 计算机网络体系结构\",\"link\":\"/fundamentals/computer-networks/chapter1\"},{\"text\":\"第二章 物理层\",\"link\":\"/fundamentals/computer-networks/chapter2\"},{\"text\":\"第三章 数据链路层\",\"link\":\"/fundamentals/computer-networks/chapter3\"}]},{\"text\":\"HTTPS\",\"link\":\"/fundamentals/computer-networks/https\"},{\"text\":\"WebSocket\",\"link\":\"/fundamentals/computer-networks/webSocket\"},{\"text\":\"强化\",\"link\":\"/fundamentals/computer-networks/强化\"}],\"/fundamentals/data-structures/\":[{\"text\":\"数据结构\",\"items\":[{\"text\":\"第一章 绪论\",\"link\":\"/fundamentals/data-structures/chapter1\"},{\"text\":\"第二章 线性表\",\"link\":\"/fundamentals/data-structures/chapter2\"},{\"text\":\"第三章 栈、队列和数组\",\"link\":\"/fundamentals/data-structures/chapter3\"},{\"text\":\"第四章 串\",\"link\":\"/fundamentals/data-structures/chapter4\"},{\"text\":\"第五章 树与二叉树\",\"link\":\"/fundamentals/data-structures/chapter5\"},{\"text\":\"第六章 图\",\"link\":\"/fundamentals/data-structures/chapter6\"},{\"text\":\"第七章 查找\",\"link\":\"/fundamentals/data-structures/chapter7\"},{\"text\":\"第八章 排序\",\"link\":\"/fundamentals/data-structures/chapter8\"}]},{\"text\":\"课后习题\",\"items\":[{\"text\":\"第一章 绪论\",\"link\":\"/fundamentals/data-structures/chapter1_ex\"},{\"text\":\"第二章 线性表\",\"link\":\"/fundamentals/data-structures/chapter2_ex\"},{\"text\":\"强化\",\"link\":\"/fundamentals/data-structures/强化\"}]}],\"/fundamentals/computer-organization/\":[{\"text\":\"计算机组成原理\",\"items\":[{\"text\":\"第一章 计算机系统概述\",\"link\":\"/fundamentals/computer-organization/chapter1\"},{\"text\":\"第二章 数据的表示和运算\",\"link\":\"/fundamentals/computer-organization/chapter2\"},{\"text\":\"第三章 存储系统\",\"link\":\"/fundamentals/computer-organization/chapter3\"},{\"text\":\"第四章 指令系统\",\"link\":\"/fundamentals/computer-organization/chapter4\"},{\"text\":\"第五章 中央处理器\",\"link\":\"/fundamentals/computer-organization/chapter5\"},{\"text\":\"第六章 总线\",\"link\":\"/fundamentals/computer-organization/chapter6\"},{\"text\":\"第七章 输入/输出系统\",\"link\":\"/fundamentals/computer-organization/chapter7\"},{\"text\":\"强化\",\"link\":\"/fundamentals/computer-organization/强化\"}]}],\"/frontend/webpack/\":[{\"text\":\"WebPack\",\"items\":[{\"text\":\"基础篇\",\"link\":\"/frontend/webpack/basic\"},{\"text\":\"实战篇\",\"link\":\"/frontend/webpack/practice\"},{\"text\":\"优化篇\",\"link\":\"/frontend/webpack/optimization\"},{\"text\":\"原理篇\",\"link\":\"/frontend/webpack/principle\"},{\"text\":\"性能优化\",\"link\":\"/frontend/webpack/performance\"}]}],\"/frontend/browser/\":[{\"text\":\"宏观视角下的浏览器\",\"items\":[{\"text\":\"Chorme架构\",\"link\":\"/frontend/browser/Chrome架构\"},{\"text\":\"TCP协议\",\"link\":\"/frontend/browser/TCP协议\"},{\"text\":\"HTTP协议\",\"link\":\"/frontend/browser/HTTP\"},{\"text\":\"导航流程\",\"link\":\"/frontend/browser/导航流程\"},{\"text\":\"渲染流程（上）\",\"link\":\"/frontend/browser/renderfirst\"},{\"text\":\"渲染流程（下）\",\"link\":\"/frontend/browser/rendersec\"}]},{\"text\":\"Javascript中的执行机制\",\"items\":[{\"text\":\"变量提升\",\"link\":\"/frontend/browser/变量提升\"},{\"text\":\"调用栈\",\"link\":\"/frontend/browser/调用栈\"},{\"text\":\"块级作用域\",\"link\":\"/frontend/browser/块级作用域\"},{\"text\":\"作用域链和闭包\",\"link\":\"/frontend/browser/作用域链和闭包\"},{\"text\":\"This\",\"link\":\"/frontend/browser/this\"}]},{\"text\":\"V8工作原理\",\"items\":[{\"text\":\"栈空间和堆空间\",\"link\":\"/frontend/browser/栈和堆\"},{\"text\":\"垃圾回收\",\"link\":\"/frontend/browser/垃圾回收\"},{\"text\":\"编译器和解释器\",\"link\":\"/frontend/browser/编译器和解释器\"}]},{\"text\":\"浏览器中的页面循环系统\",\"items\":[{\"text\":\"消息队列和事件循环\",\"link\":\"/frontend/browser/消息队列和事件循环\"},{\"text\":\"setTimeout 是如何实现的？\",\"link\":\"/frontend/browser/setTimeout如何实现\"},{\"text\":\"XMLHttpRequest 是怎么实现的？\",\"link\":\"/frontend/browser/XMLHttpRequest\"},{\"text\":\"宏任务和微任务\",\"link\":\"/frontend/browser/宏任务和微任务\"},{\"text\":\"Promise\",\"link\":\"/frontend/browser/Promise\"},{\"text\":\"async/await\",\"link\":\"/frontend/browser/async&await\"}]},{\"text\":\"浏览器中的页面\",\"items\":[{\"text\":\"Chrome开发者工具\",\"link\":\"/frontend/browser/Chrome开发者工具\"},{\"text\":\"DOM树\",\"link\":\"/frontend/browser/DOM树\"},{\"text\":\"渲染流水线\",\"link\":\"/frontend/browser/渲染流水线\"},{\"text\":\"分层和合成机制\",\"link\":\"/frontend/browser/分层和合成\"},{\"text\":\"页面性能\",\"link\":\"/frontend/browser/页面性能\"},{\"text\":\"虚拟DOM\",\"link\":\"/frontend/browser/虚拟DOM\"},{\"text\":\"渐进式网页应用PWA\",\"link\":\"/frontend/browser/渐进式网页应用PWA\"}]},{\"text\":\"浏览器中的网络\",\"items\":[{\"text\":\"HTTP1\",\"link\":\"/frontend/browser/HTTP1\"},{\"text\":\"HTTP2\",\"link\":\"/frontend/browser/HTTP2\"},{\"text\":\"HTTP3\",\"link\":\"/frontend/browser/HTTP3\"}]},{\"text\":\"浏览器安全\",\"items\":[{\"text\":\"同源策略\",\"link\":\"/frontend/browser/同源策略\"},{\"text\":\"跨站脚本攻击XSS\",\"link\":\"/frontend/browser/跨站脚本攻击XSS\"},{\"text\":\"CSRF攻击\",\"link\":\"/frontend/browser/CSRF攻击\"},{\"text\":\"安全沙箱\",\"link\":\"/frontend/browser/安全沙箱\"},{\"text\":\"HTTPS\",\"link\":\"/frontend/browser/HTTPS\"}]},{\"text\":\"浏览上下文组\",\"link\":\"/frontend/browser/浏览上下文组\"},{\"text\":\"任务调度\",\"link\":\"/frontend/browser/任务调度\"},{\"text\":\"加载阶段性能\",\"link\":\"/frontend/browser/加载阶段性能\"},{\"text\":\"Performance\",\"link\":\"/frontend/browser/Performance\"},{\"text\":\"Performance中的Main指标\",\"link\":\"/frontend/browser/Performance中的Main指标\"}],\"/blog/work-experience/\":[{\"text\":\"项目总结\",\"link\":\"/blog/work-experience/index\"},{\"text\":\"TMM\",\"link\":\"/blog/work-experience/tmm\",\"items\":[{\"text\":\"TMM模块重构与架构设计\",\"link\":\"/blog/work-experience/tmm/architecture\"},{\"text\":\"本地化搜索引擎实现\",\"link\":\"/blog/work-experience/tmm/local_search\"},{\"text\":\"@功能的高效实现\",\"link\":\"/blog/work-experience/tmm/mention\"},{\"text\":\"ELectron大文件分片上传、断点续传、并行上传\",\"link\":\"/blog/work-experience/tmm/partFileUpload\"},{\"text\":\"TMM性能优化\",\"link\":\"/blog/work-experience/tmm/performance_optimization\"},{\"text\":\"基于RBAC模型的群组权限体系设计与实现\",\"link\":\"/blog/work-experience/tmm/RBAC\"},{\"text\":\"基于AWS和Node流式大文件下载\",\"link\":\"/blog/work-experience/tmm/resources_manner\"}]}],\"/fundamentals/algorithms/\":[{\"text\":\"退避算法\",\"link\":\"/fundamentals/algorithms/退避算法\"},{\"text\":\"LRU算法\",\"link\":\"/fundamentals/algorithms/LRU\"}],\"/certifications/software-exam/\":[{\"text\":\"软考-软件设计师\",\"link\":\"/certifications/software-exam/软件设计师/index\"},{\"text\":\"软考-系统架构设计师\",\"link\":\"/certifications/software-exam/架构师/01绪论\"},{\"text\":\"时间规划\",\"link\":\"/certifications/software-exam/软件设计师/schedule\"},{\"text\":\"软件工程\",\"link\":\"/certifications/software-exam/softExam/softwareEngineering\"},{\"text\":\"面向对象\",\"link\":\"/certifications/software-exam/面向对象\"},{\"text\":\"数据库\",\"link\":\"/certifications/software-exam/database\"},{}],\"/ai/mcp/\":[{\"text\":\"MCP 协议\",\"items\":[{\"text\":\"← 返回 AI 模块\",\"link\":\"/ai/\"},{\"text\":\"BrowserTools MCP\",\"link\":\"/ai/mcp/browserTools\"},{\"text\":\"Cursor MCP\",\"link\":\"/ai/mcp/cursor-mcp\"},{\"text\":\"Figma MCP\",\"link\":\"/ai/mcp/figma\"}]}],\"/ai/Dify/\":[{\"text\":\"Dify 平台\",\"items\":[{\"text\":\"← 返回 AI 模块\",\"link\":\"/ai/\"},{\"text\":\"Dify 介绍\",\"link\":\"/ai/Dify/index\"}]}],\"/ai/sam/\":[{\"text\":\"SAM 图像分割\",\"items\":[{\"text\":\"← 返回 AI 模块\",\"link\":\"/ai/\"},{\"text\":\"SAM 概述\",\"link\":\"/ai/sam/\"},{\"text\":\"SAM 主体选择深度解析\",\"link\":\"/ai/sam/SAM主体选择深度解析\"}]}],\"/ai/机器学习/\":[{\"text\":\"机器学习\",\"items\":[{\"text\":\"← 返回 AI 模块\",\"link\":\"/ai/\"},{\"text\":\"逻辑回归\",\"link\":\"/ai/机器学习/逻辑回归\"},{\"text\":\"其他机器学习方法\",\"link\":\"/ai/机器学习/其他机器学习方法\"}]}],\"/ai/深度学习/\":[{\"text\":\"深度学习\",\"items\":[{\"text\":\"← 返回 AI 模块\",\"link\":\"/ai/\"},{\"text\":\"卷积神经网络基础\",\"link\":\"/ai/深度学习/卷积神经网络基础\"}]}],\"/ai/posts/\":[{\"text\":\"LLM 基础\",\"items\":[{\"text\":\"← 返回 AI 模块\",\"link\":\"/ai/\"},{\"text\":\"AI 基础\",\"link\":\"/ai/posts/ai\"},{\"text\":\"LLM 概述\",\"link\":\"/ai/posts/LLM\"}]}],\"/frontend/design-patterns/\":[{\"text\":\"设计模式\",\"link\":\"/frontend/design-patterns/index\"},{\"text\":\"模版方法\",\"link\":\"/frontend/design-patterns/模版方法\"}],\"/cv/计算机图形学原理/\":[{\"text\":\"计算机图形学原理\",\"items\":[{\"text\":\"← 返回图形模块\",\"link\":\"/cv/\"},{\"text\":\"教学大纲\",\"link\":\"/cv/计算机图形学原理/00-教学大纲与目录\"},{\"text\":\"图形学概述\",\"link\":\"/cv/计算机图形学原理/01-图形学概述\"},{\"text\":\"向量与线性代数\",\"link\":\"/cv/计算机图形学原理/02-向量与线性代数基础\"},{\"text\":\"矩阵与变换\",\"link\":\"/cv/计算机图形学原理/03-矩阵与变换\"},{\"text\":\"齐次坐标与投影\",\"link\":\"/cv/计算机图形学原理/04-齐次坐标与投影\"},{\"text\":\"2D 图形绘制算法\",\"link\":\"/cv/计算机图形学原理/05-2D图形绘制算法\"},{\"text\":\"曲线与曲面\",\"link\":\"/cv/计算机图形学原理/06-曲线与曲面\"},{\"text\":\"几何建模基础\",\"link\":\"/cv/计算机图形学原理/07-几何建模基础\"},{\"text\":\"可见性与遮挡\",\"link\":\"/cv/计算机图形学原理/08-可见性与遮挡\"},{\"text\":\"光照与着色模型\",\"link\":\"/cv/计算机图形学原理/09-光照与着色模型\"},{\"text\":\"纹理映射\",\"link\":\"/cv/计算机图形学原理/10-纹理映射\"},{\"text\":\"碰撞检测算法\",\"link\":\"/cv/计算机图形学原理/11-碰撞检测算法\"},{\"text\":\"空间索引与加速\",\"link\":\"/cv/计算机图形学原理/12-空间索引与加速结构\"},{\"text\":\"图像处理基础\",\"link\":\"/cv/计算机图形学原理/13-图像处理基础\"},{\"text\":\"颜色科学\",\"link\":\"/cv/计算机图形学原理/14-颜色科学\"},{\"text\":\"前沿技术\",\"link\":\"/cv/计算机图形学原理/15-前沿技术与发展方向\"}]}],\"/cv/Canvas2D基础/\":[{\"text\":\"Canvas2D 基础\",\"items\":[{\"text\":\"← 返回图形模块\",\"link\":\"/cv/\"},{\"text\":\"教学大纲\",\"link\":\"/cv/Canvas2D基础/00-教学大纲与目录\"},{\"text\":\"Canvas 元素与环境\",\"link\":\"/cv/Canvas2D基础/01-Canvas元素与绑制环境\"},{\"text\":\"基础图形绑制\",\"link\":\"/cv/Canvas2D基础/02-基础图形绑制\"},{\"text\":\"路径与贝塞尔曲线\",\"link\":\"/cv/Canvas2D基础/03-路径与贝塞尔曲线\"},{\"text\":\"样式与颜色系统\",\"link\":\"/cv/Canvas2D基础/04-样式与颜色系统\"},{\"text\":\"变换与坐标系统\",\"link\":\"/cv/Canvas2D基础/05-变换与坐标系统\"},{\"text\":\"图像与像素操作\",\"link\":\"/cv/Canvas2D基础/06-图像与像素操作\"},{\"text\":\"合成与混合模式\",\"link\":\"/cv/Canvas2D基础/07-合成与混合模式\"},{\"text\":\"文本渲染\",\"link\":\"/cv/Canvas2D基础/08-文本渲染\"},{\"text\":\"动画与帧循环\",\"link\":\"/cv/Canvas2D基础/09-动画与帧循环\"},{\"text\":\"离屏渲染与优化\",\"link\":\"/cv/Canvas2D基础/10-离屏渲染与性能优化\"},{\"text\":\"实战案例\",\"link\":\"/cv/Canvas2D基础/11-实战案例与最佳实践\"}]}],\"/cv/WebGL基础/\":[{\"text\":\"WebGL 基础\",\"items\":[{\"text\":\"← 返回图形模块\",\"link\":\"/cv/\"},{\"text\":\"教学大纲\",\"link\":\"/cv/WebGL基础/00-教学大纲与目录\"},{\"text\":\"WebGL 概述与搭建\",\"link\":\"/cv/WebGL基础/01-WebGL概述与环境搭建\"},{\"text\":\"渲染管线详解\",\"link\":\"/cv/WebGL基础/02-渲染管线详解\"},{\"text\":\"着色器与 GLSL\",\"link\":\"/cv/WebGL基础/03-着色器与GLSL\"},{\"text\":\"缓冲区与顶点数据\",\"link\":\"/cv/WebGL基础/04-缓冲区与顶点数据\"},{\"text\":\"纹理与采样\",\"link\":\"/cv/WebGL基础/05-纹理与采样\"},{\"text\":\"矩阵变换与相机\",\"link\":\"/cv/WebGL基础/06-矩阵变换与相机\"},{\"text\":\"光照与材质\",\"link\":\"/cv/WebGL基础/07-光照与材质\"},{\"text\":\"帧缓冲与离屏\",\"link\":\"/cv/WebGL基础/08-帧缓冲与离屏渲染\"},{\"text\":\"混合与深度测试\",\"link\":\"/cv/WebGL基础/09-混合与深度测试\"},{\"text\":\"WebGL2 新特性\",\"link\":\"/cv/WebGL基础/10-WebGL2新特性\"},{\"text\":\"性能优化与调试\",\"link\":\"/cv/WebGL基础/11-性能优化与调试\"},{\"text\":\"实战案例集\",\"link\":\"/cv/WebGL基础/12-实战案例集\"}]}],\"/cv/PixiJS实战/\":[{\"text\":\"PixiJS 实战\",\"items\":[{\"text\":\"← 返回图形模块\",\"link\":\"/cv/\"},{\"text\":\"教学大纲\",\"link\":\"/cv/PixiJS实战/00-教学大纲与目录\"},{\"text\":\"快速入门\",\"link\":\"/cv/PixiJS实战/01-PixiJS概述与快速入门\"},{\"text\":\"Application 与渲染器\",\"link\":\"/cv/PixiJS实战/02-Application与渲染器\"},{\"text\":\"显示对象体系\",\"link\":\"/cv/PixiJS实战/03-显示对象体系\"},{\"text\":\"Container 与场景图\",\"link\":\"/cv/PixiJS实战/04-Container容器与场景图\"},{\"text\":\"Sprite 与纹理\",\"link\":\"/cv/PixiJS实战/05-Sprite精灵与纹理\"},{\"text\":\"Graphics 图形\",\"link\":\"/cv/PixiJS实战/06-Graphics图形绘制\"},{\"text\":\"Text 文本\",\"link\":\"/cv/PixiJS实战/07-Text文本渲染\"},{\"text\":\"Transform 变换\",\"link\":\"/cv/PixiJS实战/08-Transform变换系统\"},{\"text\":\"交互与事件\",\"link\":\"/cv/PixiJS实战/09-交互与事件系统\"},{\"text\":\"资源加载\",\"link\":\"/cv/PixiJS实战/10-纹理管理与资源加载\"},{\"text\":\"滤镜与特效\",\"link\":\"/cv/PixiJS实战/11-滤镜与特效\"},{\"text\":\"遮罩与混合\",\"link\":\"/cv/PixiJS实战/12-遮罩与混合模式\"},{\"text\":\"Ticker 与动画\",\"link\":\"/cv/PixiJS实战/13-Ticker与动画\"},{\"text\":\"性能优化\",\"link\":\"/cv/PixiJS实战/14-性能优化实践\"},{\"text\":\"高级特性\",\"link\":\"/cv/PixiJS实战/15-高级特性与扩展\"}]}],\"/cv/无限画布/\":[{\"text\":\"无限画布\",\"items\":[{\"text\":\"← 返回图形模块\",\"link\":\"/cv/\"},{\"text\":\"教学大纲\",\"link\":\"/cv/无限画布/00-教学大纲与目录\"},{\"text\":\"代码路径与模块\",\"link\":\"/cv/无限画布/01-代码路径与模块映射\"},{\"text\":\"基础概念与选型\",\"link\":\"/cv/无限画布/02-基础概念与技术选型\"},{\"text\":\"坐标系统与变换\",\"link\":\"/cv/无限画布/03-坐标系统与矩阵变换\"},{\"text\":\"Viewport 视口\",\"link\":\"/cv/无限画布/04-Viewport视口管理\"},{\"text\":\"VmEngine 引擎\",\"link\":\"/cv/无限画布/05-VmEngine视图模型引擎\"},{\"text\":\"元素生命周期\",\"link\":\"/cv/无限画布/06-元素生命周期与渲染\"},{\"text\":\"事件与碰撞检测\",\"link\":\"/cv/无限画布/07-事件系统与碰撞检测\"},{\"text\":\"手势与交互\",\"link\":\"/cv/无限画布/08-手势与交互处理\"},{\"text\":\"插件系统\",\"link\":\"/cv/无限画布/09-插件系统架构\"},{\"text\":\"性能优化\",\"link\":\"/cv/无限画布/10-性能优化策略\"},{\"text\":\"导出与截图\",\"link\":\"/cv/无限画布/11-导出与截图\"},{\"text\":\"总结与实践\",\"link\":\"/cv/无限画布/12-总结与最佳实践\"}]}]},\"search\":{\"provider\":\"local\"},\"outline\":{\"level\":\"deep\",\"label\":\"本页目录\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/LynnCen\"}],\"footer\":{\"message\":\"如有转载或 CV 的请标注本站原文地址\",\"copyright\":\"Copyright © 2024-present LynnCen\"},\"darkModeSwitchLabel\":\"外观\",\"returnToTopLabel\":\"返回顶部\",\"lastUpdatedText\":\"上次更新\",\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"visitor\":{\"badgeId\":\"LynnCen.Lyc-notes\"},\"comment\":{\"repo\":\"LynnCen/Lyc-notes\",\"repoId\":\"R_kgDOLsOwUg\",\"category\":\"Announcements\",\"categoryId\":\"DIC_kwDOLsOwUs4CenzY\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>